"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SanData = void 0;
/**
 * SSR 期间的 Data 实现，替代 import('san').SanData
 *
 * * 不涉及视图更新
 * * 便于编译期优化
 */
class SanData {
    constructor(data, computed = {}) {
        this.data = data;
        this.computed = computed;
    }
    get(path) {
        if (arguments.length === 0)
            return this.data;
        if (this.computed[path])
            return this.computed[path].call({ data: this });
        return this.parseExpr(path).reduce((val, name) => val == null ? val : val[name], this.data);
    }
    set(path, value) {
        const seq = this.parseExpr(path);
        let parent = this.data;
        for (let i = 0; i < seq.length - 1; i++) {
            const name = seq[i];
            if (parent[name]) {
                parent = parent[name];
            }
            else {
                return null;
            }
        }
        parent[seq.pop()] = value;
        return value;
    }
    removeAt(path, index) {
        const value = this.get(path);
        if (value && value.splice)
            value.splice(index, 1);
    }
    parseExpr(expr) {
        return expr.split('.');
    }
}
exports.SanData = SanData;
//# sourceMappingURL=san-data.js.map