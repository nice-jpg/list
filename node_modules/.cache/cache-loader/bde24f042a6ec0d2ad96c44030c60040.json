{"remainingRequest":"/Users/a2012/Desktop/list/node_modules/babel-loader/lib/index.js??ref--1-2!/Users/a2012/Desktop/list/node_modules/@baidu/boxx/dist/boxx.esm.js","dependencies":[{"path":"/Users/a2012/Desktop/list/node_modules/@baidu/boxx/dist/boxx.esm.js","mtime":1696919503000},{"path":"/Users/a2012/Desktop/list/node_modules/san-hot-loader/index.js","mtime":1696919525000},{"path":"/Users/a2012/Desktop/list/node_modules/cache-loader/dist/cjs.js","mtime":1696919513000},{"path":"/Users/a2012/Desktop/list/node_modules/babel-loader/lib/index.js","mtime":1696919524000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCIvVXNlcnMvYTIwMTIvRGVza3RvcC9saXN0L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlRGVmYXVsdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pdGVyYXRvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJldmVyc2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvbWUiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmFzc2lnbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5mcmVlemUiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5wcm9taXNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5pbW1lZGlhdGUiKTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwoKdmFyIF90eXBlb2YyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCIvVXNlcnMvYTIwMTIvRGVza3RvcC9saXN0L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZiIpKTsKCi8qKgogKiBib3h4LmpzIAogKiB2My4wLjY5CiAqLwp2YXIgQURBUFRWRVJTSU9OID0gewogIGxpdGU6IHsKICAgICI1LjI0LjAuMCI6IHsKICAgICAgYW5kcm9pZDogIjEzLjIuMC4wIiwKICAgICAgaW9zOiAiMTMuMi4xLjAiCiAgICB9LAogICAgIjUuMjEuMC4wIjogewogICAgICBhbmRyb2lkOiAiMTIuMjguMC4wIiwKICAgICAgaW9zOiAiMTIuMjguMi4wIgogICAgfSwKICAgICI1LjE1LjAuMCI6IHsKICAgICAgYW5kcm9pZDogIjEyLjIxLjAuMCIsCiAgICAgIGlvczogIjEyLjIxLjAuMCIKICAgIH0sCiAgICAiNS42LjAuMCI6IHsKICAgICAgYW5kcm9pZDogIjEyLjEzLjAuMCIsCiAgICAgIGlvczogIjEyLjEzLjAuMCIKICAgIH0sCiAgICAiNS4wLjAuMCI6IHsKICAgICAgYW5kcm9pZDogIjEyLjEuMC4wIiwKICAgICAgaW9zOiAiMTIuMS4wLjAiCiAgICB9LAogICAgIjQuMjEuMC4wIjogewogICAgICBhbmRyb2lkOiAiMTEuMjQuMC4wIiwKICAgICAgaW9zOiAiMTEuMjQuMC4wIgogICAgfSwKICAgICI0LjE3LjAuMCI6IHsKICAgICAgYW5kcm9pZDogIjExLjIyLjAuMCIsCiAgICAgIGlvczogIjExLjIyLjAuMCIKICAgIH0KICB9LAogIHRvbWFzOiB7CiAgICAiMS4xMy4wLjAiOiB7CiAgICAgIGFuZHJvaWQ6ICIxMi4xOS4wLjAiLAogICAgICBpb3M6ICIxMi4xOS4wLjAiCiAgICB9LAogICAgIjEuMC4wLjAiOiB7CiAgICAgIGFuZHJvaWQ6ICIxMi4xLjAuMCIsCiAgICAgIGlvczogIjEyLjEuMC4wIgogICAgfQogIH0sCiAgYmFpZHVib3h2aXNpb246IHsKICAgICIyLjAuMC4wIjogewogICAgICBhbmRyb2lkOiAiMTIuMTUuMC4wIiwKICAgICAgaW9zOiAiMTIuMTUuMC4wIgogICAgfSwKICAgICIxLjAuMC4wIjogewogICAgICBhbmRyb2lkOiAiMTEuMjUuOS4xMCIsCiAgICAgIGlvczogIjExLjI1LjUuMTUiCiAgICB9CiAgfSwKICBiYWlkdWJveHNlbmlvcjogewogICAgIjEuMC4wLjAiOiB7CiAgICAgIGFuZHJvaWQ6ICIxMi4xLjAuMCIsCiAgICAgIGlvczogIjEyLjEuMC4wIgogICAgfQogIH0sCiAga25ld3M6IHsKICAgICIyLjAuMC4wIjogewogICAgICBhbmRyb2lkOiAiMTIuMTMuMC4wIiwKICAgICAgaW9zOiAiMTIuMTMuMC4wIgogICAgfQogIH0KfTsKLyoqCiAqIEBmaWxlICDojrflj5blhajlsYDlr7nosaEKICogQGF1dGhvciB6aG91ZGFuMDMKICogQGRhdGUgMjAxOS84LzYKICogQGRlc2NyaXB0aW9uIOiOt+WPluW9k+WJjeeOr+Wig+eahOWFqOWxgOWvueixoSwgQHRvZG8g5pyJ5b+F6KaB6L+Z5LmI5Yik5pat5LmI77yfCiAqLwoKLyogZ2xvYmFsIGdsb2JhbFRoaXMgKi8KCnZhciBnbG9iYWwkMSA9Ci8qIGVzbGludC1kaXNhYmxlIG5vLW5lZ2F0ZWQtY29uZGl0aW9uICovCnR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlLWJlZm9yZS1kZWZpbmUKOiB0eXBlb2YgZ2xvYmFsJDEgIT09ICd1bmRlZmluZWQnIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11c2UtYmVmb3JlLWRlZmluZQo/IGdsb2JhbCQxIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwovKiBlc2xpbnQtZW5hYmxlIG5vLW5lZ2F0ZWQtY29uZGl0aW9uICovCgovKioKICogQGZpbGU6IGRlYnVnLmpzCiAqIEBkZXNjcmlwdGlvbiDlvIDlj5Hnjq/looPovpPlh7rml6Xlv5fkv6Hmga/vvIzkvr/kuo7osIPor5UKICovCgp2YXIgZGVidWdJbnN0YW5jZSA9IG51bGw7CnZhciBtZXNzYWdlTGlzdCA9IFtdOwoKZnVuY3Rpb24gc2V0RGVidWcoZGVidWcpIHsKICBkZWJ1Z0luc3RhbmNlID0gZGVidWc7CiAgbWVzc2FnZUxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgZGVidWdJbnN0YW5jZS5hcHBseSh2b2lkIDAsIGl0ZW0pOwogIH0pOwogIG1lc3NhZ2VMaXN0ID0gW107Cn0KCmZ1bmN0aW9uIGRlYnVnKCkgewogIHZhciBhcmdzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CgogIHdoaWxlIChsZW4tLSkgewogICAgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbl07CiAgfQoKICBpZiAoIWRlYnVnSW5zdGFuY2UpIHsKICAgIG1lc3NhZ2VMaXN0LnB1c2goYXJncyk7CiAgICByZXR1cm47CiAgfQoKICBkZWJ1Z0luc3RhbmNlLmFwcGx5KHZvaWQgMCwgYXJncyk7Cn0KLyoqCiAqIEBmaWxlICDnjq/looPliKTmlq3nmoTlj5jph4/lj4rlh73mlbAKICogQGF1dGhvciB6aG91ZGFuMDMKICogQGRhdGUgMjAxOS84LzE1CiAqLwovLyDnn6npmLXkuqflk4HnmoTnq6/og73lipvpgILphY3vvIznq6/lj5HniYjlr7npvZDmlrDnmoTkuLvnur/niYjmnKzml7bvvIzov5nph4zpnIDopoHmlrDlop4KLy8g55+p6Zi15pig5bCE6KGo77yaaHR0cDovL3dpa2kuYmFpZHUuY29tL3BhZ2VzL3ZpZXdwYWdlLmFjdGlvbj9wYWdlSWQ9MTY0OTk3NzIzOAovLyBBREFQVFZFUlNJT04g5pWw5o2u5aaC6ZyA6KaB5pu05paw77yM5omn6KGMbnBtIHJ1biB1cGRhdGVBZGFwdGVJbmZvCi8vIOihqOekuuaXoOept+Wkp+eahOeJiOacrAoKCnZhciBJTkZJTklUWVZFUlNJT04gPSAnOTk5OTknOwovKioKICog5q+U6L6D5Lik5Liq5Y+C5pWw54mI5pys5aSn5bCPCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSB2ZXJzaW9uMSB2MQogKiBAcGFyYW0ge3N0cmluZ30gdmVyc2lvbjIgdjIKICogQHJldHVybiB7bnVtYmVyfSAxIHYxID4gdjIgOyAtMSB2MSA8IHYyIDsgMCB2MSA9IHYyCiAqLwoKZnVuY3Rpb24gdmVyc2lvbkNvbXBhcmUodmVyc2lvbjEsIHZlcnNpb24yKSB7CiAgaWYgKHZlcnNpb24xID09PSB2ZXJzaW9uMikgewogICAgcmV0dXJuIDA7CiAgfQoKICBmdW5jdGlvbiB0b051bWJlcihpdGVtKSB7CiAgICBpZiAoISgraXRlbSA+PSAwKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ+S8oOmAkuS6humdnuazleeJiOacrOWPtzo6ICcgKyBpdGVtKTsKICAgIH0KCiAgICByZXR1cm4gK2l0ZW07CiAgfQoKICB2YXIgdmVyc2lvbkFycmF5MSA9ICgnJyArIHZlcnNpb24xKS5zcGxpdCgnLicpLm1hcCh0b051bWJlcik7CiAgdmFyIHZlcnNpb25BcnJheTIgPSAoJycgKyB2ZXJzaW9uMikuc3BsaXQoJy4nKS5tYXAodG9OdW1iZXIpOwogIHZhciBpID0gMDsKICB2YXIgbGVuID0gTWF0aC5tYXgodmVyc2lvbkFycmF5MS5sZW5ndGgsIHZlcnNpb25BcnJheTIubGVuZ3RoKTsKCiAgZm9yICg7IGkgPCBsZW47IGkrKykgewogICAgaWYgKHZlcnNpb25BcnJheTFbaV0gPiB2ZXJzaW9uQXJyYXkyW2ldIHx8IHZlcnNpb25BcnJheTFbaV0gJiYgIXZlcnNpb25BcnJheTJbaV0gJiYgdmVyc2lvbkFycmF5MVtpXSA+IDApIHsKICAgICAgcmV0dXJuIDE7CiAgICB9IGVsc2UgaWYgKHZlcnNpb25BcnJheTFbaV0gPCB2ZXJzaW9uQXJyYXkyW2ldIHx8IHZlcnNpb25BcnJheTJbaV0gJiYgIXZlcnNpb25BcnJheTFbaV0gJiYgdmVyc2lvbkFycmF5MltpXSA+IDApIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogIH0KCiAgcmV0dXJuIDA7Cn0KCnZhciBpbkJyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJzsKdmFyIFVBID0gaW5Ccm93c2VyICYmIHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7Ci8qKgogKiDojrflj5ZpT1MvQW5kcm9pZOaTjeS9nOezu+e7n+eJiOacrOWPtwogKgogKiBAcmV0dXJuIHtudW1iZXJ9CiAqLwoKZnVuY3Rpb24gZ2V0T1NWZXJzaW9uKG9wdGlvbnMpIHsKICB2YXIgVUEgPSBvcHRpb25zLlVBOwogIHZhciBpc0lPUyA9IG9wdGlvbnMuaXNJT1M7CiAgdmFyIGlzQW5kcm9pZCA9IG9wdGlvbnMuaXNBbmRyb2lkOwogIHZhciByZXN1bHQgPSAwOwoKICBpZiAoaXNBbmRyb2lkKSB7CiAgICB2YXIgYW5kcm9pZE1hdGNoID0gVUEubWF0Y2goLyhhbmRyb2lkKTs/XHMrKFtcZC5dKyk/Lyk7IC8vIOS8mOWFiOWIpOaWrWFuZHJvaWTlubbkuJTmj5DliY0gcmV0dXJu77yM6YG/5YWNIGFuZHJvaWQg55qE5Lu/IElPUyDns7vnu5/vvIzkvovlpoInYW5kcm9pZCAxLjEgeHh4SU9TIDEuMCfmg4XlhrXooqvor4bliKvkuLogaW9zIOezu+e7n+W5tui/lOWbnumUmeivr+eJiOacrAoKICAgIHJldHVybiBhbmRyb2lkTWF0Y2ggJiYgYW5kcm9pZE1hdGNoWzJdOwogIH0KCiAgaWYgKGlzSU9TKSB7CiAgICB2YXIgaW9zTWF0Y2ggPSBVQS5tYXRjaCgvKGlwYWR8aXBob25lfGlwb2QpLipvc1xzKFtcZF9dKykvKTsKICAgIHJldHVybiBpb3NNYXRjaCAmJiBpb3NNYXRjaFsyXS5yZXBsYWNlKC9fL2csICcuJyk7CiAgfQoKICByZXR1cm4gcmVzdWx0Owp9Ci8qKgogKiDojrflj5blvZPliY0gVUEg6YCC6YWN55qE54mI5pys5L+h5oGv77yM6K+l5pa55rOV5L6d6LWW6YCC6YWN5L+h5oGvQURBUFRWRVJTSU9O77yM5Y2z5pe25aSW6YOo6LCD55So5Lmf5Y+v5Lul5L+d6K+B5ZyoQURBUFRWRVJTSU9O55qE6YCC6YWN6IyD5Zu05YaFCiAqIEBwYXJhbSB7c3RyaW5nfSBiZHZlcnNpb24g5b2T5YmNIFVBIOeahOecn+WunueJiOacrAogKiBAcGFyYW0ge3N0cmluZ30gdWFUeXBlIOW9k+WJjSBVQSDnmoTnnJ/lrp7nsbvlnos6ICdtYWluJ+OAgSdtaXNzaW9uJ+OAgSdsaXRlJ+OAgSd0b21hcyfjgIEnYmFpZHVib3h2aXNpb24n44CBJ3Vua25vd24n77yM5Ly06ZqP55+p6Zi15Lqn5ZOB55qE5aKe5Yqg5Lya6LaK5p2l6LaK5aSaCiAqIEByZXR1cm4ge3N0cmluZ30KICovCgoKZnVuY3Rpb24gZ2V0QWRhcHRWZXJzaW9uKG9wdGlvbnMpIHsKICB2YXIgYm94VHlwZSA9IG9wdGlvbnMuYm94VHlwZTsKICB2YXIgcmVhbEJveFZlcnNpb24gPSBvcHRpb25zLnJlYWxCb3hWZXJzaW9uOwogIHZhciBpc0lPUyA9IG9wdGlvbnMuaXNJT1M7IC8vIOiOt+WPlumAgumFjeS/oeaBr+S4reeahOeJiOacrGxpc3QKCiAgdmFyIHZlcnNpb25MaXN0ID0gQURBUFRWRVJTSU9OW2JveFR5cGVdIHx8IHt9OwogIHZhciBhZGFwdFZlcnNpb25LZXlzID0gT2JqZWN0LmtleXModmVyc2lvbkxpc3QpOwogIHZhciBsZW4gPSBhZGFwdFZlcnNpb25LZXlzLmxlbmd0aDsgLy8gQURBUFRWRVJTSU9O5Lit5rKh5pyJ6YCC6YWN5L+h5oGv55qEIFVB77yM6L+U5ZueJycsIOihqOekuuS4jeaUr+aMgeerr+iDveWKm++8jOiLpemcgOimgeaUr+aMgWJveHh477yM6ZyA6KaB5ZyoQURBUFRWRVJTSU9O5Lit5aKe5Yqg6YWN572uCgogIGlmIChsZW4gPT09IDApIHsKICAgIHJldHVybiAnJzsKICB9IC8vIOiOt+WPlumAgumFjeWJjeeahOeJiOacrGxpc3TvvIzlubbkuJTku47pq5jliLDlupXmjpLluo8KCgogIGFkYXB0VmVyc2lvbktleXMuc29ydCh2ZXJzaW9uQ29tcGFyZSkucmV2ZXJzZSgpOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGFkYXB0VmVyc2lvbktleXMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBhZGFwdFZlcnNpb25LZXkgPSBhZGFwdFZlcnNpb25LZXlzW2ldOwoKICAgIGlmICh2ZXJzaW9uQ29tcGFyZShyZWFsQm94VmVyc2lvbiwgYWRhcHRWZXJzaW9uS2V5KSA+PSAwKSB7CiAgICAgIGlmICh0eXBlb2YgdmVyc2lvbkxpc3RbYWRhcHRWZXJzaW9uS2V5XSAhPT0gJ3N0cmluZycpIHsKICAgICAgICByZXR1cm4gaXNJT1MgPyB2ZXJzaW9uTGlzdFthZGFwdFZlcnNpb25LZXldLmlvcyA6IHZlcnNpb25MaXN0W2FkYXB0VmVyc2lvbktleV0uYW5kcm9pZDsKICAgICAgfQoKICAgICAgcmV0dXJuIHZlcnNpb25MaXN0W2FkYXB0VmVyc2lvbktleV07CiAgICB9CiAgfSAvLyDkvY7kuo5BREFQVFZFUlNJT07kuK3nmoTmnIDkvY7niYjmnKznmoRhcHDvvIzooajnpLrmsqHmnInlr7npvZDkuLvnur/vvIzov5Tlm54nJwoKCiAgcmV0dXJuICcnOwp9Ci8qKgogKiDojrflj5blvZPliY3njq/looPnnJ/lrp7niYjmnKzlj7fvvIzlkI7nu63miZPngrnkuK3pnIDopoHkvb/nlKgKICogQHJldHVybnMge3N0cmluZ30KICovCgoKZnVuY3Rpb24gZ2V0UmVhbEJveFZlcnNpb24ob3B0aW9ucykgewogIHZhciBpc0JkQXBwID0gb3B0aW9ucy5pc0JkQXBwOwogIHZhciBVQSA9IG9wdGlvbnMuVUE7CiAgdmFyIGFwcFByb3RvTmFtZSA9IG9wdGlvbnMuYXBwUHJvdG9OYW1lOwoKICBpZiAoaXNCZEFwcCkgewogICAgdmFyIGJkYXBwTWF0Y2ggPSBuZXcgUmVnRXhwKGFwcFByb3RvTmFtZSArICcvKFtcXGQrLl0rKScpLmV4ZWMoVUEpOwoKICAgIGlmIChiZGFwcE1hdGNoICYmIGJkYXBwTWF0Y2hbMV0pIHsKICAgICAgcmV0dXJuIGJkYXBwTWF0Y2hbMV07CiAgICB9CiAgfSAvLyDnjrDku6PmiYvnmb7vvIzljIXlkKttYWlu5ZKMbGl0ZQoKCiAgdmFyIG1hdGNoID0gL2JhaWR1Ym94YXBwXC8oW1xkKy5dKykvLmV4ZWMoVUEpOwoKICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHsKICAgIHJldHVybiBtYXRjaFsxXTsKICB9IC8vIOafkOS4quWOhuWPsueJiOacrOaJi+eZvgoKCiAgaWYgKGdsb2JhbCQxLmJhaWR1Ym94YXBwX3ZlcnNpb24pIHsKICAgIHJldHVybiBnbG9iYWwkMS5iYWlkdWJveGFwcF92ZXJzaW9uOwogIH0gLy8g5p+Q5Liq5Y6G5Y+y54mI5pys5omL55m+CgoKICB2YXIgb2xkTWF0Y2ggPSAvKFtcZCsuXSspXyg/OmRpb3JkbmF8ZW5vaHBpKV8vLmV4ZWMoVUEpOwogIHJldHVybiBvbGRNYXRjaCAmJiBvbGRNYXRjaFsxXSAmJiBvbGRNYXRjaFsxXS5zcGxpdCgnLicpLnJldmVyc2UoKS5qb2luKCcuJykgfHwgMDsKfQovKioKICog6I635Y+W6YCC6YWN5Li757q/55qE54mI5pys5Y+377yM5aSn5a2X54mI44CB6Z2S5pil54mI44CB5YWz5oCA54mI44CBbGl0Zei/lOWbnumAgumFjeWQjueahOS4u+e6v+eJiOacrO+8jOS4u+e6v+WFtuecn+WunueJiOacrAogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwoKCmZ1bmN0aW9uIGdldE1haW5Cb3hWZXJzaW9uKG9wdGlvbnMpIHsKICB2YXIgaXNCZEFwcCA9IG9wdGlvbnMuaXNCZEFwcDsKICB2YXIgaXNMaXRlQm94ID0gb3B0aW9ucy5pc0xpdGVCb3g7CiAgdmFyIHJlYWxCb3hWZXJzaW9uID0gb3B0aW9ucy5yZWFsQm94VmVyc2lvbjsgLy8gYmRhcHAg5ZKMIGxpdGUg55+p6Zi15Lqn5ZOB5L2/55So5a+56b2Q5Li757q/55qE54mI5pysCgogIGlmIChpc0JkQXBwIHx8IGlzTGl0ZUJveCkgewogICAgcmV0dXJuIGdldEFkYXB0VmVyc2lvbihvcHRpb25zKTsKICB9CgogIHJldHVybiByZWFsQm94VmVyc2lvbjsKfQovKioKICog6I635Y+WIFVBIOebuOWFs+eahOS/oeaBrwogKiBAcGFyYW0ge3N0cmluZ30gVUEKICogQHJldHVybnMge3N0cmluZ30KICovCgoKZnVuY3Rpb24gZ2V0VUFJbmZvKFVBKSB7CiAgdmFyIGlzSU9TID0gVUEgJiYgL2lwaG9uZXxpcGFkfGlwb2R8aW9zLy50ZXN0KFVBKTsKICB2YXIgaXNBbmRyb2lkID0gVUEgJiYgVUEuaW5kZXhPZignYW5kcm9pZCcpID4gMDsgLy8g57O757uf5LyY5YWI5Yik5patIGFuZHJvaWQsIOmBv+WFjSBhbmRyb2lkIOeahOS7vyBJT1Mg57O757uf77yM5L6L5aaCJ2FuZHJvaWQgMS4xIHh4eElPUyAxLjAn5oOF5Ya16KKr6K+G5Yir5Li6IGlvcyDns7vnu58KCiAgdmFyIE9TID0gaXNBbmRyb2lkID8gJ2FuZHJvaWQnIDogaXNJT1MgPyAnaW9zJyA6ICd1bmtub3duJzsKICB2YXIgb3B0aW9ucyA9IHsKICAgIFVBOiBVQSwKICAgIGlzSU9TOiBpc0lPUywKICAgIGlzQW5kcm9pZDogaXNBbmRyb2lkCiAgfTsgLy8g5pON5L2c57O757uf54mI5pysCgogIHZhciBPU1ZlcnNpb24gPSBnZXRPU1ZlcnNpb24ob3B0aW9ucyk7IC8vIOaJi+eZvuezu+WIl+S6p+WTgQoKICB2YXIgaXNCb3hTZXJpZXMgPSAvIGJhaWR1Ym94YXBwXC8vaS50ZXN0KFVBKSB8fCAvIGJkYXBwXC8vaS50ZXN0KFVBKTsgLy8gYmRhcHDljY/orq7nmoTmiYvnmb7nn6npmLXkuqflk4EKCiAgdmFyIGlzQmRBcHAgPSAvIGJkYXBwXC8vaS50ZXN0KFVBKTsgLy8g6I635Y+WYmRhcHDljY/orq7lpLQKCiAgdmFyIHNjaGVtYUhlYWRSZWcgPSAvIGJkYXBwXC9cZCtbLlxkK10qXHNcKChcdyspWztdP1xzPyhcdyspP1wpL2c7CiAgdmFyIGFwcFNjaGVtYUhlYWQgPSBzY2hlbWFIZWFkUmVnLmV4ZWMoVUEpOyAvLyDmtY/op4jlmajmmK/lkKbmlK/mjIHlsI/nqIvluo8KCiAgdmFyIGlzU3VwcG9ydFN3YW5JbkJyb3dzZXIgPSBpbkJyb3dzZXIgJiYgd2luZG93ICYmIHdpbmRvdy5fbmEgJiYgd2luZG93Ll9uYS5pc1N1cHBvcnRTd2FuICYmIHdpbmRvdy5fbmEuZ2V0U2NoZW1lSGVhZGVyICYmIHdpbmRvdy5fbmEuaXNTdXBwb3J0U3dhbigpOyAvLyDoi6XmtY/op4jlmajmlK/mjIHlsI/nqIvluo/vvIzojrflj5blr7nlupTnmoTnq6/og73lipvljY/orq7lpLQKCgogIHZhciBhcHBQcm90b05hbWUgPSBpc1N1cHBvcnRTd2FuSW5Ccm93c2VyID8gd2luZG93Ll9uYS5nZXRTY2hlbWVIZWFkZXIoKSA6IGFwcFNjaGVtYUhlYWQgPyBhcHBTY2hlbWFIZWFkWzJdIHx8IGFwcFNjaGVtYUhlYWRbMV0gOiAnYmFpZHVib3hhcHAnOyAvLyDmiYvnmb7kuLvniYjmnKwKCiAgdmFyIGlzTWFpbkJveCA9IC8gYmFpZHVib3hhcHBcLy9pLnRlc3QoVUEpICYmICEvIChsaXRlfGluZm98cHJvfG1pc3Npb24pIGJhaWR1Ym94YXBwLy50ZXN0KFVBKSAmJiAhaXNCZEFwcDsgLy8g5omL55m+5p6B6YCf54mI77yI5ZyoIGlPU++8jOaegemAn+eJiOeahOWFs+mUruivjeaYryBpbmZvOyDlnKggQW5kcm9pZO+8jOaegemAn+eJiOeahCBVQSDlhbPplK7lrZfmmK8gbGl0ZeOAguWFtuS7luS5n+S4uiBpbmZvIOeahOS6p+WTgeS4uiBsaXRlIOeahOWJjei6q++8jOWPr+S7peW/veeVpe+8iQogIC8vIHdpa2k6ICBodHRwOi8vd2lraS5iYWlkdS5jb20vcGFnZXMvdmlld3BhZ2UuYWN0aW9uP3BhZ2VJZD00MTgzMzM5MTQKCiAgdmFyIGlzTGl0ZUJveCA9IGlzSU9TICYmIC8gaW5mbyBiYWlkdWJveGFwcFwvL2kudGVzdChVQSkgfHwgaXNBbmRyb2lkICYmIC8gbGl0ZSBiYWlkdWJveGFwcFwvL2kudGVzdChVQSk7IC8vIOaJi+eZvueci+WkmuWkmgoKICB2YXIgaXNNaXNzaW9uQm94ID0gLyBtaXNzaW9uIGJhaWR1Ym94YXBwXC8vaS50ZXN0KFVBKTsgLy8g5omL55m+57G75Z6LICAgICdtYWluJ+S4u+eJiCAgJ21pc3Npb24n55yL5aSa5aSaICAnbGl0ZSfmnoHpgJ/niYgKCiAgdmFyIGJveFR5cGUgPSBpc01haW5Cb3ggPyAnbWFpbicgOiBpc01pc3Npb25Cb3ggPyAnbWlzc2lvbicgOiBpc0xpdGVCb3ggPyAnbGl0ZScgOiBhcHBQcm90b05hbWUgfHwgJ3Vua25vd24nOyAvLyDpgILphY3lkI7nmoTmiYvnmb7nsbvlnosKCiAgdmFyIGFkYXB0Qm94VHlwZSA9ICdtYWluJzsgLy8g5rWP6KeI5Zmo5qGG5p62ICBsaWdodO+8mui9u+a1j+iniOWZqOahhuaetu+8m3NlYXJjaO+8muS4u++8iOaQnOe0ou+8iea1j+iniOWZqOahhuaetjsgaW1hZ2VzZWFyY2ggbWlhbjog5aSa5qih5Y2K5bGPd2VidmlldwoKICB2YXIgYm94QnJvd3NlclR5cGUgPSAvaW1hZ2VzZWFyY2hbXHNcU10rbWFpbi9pLnRlc3QoVUEpID8gJ2ltYWdlc2VhY2gnIDogL2xpZ2h0L2kudGVzdChVQSkgPyAnbGlnaHQnIDogJ3NlYXJjaCc7CiAgT2JqZWN0LmFzc2lnbihvcHRpb25zLCB7CiAgICBpc0JkQXBwOiBpc0JkQXBwLAogICAgYm94VHlwZTogYm94VHlwZSwKICAgIGFwcFByb3RvTmFtZTogYXBwUHJvdG9OYW1lCiAgfSk7IC8vIOiOt+WPluW9k+WJjSBVQSDlr7nlupTnmoTnnJ/lrp7niYjmnKzlj7fvvIzlkI7nu63miZPngrnkuK3pnIDopoHkvb/nlKgKCiAgdmFyIHJlYWxCb3hWZXJzaW9uID0gZ2V0UmVhbEJveFZlcnNpb24ob3B0aW9ucyk7CiAgT2JqZWN0LmFzc2lnbihvcHRpb25zLCB7CiAgICByZWFsQm94VmVyc2lvbjogcmVhbEJveFZlcnNpb24sCiAgICBpc0xpdGVCb3g6IGlzTGl0ZUJveAogIH0pOyAvLyDojrflj5blvZPliY0gVUEg6YCC6YWN5Li757q/55qE54mI5pys5Y+377yM5aSn5a2X54mI44CB6Z2S5pil54mI44CB5YWz5oCA54mI6L+U5Zue6YCC6YWN5ZCO55qE5Li757q/54mI5pys77yM5Li757q/5ZKMbGl0Zei/lOWbnuWFtuecn+WunueJiOacrAoKICB2YXIgYm94VmVyc2lvbiA9IGdldE1haW5Cb3hWZXJzaW9uKG9wdGlvbnMpOwogIHJldHVybiB7CiAgICBpc0lPUzogaXNJT1MsCiAgICBpc0FuZHJvaWQ6IGlzQW5kcm9pZCwKICAgIE9TOiBPUywKICAgIE9TVmVyc2lvbjogT1NWZXJzaW9uLAogICAgaXNCb3hTZXJpZXM6IGlzQm94U2VyaWVzLAogICAgaXNCZEFwcDogaXNCZEFwcCwKICAgIGlzU3VwcG9ydFN3YW5JbkJyb3dzZXI6IGlzU3VwcG9ydFN3YW5JbkJyb3dzZXIsCiAgICBhcHBQcm90b05hbWU6IGFwcFByb3RvTmFtZSwKICAgIGlzTWFpbkJveDogaXNNYWluQm94LAogICAgaXNMaXRlQm94OiBpc0xpdGVCb3gsCiAgICBpc01pc3Npb25Cb3g6IGlzTWlzc2lvbkJveCwKICAgIGJveFR5cGU6IGJveFR5cGUsCiAgICBhZGFwdEJveFR5cGU6IGFkYXB0Qm94VHlwZSwKICAgIGJveEJyb3dzZXJUeXBlOiBib3hCcm93c2VyVHlwZSwKICAgIHJlYWxCb3hWZXJzaW9uOiByZWFsQm94VmVyc2lvbiwKICAgIGJveFZlcnNpb246IGJveFZlcnNpb24KICB9Owp9Cgp2YXIgcmVmID0gZ2V0VUFJbmZvKFVBKTsKdmFyIGlzSU9TID0gcmVmLmlzSU9TOwp2YXIgaXNBbmRyb2lkID0gcmVmLmlzQW5kcm9pZDsKdmFyIE9TID0gcmVmLk9TOwp2YXIgT1NWZXJzaW9uID0gcmVmLk9TVmVyc2lvbjsKdmFyIGlzQm94U2VyaWVzID0gcmVmLmlzQm94U2VyaWVzOwp2YXIgaXNCZEFwcCA9IHJlZi5pc0JkQXBwOwp2YXIgaXNTdXBwb3J0U3dhbkluQnJvd3NlciA9IHJlZi5pc1N1cHBvcnRTd2FuSW5Ccm93c2VyOwp2YXIgYXBwUHJvdG9OYW1lID0gcmVmLmFwcFByb3RvTmFtZTsKdmFyIGlzTWFpbkJveCA9IHJlZi5pc01haW5Cb3g7CnZhciBpc0xpdGVCb3ggPSByZWYuaXNMaXRlQm94Owp2YXIgaXNNaXNzaW9uQm94ID0gcmVmLmlzTWlzc2lvbkJveDsKdmFyIGJveFR5cGUgPSByZWYuYm94VHlwZTsKdmFyIGFkYXB0Qm94VHlwZSA9IHJlZi5hZGFwdEJveFR5cGU7CnZhciBib3hCcm93c2VyVHlwZSA9IHJlZi5ib3hCcm93c2VyVHlwZTsKdmFyIHJlYWxCb3hWZXJzaW9uID0gcmVmLnJlYWxCb3hWZXJzaW9uOwp2YXIgYm94VmVyc2lvbiA9IHJlZi5ib3hWZXJzaW9uOwovKioKICog5Li65p+Q5LiA5a+56LGh5pWw5o2u5LiK5re75Yqg546v5aKD5L+h5oGv77yaIGFwcCDnsbvlnovvvIwgYXBwIOeJiOacrAogKiAgICAg5LiA6Iis55So5p2l5YGa57uf6K6h77yMIOavlOWmguWcqOmUmeivr+S6i+S7tuaVsOaNruS4iua3u+WKoAogKgogKiBAcGFyYW0ge09iamVjdH0gZGF0YSDljp/mlbDmja4KICovCgpmdW5jdGlvbiBhZGRFbnZJbmZvKGRhdGEpIHsKICB0cnkgewogICAgZGF0YS5ib3hUeXBlID0gYm94VHlwZTsKICAgIGRhdGEuYm94VmVyc2lvbiA9IHJlYWxCb3hWZXJzaW9uOwogIH0gY2F0Y2ggKGV4KSB7Ly8gbm90aGluZAogIH0KCiAgcmV0dXJuIGRhdGE7Cn0KLyoqCiAqIOS4u+e6vyAxMi4xNiDku6XkuIvku6Xlj4rlhbblroPnn6npmLXkuqflk4HlnYfkvb/nlKjlhZzlupXmj4/ov7DooagKICog55+p6Zi15Lqn5ZOB5byA5ZCv56uv5o+P6L+w6KGo5LiL5Y+R5Lul5ZCO77yM6L+Z5Liq6ZyA6KaB5ZCM5q2l5Y+Y5pu0CiAqIEBwYXJhbSB7Kn0gaXNMb2NhbERlc2Mg5piv5ZCm5ZG95Lit5YWc5bqV5o+P6L+w6KGoCiAqIEBwYXJhbSB7Kn0gb3B0aW9ucyBVQSDnm7jlhbPlj4LmlbDvvIxvcHRpb25z55Sx5LqO57yW6K+R6Zeu6aKY5LiN6IO95LiO5YWo5bGA5Y+Y6YeP5ZCM5ZCNCiAqLwoKCmZ1bmN0aW9uIGlzSGl0TG9jRGVzYyhpc0xvY2FsRGVzYywgb3B0aW9ucykgewogIGlmIChvcHRpb25zID09PSB2b2lkIDApIG9wdGlvbnMgPSB7CiAgICBpc0FwcDogaXNNYWluQm94LAogICAgaXNCZEJveDogaXNCZEFwcCwKICAgIGlzTGl0ZUFwcDogaXNMaXRlQm94LAogICAgYXBwVHlwZTogYm94VHlwZSwKICAgIHJlYWxBcHBWZXJzaW9uOiByZWFsQm94VmVyc2lvbgogIH07CiAgdmFyIGlzQXBwID0gb3B0aW9ucy5pc0FwcDsKICB2YXIgaXNCZEJveCA9IG9wdGlvbnMuaXNCZEJveDsKICB2YXIgaXNMaXRlQXBwID0gb3B0aW9ucy5pc0xpdGVBcHA7CiAgdmFyIGFwcFR5cGUgPSBvcHRpb25zLmFwcFR5cGU7CiAgdmFyIHJlYWxBcHBWZXJzaW9uID0gb3B0aW9ucy5yZWFsQXBwVmVyc2lvbjsKCiAgaWYgKGlzTG9jYWxEZXNjKSB7CiAgICBpZiAoaXNBcHAgJiYgdmVyc2lvbkNvbXBhcmUocmVhbEFwcFZlcnNpb24sICcxMi4xNicpIDwgMCB8fCBpc0JkQm94IHx8IGlzTGl0ZUFwcCkgewogICAgICBkZWJ1ZyhhcHBUeXBlICsgcmVhbEFwcFZlcnNpb24gKyAn5L2/55So5YWc5bqV5o+P6L+w6KGo77yM56ym5ZCI6aKE5pyfJyk7CiAgICB9IGVsc2UgewogICAgICBkZWJ1ZyhhcHBUeXBlICsgcmVhbEFwcFZlcnNpb24gKyAn5L2/55So5YWc5bqV5o+P6L+w6KGo77yM77yB77yB77yB5LiN56ym5ZCI6aKE5pyf77yM6K+35Yqg5oq95qC36aqM6K+B5pWI5p6c77yB77yB77yBJyk7CiAgICB9CiAgfSBlbHNlIGlmIChpc0FwcCkgewogICAgaWYgKHZlcnNpb25Db21wYXJlKHJlYWxBcHBWZXJzaW9uLCAnMTIuMTYnKSA+IDApIHsKICAgICAgZGVidWcoYXBwVHlwZSArIHJlYWxBcHBWZXJzaW9uICsgJ+S9v+eUqOerr+aPj+i/sOihqO+8jOespuWQiOmihOacnycpOwogICAgfSBlbHNlIHsKICAgICAgZGVidWcoYXBwVHlwZSArIHJlYWxBcHBWZXJzaW9uICsgJ+S9v+eUqOerr+aPj+i/sOihqO+8jO+8ge+8ge+8geS4jeespuWQiOmihOacn++8jOivt+WOu+aOieaKveagt+S9v+eUqOWFnOW6leaPj+i/sOihqOmqjOivgeaViOaenO+8ge+8ge+8gScpOwogICAgfQogIH0gZWxzZSB7CiAgICAvLyDnur/kuIrnn6npmLXkuqflk4HkuI3kvJrlkb3kuK3mir3moLfvvIzkuIDnm7Tkvb/nlKjlhZzlupXmj4/ov7DooagKICAgIGRlYnVnKCfnn6npmLXkuqflk4EnICsgYXBwVHlwZSArIHJlYWxBcHBWZXJzaW9uICsgJ+e6v+S4iuaXoOazleWRveS4reiBlOWKqOWunumqjO+8jOS4jeS8muS9v+eUqOerr+aPj+i/sOihqO+8jO+8ge+8ge+8geS4jemcgOimgeWKoOaKveagt+mqjOivge+8jOivt+WOu+aOieaKveagt+S9v+eUqOWFnOW6leaPj+i/sOihqOmqjOivgeaViOaenO+8ge+8ge+8gScpOwogIH0KfQoKdmFyIGVudiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKICBfX3Byb3RvX186IG51bGwsCiAgSU5GSU5JVFlWRVJTSU9OOiBJTkZJTklUWVZFUlNJT04sCiAgdmVyc2lvbkNvbXBhcmU6IHZlcnNpb25Db21wYXJlLAogIGluQnJvd3NlcjogaW5Ccm93c2VyLAogIFVBOiBVQSwKICBnZXRVQUluZm86IGdldFVBSW5mbywKICBpc0lPUzogaXNJT1MsCiAgaXNBbmRyb2lkOiBpc0FuZHJvaWQsCiAgT1M6IE9TLAogIE9TVmVyc2lvbjogT1NWZXJzaW9uLAogIGlzQm94U2VyaWVzOiBpc0JveFNlcmllcywKICBpc0JkQXBwOiBpc0JkQXBwLAogIGlzU3VwcG9ydFN3YW5JbkJyb3dzZXI6IGlzU3VwcG9ydFN3YW5JbkJyb3dzZXIsCiAgYXBwUHJvdG9OYW1lOiBhcHBQcm90b05hbWUsCiAgaXNNYWluQm94OiBpc01haW5Cb3gsCiAgaXNMaXRlQm94OiBpc0xpdGVCb3gsCiAgaXNNaXNzaW9uQm94OiBpc01pc3Npb25Cb3gsCiAgYm94VHlwZTogYm94VHlwZSwKICBhZGFwdEJveFR5cGU6IGFkYXB0Qm94VHlwZSwKICBib3hCcm93c2VyVHlwZTogYm94QnJvd3NlclR5cGUsCiAgcmVhbEJveFZlcnNpb246IHJlYWxCb3hWZXJzaW9uLAogIGJveFZlcnNpb246IGJveFZlcnNpb24sCiAgYWRkRW52SW5mbzogYWRkRW52SW5mbywKICBpc0hpdExvY0Rlc2M6IGlzSGl0TG9jRGVzYwp9KTsKLyoqCiAqIOW5v+aSreS6i+S7tuWkhOeQhgogKiBAZGVzY3JpcHRpb24g55uu5qCHOiDkuLrkuoblsL3lj6/og73nmoTlh4/lsJHmqKHlnZfkuYvpl7TkuJrliqHpgLvovpHnmoTogKblkIjluqYsIOiAjOW8gOWPkeS6hui/meS4qmV2ZW50YnVzLCDkuLvopoHnlKjkuo7kuJrliqHpgLvovpHnmoTkuovku7bkvKDpgJIKICog5L2/55So6KeE6IyDOiDmr4/kuKpqc+aooeWdl+WwveWPr+iDvemAmui/h+S6i+S7tuWOu+mAmuS/oSwg5YeP5bCR5qih5Z2X5LmL6Ze055qE55u05o6l6LCD55So5ZKM5L6d6LWWKOiApuWQiCkKICoKICogQGF1dGhvciBjaGVucWkxNAogKi8KCnZhciBfY2FjaGUgPSB7fTsKdmFyIGJyb2FkY2FzdCA9IHsKICAvKioKICAgKiDmtL7lj5EKICAgKiBAcGFyYW0gIHtTdHJpbmd9IHR5cGUg5LqL5Lu257G75Z6LCiAgICogQHBhcmFtICB7Li4uKn0gZGF0YSDlm57osIPmlbDmja7vvIzmlK/mjIHov57nu63kvKDpgJIKICAgKiBAcmV0dXJuIHt0aGlzfSAgIHRoaXMgICBicm9hZGNhc3Tlr7nosaEKICAgKiBAZXhhbXBsZQogICAqIEJkYm94LmV2ZW50LmJyb2FkY2FzdC5maXJlKCdzb21lIGV2ZW50JywgYXJnMSwgYXJnMikKICAgKi8KICBmaXJlOiBmdW5jdGlvbiBmaXJlKHR5cGUsIGRhdGEpIHsKICAgIHZhciBsaXN0ZW5lcnMgPSBfY2FjaGVbdHlwZV07CiAgICB2YXIgbGVuID0gMDsKCiAgICBpZiAobGlzdGVuZXJzKSB7CiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItcmVzdC1wYXJhbXMKICAgICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7IC8vIOWQjumdouihpeWNlea1i+aXtuivt+WIoOmZpOS4iumdoueahCBkaXNhYmxlIOazqOmHigoKICAgICAgYXJncyA9IGFyZ3MubGVuZ3RoID4gMiA/IGFyZ3Muc3BsaWNlKDIsIGFyZ3MubGVuZ3RoIC0gMSkgOiBbXTsKICAgICAgYXJncyA9IFt0eXBlLCBkYXRhXS5jb25jYXQoYXJncyk7CiAgICAgIGxlbiA9IGxpc3RlbmVycy5sZW5ndGg7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIGxpc3RlbmVyID0gbGlzdGVuZXJzW2ldOwoKICAgICAgICBpZiAobGlzdGVuZXIgJiYgbGlzdGVuZXIuY2FsbGJhY2spIHsKICAgICAgICAgIGFyZ3MgPSBhcmdzLmNvbmNhdChsaXN0ZW5lci5hcmdzKTsKICAgICAgICAgIGxpc3RlbmVyLmNhbGxiYWNrLmFwcGx5KGxpc3RlbmVyLnNjb3BlLCBhcmdzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvKioKICAgKiDorqLpmIXlub/mkq3kuovku7YKICAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgdHlwZXMgICAgIOS6i+S7tuexu+Wei++8jOaUr+aMgWAsYOWIhumalOespgogICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayDlm57osIPlh73mlbAKICAgKiBAcGFyYW0gIHtPYmplY3R9ICAgW3Njb3BlPXVuZGVmaW5lZF0gICAg5Zue6LCD5Ye95pWw5LiK5LiL5paHCiAgICogQHJldHVybiB7dGhpc30gICAgdGhpcyBicm9hZGNhc3QKICAgKiBAZXhhbXBsZQogICAqIEJkYm94LmV2ZW50LmJyb2FkY2FzdC5vbignc29tZSBldmVudCxzb21lZXZlbnQyJywgZnVuY3Rpb24oYXJnMSwgYXJnMil7CiAgICogICAgIGNvbnNvbGUubG9nKGFyZzEsIGFyZzIpOwogICAqIH0pOwogICAqLwogIG9uOiBmdW5jdGlvbiBvbih0eXBlcywgY2FsbGJhY2ssIHNjb3BlKSB7CiAgICB0eXBlcyA9IHR5cGVzIHx8IFtdOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLXJlc3QtcGFyYW1zCgogICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7IC8vIOWQjumdouihpeWNlea1i+aXtuivt+WIoOmZpOS4iumdoueahCBkaXNhYmxlIOazqOmHigoKICAgIGlmICh0eXBlb2YgdHlwZXMgPT09ICdzdHJpbmcnKSB7CiAgICAgIHR5cGVzID0gdHlwZXMuc3BsaXQoJywnKTsKICAgIH0KCiAgICB2YXIgbGVuID0gdHlwZXMubGVuZ3RoOwoKICAgIGlmIChsZW4gPT09IDApIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgYXJncyA9IGFyZ3MubGVuZ3RoID4gMyA/IGFyZ3Muc3BsaWNlKDMsIGFyZ3MubGVuZ3RoIC0gMSkgOiBbXTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIHZhciB0eXBlID0gdHlwZXNbaV07CiAgICAgIF9jYWNoZVt0eXBlXSA9IF9jYWNoZVt0eXBlXSB8fCBbXTsKCiAgICAgIF9jYWNoZVt0eXBlXS5wdXNoKHsKICAgICAgICBjYWxsYmFjazogY2FsbGJhY2ssCiAgICAgICAgc2NvcGU6IHNjb3BlLAogICAgICAgIGFyZ3M6IGFyZ3MKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICog6YCA6K6iCiAgICogQHBhcmFtICB7U3RyaW5nfSAgIHR5cGUgICAgIOmAgOiuouacjeWKoeeahOexu+WeiwogICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayDlgYflpoLkvKDlhaXliJnnp7vlh7rkvKDlhaXnmoTnm5Hmjqfkuovku7bvvIzlkKbliJnnp7vlh7rlhajpg6gKICAgKiBAcmV0dXJuIHt0aGlzfSB0aGlzIGJyb2FkY2FzdAogICAqIEBleGFtcGxlCiAgICogQmRib3guZXZlbnQuYnJvYWRjYXN0Lm9mZignc29tZSBldmVudCcsIGNhbGxiYWNrKTsKICAgKi8KICBvZmY6IGZ1bmN0aW9uIG9mZih0eXBlLCBjYWxsYmFjaywgc2NvcGUpIHsKICAgIHZhciBsaXN0ZW5lcnMgPSBfY2FjaGVbdHlwZV07CgogICAgaWYgKCFsaXN0ZW5lcnMpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgIHZhciBsZW4gPSBsaXN0ZW5lcnMubGVuZ3RoOwogICAgICB2YXIgdG1wID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIGxpc3RlbmVyID0gbGlzdGVuZXJzW2ldOwoKICAgICAgICBpZiAobGlzdGVuZXIuY2FsbGJhY2sgIT09IGNhbGxiYWNrIHx8IGxpc3RlbmVyLnNjb3BlICE9PSBzY29wZSkgewogICAgICAgICAgdG1wLnB1c2gobGlzdGVuZXIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgX2NhY2hlW3R5cGVdID0gdG1wOwogICAgfSBlbHNlIHsKICAgICAgbGlzdGVuZXJzLmxlbmd0aCA9IDA7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICog56e75Ye65omA5pyJ5LqL5Lu2CiAgICogQHJldHVybiB7dGhpc30gdGhpcyBicm9hZGNhc3Tlr7nosaEKICAgKi8KICByZW1vdmVBbGw6IGZ1bmN0aW9uIHJlbW92ZUFsbCgpIHsKICAgIF9jYWNoZSA9IHt9OwogICAgcmV0dXJuIHRoaXM7CiAgfQp9OwoKZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkgewogIHZhciBoYW5kbGVycyA9IHt9OwogIHJldHVybiB7CiAgICBvbjogZnVuY3Rpb24gb24oZXZlbnROYW1lLCBmbikgewogICAgICBpZiAoaGFuZGxlcnMuaGFzT3duUHJvcGVydHkoZXZlbnROYW1lKSkgewogICAgICAgIGhhbmRsZXJzW2V2ZW50TmFtZV0uaW5kZXhPZihmbikgPT09IC0xICYmIGhhbmRsZXJzW2V2ZW50TmFtZV0ucHVzaChmbik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaGFuZGxlcnNbZXZlbnROYW1lXSA9IFtmbl07CiAgICAgIH0KICAgIH0sCiAgICBvZmY6IGZ1bmN0aW9uIG9mZihldmVudE5hbWUsIGZuKSB7CiAgICAgIHZhciBoYW5kbGVyTGlzdCA9IGhhbmRsZXJzW2V2ZW50TmFtZV0gfHwgW107CiAgICAgIHZhciBpbmRleCA9IGhhbmRsZXJMaXN0LmluZGV4T2YoZm4pOwoKICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICBoYW5kbGVyc1tldmVudE5hbWVdLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBvbmNlOiBmdW5jdGlvbiBvbmNlKGV2ZW50TmFtZSwgZm4pIHsKICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7CgogICAgICB2YXIgb25seSA9IGZ1bmN0aW9uIG9ubHkoKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbXSwKICAgICAgICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKCiAgICAgICAgd2hpbGUgKGxlbi0tKSB7CiAgICAgICAgICBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuXTsKICAgICAgICB9CgogICAgICAgIHRoaXMkMS5vZmYoZXZlbnROYW1lLCBvbmx5KTsKICAgICAgICBmbi5hcHBseS5hcHBseShmbiwgW3RoaXMkMV0uY29uY2F0KGFyZ3MpKTsKICAgICAgfTsKCiAgICAgIHRoaXMub24oZXZlbnROYW1lLCBvbmx5KTsKICAgIH0sCiAgICBlbWl0OiBmdW5jdGlvbiBlbWl0KGV2ZW50TmFtZSkgewogICAgICB2YXIgYXJncyA9IFtdLAogICAgICAgICAgbGVuJDEgPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgICAgIHdoaWxlIChsZW4kMS0tID4gMCkgewogICAgICAgIGFyZ3NbbGVuJDFdID0gYXJndW1lbnRzW2xlbiQxICsgMV07CiAgICAgIH0KCiAgICAgIHZhciBhcnIgPSBldmVudE5hbWUuc3BsaXQoJzonKTsKICAgICAgdmFyIGxlbiA9IGFyci5sZW5ndGg7IC8vIOS4jeWFgeiuuOebtOaOpSBlbWl0KCd4eHg6KicpCgogICAgICBpZiAobGVuID09PSAyICYmIGFyclsxXSA9PT0gJyonKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIGVtaXQgKCd4eHg6Kicp5LqL5Lu2CgoKICAgICAgaWYgKGxlbiA+IDEpIHsKICAgICAgICB2YXIga2V5ID0gYXJyWzBdICsgJzoqJzsKICAgICAgICBoYW5kbGVFbWl0RXZlbnQuYXBwbHkodm9pZCAwLCBbaGFuZGxlcnMsIGtleSwgZXZlbnROYW1lXS5jb25jYXQoYXJncykpOwogICAgICB9IC8vIOaJp+ihjGV2ZW50TmFtZeS6i+S7tgoKCiAgICAgIGhhbmRsZUVtaXRFdmVudC5hcHBseSh2b2lkIDAsIFtoYW5kbGVycywgZXZlbnROYW1lXS5jb25jYXQoYXJncykpOwogICAgfQogIH07Cn0KCmZ1bmN0aW9uIGhhbmRsZUVtaXRFdmVudChoYW5kbGVycywga2V5KSB7CiAgdmFyIGFyZ3MgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDI7CgogIHdoaWxlIChsZW4tLSA+IDApIHsKICAgIGFyZ3NbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAyXTsKICB9CgogIGlmIChoYW5kbGVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICBoYW5kbGVyc1trZXldLmZvckVhY2goZnVuY3Rpb24gKGZuKSB7CiAgICAgIGZuLmFwcGx5KHZvaWQgMCwgYXJncyk7CiAgICB9KTsKICB9Cn0KLyoqCiAqIOaatOmcsue7meWklumDqOS6i+S7tgogKi8KCgp2YXIgZXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7Ci8qKgogKiDmmrTpnLLnu5nlhoXpg6jkuovku7YKICovCgp2YXIgaW5uZXJFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXIoKTsKLyoqCiAqIEBmaWxlIOWOguWVhua1j+iniOWZqOerr+iDveWKm+aPj+i/sOihqGxpc3QKICogQGF1dGhvciBsaWh1YW55dTAxCiAqIEBkYXRhIDIwMjEvMTAvMDgKICogQHdpa2kg5Y6C5ZWG5rWP6KeI5Zmo6ZyA6KaB5oyJ54Wn5q2k6KeE6IyD5o6l5YWl77yaaHR0cDovL3dpa2kuYmFpZHUuY29tL3BhZ2VzL3ZpZXdwYWdlLmFjdGlvbj9wYWdlSWQ9MTY4NTM2MDU1NQogKiBAZGVzYyDmkJzntKLlj6/ku6Xnu7TmiqQxMOS4quS7peWGheeahOaPj+i/sOihqO+8jOW9k+aPj+i/sOihqOi+g+WkmuaXtu+8jOW/hemhu+aOqOWKqOWOguWVhuiHquihjOS4i+WPkeaPj+i/sOihqAogKi8KCnZhciBicm93c2VyRGVzY3JpcHRpb25MaXN0ID0gW3sKICBuYW1lOiAnc3dhbi5vcGVuJywKICBpbnZva2U6ICdpZnJhbWUub3BlblN3YW4nLAogIGFyZ3M6IFt7CiAgICBuYW1lOiAnYXBwS2V5JywKICAgIHZhbHVlOiAnc3RyaW5nJwogIH0sIHsKICAgIG5hbWU6ICdwYXRoJywKICAgIHZhbHVlOiAnc3RyaW5nPScKICB9LCB7CiAgICBuYW1lOiAncXVlcnknLAogICAgdmFsdWU6ICdPYmplY3Q9JwogIH0sIHsKICAgIG5hbWU6ICdfYmFpZHVib3hhcHAnLAogICAgdmFsdWU6IHsKICAgICAgdHlwZTogewogICAgICAgIGZyb206ICdzdHJpbmc9JywKICAgICAgICBub3RpbmhpczogJ3N0cmluZz0nLAogICAgICAgIHNyY0FwcElkOiAnc3RyaW5nPScsCiAgICAgICAgZXh0cmFEYXRhOiAnT2JqZWN0PScsCiAgICAgICAgZXh0OiAnT2JqZWN0PScsCiAgICAgICAgc3JjQXBwUGFnZTogJ3N0cmluZz0nLAogICAgICAgIHViYzogJ09iamVjdD0nLAogICAgICAgIG5hdmk6ICdzdHJpbmc9JywKICAgICAgICBiYWNrd2FyZFVSTDogJ3N0cmluZz0nCiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBuYW1lOiAndGhpcmRfZXh0JywKICAgIHZhbHVlOiAnc3RyaW5nPScKICB9LCB7CiAgICBuYW1lOiAnYWJ0ZXN0JywKICAgIHZhbHVlOiAnc3RyaW5nPScKICB9LCB7CiAgICBuYW1lOiAnb2F1dGhUeXBlJywKICAgIHZhbHVlOiAnc3RyaW5nPScKICB9LCB7CiAgICBuYW1lOiAnX3N3YW5pbmZvJywKICAgIHZhbHVlOiAnc3RyaW5nPScKICB9LCB7CiAgICBuYW1lOiAnZG93bmxvYWRVcmwnLAogICAgdmFsdWU6ICdzdHJpbmc9JwogIH0sIHsKICAgIG5hbWU6ICd1ZGlkJywKICAgIHZhbHVlOiAnc3RyaW5nPScKICB9LCB7CiAgICBuYW1lOiAnaG9zdCcsCiAgICB2YWx1ZTogJ3N0cmluZz0nCiAgfSwgewogICAgbmFtZTogJ2NiJywKICAgIHZhbHVlOiAnc3RyaW5nPScKICB9LCB7CiAgICBuYW1lOiAncG9ydCcsCiAgICB2YWx1ZTogJ3N0cmluZz0nCiAgfV0sCiAgYXV0aG9yaXR5OiAnc3dhbicsCiAgc2NoZW1lOiB3aW5kb3cgJiYgd2luZG93Ll9uYSAmJiB3aW5kb3cuX25hLmdldFNjaGVtZUhlYWRlciAmJiB3aW5kb3cuX25hLmdldFNjaGVtZUhlYWRlcigpCn1dOwp2YXIgY29tbW9uanNHbG9iYWwgPSB0eXBlb2YgZ2xvYmFsVGhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWxUaGlzIDogdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiB0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgOiB7fTsKCmZ1bmN0aW9uIGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZuLCBtb2R1bGUpIHsKICByZXR1cm4gbW9kdWxlID0gewogICAgZXhwb3J0czoge30KICB9LCBmbihtb2R1bGUsIG1vZHVsZS5leHBvcnRzKSwgbW9kdWxlLmV4cG9ydHM7Cn0KCnZhciBqc05hdGl2ZSA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAvKioKICAgKiBAZmlsZSBqcy1uYXRpdmUg6YCa5L+h566h55CGCiAgICogQGF1dGhvciBlcnJvcnJpayhlcnJvcnJpa0BnbWFpbC5jb20pCiAgICogQGF1dGhvciBob3V5dSg3ODU3OTg4MzVAcXEuY29tKQogICAqLwogIChmdW5jdGlvbiAocm9vdCkgewogICAgLyoqCiAgICAgKiDlr7nmlbDnu4Tov5vooYzpgY3ljoYKICAgICAqCiAgICAgKiBAaW5uZXIKICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IOimgemBjeWOhueahOaVsOe7hAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4g6YGN5Y6G5Ye95pWwCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVhY2goYXJyYXksIGZuKSB7CiAgICAgIHZhciBsZW4gPSBhcnJheSAmJiBhcnJheS5sZW5ndGggfHwgMDsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbGVuOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgaWYgKGZuKGFycmF5W2ldLCBpKSA9PT0gZmFsc2UpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiDov5Tlm57ljp/lgLznmoTmlrnms5XvvIzosIPnlKjov4fnqIvnmoTlhZzlupXlpITnkIblh73mlbAKICAgICAqCiAgICAgKiBAaW5uZXIKICAgICAqIEBwYXJhbSB7Kn0gc291cmNlIOWOn+WAvAogICAgICogQHJldHVybiB7Kn0KICAgICAqLwoKCiAgICBmdW5jdGlvbiByZXR1cm5SYXcoc291cmNlKSB7CiAgICAgIHJldHVybiBzb3VyY2U7CiAgICB9CiAgICAvKioKICAgICAqIOWvuei/lOWbnuWAvOi/m+ihjCBKU09OIOino+egge+8iOWPjeW6j+WIl+WMlu+8ieWkhOeQhueahOWHveaVsAogICAgICoKICAgICAqIEBpbm5lcgogICAgICogQHBhcmFtIHsqfSBzb3VyY2Ug5Y6f5YC8CiAgICAgKiBAcmV0dXJuIHsqfQogICAgICovCgoKICAgIGZ1bmN0aW9uIHJldHVybkpTT05EZWNvZGUoc291cmNlKSB7CiAgICAgIHJldHVybiB0eXBlb2Ygc291cmNlID09PSAnc3RyaW5nJyA/IEpTT04ucGFyc2Uoc291cmNlKSA6IHNvdXJjZTsKICAgIH0KICAgIC8qKgogICAgICog5Y+C5pWw5qOA5p+l77yM6ZSZ6K+v55u05o6l5oqb5Ye65byC5bi4CiAgICAgKgogICAgICogQGlubmVyCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIOiwg+eUqOWPguaVsAogICAgICogQHBhcmFtIHtBcnJheX0gZGVjbGFyYXRpb25zIOWPguaVsOWjsOaYjuWIl+ihqAogICAgICovCgoKICAgIGZ1bmN0aW9uIGNoZWNrQXJncyhhcmdzLCBkZWNsYXJhdGlvbnMsIGFwaUNvbnRhaW5lcikgewogICAgICBlYWNoKGRlY2xhcmF0aW9ucywgZnVuY3Rpb24gKGRlY2xhcmF0aW9uLCBpKSB7CiAgICAgICAgdmFyIGVycm9yTXNnOwogICAgICAgIHZhciB2YWx1ZSA9IG5vcm1hbGl6ZVZhbHVlRGVjbGFyYXRpb24oZGVjbGFyYXRpb24udmFsdWUpOwoKICAgICAgICBzd2l0Y2ggKGNoZWNrVmFsdWUoYXJnc1tpXSwgdmFsdWUpKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIGVycm9yTXNnID0gJyBpcyByZXF1aXJlZC4nOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIGVycm9yTXNnID0gJyB0eXBlIGVycm9yLiBtdXN0IGJlICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZS50eXBlIHx8ICdBcnJheScpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIGVycm9yTXNnID0gJyB0eXBlIGVycm9yLCBtdXN0IGJlIG9uZU9mICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZS5vbmVPZik7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgZXJyb3JNc2cgPSAnIHR5cGUgZXJyb3IsIG11c3QgYmUgb25lT2ZUeXBlICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZS5vbmVPZlR5cGUpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIGVycm9yTXNnID0gJyB0eXBlIGVycm9yLCBtdXN0IGJlIGFycmF5T2YgJyArIEpTT04uc3RyaW5naWZ5KHZhbHVlLmFycmF5T2YpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGlmIChlcnJvck1zZykgewogICAgICAgICAgdmFyIHRpdGxlID0gYXBpQ29udGFpbmVyICYmIGFwaUNvbnRhaW5lci5vcHRpb25zLmVycm9yVGl0bGUgfHwgJ2pzTmF0aXZlJzsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcignWycgKyB0aXRsZSArICcgQXJndW1lbnQgRXJyb3JdJyArIGRlY2xhcmF0aW9uLm5hbWUgKyBlcnJvck1zZyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICog5a+55YC85aOw5piO6L+b6KGM5qCH5YeG5YyW5aSE55CGCiAgICAgKgogICAgICogQGlubmVyCiAgICAgKiBAcGFyYW0ge09iamVjdHxzdHJpbmd9IGRlY2xhcmF0aW9uIOWAvOWjsOaYjgogICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICovCgoKICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZVZhbHVlRGVjbGFyYXRpb24oZGVjbGFyYXRpb24pIHsKICAgICAgaWYgKHR5cGVvZiBkZWNsYXJhdGlvbiA9PT0gJ3N0cmluZycpIHsKICAgICAgICB2YXIgcmVhbERlY2xhcmF0aW9uID0gewogICAgICAgICAgaXNSZXF1aXJlZDogdHJ1ZQogICAgICAgIH07CgogICAgICAgIGlmICgvPSQvLnRlc3QoZGVjbGFyYXRpb24pKSB7CiAgICAgICAgICByZWFsRGVjbGFyYXRpb24uaXNSZXF1aXJlZCA9IGZhbHNlOwogICAgICAgICAgZGVjbGFyYXRpb24gPSBkZWNsYXJhdGlvbi5zbGljZSgwLCBkZWNsYXJhdGlvbi5sZW5ndGggLSAxKTsKICAgICAgICB9CgogICAgICAgIGlmICgvXFtcXSQvLnRlc3QoZGVjbGFyYXRpb24pKSB7CiAgICAgICAgICByZWFsRGVjbGFyYXRpb24uYXJyYXlPZiA9IGRlY2xhcmF0aW9uLnNsaWNlKDAsIGRlY2xhcmF0aW9uLmxlbmd0aCAtIDIpOwogICAgICAgIH0gZWxzZSBpZiAoZGVjbGFyYXRpb24uaW5kZXhPZignfCcpID4gMCkgewogICAgICAgICAgcmVhbERlY2xhcmF0aW9uLm9uZU9mVHlwZSA9IGRlY2xhcmF0aW9uLnNwbGl0KCd8Jyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlYWxEZWNsYXJhdGlvbi50eXBlID0gZGVjbGFyYXRpb247CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVhbERlY2xhcmF0aW9uOwogICAgICB9CgogICAgICByZXR1cm4gZGVjbGFyYXRpb247CiAgICB9CiAgICAvKioKICAgICAqIOWvueWPguaVsOWAvOi/m+ihjOajgOafpQogICAgICoKICAgICAqIEBpbm5lcgogICAgICogQHBhcmFtIHsqfSB2YWx1ZSDlgLwKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkZWNsYXJhdGlvbiDlgLzlo7DmmI4KICAgICAqIEByZXR1cm4ge251bWJlcn0KICAgICAqLwoKCiAgICBmdW5jdGlvbiBjaGVja1ZhbHVlKHZhbHVlLCBkZWNsYXJhdGlvbikgewogICAgICBkZWNsYXJhdGlvbiA9IG5vcm1hbGl6ZVZhbHVlRGVjbGFyYXRpb24oZGVjbGFyYXRpb24pOwoKICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICByZXR1cm4gZGVjbGFyYXRpb24uaXNSZXF1aXJlZCAmJiBkZWNsYXJhdGlvbi50eXBlICE9PSAnKicgPyAxIDogMDsKICAgICAgfQoKICAgICAgdmFyIHZhbGlkID0gZmFsc2U7CgogICAgICBzd2l0Y2ggKCgwLCBfdHlwZW9mMi5kZWZhdWx0KShkZWNsYXJhdGlvbi50eXBlKSkgewogICAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgICAgICBzd2l0Y2ggKGRlY2xhcmF0aW9uLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzoKICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6CiAgICAgICAgICAgIGNhc2UgJ251bWJlcic6CiAgICAgICAgICAgIGNhc2UgJ2Z1bmN0aW9uJzoKICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzoKICAgICAgICAgICAgICB2YWxpZCA9ICgwLCBfdHlwZW9mMi5kZWZhdWx0KSh2YWx1ZSkgPT09IGRlY2xhcmF0aW9uLnR5cGU7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdPYmplY3QnOgogICAgICAgICAgICAgIHZhbGlkID0gKDAsIF90eXBlb2YyLmRlZmF1bHQpKHZhbHVlKSA9PT0gJ29iamVjdCc7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdBcnJheSc6CiAgICAgICAgICAgICAgdmFsaWQgPSB2YWx1ZSBpbnN0YW5jZW9mIEFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnKic6CiAgICAgICAgICAgICAgdmFsaWQgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgICAgcmV0dXJuIDI7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ29iamVjdCc6CiAgICAgICAgICBpZiAodmFsdWUgJiYgKDAsIF90eXBlb2YyLmRlZmF1bHQpKHZhbHVlKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgdmFsaWQgPSB0cnVlOwoKICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGRlY2xhcmF0aW9uLnR5cGUpIHsKICAgICAgICAgICAgICB2YWxpZCA9ICFjaGVja1ZhbHVlKHZhbHVlW2tleV0sIGRlY2xhcmF0aW9uLnR5cGVba2V5XSk7CgogICAgICAgICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgICAgcmV0dXJuIDI7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpZiAoZGVjbGFyYXRpb24ub25lT2YpIHsKICAgICAgICAgICAgZWFjaChkZWNsYXJhdGlvbi5vbmVPZiwgZnVuY3Rpb24gKGV4cGVjdFZhbHVlKSB7CiAgICAgICAgICAgICAgdmFsaWQgPSBleHBlY3RWYWx1ZSA9PT0gdmFsdWU7CiAgICAgICAgICAgICAgcmV0dXJuICF2YWxpZDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIDM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoZGVjbGFyYXRpb24ub25lT2ZUeXBlKSB7CiAgICAgICAgICAgIGVhY2goZGVjbGFyYXRpb24ub25lT2ZUeXBlLCBmdW5jdGlvbiAoZXhwZWN0VHlwZSkgewogICAgICAgICAgICAgIHZhbGlkID0gIWNoZWNrVmFsdWUodmFsdWUsIGV4cGVjdFR5cGUpOwogICAgICAgICAgICAgIHJldHVybiAhdmFsaWQ7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgICAgICAgIHJldHVybiA0OwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGRlY2xhcmF0aW9uLmFycmF5T2YpIHsKICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICAgICAgICB2YWxpZCA9IHRydWU7CiAgICAgICAgICAgICAgZWFjaCh2YWx1ZSwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZCA9ICFjaGVja1ZhbHVlKGl0ZW0sIGRlY2xhcmF0aW9uLmFycmF5T2YpOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gNTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIDI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgIH0KCiAgICAgIHJldHVybiAwOwogICAgfQogICAgLyoqCiAgICAgKiDlr7nosIPnlKjlj4LmlbDkuK3nmoTmiYDmnInlm57osIPlh73mlbDvvIzov5vooYzlj4LmlbDop6PnoIHvvIjlj43luo/liJfljJbvvInljIXoo4UKICAgICAqCiAgICAgKiBAaW5uZXIKICAgICAqIEBwYXJhbSB7QXJyYXl9IGFyZ3Mg6LCD55So5Y+C5pWwCiAgICAgKiBAcmV0dXJuIHtBcnJheX0KICAgICAqLwoKCiAgICBmdW5jdGlvbiB3cmFwRGVjb2RlRnVuY0FyZ3MoYXJncykgewogICAgICBlYWNoKGFyZ3MsIGZ1bmN0aW9uIChhcmcsIGkpIHsKICAgICAgICBpZiAodHlwZW9mIGFyZyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgYXJnc1tpXSA9IHdyYXBEZWNvZGVGdW5jQXJnKGFyZyk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGFyZ3M7CiAgICB9CiAgICAvKioKICAgICAqIOWvueWbnuiwg+WHveaVsOeahOWPguaVsOi/m+ihjOino+egge+8iOWPjeW6j+WIl+WMlu+8ieWMheijhQogICAgICoKICAgICAqIEBpbm5lcgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4g5Zue6LCD5Ye95pWwCiAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0KICAgICAqLwoKCiAgICBmdW5jdGlvbiB3cmFwRGVjb2RlRnVuY0FyZyhmbikgewogICAgICByZXR1cm4gZnVuY3Rpb24gKGFyZykgewogICAgICAgIGZuKHR5cGVvZiBhcmcgPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShhcmcpIDogYXJnKTsKICAgICAgfTsKICAgIH0KICAgIC8qKgogICAgICog5a+56LCD55So5Y+C5pWw5Lit55qE5omA5pyJ5Zue6LCD5Ye95pWw77yM6L+b6KGM5bqP5YiX5YyW5YyF6KOFCiAgICAgKgogICAgICogQGlubmVyCiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIOiwg+eUqOWPguaVsAogICAgICogQHJldHVybiB7QXJyYXl9CiAgICAgKi8KCgogICAgZnVuY3Rpb24gd3JhcEFyZ0Z1bmMoYXJncykgewogICAgICBlYWNoKGFyZ3MsIGZ1bmN0aW9uIChhcmcsIGkpIHsKICAgICAgICBpZiAodHlwZW9mIGFyZyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgYXJnc1tpXSA9IHdyYXBGdW5jKGFyZyk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGFyZ3M7CiAgICB9CiAgICAvKioKICAgICAqIOeUqOS6juWbnuiwg+WHveaVsOWMheijheWRveWQjeeahOiHquWinmlkCiAgICAgKgogICAgICogQGlubmVyCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICovCgoKICAgIHZhciBmdW5jSWQgPSAxOwogICAgLyoqCiAgICAgKiDnlKjkuo7lm57osIPlh73mlbDljIXoo4Xlkb3lkI3nmoTliY3nvIAKICAgICAqCiAgICAgKiBAaW5uZXIKICAgICAqIEBjb25zdAogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqLwoKICAgIHZhciBGVU5DX1BSRUZJWCA9ICdfX2pzbmFfJzsKICAgIC8qKgogICAgICog5a+55Zue6LCD5Ye95pWw77yM6L+b6KGM5bqP5YiX5YyW5YyF6KOFCiAgICAgKgogICAgICogQGlubmVyCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiDlm57osIPlh73mlbAKICAgICAqIEByZXR1cm4ge3N0cmluZ30KICAgICAqLwoKICAgIGZ1bmN0aW9uIHdyYXBGdW5jKGZuKSB7CiAgICAgIHZhciBmdW5jTmFtZSA9IEZVTkNfUFJFRklYICsgZnVuY0lkKys7CgogICAgICByb290W2Z1bmNOYW1lXSA9IGZ1bmN0aW9uIChhcmcpIHsKICAgICAgICBkZWxldGUgcm9vdFtmdW5jTmFtZV07CiAgICAgICAgZm4oYXJnKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBmdW5jTmFtZTsKICAgIH0KICAgIC8qKgogICAgICog5a+56LCD55So5Y+C5pWw5Lit55qE5omA5pyJ5Y+C5pWw6L+b6KGMSlNPTuW6j+WIl+WMlgogICAgICoKICAgICAqIEBpbm5lcgogICAgICogQHBhcmFtIHtBcnJheX0gYXJncyDosIPnlKjlj4LmlbAKICAgICAqIEByZXR1cm4ge0FycmF5fQogICAgICovCgoKICAgIGZ1bmN0aW9uIGFyZ0pTT05FbmNvZGUoYXJncykgewogICAgICBlYWNoKGFyZ3MsIGZ1bmN0aW9uIChhcmcsIGkpIHsKICAgICAgICBhcmdzW2ldID0gSlNPTi5zdHJpbmdpZnkoYXJnKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBhcmdzOwogICAgfQogICAgLyoqCiAgICAgKiDlsIbosIPnlKjlj4LmlbDlkIjlubbmiJDlr7nosaEKICAgICAqCiAgICAgKiBAaW5uZXIKICAgICAqIEBwYXJhbSB7QXJyYXl9IGFyZ3Mg6LCD55So5Y+C5pWwCiAgICAgKiBAcGFyYW0ge0FycmF5fSBkZWNsYXJhdGlvbnMg5Y+C5pWw5aOw5piO5YiX6KGoCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICAgKi8KCgogICAgZnVuY3Rpb24gYXJnQ29tYmluZShhcmdzLCBkZWNsYXJhdGlvbnMpIHsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICBlYWNoKGRlY2xhcmF0aW9ucywgZnVuY3Rpb24gKGRlY2xhcmF0aW9uLCBpKSB7CiAgICAgICAgdmFyIGFyZyA9IGFyZ3NbaV07CgogICAgICAgIGlmIChhcmcgIT0gbnVsbCkgewogICAgICAgICAgcmVzdWx0W2RlY2xhcmF0aW9uLm5hbWVdID0gYXJnOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIOmAmui/hyBwcm9tcHQg5a+56K+d5qGG6L+b6KGMIE5hdGl2ZSDosIPnlKgKICAgICAqCiAgICAgKiBAaW5uZXIKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2Ug6KaB5Lyg6YCS55qE5pWw5o2u5a2X56ym5LiyCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9CiAgICAgKi8KCgogICAgZnVuY3Rpb24gY2FsbFByb21wdChzb3VyY2UpIHsKICAgICAgcmV0dXJuIHJvb3QucHJvbXB0KHNvdXJjZSk7CiAgICB9CiAgICAvKioKICAgICAqIOmAmui/hyBsb2NhdGlvbi5ocmVmIOi/m+ihjCBOYXRpdmUg6LCD55SoCiAgICAgKgogICAgICogQGlubmVyCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIOimgeS8oOmAkueahHVybOWtl+espuS4sgogICAgICovCgoKICAgIGZ1bmN0aW9uIGNhbGxMb2NhdGlvbih1cmwpIHsKICAgICAgcm9vdC5sb2NhdGlvbi5ocmVmID0gdXJsOwogICAgfQogICAgLyoqCiAgICAgKiDpgJrov4cgaWZyYW1lIOi/m+ihjCBOYXRpdmUg6LCD55SoCiAgICAgKgogICAgICogQGlubmVyCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIOimgeS8oOmAkueahHVybOWtl+espuS4sgogICAgICovCgoKICAgIGZ1bmN0aW9uIGNhbGxJZnJhbWUodXJsKSB7CiAgICAgIHZhciBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsKICAgICAgaWZyYW1lLnNyYyA9IHVybDsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpOwogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGlmcmFtZSk7CiAgICB9CiAgICAvKioKICAgICAqIOaYoOWwhOiwg+eUqOWvueixoeaPj+i/sOS4reeahOWQjeensAogICAgICoKICAgICAqIEBpbm5lcgogICAgICogQHBhcmFtIHtPYmplY3R8RnVuY3Rpb259IG1hcEFQSSDosIPnlKjmj4/ov7Dlr7nosaHlkI3np7DnmoTmmKDlsITooajmiJbmmKDlsITlh73mlbAKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIOiwg+eUqOaPj+i/sOWvueixoeS4reeahOWQjeensAogICAgICogQHJldHVybiB7c3RyaW5nfQogICAgICovCgoKICAgIGZ1bmN0aW9uIG1hcEFQSU5hbWUobWFwQVBJLCBuYW1lKSB7CiAgICAgIGlmICh0eXBlb2YgbWFwQVBJID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgcmV0dXJuIG1hcEFQSShuYW1lKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG1hcEFQSVtuYW1lXTsKICAgIH0KICAgIC8qKgogICAgICog6LCD55So5o+P6L+w5a+56LGh55qEIGludm9rZSDlsZ7mgKfkuLrlrZfnrKbkuLLml7bnmoTlv6vmjbfmmKDlsITooagKICAgICAqCiAgICAgKiBAaW5uZXIKICAgICAqIEBjb25zdAogICAgICogQHR5cGUge09iamVjdH0KICAgICAqLwoKCiAgICB2YXIgSU5WT0tFX1NIT1JUQ1VUID0gewogICAgICAnbWV0aG9kJzogWydBcmdDaGVjaycsICdDYWxsTWV0aG9kJ10sCiAgICAgICdtZXRob2QuanNvbic6IFsnQXJnQ2hlY2snLCAnQXJnRnVuY0FyZ0RlY29kZTpKU09OJywgJ0FyZ0Z1bmNFbmNvZGUnLCAnQXJnRW5jb2RlOkpTT04nLCAnQ2FsbE1ldGhvZCcsICdSZXR1cm5EZWNvZGU6SlNPTiddLAogICAgICAncHJvbXB0Lmpzb24nOiBbJ0FyZ0NoZWNrJywgJ0FyZ0Z1bmNBcmdEZWNvZGU6SlNPTicsICdBcmdGdW5jRW5jb2RlJywgJ0FyZ0FkZDpuYW1lJywgJ0FyZ0NvbWJpbmU6SlNPTlN0cmluZycsICdDYWxsUHJvbXB0JywgJ1JldHVybkRlY29kZTpKU09OJ10sCiAgICAgICdwcm9tcHQudXJsJzogWydBcmdDaGVjaycsICdBcmdGdW5jQXJnRGVjb2RlOkpTT04nLCAnQXJnRnVuY0VuY29kZScsICdBcmdFbmNvZGU6SlNPTicsICdBcmdDb21iaW5lOlVSTCcsICdDYWxsUHJvbXB0JywgJ1JldHVybkRlY29kZTpKU09OJ10sCiAgICAgICdsb2NhdGlvbic6IFsnQXJnQ2hlY2snLCAnQXJnRnVuY0FyZ0RlY29kZTpKU09OJywgJ0FyZ0Z1bmNFbmNvZGUnLCAnQXJnRW5jb2RlOkpTT04nLCAnQXJnQ29tYmluZTpVUkwnLCAnQ2FsbExvY2F0aW9uJ10sCiAgICAgICdpZnJhbWUnOiBbJ0FyZ0NoZWNrJywgJ0FyZ0Z1bmNBcmdEZWNvZGU6SlNPTicsICdBcmdGdW5jRW5jb2RlJywgJ0FyZ0VuY29kZTpKU09OJywgJ0FyZ0NvbWJpbmU6VVJMJywgJ0NhbGxJZnJhbWUnXSwKICAgICAgJ21lc3NhZ2UnOiBbJ0FyZ0NoZWNrJywgJ0FyZ0Z1bmNBcmdEZWNvZGU6SlNPTicsICdBcmdGdW5jRW5jb2RlJywgJ0FyZ0FkZDpuYW1lJywgJ0FyZ0NvbWJpbmU6T2JqZWN0JywgJ0NhbGxNZXNzYWdlJ10KICAgIH07CiAgICAvKioKICAgICAqIOiwg+eUqOaPj+i/sOWvueixoeeahCBpbnZva2Ug5bGe5oCn5Li6IE9iamVjdOaXtu+8jGNhbGwg5a2X5q615a+55bqU55qE5pig5bCE6KGoCiAgICAgKgogICAgICogQGlubmVyCiAgICAgKiBAY29uc3QKICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgKi8KCiAgICB2YXIgSU5WT0tFX0NBTExfTUFQID0gewogICAgICBtZXRob2Q6ICdDYWxsTWV0aG9kJywKICAgICAgcHJvbXB0OiAnQ2FsbFByb21wdCcsCiAgICAgIGxvY2F0aW9uOiAnQ2FsbExvY2F0aW9uJywKICAgICAgaWZyYW1lOiAnQ2FsbElmcmFtZScsCiAgICAgIG1lc3NhZ2U6ICdDYWxsTWVzc2FnZScKICAgIH07CiAgICAvKioKICAgICAqIOiwg+eUqOaPj+i/sOWvueixoeeahCBpbnZva2Ug5bGe5oCn5Li6IE9iamVjdOaXtu+8jGJlZm9yZSDlrZfmrrXlr7nlupTnmoTmmKDlsITooagKICAgICAqCiAgICAgKiBAaW5uZXIKICAgICAqIEBjb25zdAogICAgICogQHR5cGUge09iamVjdH0KICAgICAqLwoKICAgIHZhciBJTlZPS0VfQkVGT1JFX01BUCA9IHsKICAgICAgSlNPTlN0cmluZ0luVHVybjogWydBcmdGdW5jQXJnRGVjb2RlOkpTT04nLCAnQXJnRnVuY0VuY29kZScsICdBcmdFbmNvZGU6SlNPTiddLAogICAgICBKU09OU3RyaW5nOiBbJ0FyZ0Z1bmNBcmdEZWNvZGU6SlNPTicsICdBcmdGdW5jRW5jb2RlJywgJ0FyZ0FkZDpuYW1lJywgJ0FyZ0NvbWJpbmU6SlNPTlN0cmluZyddLAogICAgICBKU09OT2JqZWN0OiBbJ0FyZ0Z1bmNBcmdEZWNvZGU6SlNPTicsICdBcmdGdW5jRW5jb2RlJywgJ0FyZ0FkZDpuYW1lJywgJ0FyZ0NvbWJpbmU6T2JqZWN0J10sCiAgICAgIFVSTDogWydBcmdGdW5jQXJnRGVjb2RlOkpTT04nLCAnQXJnRnVuY0VuY29kZScsICdBcmdFbmNvZGU6SlNPTicsICdBcmdDb21iaW5lOlVSTCddCiAgICB9OwogICAgdmFyIEJVSUxUSU5fREVTQ1JJUFRJT05fUFJPUFMgPSB7CiAgICAgIG5hbWU6IDEsCiAgICAgIGFyZ3M6IDEsCiAgICAgIGludm9rZTogMSwKICAgICAgbWV0aG9kOiAxLAogICAgICBzY2hlbWU6IDEsCiAgICAgIGF1dGhvcml0eTogMSwKICAgICAgcGF0aDogMSwKICAgICAgaGFuZGxlcjogMQogICAgfTsKCiAgICBmdW5jdGlvbiBkZXNjcmlwdGlvblByb3BNZXJnZXIodGFyZ2V0LCBzb3VyY2UpIHsKICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgIGlmIChzb3VyY2UuaGFzT3duUHJvcGVydHkoa2V5KSAmJiAhQlVJTFRJTl9ERVNDUklQVElPTl9QUk9QU1trZXldKSB7CiAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICog5a+56LCD55So5o+P6L+w5a+56LGh6L+b6KGM5qCH5YeG5YyW5aSE55CGCiAgICAgKgogICAgICogQGlubmVyCiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g6LCD55So5o+P6L+w5a+56LGhCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9uP30gcHJvcE1lcmdlciDlsZ7mgKflkIjlubbmlrnms5XvvIzpu5jorqTlrp7njrDkuLpmb3IuLi5pbu+8jEFQSUNvbnRhaW5lcuWPr+eUqOS6juaPkOWNh+aAp+iDvQogICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICovCgoKICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZURlc2NyaXB0aW9uKGRlc2NyaXB0aW9uLCBwcm9wTWVyZ2VyKSB7CiAgICAgIHZhciBhcmdzID0gW107CgogICAgICBpZiAoZGVzY3JpcHRpb24uYXJncyBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZXNjcmlwdGlvbi5hcmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgYXJnID0gZGVzY3JpcHRpb24uYXJnc1tpXTsKICAgICAgICAgIGFyZ3MucHVzaCh7CiAgICAgICAgICAgIG5hbWU6IGFyZy5uYW1lIHx8IGFyZy5uLAogICAgICAgICAgICB2YWx1ZTogYXJnLnZhbHVlIHx8IGFyZy52CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHByb3BNZXJnZXIgPSBwcm9wTWVyZ2VyIHx8IGRlc2NyaXB0aW9uUHJvcE1lcmdlcjsKICAgICAgcmV0dXJuIHByb3BNZXJnZXIoewogICAgICAgIG5hbWU6IGRlc2NyaXB0aW9uLm5hbWUsCiAgICAgICAgYXJnczogYXJncywKICAgICAgICBpbnZva2U6IG5vcm1hbGl6ZUludm9rZShkZXNjcmlwdGlvbi5pbnZva2UpLAogICAgICAgIG1ldGhvZDogZGVzY3JpcHRpb24ubWV0aG9kLAogICAgICAgIHNjaGVtZTogZGVzY3JpcHRpb24uc2NoZW1lIHx8IGRlc2NyaXB0aW9uLnNjaGVtYSwKICAgICAgICBhdXRob3JpdHk6IGRlc2NyaXB0aW9uLmF1dGhvcml0eSwKICAgICAgICBwYXRoOiBkZXNjcmlwdGlvbi5wYXRoLAogICAgICAgIGhhbmRsZXI6IGRlc2NyaXB0aW9uLmhhbmRsZXIKICAgICAgfSwgZGVzY3JpcHRpb24pOwogICAgfQogICAgLyoqCiAgICAgKiDlr7kgZGVzY3JpcHRpb24g5Lit55qEIGludm9rZSDlsZ7mgKfov5vooYzmoIflh4bljJblpITnkIYKICAgICAqCiAgICAgKiBAaW5uZXIKICAgICAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fHN0cmluZ30gaW52b2tlIGRlc2NyaXB0aW9u55qEaW52b2tl5bGe5oCnCiAgICAgKiBAcmV0dXJuIHtBcnJheT99CiAgICAgKi8KCgogICAgZnVuY3Rpb24gbm9ybWFsaXplSW52b2tlKGludm9rZSkgewogICAgICBpZiAoaW52b2tlIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICByZXR1cm4gaW52b2tlOwogICAgICB9CgogICAgICBzd2l0Y2ggKCgwLCBfdHlwZW9mMi5kZWZhdWx0KShpbnZva2UpKSB7CiAgICAgICAgY2FzZSAnc3RyaW5nJzoKICAgICAgICAgIHJldHVybiBJTlZPS0VfU0hPUlRDVVRbaW52b2tlXTsKCiAgICAgICAgY2FzZSAnb2JqZWN0JzoKICAgICAgICAgIHZhciByZXN1bHQgPSBbXTsKCiAgICAgICAgICBpZiAoaW52b2tlLmNoZWNrKSB7CiAgICAgICAgICAgIHJlc3VsdC5wdXNoKCdBcmdDaGVjaycpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpbnZva2UuYmVmb3JlKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5jb25jYXQoSU5WT0tFX0JFRk9SRV9NQVBbaW52b2tlLmJlZm9yZV0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJlc3VsdC5wdXNoKElOVk9LRV9DQUxMX01BUFtpbnZva2UuY2FsbF0pOwoKICAgICAgICAgIGlmIChpbnZva2UuYWZ0ZXIgPT09ICdKU09OJykgewogICAgICAgICAgICByZXN1bHQucHVzaCgnUmV0dXJuRGVjb2RlOkpTT04nKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gQVBJQ29udGFpbmVyKG9wdGlvbnMpIHsKICAgICAgLyoqCiAgICAgICAqIHByb2Nlc3NvciDliJvlu7rmlrnms5Xpm4blkIgKICAgICAgICoKICAgICAgICogQGlubmVyCiAgICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgICAqLwogICAgICB2YXIgcHJvY2Vzc29yQ3JlYXRvcnMgPSB7CiAgICAgICAgLyoqCiAgICAgICAgICog5Yib5bu65Y+C5pWw5qOA5p+l5aSE55CG5Ye95pWwCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g6LCD55So5o+P6L+w5a+56LGhCiAgICAgICAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICAgICAgICovCiAgICAgICAgQXJnQ2hlY2s6IGZ1bmN0aW9uIEFyZ0NoZWNrKGRlc2NyaXB0aW9uLCBvcHRpb24sIGFwaUNvbnRhaW5lcikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcmdzKSB7CiAgICAgICAgICAgIGNoZWNrQXJncyhhcmdzLCBkZXNjcmlwdGlvbi5hcmdzLCBhcGlDb250YWluZXIpOwogICAgICAgICAgICByZXR1cm4gYXJnczsKICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICog5Yib5bu66Kej56CB5Zue6LCD5Ye95pWw5Y+C5pWw5YyF6KOF55qE5aSE55CG5Ye95pWwCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g6LCD55So5o+P6L+w5a+56LGhCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbiDlpITnkIblj4LmlbAKICAgICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0KICAgICAgICAgKi8KICAgICAgICBBcmdGdW5jQXJnRGVjb2RlOiBmdW5jdGlvbiBBcmdGdW5jQXJnRGVjb2RlKGRlc2NyaXB0aW9uLCBvcHRpb24pIHsKICAgICAgICAgIHJldHVybiBvcHRpb24gPT09ICdKU09OJyA/IHdyYXBEZWNvZGVGdW5jQXJncyA6IHJldHVyblJhdzsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiDliJvlu7rlm57osIPlh73mlbDluo/liJfljJbnmoTlpITnkIblh73mlbAKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAgICAgICAqLwogICAgICAgIEFyZ0Z1bmNFbmNvZGU6IGZ1bmN0aW9uIEFyZ0Z1bmNFbmNvZGUoKSB7CiAgICAgICAgICByZXR1cm4gd3JhcEFyZ0Z1bmM7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICog5Yib5bu65Y+C5pWw5bqP5YiX5YyW55qE5aSE55CG5Ye95pWwCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g6LCD55So5o+P6L+w5a+56LGhCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbiDlpITnkIblj4LmlbAKICAgICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0KICAgICAgICAgKi8KICAgICAgICBBcmdFbmNvZGU6IGZ1bmN0aW9uIEFyZ0VuY29kZShkZXNjcmlwdGlvbiwgb3B0aW9uKSB7CiAgICAgICAgICByZXR1cm4gb3B0aW9uID09PSAnSlNPTicgPyBhcmdKU09ORW5jb2RlIDogcmV0dXJuUmF3OwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIOWIm+W7uuS7juiwg+eUqOaPj+i/sOWvueixoeS4rea3u+WKoOmineWkluWPguaVsOeahOWkhOeQhuWHveaVsAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRlc2NyaXB0aW9uIOiwg+eUqOaPj+i/sOWvueixoQogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb24g5aSE55CG5Y+C5pWwCiAgICAgICAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICAgICAgICovCiAgICAgICAgQXJnQWRkOiBmdW5jdGlvbiBBcmdBZGQoZGVzY3JpcHRpb24sIG9wdGlvbikgewogICAgICAgICAgdmFyIGFyZ0xlbiA9IGRlc2NyaXB0aW9uLmFyZ3MubGVuZ3RoOwogICAgICAgICAgZGVzY3JpcHRpb24uYXJncy5wdXNoKHsKICAgICAgICAgICAgbmFtZTogJ18nICsgb3B0aW9uLAogICAgICAgICAgICB2YWx1ZTogJyonCiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciB2YWx1ZSA9IGRlc2NyaXB0aW9uW29wdGlvbl07CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgICAgICAgYXJnc1thcmdMZW5dID0gdmFsdWU7CiAgICAgICAgICAgIHJldHVybiBhcmdzOwogICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiDliJvlu7rlj4LmlbDlkIjlubbnmoTlpITnkIblh73mlbAKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdGlvbiDosIPnlKjmj4/ov7Dlr7nosaEKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9uIOWkhOeQhuWPguaVsAogICAgICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAgICAgICAqLwogICAgICAgIEFyZ0NvbWJpbmU6IGZ1bmN0aW9uIEFyZ0NvbWJpbmUoZGVzY3JpcHRpb24sIG9wdGlvbikgewogICAgICAgICAgc3dpdGNoIChvcHRpb24pIHsKICAgICAgICAgICAgY2FzZSAnVVJMJzoKICAgICAgICAgICAgICB2YXIgcHJlZml4ID0gZGVzY3JpcHRpb24uc2NoZW1lICsgJzovLycgKyBkZXNjcmlwdGlvbi5hdXRob3JpdHkgKyBkZXNjcmlwdGlvbi5wYXRoOwogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYXJncykgewogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgICAgICAgICAgZWFjaChkZXNjcmlwdGlvbi5hcmdzLCBmdW5jdGlvbiAoZGVjbGFyYXRpb24sIGkpIHsKICAgICAgICAgICAgICAgICAgdmFyIGFyZyA9IGFyZ3NbaV07CgogICAgICAgICAgICAgICAgICBpZiAoYXJnICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChkZWNsYXJhdGlvbi5uYW1lICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGFyZykpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciBxdWVyeVN0ciA9IHJlc3VsdC5qb2luKCcmJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gcXVlcnlTdHIgPyBwcmVmaXggKyAnPycgKyBxdWVyeVN0ciA6IHByZWZpeDsKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgY2FzZSAnT2JqZWN0JzoKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhcmdDb21iaW5lKGFyZ3MsIGRlc2NyaXB0aW9uLmFyZ3MpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICBjYXNlICdKU09OU3RyaW5nJzoKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcmdDb21iaW5lKGFyZ3MsIGRlc2NyaXB0aW9uLmFyZ3MpKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZXR1cm5SYXc7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICog5Yib5bu65pa55rOV6LCD55So55qE5aSE55CG5Ye95pWwCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g6LCD55So5o+P6L+w5a+56LGhCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbiDlpITnkIblj4LmlbAKICAgICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0KICAgICAgICAgKi8KICAgICAgICBDYWxsTWV0aG9kOiBmdW5jdGlvbiBDYWxsTWV0aG9kKGRlc2NyaXB0aW9uLCBvcHRpb24pIHsKICAgICAgICAgIHZhciBtZXRob2RPd25lcjsKICAgICAgICAgIHZhciBtZXRob2ROYW1lOwoKICAgICAgICAgIGZ1bmN0aW9uIGZpbmRNZXRob2QoKSB7CiAgICAgICAgICAgIGlmICghbWV0aG9kT3duZXIpIHsKICAgICAgICAgICAgICB2YXIgc2VncyA9IGRlc2NyaXB0aW9uLm1ldGhvZC5zcGxpdCgnLicpOwogICAgICAgICAgICAgIHZhciBsYXN0SW5kZXggPSBzZWdzLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgbWV0aG9kTmFtZSA9IHNlZ3NbbGFzdEluZGV4XTsKICAgICAgICAgICAgICBtZXRob2RPd25lciA9IHJvb3Q7CgogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGFzdEluZGV4OyBpKyspIHsKICAgICAgICAgICAgICAgIG1ldGhvZE93bmVyID0gbWV0aG9kT3duZXJbc2Vnc1tpXV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcmdzKSB7CiAgICAgICAgICAgIGZpbmRNZXRob2QoKTsKCiAgICAgICAgICAgIHN3aXRjaCAoZGVzY3JpcHRpb24uYXJncy5sZW5ndGgpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICByZXR1cm4gbWV0aG9kT3duZXJbbWV0aG9kTmFtZV0oKTsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZE93bmVyW21ldGhvZE5hbWVdKGFyZ3NbMF0pOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXR1cm4gbWV0aG9kT3duZXJbbWV0aG9kTmFtZV0oYXJnc1swXSwgYXJnc1sxXSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2RPd25lclttZXRob2ROYW1lXShhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1ldGhvZE93bmVyW21ldGhvZE5hbWVdLmFwcGx5KG1ldGhvZE93bmVyLCBhcmdzKTsKICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICog5Yib5bu6IHByb21wdCDosIPnlKjnmoTlpITnkIblh73mlbAKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAgICAgICAqLwogICAgICAgIENhbGxQcm9tcHQ6IGZ1bmN0aW9uIENhbGxQcm9tcHQoKSB7CiAgICAgICAgICByZXR1cm4gY2FsbFByb21wdDsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiDliJvlu7ogaWZyYW1lIOiwg+eUqOeahOWkhOeQhuWHveaVsAogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICAgICAgICovCiAgICAgICAgQ2FsbElmcmFtZTogZnVuY3Rpb24gQ2FsbElmcmFtZSgpIHsKICAgICAgICAgIHJldHVybiBjYWxsSWZyYW1lOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIOWIm+W7uiBsb2NhdGlvbiDosIPnlKjnmoTlpITnkIblh73mlbAKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAgICAgICAqLwogICAgICAgIENhbGxMb2NhdGlvbjogZnVuY3Rpb24gQ2FsbExvY2F0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGNhbGxMb2NhdGlvbjsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiDliJvlu7ogcG9zdE1lc3NhZ2Ug6LCD55So55qE5aSE55CG5Ye95pWwCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g6LCD55So5o+P6L+w5a+56LGhCiAgICAgICAgICogQHJldHVybiB7RnVuY3Rpb259CiAgICAgICAgICovCiAgICAgICAgQ2FsbE1lc3NhZ2U6IGZ1bmN0aW9uIENhbGxNZXNzYWdlKGRlc2NyaXB0aW9uKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgICAgICAgcm9vdC53ZWJraXQubWVzc2FnZUhhbmRsZXJzW2Rlc2NyaXB0aW9uLmhhbmRsZXJdLnBvc3RNZXNzYWdlKGFyZ3MpOwogICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiDliJvlu7rlr7nov5Tlm57lgLzov5vooYzop6PnoIHnmoTlpITnkIblh73mlbAKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdGlvbiDosIPnlKjmj4/ov7Dlr7nosaEKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9uIOWkhOeQhuWPguaVsAogICAgICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAgICAgICAqLwogICAgICAgIFJldHVybkRlY29kZTogZnVuY3Rpb24gUmV0dXJuRGVjb2RlKGRlc2NyaXB0aW9uLCBvcHRpb24pIHsKICAgICAgICAgIHJldHVybiBvcHRpb24gPT09ICdKU09OJyA/IHJldHVybkpTT05EZWNvZGUgOiByZXR1cm5SYXc7CiAgICAgICAgfQogICAgICB9OwogICAgICB2YXIgYXBpQ29udGFpbmVyID0gewogICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgIGVycm9yVGl0bGU6ICdqc05hdGl2ZScsCiAgICAgICAgICBuYW1pbmdDb25mbGljdDogJ2Vycm9yJwogICAgICAgIH0sCiAgICAgICAgYXBpczogW10sCiAgICAgICAgYXBpc0xlbjogMCwKICAgICAgICBhcGlJbmRleDoge30sCgogICAgICAgIC8qKgogICAgICAgICAqIOmFjee9ruWPguaVsO+8jOiuvue9rueahOWPguaVsOWwhuiiq+WQiOW5tuWIsOeOsOacieWPguaVsOS4rQogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMg5Y+C5pWw5a+56LGhCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmc9fSBvcHRpb25zLmVycm9yVGl0bGUg5pi+56S65oql6ZSZ5L+h5oGv55qE5qCH6aKYCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmc9fSBvcHRpb25zLm5hbWluZ0NvbmZsaWN0IOWQjeWtl+WGsueqgeaXtueahOWkhOeQhuetlueVpQogICAgICAgICAqIEByZXR1cm4ge0FQSUNvbnRhaW5lcn0KICAgICAgICAgKi8KICAgICAgICBjb25maWc6IGZ1bmN0aW9uIGNvbmZpZyhvcHRpb25zKSB7CiAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsgLy8g5YaN5aSa5bCx5LiN6IO96L+Z5LmI5bmy5LqGCgogICAgICAgICAgdGhpcy5vcHRpb25zLmVycm9yVGl0bGUgPSBvcHRpb25zLmVycm9yVGl0bGUgfHwgdGhpcy5vcHRpb25zLmVycm9yVGl0bGU7CiAgICAgICAgICB0aGlzLm9wdGlvbnMubmFtaW5nQ29uZmxpY3QgPSBvcHRpb25zLm5hbWluZ0NvbmZsaWN0IHx8IHRoaXMub3B0aW9ucy5uYW1pbmdDb25mbGljdDsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIOa3u+WKoOiwg+eUqEFQSQogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R8QXJyYXl9IGRlc2NyaXB0aW9uIOiwg+eUqOaPj+i/sOWvueixoQogICAgICAgICAqIEByZXR1cm4ge0FQSUNvbnRhaW5lcn0KICAgICAgICAgKi8KICAgICAgICBhZGQ6IGZ1bmN0aW9uIGFkZChkZXNjcmlwdGlvbikgewogICAgICAgICAgaWYgKGRlc2NyaXB0aW9uIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZXNjcmlwdGlvbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHRoaXMuYWRkKGRlc2NyaXB0aW9uW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICgoMCwgX3R5cGVvZjIuZGVmYXVsdCkoZGVzY3JpcHRpb24pID09PSAnb2JqZWN0JykgewogICAgICAgICAgICB2YXIgbmFtZSA9IGRlc2NyaXB0aW9uLm5hbWU7CgogICAgICAgICAgICBpZiAodGhpcy5hcGlJbmRleFtuYW1lXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLm9wdGlvbnMubmFtaW5nQ29uZmxpY3QpIHsKICAgICAgICAgICAgICAgIC8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi8KICAgICAgICAgICAgICAgIGNhc2UgJ292ZXJyaWRlJzoKICAgICAgICAgICAgICAgICAgdGhpcy5hcGlzW3RoaXMuYXBpSW5kZXhbbmFtZV1dID0gbm9ybWFsaXplRGVzY3JpcHRpb24oZGVzY3JpcHRpb24sIHRoaXMuZGVzY3JpcHRpb25Qcm9wTWVyZ2VyKTsKCiAgICAgICAgICAgICAgICBjYXNlICdpZ25vcmUnOgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAvKiBqc2hpbnQgaWdub3JlOmVuZCAqLwoKICAgICAgICAgICAgICAgIGNhc2UgJ2Vycm9yJzoKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignWycgKyB0aGlzLm9wdGlvbnMuZXJyb3JUaXRsZSArICddIEFQSSBleGlzdHM6ICcgKyBuYW1lKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIHJlYWxEZXNjID0gbm9ybWFsaXplRGVzY3JpcHRpb24oZGVzY3JpcHRpb24sIHRoaXMuZGVzY3JpcHRpb25Qcm9wTWVyZ2VyKTsKICAgICAgICAgICAgICB0aGlzLmFwaUluZGV4W25hbWVdID0gdGhpcy5hcGlzTGVuOwogICAgICAgICAgICAgIHRoaXMuYXBpc1t0aGlzLmFwaXNMZW4rK10gPSByZWFsRGVzYzsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIOS7juS4gOasoSBOYXRpdmUg55qE6LCD55So57uT5p6c5Lit5re75Yqg6LCD55SoQVBJCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g6LCD55So5o+P6L+w5a+56LGhCiAgICAgICAgICogQHJldHVybiB7QVBJQ29udGFpbmVyfQogICAgICAgICAqLwogICAgICAgIGZyb21OYXRpdmU6IGZ1bmN0aW9uIGZyb21OYXRpdmUoZGVzY3JpcHRpb24pIHsKICAgICAgICAgIHJldHVybiB0aGlzLmFkZChpbnZva2VEZXNjcmlwdGlvbihub3JtYWxpemVEZXNjcmlwdGlvbihkZXNjcmlwdGlvbiwgdGhpcy5kZXNjcmlwdGlvblByb3BNZXJnZXIpKSk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICog6YCa6L+H5o+P6L+w5a+56LGh55qEIG5hbWUg5bGe5oCn6L+b6KGM6LCD55SoCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSDosIPnlKjmj4/ov7Dlr7nosaHlkI0KICAgICAgICAgKiBAcGFyYW0ge0FycmF5PX0gYXJncyDosIPnlKjlj4LmlbAKICAgICAgICAgKiBAcmV0dXJuIHsqfQogICAgICAgICAqLwogICAgICAgIGludm9rZTogZnVuY3Rpb24gaW52b2tlKG5hbWUsIGFyZ3MpIHsKICAgICAgICAgIHJldHVybiBpbnZva2VEZXNjcmlwdGlvbih0aGlzLmFwaXNbdGhpcy5hcGlJbmRleFtuYW1lXV0sIGFyZ3MpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIOeUn+aIkOS4gOS4quWvueixoe+8jOWFtuS4iueahOaWueazleaYryBBUEkg5a655Zmo5a+56LGh5Lit6LCD55So5o+P6L+w5a+56LGh57yW6K+R5oiQ55qE77yM5Y+v6KKr55u05o6l6LCD55So55qE5Ye95pWwCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdHxGdW5jdGlvbn0gbWFwQVBJIOiwg+eUqOaPj+i/sOWvueixoeWQjeensOeahOaYoOWwhOihqOaIluaYoOWwhOWHveaVsAogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0KICAgICAgICAgKi8KICAgICAgICBtYXA6IGZ1bmN0aW9uIG1hcChtYXBBUEkpIHsKICAgICAgICAgIG1hcEFQSSA9IG1hcEFQSSB8fCBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICByZXR1cm4gbmFtZTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIGFwaU9iamVjdCA9IHt9OwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5hcGlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBhcGkgPSB0aGlzLmFwaXNbaV07CiAgICAgICAgICAgIHZhciBhcGlOYW1lID0gbWFwQVBJTmFtZShtYXBBUEksIGFwaS5uYW1lKTsKCiAgICAgICAgICAgIGlmIChhcGlOYW1lICYmIGFwaS5pbnZva2UpIHsKICAgICAgICAgICAgICBpZiAoYXBpTmFtZS5pbmRleE9mKCcuJykgPiAwKSB7CiAgICAgICAgICAgICAgICB2YXIgYXBpTmFtZVNlZ3MgPSBhcGlOYW1lLnNwbGl0KCcuJyk7CiAgICAgICAgICAgICAgICB2YXIgaiA9IDA7CiAgICAgICAgICAgICAgICB2YXIgbnMgPSBhcGlPYmplY3Q7CgogICAgICAgICAgICAgICAgZm9yICg7IGogPCBhcGlOYW1lU2Vncy5sZW5ndGggLSAxOyBqKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIHNlZyA9IGFwaU5hbWVTZWdzW2pdOwogICAgICAgICAgICAgICAgICBuc1tzZWddID0gbnNbc2VnXSB8fCB7fTsKICAgICAgICAgICAgICAgICAgbnMgPSBuc1tzZWddOyAvLyDml6DogYrnlZnkuKrnsr7nroDlhpnms5UKICAgICAgICAgICAgICAgICAgLy8gbnMgPSBuc1thcGlOYW1lU2Vnc1tqXV0gPSBuc1thcGlOYW1lU2Vnc1tqXV0gfHwge307CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbnNbYXBpTmFtZVNlZ3Nbal1dID0gYnVpbGRBUElNZXRob2QoYXBpKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXBpT2JqZWN0W2FwaU5hbWVdID0gYnVpbGRBUElNZXRob2QoYXBpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gYXBpT2JqZWN0OwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIOmAmui/h+iwg+eUqOaPj+i/sOWvueixoei/m+ihjOiwg+eUqAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRlc2NyaXB0aW9uIOiwg+eUqOaPj+i/sOWvueixoQogICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGFyZ3Mg6LCD55So5Y+C5pWwCiAgICAgICAgICogQHJldHVybiB7Kn0KICAgICAgICAgKi8KICAgICAgICBpbnZva2VBUEk6IGZ1bmN0aW9uIGludm9rZUFQSShkZXNjcmlwdGlvbiwgYXJncykgewogICAgICAgICAgcmV0dXJuIGludm9rZURlc2NyaXB0aW9uKG5vcm1hbGl6ZURlc2NyaXB0aW9uKGRlc2NyaXB0aW9uLCB0aGlzLmRlc2NyaXB0aW9uUHJvcE1lcmdlciksIGFyZ3MpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIOW8gOWPkeiAheihpeWFhXByb2Nlc3NvcnNDcmVhdG9yc+eahOiHquWumuS5iembhihUSVBTOuS4jeiDveWIt+aOieWGhee9rueahHByb2Nlc3NvckNyZWF0b3JzKQogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUg5rOo5YaM55qEcHJvY2Vzc29yQ3JlYXRvcuWQjeensAogICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IOmcgOimgeazqOWGjOeahHByb2Nlc3NvckNyZWF0b3LvvIzmraTlh73mlbDov5Tlm57lgLzpnIDopoHmmK/kuIDkuKrlh73mlbAKICAgICAgICAgKiBAcmV0dXJuIHtBUElDb250YWluZXJ9CiAgICAgICAgICovCiAgICAgICAgYWRkUHJvY2Vzc29yQ3JlYXRvcjogZnVuY3Rpb24gYWRkUHJvY2Vzc29yQ3JlYXRvcihuYW1lLCBwcm9jZXNzb3JDcmVhdG9yKSB7CiAgICAgICAgICBpZiAocHJvY2Vzc29yQ3JlYXRvcnNbbmFtZV0pIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbJyArIHRoaXMub3B0aW9ucy5lcnJvclRpdGxlICsgJ10gcHJvY2Vzc29yQ3JlYXRvcnMgZXhpc3RzOiAnICsgbmFtZSk7CiAgICAgICAgICB9CgogICAgICAgICAgcHJvY2Vzc29yQ3JlYXRvcnNbbmFtZV0gPSBwcm9jZXNzb3JDcmVhdG9yOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICog6K6+572uIGRlc2NyaXB0aW9uIOmineWklueahOWxnuaAp+WIl+ihqAogICAgICAgICAqIOiLpeiuvue9ruS6hmRlc2NyaXB0aW9uIOmineWklueahOWxnuaAp+WIl+ihqO+8jOS4jeWcqOWIl+ihqOS4reeahOWxnuaAp+Wwhuiiq+W/veeVpQogICAgICAgICAqIOivpeaOpeWPo+W6lOS7heeUqOS6juaAp+iDveS8mOWMlu+8jOS4jeW6lOaUueWPmOm7mOiupOihjOS4ugogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtBcnJheS48c3RyaW5nPn0gcHJvcHMgZGVzY3JpcHRpb27pop3lpJbnmoTlsZ7mgKfliJfooagKICAgICAgICAgKi8KICAgICAgICBzZXRFeHRlcm5hbERlc2NyaXB0aW9uUHJvcHM6IGZ1bmN0aW9uIHNldEV4dGVybmFsRGVzY3JpcHRpb25Qcm9wcyhwcm9wcykgewogICAgICAgICAgdmFyIGNvZGUgPSAnJzsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBwcm9wID0gcHJvcHNbaV07CiAgICAgICAgICAgIGNvZGUgKz0gJ3RhcmdldFsiJyArIHByb3AgKyAnIl0gPSBzb3VyY2VbIicgKyBwcm9wICsgJyJdOyc7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5kZXNjcmlwdGlvblByb3BNZXJnZXIgPSBuZXcgRnVuY3Rpb24oJ3RhcmdldCcsICdzb3VyY2UnLCBjb2RlICsgJ3JldHVybiB0YXJnZXQ7Jyk7CiAgICAgICAgfQogICAgICB9OwogICAgICBhcGlDb250YWluZXIuY29uZmlnKG9wdGlvbnMpOwogICAgICByZXR1cm4gYXBpQ29udGFpbmVyOwogICAgICAvKioKICAgICAgICog55Sf5oiQ6LCD55So6L+H56iL5aSE55CG5Ye95pWw55qE5YiX6KGoCiAgICAgICAqCiAgICAgICAqIEBpbm5lcgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g6LCD55So5o+P6L+w5a+56LGhCiAgICAgICAqIEByZXR1cm4ge0Z1bmN0aW9uW119CiAgICAgICAqLwoKICAgICAgZnVuY3Rpb24gZ2V0UHJvY2Vzc29ycyhkZXNjcmlwdGlvbikgewogICAgICAgIHZhciBwcm9jZXNzb3JzID0gW107CgogICAgICAgIGlmICghZGVzY3JpcHRpb24uaW52b2tlKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1snICsgYXBpQ29udGFpbmVyLm9wdGlvbnMuZXJyb3JUaXRsZSArICddIGludm9rZSB1bmRlZmluZWQ6ICcgKyBkZXNjcmlwdGlvbi5uYW1lKTsKICAgICAgICB9CgogICAgICAgIGVhY2goZGVzY3JpcHRpb24uaW52b2tlLCBmdW5jdGlvbiAocHJvY2Vzc05hbWUpIHsKICAgICAgICAgIHZhciBkb3RJbmRleCA9IHByb2Nlc3NOYW1lLmluZGV4T2YoJzonKTsKICAgICAgICAgIHZhciBvcHRpb247CgogICAgICAgICAgaWYgKGRvdEluZGV4ID4gMCkgewogICAgICAgICAgICBvcHRpb24gPSBwcm9jZXNzTmFtZS5zbGljZShkb3RJbmRleCArIDEpOwogICAgICAgICAgICBwcm9jZXNzTmFtZSA9IHByb2Nlc3NOYW1lLnNsaWNlKDAsIGRvdEluZGV4KTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcHJvY2Vzc29yID0gcHJvY2Vzc29yQ3JlYXRvcnNbcHJvY2Vzc05hbWVdKGRlc2NyaXB0aW9uLCBvcHRpb24sIGFwaUNvbnRhaW5lcik7CgogICAgICAgICAgaWYgKHR5cGVvZiBwcm9jZXNzb3IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgcHJvY2Vzc29ycy5wdXNoKHByb2Nlc3Nvcik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHByb2Nlc3NvcnM7CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIOmAmui/h+iwg+eUqOaPj+i/sOWvueixoei/m+ihjOiwg+eUqAogICAgICAgKgogICAgICAgKiBAaW5uZXIKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRlc2NyaXB0aW9uIOiwg+eUqOaPj+i/sOWvueixoQogICAgICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIOiwg+eUqOWPguaVsAogICAgICAgKiBAcmV0dXJuIHsqfSDlpITnkIblrozmiJDnu5PmnpwKICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gaW52b2tlRGVzY3JpcHRpb24oZGVzY3JpcHRpb24sIGFyZ3MpIHsKICAgICAgICBpZiAoZGVzY3JpcHRpb24pIHsKICAgICAgICAgIGFyZ3MgPSBhcmdzIHx8IFtdOwogICAgICAgICAgZWFjaChnZXRQcm9jZXNzb3JzKGRlc2NyaXB0aW9uKSwgZnVuY3Rpb24gKHByb2Nlc3NvcikgewogICAgICAgICAgICBhcmdzID0gcHJvY2Vzc29yKGFyZ3MpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gYXJnczsKICAgICAgICB9CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIOaKiuiwg+eUqOaPj+i/sOWvueixoee8luivkeaIkOWPr+iiq+ebtOaOpeiwg+eUqOeahOWHveaVsAogICAgICAgKgogICAgICAgKiBAaW5uZXIKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRlc2NyaXB0aW9uIOiwg+eUqOaPj+i/sOWvueixoQogICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0KICAgICAgICovCgoKICAgICAgZnVuY3Rpb24gYnVpbGRBUElNZXRob2QoZGVzY3JpcHRpb24pIHsKICAgICAgICB2YXIgcHJvY2Vzc29ycyA9IGdldFByb2Nlc3NvcnMoZGVzY3JpcHRpb24pOwoKICAgICAgICBmdW5jdGlvbiBwcm9jZXNzKGFyZ3MpIHsKICAgICAgICAgIGVhY2gocHJvY2Vzc29ycywgZnVuY3Rpb24gKHByb2Nlc3NvcikgewogICAgICAgICAgICBhcmdzID0gcHJvY2Vzc29yKGFyZ3MpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gYXJnczsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gcHJvY2VzcyhBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDAsIGRlc2NyaXB0aW9uLmFyZ3MubGVuZ3RoKSk7CiAgICAgICAgfTsKICAgICAgfQogICAgfSAvLyBleHBvcnQgb2JqZWN0ID09PT09PT09PT09CgogICAgLyoqCiAgICAgKiDpu5jorqTnmoQgQVBJIENvbnRhaW5lciDlrp7kvosKICAgICAqCiAgICAgKiBAdHlwZSB7QVBJQ29udGFpbmVyfQogICAgICovCgoKICAgIHZhciBqc05hdGl2ZSA9IG5ldyBBUElDb250YWluZXIoKTsKICAgIC8qKgogICAgICog54mI5pys5Y+3CiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqLwoKICAgIGpzTmF0aXZlLnZlcnNpb24gPSAnMS4yLjQnOwogICAgLyoqCiAgICAgKiDliJvlu7ogQVBJIENvbnRhaW5lcgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0PX0gb3B0aW9ucyDliJvlu7rnmoTlj4LmlbAKICAgICAqIEByZXR1cm4ge0FQSUNvbnRhaW5lcn0KICAgICAqLwoKICAgIGpzTmF0aXZlLmNyZWF0ZUNvbnRhaW5lciA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgIHJldHVybiBuZXcgQVBJQ29udGFpbmVyKG9wdGlvbnMpOwogICAgfTsgLy8gZXhwb3J0ID09PT09PT09PT09PT09CgoKICAgIHJvb3QuanNOYXRpdmUgPSBqc05hdGl2ZTsgLy8gZm9yIENvbW1vbmpzCgogICAgewogICAgICBleHBvcnRzLmpzTmF0aXZlID0ganNOYXRpdmU7CiAgICB9CiAgfSkodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiB0eXBlb2YgY29tbW9uanNHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gY29tbW9uanNHbG9iYWwgOiBjb21tb25qc0dsb2JhbCk7Cn0pOwp2YXIganNOYXRpdmVfMSA9IGpzTmF0aXZlLmpzTmF0aXZlOwovKioKICogQGZpbGUg5Yib5bu6IEFQSSDlrrnlmagKICogQGF1dGhvciB6aG91ZGFuMDMKICogQGRhdGUgMjAxOS82LzIKICovCgp2YXIgYXBpQ29udGFpbmVyID0ganNOYXRpdmVfMS5jcmVhdGVDb250YWluZXIoKS5jb25maWcoewogIGVycm9yVGl0bGU6ICdib3h4JywKICBuYW1pbmdDb25mbGljdDogJ292ZXJyaWRlJwp9KTsKLyoqCiAqIEBmaWxlIE5BIOS4iuiOt+WPliBkZXNjcmlwdGlvbiDnmoTmjqXlj6MKICogQGF1dGhvciB6aG91ZGFuMDMKICogQGRhdGUgMjAxOS81LzI3CiAqLwoKLyoqCiAqIGdldEFQSXMg5o6l5Y+j5o+P6L+wCiAqIEBwYXJhbXMge251bWJlcj0wfSBmcmFnbWVudEluZGV4IOe0ouW8leWAvAogKiBAcmV0dXJucyB7T2JqZWN0fSByZXMg6L+U5Zue5YC8CiAqIEByZXR1cm5zIHtTdHJpbmd9IHJlcy50b3RhbFNsaWNlcyDmgLvniYfmrrXmlbAKICogQHJldHVybnMge09iamVjdH0gcmVzLmN1cnJlbnRJbmRleCDlvZPliY3ntKLlvJUKICogQHJldHVybnMge09iamVjdH0gcmVzLmRlc2NyaXB0aW9ucyDmj4/ov7DooajmlbDnu4QKICovCgp2YXIgbmFHZXRBUElEZXNjID0gewogIGludm9rZTogWydBcmdGdW5jQXJnRGVjb2RlOkpTT04nLCAnQXJnRnVuY0VuY29kZScsICdDYWxsTWV0aG9kJywgJ1JldHVybkRlY29kZTpKU09OJ10sCiAgbmFtZTogJ25hLmdldEFQSXMnLAogIG1ldGhvZDogJ19uYS5nZXRBUElzJywKICBhcmdzOiBbewogICAgbmFtZTogJ2ZyYWdtZW50SW5kZXgnLAogICAgdmFsdWU6ICdudW1iZXI9JwogIH1dCn07Ci8qKgogKiBAZmlsZSBpbnZva2XnroDnp7AKICogQGRlc2NyaXB0aW9uIOS7peS4i+avj+S4qiBpbnZva2Ug6YO95a+55bqU552A5LiA5Liq5Ye95pWw5aSE55CG5qCI77yM5Lya5L6d5qyh5a+555So5oi35Y+C5pWw6L+b6KGM5aSE55CG44CB54S25ZCO5ou85o6l5bm255So5LqO5a+55a6i5oi356uv55qE6YCa5L+h44CC5omA5pyJ55qE5Ye95pWw55qE5a6e546w6YC76L6R5Z2H5L2N5LqOIHByb2Nlc3Nvci5qcyDmiJYganMtbmF0aXZlIOaWh+S7tuS4reOAggogKgogKiBAYXV0aG9yIHpob3VkYW4wMwogKiBAZGF0ZSAyMDE5LzUvMjgKICovCgovKioKICogQXJnRnVuY0FyZ0RlY29kZTpKU09OICAgICDlr7nosIPnlKjlj4LmlbDkuK3nmoTmiYDmnInlm57osIPlh73mlbDvvIzov5vooYzlj4LmlbDop6PnoIHvvIjlj43luo/liJfljJbvvInljIXoo4XvvIjlm6DkuLrlm57osIPmmK/nq6/kuIrop6blj5HvvIzkvKDpgJLlj4LmlbDpgJrluLjmmK/luo/liJfljJblkI7nmoQgSlNPTiDlr7nosaHvvIkKICogQXJnRnVuY0VuY29kZTogIOWvueiwg+eUqOWPguaVsOS4reeahOaJgOacieWbnuiwg+WHveaVsO+8jOi/m+ihjOW6j+WIl+WMluWMheijhSDjgILlhrPlrprkuobmmK/lkKbmioogZnVuYyDmi7zmjqXov5vljrsKICogQXJnc0VuY29kZVRvSlNPTkV4Y2VwdFN0cmluZyAg5a+55LqO5q+P5Liq6ZyA6KaB5ou85o6l5Zyo5Y2P6K6u5Lit55qE5Y+C5pWwKOmZpOS6hnN0cmluZ+S7peWklueahOexu+WeiynvvIzov5vooYxKU09O5bqP5YiX5YyWCiAqIEFyZ0NvbWJpbmU6VVJMICDlsIblj4LmlbDmi7zmjqXkuLrljY/orq4KICogQXJnQ29tYmluZTpKU09OU3RyaW5nIOWwhuWPguaVsOaLvOaOpeS4uuS4gOS4qiBKU09OIOWvueixoQogKiAgZWcuIFtdID09PT1BcmdjQ29tYmluZT09PiB7fSA9PT09SlNOT1N0cmluZz09PT0+ICJ7fSIKICogIGVnLiBbJ3ZhbHVlMScsICd2YWx1ZTInXSA9PT0+IHtrZXkxOnZhbHVlMSwga2V5Mjp2YWx1ZTJ9ICA9PT0+ICJ7ImtleTEiOiJ2YWx1ZTEiLCJrZXkyIjoidmFsdWUyIn0iCiAqCiAqLwovLyBBcmdGdW5jQXJnRGVjb2RlIHdyYXBEZWNvZGVGdW5jQXJnICBmaXhtZSDljrvmjokganNuYXRpdmUg5Zue6LCD5Ye95pWw55qE5Y+N5bqP5YiX5YyW5YyF6KOFIOOAguWboOS4uuacieS6jOe6p+Wbnuiwg+WHveaVsO+8jOi/lOWbnuWAvOaYr+Wtl+espuS4suOAguS4jeiDveiiqyBwYXJzZQoKdmFyIElOVk9LRV9TSE9SVENVVCA9IHsKICAvLyBiZGJveFVSTCDnibnmjIflj4LmlbDlkIjlubbkuLogSlNPTlN0cmluZyDnmoTjgILlj4LmlbDlj6/og73pgJrov4cgcGFyYW1zIOS8oOmAku+8jOS5n+WPr+iDvemAmui/hyBvcHRpb25zIOS8oOmAkgogICdpZnJhbWUuYmRib3hVUkwnOiBbJ0FyZ0NoZWNrV2l0aENhbGxiYWNrJywgLy8g5qCh6aqMQVBJ55qE5Y+C5pWwICjljIXmi6wgc3VjY2VzcyDlkowgZmFpbCkKICAnUmVnaXN0ZXJDYWxsYmFja3MnLCAvLyDms6jlhozkuIDkuoznuqflm57osIPlh73mlbDvvIjnlKjkuo7miafooYwgc3VjY2VzcyDlkowgZmFpbO+8iQogICdBcmdGdW5jQXJnRGVjb2RlOkpTT04nLCAvLyDlr7lBUEnlj4LmlbDkuK3nmoTlm57osIPlh73mlbDnmoTlj4LmlbDlgLzov5vooYwgSlNPTiDop6PnoIEKICAnQXJnRnVuY0VuY29kZScsIC8vIOWvuUFQSeWPguaVsOS4reeahOWHveaVsOi/m+ihjOW6j+WIl+WMluWMheijhe+8iOi9rOS4uumaj+acuuWtl+espuS4suW5tuaMguWcqOWFqOWxgO+8iQogICdBcmdDb21iaW5lV2l0aENhbGxiYWNrOk9iamVjdCcsIC8vIOWwhuWPguaVsOaVsOe7hOWQiOW5tuS4uueUqOS6jnBhcmFtc+WAvOeahOWvueixoeOAgumAj+S8oOS4gOe6p+WbnuiwgwogICdBcmdKU09OU3RyaW5nJywgLy8g5a+5IHBhcmFtcyBzdHJpbmdpZnnvvJvpgI/kvKDkuIDnuqflm57osIMKICAnQXJnQ29tYmluZVdpdGhDYWxsYmFjazpiZGJveFVSTCcsIC8vIOaLvOWNj+iuru+8iOWcqOWNj+iuruS4re+8jOazqOWFpeS4gOe6p+Wbnuiwg++8iQogICdDaGVja1VSTCcsIC8vIOajgOafpSBVUkwg6ZW/5bqm5Y+K54m55q6K5YWz6ZSu5a2XCiAgJ0NhbGxJZnJhbWUnIC8vIOS9v+eUqCBpZnJhbWUg55qE5pa55byP5Y+R5Y2P6K6uCiAgXSwKICAnaWZyYW1lLnVybCc6IFsnQXJnQ2hlY2tXaXRoQ2FsbGJhY2snLCAvLyDmoKHpqoxBUEnnmoTlj4LmlbAgKOWMheaLrCBzdWNjZXNzIOWSjCBmYWlsKQogICdSZWdpc3RlckNhbGxiYWNrcycsIC8vIOazqOWGjOS4gOS6jOe6p+Wbnuiwg+WHveaVsO+8iOeUqOS6juaJp+ihjCBzdWNjZXNzIOWSjCBmYWls77yJCiAgJ0FyZ0Z1bmNBcmdEZWNvZGU6SlNPTicsIC8vIOWvuUFQSeWPguaVsOS4reeahOWbnuiwg+WHveaVsOeahOWPguaVsOWAvOi/m+ihjCBKU09OIOino+eggQogICdBcmdGdW5jRW5jb2RlJywgLy8g5a+5QVBJ5Y+C5pWw5Lit55qE5Ye95pWw6L+b6KGM5bqP5YiX5YyW5YyF6KOF77yI6L2s5Li66ZqP5py65a2X56ym5Liy5bm25oyC5Zyo5YWo5bGA77yJCiAgJ0FyZ3NFbmNvZGVUb0pTT05FeGNlcHRTdHJpbmcnLCAvLyDlr7nkuo7mr4/kuKrpnIDopoHmi7zmjqXlnKjljY/orq7kuK3nmoTlj4LmlbAo6Zmk5LqGc3RyaW5n5Lul5aSW55qE57G75Z6LKe+8jOi/m+ihjOi9rOeggeOAggogICdBcmdDb21iaW5lV2l0aENhbGxiYWNrOlVSTCcsIC8vIOaLvOWNj+iuru+8iOWcqOWNj+iuruS4re+8jOazqOWFpeS4gOe6p+Wbnuiwg++8iQogICdDaGVja1VSTCcsIC8vIOajgOafpSBVUkwg6ZW/5bqm5Y+K54m55q6K5YWz6ZSu5a2XCiAgJ0NhbGxJZnJhbWUnIC8vIOS9v+eUqCBpZnJhbWUg55qE5pa55byP5Y+R5Y2P6K6uCiAgXSwKICAnbWV0aG9kLmFyZ3MtanNvbitjYWxsYmFjayc6IFsnQXJnQ2hlY2tXaXRoQ2FsbGJhY2snLCAvLyDmoKHpqoxBUEnnmoTlj4LmlbAgKOWMheaLrCBzdWNjZXNzIOWSjCBmYWlsKQogICdSZWdpc3RlckNhbGxiYWNrcycsIC8vIOazqOWGjOS4gOS6jOe6p+Wbnuiwg+WHveaVsAogICdBcmdDb21iaW5lV2l0aENhbGxiYWNrOkpTT05TdHJpbmcnLCAvLyA4LjIg5LmL5YmN55qE5o6l5Y+j6KaB5rGC77yMSlNPTiDnsbvlnovlv4XpobvpgJrov4dKU09OLnN0cmluZ2lmeSDlkI7kvKDlhaXjgIIg6L+U5Zue5YC85piv5pWw57uECiAgJ0NhbGxNZXRob2RCeVVzZXJBcmdzOmNhbGxiYWNrJyAvLyDosIPnlKjlronljZPnmoQgSlMgYnJpZGdlCiAgXSwKICAnbWV0aG9kLmFyZ3MtanNvbic6IFsnQXJnQ2hlY2tXaXRoQ2FsbGJhY2snLCAvLyDmoKHpqoxBUEnnmoTlj4LmlbAgKOWMheaLrCBzdWNjZXNzIOWSjCBmYWlsKQogICdSZWdpc3RlckNhbGxiYWNrcycsIC8vIOayoeaciSBjYWxsYmFja++8jOS9huaYr+S5n+aKiiBzdWNjZXNzIOWSjCBmYWlsIOWMhei/m+WOuyBjYWxsYmFja3Mg5pa55L6/5omn6KGMCiAgJ0FyZ0NvbWJpbmVXaXRoQ2FsbGJhY2s6SlNPTlN0cmluZycsIC8vIDguMiDkuYvliY3nmoTmjqXlj6PopoHmsYLvvIxKU09OIOexu+Wei+W/hemhu+mAmui/h0pTT04uc3RyaW5naWZ5IOWQjuS8oOWFpQogICdDYWxsTWV0aG9kQnlVc2VyQXJnczpub0NhbGxiYWNrJyAvLyDosIPnlKjlronljZPnmoQgSlMgYnJpZGdlLiDkuI3mjqXlj5cgY2FsbGJhY2sg5L2c5Li65Y+C5pWw77yM5ZON5bqU6YCa6L+H5Ye95pWw55u05o6l6L+U5Zue44CCCiAgXSwKICAnbWV0aG9kLmJkYm94VVJMJzogWydBcmdDaGVja1dpdGhDYWxsYmFjaycsIC8vIOagoemqjEFQSeeahOWPguaVsCAo5YyF5ousIHN1Y2Nlc3Mg5ZKMIGZhaWwpCiAgJ1JlZ2lzdGVyQ2FsbGJhY2tzJywgLy8g5rOo5YaM5LiA5LqM57qn5Zue6LCD5Ye95pWwCiAgJ0FyZ0Z1bmNBcmdEZWNvZGU6SlNPTicsIC8vIOWvuUFQSeWPguaVsOS4reeahOWbnuiwg+WHveaVsOeahOWPguaVsOWAvOi/m+ihjCBKU09OIOino+eggQogICdBcmdGdW5jRW5jb2RlJywgLy8g5a+5QVBJ5Y+C5pWw5Lit55qE5Ye95pWw6L+b6KGM5bqP5YiX5YyW5YyF6KOF77yI6L2s5Li66ZqP5py65a2X56ym5Liy5bm25oyC5Zyo5YWo5bGA77yJCiAgJ0FyZ0NvbWJpbmVXaXRoQ2FsbGJhY2s6T2JqZWN0JywgLy8g5bCG5Y+C5pWw5pWw57uE5ZCI5bm25Li655So5LqOcGFyYW1z5YC855qE5a+56LGh44CC6L6T5YWl5pWw57uE77yM6L6T5Ye65a+56LGh77yI5YyF5ous5LiA57qn5Zue6LCD77yJCiAgJ0FyZ0pTT05TdHJpbmcnLCAvLyDlr7kgcGFyYW1zIHN0cmluZ2lmee+8m+mAj+S8oOS4gOe6p+WbnuiwgwogICdBcmdDb21iaW5lV2l0aENhbGxiYWNrOmJkYm94VVJMJywgLy8g5ou85Y2P6K6u77yI5Zyo5Y2P6K6u5Lit77yM5rOo5YWl5LiA57qn5Zue6LCD77yJCiAgJ0NoZWNrVVJMJywgLy8g5qOA5p+lIFVSTCDplb/luqblj4rnibnmrorlhbPplK7lrZcKICAnQ2FsbE1ldGhvZEJ5VXNlckFyZ3M6Y2FsbGJhY2snIC8vIOaOpeWPl+eahOWPguaVsOS4uuaVsOe7hAogIF0sCiAgJ21ldGhvZC51cmwnOiBbJ0FyZ0NoZWNrV2l0aENhbGxiYWNrJywgLy8g5qCh6aqMQVBJ55qE5Y+C5pWwICjljIXmi6wgc3VjY2VzcyDlkowgZmFpbCkKICAnUmVnaXN0ZXJDYWxsYmFja3MnLCAvLyDms6jlhozkuIDkuoznuqflm57osIPlh73mlbDvvIjnlKjkuo7miafooYwgc3VjY2VzcyDlkowgZmFpbO+8iQogICdBcmdGdW5jQXJnRGVjb2RlOkpTT04nLCAvLyDlr7lBUEnlj4LmlbDkuK3nmoTlm57osIPlh73mlbDnmoTlj4LmlbDlgLzov5vooYwgSlNPTiDop6PnoIEKICAnQXJnRnVuY0VuY29kZScsIC8vIOWvuUFQSeWPguaVsOS4reeahOWHveaVsOi/m+ihjOW6j+WIl+WMluWMheijhe+8iOi9rOS4uumaj+acuuWtl+espuS4suW5tuaMguWcqOWFqOWxgO+8iQogICdBcmdzRW5jb2RlVG9KU09ORXhjZXB0U3RyaW5nJywgLy8g5a+55LqO5q+P5Liq6ZyA6KaB5ou85o6l5Zyo5Y2P6K6u5Lit55qE5Y+C5pWwKOmZpOS6hnN0cmluZ+S7peWklueahOexu+WeiynvvIzov5vooYzovaznoIHjgIIKICAnQXJnQ29tYmluZVdpdGhDYWxsYmFjazpVUkwnLCAvLyDmi7zljY/orq7vvIjlnKjljY/orq7kuK3vvIzms6jlhaXkuIDnuqflm57osIPvvIkKICAnQ2hlY2tVUkwnLCAvLyDmo4Dmn6UgVVJMIOmVv+W6puWPiueJueauiuWFs+mUruWtlwogICdDYWxsTWV0aG9kQnlVc2VyQXJnczpjYWxsYmFjaycgLy8g5o6l5Y+X55qE5Y+C5pWw5Li65pWw57uECiAgXSwKICAnbWV0aG9kLm9wZW5Td2FuJzogWydBcmdDaGVja1dpdGhDYWxsYmFjaycsIC8vIOagoemqjEFQSeeahOWPguaVsCAo5YyF5ousIHN1Y2Nlc3Mg5ZKMIGZhaWwpCiAgJ1JlZ2lzdGVyQ2FsbGJhY2tzJywgLy8g5rOo5YaM5LiA5LqM57qn5Zue6LCD5Ye95pWw77yI55So5LqO5omn6KGMIHN1Y2Nlc3Mg5ZKMIGZhaWzvvIkKICAnQXJnc0VuY29kZVRvSlNPTkV4Y2VwdFN0cmluZycsIC8vIOWvueS6juavj+S4qumcgOimgeaLvOaOpeWcqOWNj+iuruS4reeahOWPguaVsCjpmaTkuoZzdHJpbmfku6XlpJbnmoTnsbvlnosp77yM6L+b6KGM6L2s56CB44CCCiAgJ1N3YW5TY2hlbWVDb21iaW5lJywgLy8g5bCP56iL5bqP54m55pyJ55qE5ou85o6l5pa55byPCiAgJ0NoZWNrVVJMJywgLy8g5qOA5p+lIFVSTCDplb/luqblj4rnibnmrorlhbPplK7lrZcKICAnQ2FsbE1ldGhvZEJ5VXNlckFyZ3M6Y2FsbGJhY2snIC8vIOaOpeWPl+eahOWPguaVsOS4uuaVsOe7hAogIF0sCiAgJ2lmcmFtZS5vcGVuU3dhbic6IFsnQXJnQ2hlY2tXaXRoQ2FsbGJhY2snLCAvLyDmoKHpqoxBUEnnmoTlj4LmlbAgKOWMheaLrCBzdWNjZXNzIOWSjCBmYWlsKQogICdSZWdpc3RlckNhbGxiYWNrcycsIC8vIOazqOWGjOS4gOS6jOe6p+Wbnuiwg+WHveaVsO+8iOeUqOS6juaJp+ihjCBzdWNjZXNzIOWSjCBmYWls77yJCiAgJ0FyZ3NFbmNvZGVUb0pTT05FeGNlcHRTdHJpbmcnLCAvLyDlr7nkuo7mr4/kuKrpnIDopoHmi7zmjqXlnKjljY/orq7kuK3nmoTlj4LmlbAo6Zmk5LqGc3RyaW5n5Lul5aSW55qE57G75Z6LKe+8jOi/m+ihjOi9rOeggeOAggogICdTd2FuU2NoZW1lQ29tYmluZScsIC8vIOWwj+eoi+W6j+eJueacieeahOaLvOaOpeaWueW8jwogICdDaGVja1VSTCcsIC8vIOajgOafpSBVUkwg6ZW/5bqm5Y+K54m55q6K5YWz6ZSu5a2XCiAgJ0NhbGxJZnJhbWUnIC8vIOS9v+eUqCBpZnJhbWUg55qE5pa55byP5Y+R5Y2P6K6uCiAgXQp9OwovKioKICogQGZpbGUg5ZCI5bm255Sf5oiQ5LiA5Lu95L2/55So55qEIGRlc2NyaXB0aW9uIOaVsOe7hAogKiBAYXV0aG9yIHpob3VkYW4wMwogKiBAZGF0ZSAyMDE5LzUvMjcKICovCgovKioKICog5qC55o2u5YWs5Y+C5L+h5oGv6YeM55qEIOKAnOm7mOiupOWtl+auteKAnSDnu5nmr4/kuKpkZXNjcmlwdGlvbiDlop7liqDpu5jorqTlgLwKICoKICogQHBhcmFtIHtBcnJheX0gbmF0aXZlRGVzY3JpcHRpb25zICBuYeaPj+i/sOihqAogKiBAcGFyYW0ge09iamVjdH0gZGVmYXVsdHNGaWVsZHMKICogQHJldHVybiB7QXJyYXl9IOaPj+i/sOihqAogKi8KCmZ1bmN0aW9uIGFkZERlZmF1bHRGaWVsZHMobmF0aXZlRGVzY3JpcHRpb25zLCBkZWZhdWx0c0ZpZWxkcykgewogIC8vIGZpeG1lIOWuieWNk+WcqOW8gOWFs+WFs+mXreaXtu+8jOS7jeeEtui/lOWbnuacieS4gOS4quWFg+e0oOeahOaVsOe7hO+8jOWvvOiHtOWIpOaWreWkseaViOOAguS4tOaXtiBoYXJkIGNvZGXvvIwxMS4zLjUgQOmCtemiluaFpyDkv67lpI3lkI7lsLHliKDmjonjgIIKICBpZiAobmF0aXZlRGVzY3JpcHRpb25zLmxlbmd0aCA9PT0gMSkgewogICAgcmV0dXJuIFtdOwogIH0KCiAgcmV0dXJuIG5hdGl2ZURlc2NyaXB0aW9ucy5tYXAoZnVuY3Rpb24gKGRlc2MpIHsKICAgIGZvciAodmFyIGtleSBpbiBkZWZhdWx0c0ZpZWxkcykgewogICAgICBpZiAoZGVmYXVsdHNGaWVsZHMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgIGRlc2Nba2V5XSA9IGRlc2Nba2V5XSB8fCBkZWZhdWx0c0ZpZWxkc1trZXldOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGRlc2M7CiAgfSk7Cn0KLyoqCiAqIOWIoOmZpOaPj+i/sOihqAogKiDlj6rmnIkgbmFtZSDlrZfmrrXml7bvvIzorqTkuLrmmK/ml6DmlYjnmoTmj4/ov7DooajvvIzpnIDopoHliKDpmaTvvIxwczog5LuO5ZCO5b6A5YmN6YGN5Y6G5Yig6Zmk5LiN5Lya5b2x5ZON5LiL5qCHCiAqIEBwYXJhbSB7QXJyYXl9IGRlc2NyaXB0aW9ucyDmj4/ov7DooagKICogQHJldHVybiB7dm9pZH0KICovCgoKZnVuY3Rpb24gZGVsZXRlRGVzY3JpcHRpb25zKGRlc2NyaXB0aW9ucykgewogIGZvciAodmFyIGkgPSBkZXNjcmlwdGlvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoZGVzY3JpcHRpb25zW2ldKTsKCiAgICBpZiAoa2V5cy5sZW5ndGggPT09IDEgJiYga2V5c1swXSA9PT0gJ25hbWUnKSB7CiAgICAgIGRlc2NyaXB0aW9ucy5zcGxpY2UoaSwgMSk7CiAgICB9CiAgfQp9Ci8qKgogKiDku47lrqLmiLfnq6/ojrflj5YgQVBJCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBhcGlDb250YWluZXIg55SxanNOYXRpdmXliJvlu7rnmoQgQVBJQ29udGFpbmVyIOWunuS+iwogKiBAcmV0dXJuIHtBcnJheX0g6L+U5ZueIE5BIOeahOaPj+i/sOihqOaVsOe7hAogKi8KCgpmdW5jdGlvbiBnZXROQURlc2NyaXB0aW9ucyhhcGlDb250YWluZXIpIHsKICBpZiAodHlwZW9mIF9uYSA9PT0gJ3VuZGVmaW5lZCcgfHwgX25hID09PSBudWxsIHx8ICFfbmEuZ2V0QVBJcykgewogICAgZGVidWcoJ+err+aPj+i/sOihqOW8gOWFs+W3suWFs+mXrScpOwogICAgcmV0dXJuIFtdOwogIH0KCiAgZGVidWcoJ+err+aPj+i/sOihqOW8gOWFs+W3suaJk+W8gO+8jCDnq6/kuIrkvJrms6jlhaXmj4/ov7DooajvvIwg5L2G5aaC5p6c5q2k5pe25ZCM5pe25byV5YWl5LqG5YWc5bqV5o+P6L+w6KGo77yMIOWImeS8muiiq+WFnOW6leaPj+i/sOihqOimhueblu+8jOebruWJjeefqemYte+8iGxpdGXjgIF0b21hc+OAgemdkuaYpeeJiO+8ieS6p+WTgeWxnuS6juivpeenjeaDheWGtScpOwogIHZhciBuYXRpdmVEZXNjcmlwdGlvbnMgPSBbXTsKICB2YXIgcmVzdWx0RGVzY3JpcHRpb25zID0gW107CiAgdmFyIGFtZW5kRGVzY3JpcHRpb25zID0gW107CiAgdmFyIG5hdGl2ZVNsaWNlczsKICB2YXIgZGVmYXVsdHNGaWVsZHM7CiAgdmFyIGkgPSAwOwoKICBkbyB7CiAgICB2YXIgcmVmID0gYXBpQ29udGFpbmVyLmludm9rZUFQSShuYUdldEFQSURlc2MsIFtpXSk7CiAgICB2YXIgdG90YWxTbGljZXMgPSByZWYudG90YWxTbGljZXM7CiAgICB2YXIgZGVzY3JpcHRpb25zID0gcmVmLmRlc2NyaXB0aW9uczsKICAgIHZhciBkZWZhdWx0cyA9IHJlZi5kZWZhdWx0czsKICAgIGRlZmF1bHRzRmllbGRzID0gZGVmYXVsdHM7CiAgICBuYXRpdmVTbGljZXMgPSB0b3RhbFNsaWNlczsKICAgIGkrKzsKICAgIG5hdGl2ZURlc2NyaXB0aW9ucyA9IG5hdGl2ZURlc2NyaXB0aW9ucy5jb25jYXQoZGVzY3JpcHRpb25zKTsKICB9IHdoaWxlIChpIDwgbmF0aXZlU2xpY2VzKTsKCiAgbmF0aXZlRGVzY3JpcHRpb25zID0gYWRkRGVmYXVsdEZpZWxkcyhuYXRpdmVEZXNjcmlwdGlvbnMsIGRlZmF1bHRzRmllbGRzKTsgLy8g6I635Y+W5L+u5aSN5o+P6L+w6KGo77yM5YGabWVyZ2UKCiAgaWYgKF9uYSAmJiBfbmEuZ2V0QW1lbmRBUElzKSB7CiAgICB2YXIgYW1lbmREZXNjSnNvblN0ck9yQXJyYXkgPSBfbmEuZ2V0QW1lbmRBUElzKCk7CgogICAgaWYgKGFtZW5kRGVzY0pzb25TdHJPckFycmF5ICYmIHR5cGVvZiBhbWVuZERlc2NKc29uU3RyT3JBcnJheSA9PT0gJ3N0cmluZycpIHsKICAgICAgdHJ5IHsKICAgICAgICBhbWVuZERlc2NyaXB0aW9ucyA9IEpTT04ucGFyc2UoYW1lbmREZXNjSnNvblN0ck9yQXJyYXkpOwogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogICAgICAgIGlmICgicHJvZHVjdGlvbiIgPT09ICdkZXZlbG9wbWVudCcgfHwgInByb2R1Y3Rpb24iID09PSAnZGV2ZWxvcG1lbnQtbW9jaycpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0t5L+u5aSN5o+P6L+w6KGo5L+h5oGvLS0tLS0tLS0tLS0tLS0tLS0tLScpOwogICAgICAgICAgY29uc29sZS5sb2coJ2FtZW5kIGRlc2NyaXB0aW9uczo6ICcsIGFtZW5kRGVzY3JpcHRpb25zKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGFtZW5kRGVzY0pzb25TdHJPckFycmF5KSkgewogICAgICBhbWVuZERlc2NyaXB0aW9ucyA9IGFtZW5kRGVzY0pzb25TdHJPckFycmF5OwogICAgfQoKICAgIGlmIChhbWVuZERlc2NyaXB0aW9ucyAmJiBhbWVuZERlc2NyaXB0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgIHZhciBhbWVuZERlc2MgPSB7fTsKICAgICAgYW1lbmREZXNjcmlwdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGFtZW5kRGVzY1tpdGVtLm5hbWVdID0gaXRlbTsKICAgICAgfSk7IC8vIOWtmOWcqOS6keaOp+eahG5hbWXvvIzpnIDopoHliKDpmaTnq6/kuIvlj5HnmoTmj4/ov7DooagKCiAgICAgIGZvciAodmFyIGkkMSA9IG5hdGl2ZURlc2NyaXB0aW9ucy5sZW5ndGggLSAxOyBpJDEgPj0gMDsgaSQxLS0pIHsKICAgICAgICBpZiAoYW1lbmREZXNjW25hdGl2ZURlc2NyaXB0aW9uc1tpJDFdLm5hbWVdKSB7CiAgICAgICAgICBuYXRpdmVEZXNjcmlwdGlvbnMuc3BsaWNlKGkkMSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICByZXN1bHREZXNjcmlwdGlvbnMgPSBuYXRpdmVEZXNjcmlwdGlvbnMuY29uY2F0KGFtZW5kRGVzY3JpcHRpb25zKTsgLy8g5Y+q5pyJbmFtZeWtl+aute+8jOWIoOmZpOepuueahOaPj+i/sOihqAoKICBkZWxldGVEZXNjcmlwdGlvbnMocmVzdWx0RGVzY3JpcHRpb25zKTsKICByZXR1cm4gcmVzdWx0RGVzY3JpcHRpb25zOwp9Ci8qKgogKiDojrflj5bmn5DkuKrmj4/ov7DooajmlK/mjIHnmoTniYjmnKzlj7cKICogQHBhcmFtIHtPYmplY3R9IGVudiDnjq/looPlgLwKICogQHJldHVybiB7c3RyaW5nfSDniYjmnKzlj7cKICovCgoKZnVuY3Rpb24gZ2V0VmVyc2lvbkJ5RW52KGVudiwgb3B0aW9ucykgewogIHZhciBhcHBUeXBlID0gb3B0aW9ucy5hcHBUeXBlOwogIHZhciBhZGFwdEFwcFR5cGUgPSBvcHRpb25zLmFkYXB0QXBwVHlwZTsgLy8g5qC55o2u5b2T5YmNIFVBIOexu+WeiyBib3hUeXBl6I635Y+W5YWc5bqV5o+P6L+w6KGoIGVudiDkuK3nmoTphY3nva7niYjmnKwKCiAgdmFyIHZlcnNpb24gPSBnZXRWZXJzaW9uQnlCb3h0eXBlSW5FbnYoZW52LCBhcHBUeXBlKTsgLy8g5LyY5YWI5L2/55So5YWc5bqV5o+P6L+w6KGo5Lit6YWN572u55qE5L+h5oGvCiAgLy8gMeOAgeiLpemFjee9ruS6huaUr+aMgeeahOeJiOacrO+8jOS+i+Wmgu+8micyLjAn77yM5LyY5YWI5L2/55So6K+l6YWN572u5L+h5oGvCiAgLy8gMuOAgeiLpemFjee9ruS6hmZhbHNl77yM6KGo56S66ZyA6KaB6KOB5Ymq5o6J6K+l56uv6IO95YqbCiAgLy8gM+OAgeiLpeayoeaciemFjee9ruebuOWFs+S/oeaBr3VuZGVmaW5lZO+8jOWImeS9v+eUqOmAgumFjeS4u+e6v+S7peWQjueahOeJiOacrAoKICBpZiAodmVyc2lvbiB8fCB2ZXJzaW9uID09PSBmYWxzZSkgewogICAgcmV0dXJuIHsKICAgICAgaXNBZGFwdGVkOiBmYWxzZSwKICAgICAgc3RhcnRlZFZlcnNpb246IHZlcnNpb24KICAgIH07CiAgfSAvLyDmoLnmja7pgILphY3lkI7nmoQgVUEg57G75Z6LIGFkYXB0Qm94VHlwZeiOt+WPluWFnOW6leaPj+i/sOihqCBlbnYg5Lit55qE6YCC6YWN54mI5pysCgoKICB2YXIgYWRhcHRWZXJzaW9uID0gZ2V0VmVyc2lvbkJ5Qm94dHlwZUluRW52KGVudiwgYWRhcHRBcHBUeXBlKTsgLy8g5YW25qyh5L2/55So6YCC6YWN5Li757q/55qE54mI5pysCgogIGlmIChhZGFwdFZlcnNpb24pIHsKICAgIHJldHVybiB7CiAgICAgIGlzQWRhcHRlZDogdHJ1ZSwKICAgICAgc3RhcnRlZFZlcnNpb246IGFkYXB0VmVyc2lvbgogICAgfTsKICB9IC8vIOayoeacieWvuem9kOS4u+e6v+eahOefqemYteS8mui1sOWIsOivpemAu+i+kQoKCiAgcmV0dXJuIHsKICAgIGlzQWRhcHRlZDogZmFsc2UsCiAgICBzdGFydGVkVmVyc2lvbjogSU5GSU5JVFlWRVJTSU9OCiAgfTsKfQovKioKICog5L+d55WZIOayoeacieagh+azqOeJiOacrOWPt+eahO+8jOS7peWPiiDmoIfms6jnmoTotbflp4vniYjmnKzlj7cg5bCP5LqO5b2T5YmN5omL55m+54mI5pys5Y+355qECiAqIEBwYXJhbSB7QXJyYXl9IGRlc2NyaXB0aW9ucyDmj4/ov7DooagKICogQHJldHVybiB7QXJyYXl9IOi/h+a7pOWQjueahOaPj+i/sOihqAogKi8KCgpmdW5jdGlvbiBmaWx0ZXJWZXJzaW9uKGRlc2NyaXB0aW9ucykgewogIC8vIOS4uuS6humBv+WFjeWFqOWxgOWPmOmHj+iiq+S/ruaUue+8jOi/memHjOWvueixoeeahOWxnuaAp+mHjeWRveWQje+8jOS4juWFqOWxgOWPmOmHj+WQjeS4jeWQjAogIHZhciBvcHRpb25zID0gewogICAgYXBwVHlwZTogYm94VHlwZSwKICAgIGFkYXB0QXBwVHlwZTogYWRhcHRCb3hUeXBlLAogICAgcmVhbEFwcFZlcnNpb246IHJlYWxCb3hWZXJzaW9uLAogICAgYXBwVmVyc2lvbjogYm94VmVyc2lvbgogIH07CiAgcmV0dXJuIGRlc2NyaXB0aW9ucy5maWx0ZXIoZnVuY3Rpb24gKGRlc2NyaXB0aW9uKSB7CiAgICByZXR1cm4gaXNDYXBhY2l0eUV4aXN0aW5nKGRlc2NyaXB0aW9uLCBvcHRpb25zKTsKICB9KTsKfQovKioKICog6I635Y+W5YmN56uv6aKE572u5o+P6L+w6KGo77yI5qC55o2u54mI5pys44CB5bmz5Y+w562J5LiN5ZCM77yM6L6T5Ye655qE5o+P6L+w6KGo5LiN5ZCM77yJCiAqCiAqIEByZXR1cm4ge0FycmF5fSDmj4/ov7DooagKICovCgoKZnVuY3Rpb24gZ2V0RGVmYXVsdERlc2NyaXB0aW9uKGRlZmF1bHREZWNzKSB7CiAgdmFyIGRlc2NyaXB0aW9ucyA9IGlzSU9TID8gZGVmYXVsdERlY3MuaW9zIDogZGVmYXVsdERlY3MuYW5kcm9pZDsKICByZXR1cm4gZGVzY3JpcHRpb25zICYmIGRlc2NyaXB0aW9ucy5sZW5ndGggPiAwID8gZmlsdGVyVmVyc2lvbihkZXNjcmlwdGlvbnMpIDogW107Cn0KLyoqCiAqIOiOt+WPluWJjeerr+eUqOS6juWFvOWuueeahOS9jueJiOacrOmihOe9ruaPj+i/sOihqAogKgogKiBAcmV0dXJuIHtBcnJheX0g5o+P6L+w6KGoCiAqLwoKCmZ1bmN0aW9uIGdldENvbXBhdGliaWxpdHlEZXNjcmlwdGlvbihkZWZhdWx0RGVjcykgewogIHZhciBkZXNjcmlwdGlvbnMgPSBpc0lPUyA/IGRlZmF1bHREZWNzLmlvc0NvbXBhdGliaWxpdHkgOiBkZWZhdWx0RGVjcy5hbmRyb2lkQ29tcGF0aWJpbGl0eTsKICByZXR1cm4gZmlsdGVyVmVyc2lvbihkZXNjcmlwdGlvbnMgfHwgW10pOwp9Ci8qKgogKiDmoLnmja7nn6npmLXkuqflk4Hnsbvlnovojrflj5ZlbnbkuK3nmoTniYjmnKzphY3nva4KICovCgoKZnVuY3Rpb24gZ2V0VmVyc2lvbkJ5Qm94dHlwZUluRW52KGVudiwgYm94VHlwZSkgewogIHJldHVybiBlbnYgJiYgZW52W2JveFR5cGVdICYmIGVudltib3hUeXBlXVtib3hCcm93c2VyVHlwZV07Cn0KLyoqCiAqIOivpeerr+iDveWKm+aYr+WtmOWcqOeahO+8iOagueaNruWSjOW9k+WJjeaJi+eZvueJiOacrOWPt+avlOWvueiAjOW+l++8iQogKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g5o+P6L+w6KGoCiAqIEByZXR1cm4ge2Jvb2xlYW59ICB0cnVlIOWtmOWcqO+8jGZhbHNlIOS4jeWtmOWcqAogKi8KCgpmdW5jdGlvbiBpc0NhcGFjaXR5RXhpc3RpbmcoZGVzY3JpcHRpb24sIG9wdGlvbnMpIHsKICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSBvcHRpb25zID0gewogICAgYXBwVHlwZTogYm94VHlwZSwKICAgIGFkYXB0QXBwVHlwZTogYWRhcHRCb3hUeXBlLAogICAgcmVhbEFwcFZlcnNpb246IHJlYWxCb3hWZXJzaW9uLAogICAgYXBwVmVyc2lvbjogYm94VmVyc2lvbgogIH07IC8vIOWPmOmHj+WRveWQjeS4jeimgeS4juWFqOWxgOWPmOmHj+WQjOWQje+8jOWQpuWImeWFqOWxgOWPmOmHj+S8muiiq+S/ruaUuQoKICB2YXIgcmVhbEFwcFZlcnNpb24gPSBvcHRpb25zLnJlYWxBcHBWZXJzaW9uOwogIHZhciBhcHBWZXJzaW9uID0gb3B0aW9ucy5hcHBWZXJzaW9uOwogIHZhciByZWYgPSBnZXRWZXJzaW9uQnlFbnYoZGVzY3JpcHRpb24uZW52LCBvcHRpb25zKTsKICB2YXIgaXNBZGFwdGVkID0gcmVmLmlzQWRhcHRlZDsKICB2YXIgc3RhcnRlZFZlcnNpb24gPSByZWYuc3RhcnRlZFZlcnNpb247IC8vIOiLpeWFnOW6leaPj+i/sOihqOS4remFjee9ruS6hmZhbHNl77yM5YiZ6KGo56S65LiN5pSv5oyBCgogIGlmICghc3RhcnRlZFZlcnNpb24pIHsKICAgIHJldHVybiBmYWxzZTsKICB9IC8vIOiLpeWFnOW6leaPj+i/sOihqOS4reWtmOWcqOmFjee9ruS/oeaBr++8jOS9v+eUqOecn+WunueJiOacrOWvueavlO+8jOS4jeWtmOWcqOS9v+eUqOmAgumFjeeJiOacrAoKCiAgdmFyIHZlcnNpb24gPSBpc0FkYXB0ZWQgPyBhcHBWZXJzaW9uIDogcmVhbEFwcFZlcnNpb247CiAgcmV0dXJuIHZlcnNpb24gPyB2ZXJzaW9uQ29tcGFyZSh2ZXJzaW9uLCBzdGFydGVkVmVyc2lvbikgPj0gMCA6IGZhbHNlOwp9Ci8qKgogKiDlr7nmj4/ov7DooajnmoTlrZfmrrXmoIflh4bljJblpITnkIbvvJppbnZva2Ug5LuO57yp5YaZID0+IHByb2Nlc3NvciDmlbDnu4QKICoKICogQHBhcmFtIHtPYmplY3R9IGRlc2NyaXB0aW9uIOaPj+i/sOihqAogKiBAcmV0dXJuIHtPYmplY3R9IOagh+WHhuWMluWkhOeQhuWQjueahOaPj+i/sOihqAogKi8KCgpmdW5jdGlvbiBub3JtYWxpemVEZXNjcmlwdGlvbihkZXNjcmlwdGlvbikgewogIGRlc2NyaXB0aW9uLmludm9rZSA9IElOVk9LRV9TSE9SVENVVFtkZXNjcmlwdGlvbi5pbnZva2VdIHx8IGRlc2NyaXB0aW9uLmludm9rZTsKICBkZXNjcmlwdGlvbi5wYXRoID0gZGVzY3JpcHRpb24ucGF0aCB8fCAnJzsKICByZXR1cm4gZGVzY3JpcHRpb247Cn0KCmZ1bmN0aW9uIGdldExvY2FsRGVzY3JpcHRpb25zKGRlZmF1bHREZWNzKSB7CiAgdmFyIGRlZmF1bHREZXNjcmlwdGlvbnMgPSBnZXREZWZhdWx0RGVzY3JpcHRpb24oZGVmYXVsdERlY3MpOyAvLyDlhbzlrrnmgKfnmoTmj4/ov7DooajvvIzku4XlrZjlnKjkuo7liY3nq6/jgILkuI3lj4LkuI7lkowgTkEg55qEIG1lcmdlIOetlueVpe+8jG1lcmdlIOWujOWQjuebtOaOpeaLvOaOpQoKICB2YXIgY29tcGF0aWJpbGl0eURlc2NyaXB0aW9ucyA9IGdldENvbXBhdGliaWxpdHlEZXNjcmlwdGlvbihkZWZhdWx0RGVjcyk7CiAgdmFyIG1lcmdlZERlZmF1bHREZXNjcmlwdGlvbnMgPSBkZWZhdWx0RGVzY3JpcHRpb25zLmNvbmNhdChjb21wYXRpYmlsaXR5RGVzY3JpcHRpb25zKTsKICBtZXJnZWREZWZhdWx0RGVzY3JpcHRpb25zLmZvckVhY2gobm9ybWFsaXplRGVzY3JpcHRpb24pOwogIHJldHVybiBtZXJnZWREZWZhdWx0RGVzY3JpcHRpb25zOwp9Ci8qKgogKiDojrflj5bnq6/kuIvlj5HnmoTmj4/ov7DooagKICoKICogQHBhcmFtIHtPYmplY3R9IGFwaUNvbnRhaW5lciDnlLFqc05hdGl2ZeWIm+W7uueahCBBUElDb250YWluZXIg5a6e5L6LCiAqIEByZXR1cm4ge0FycmF5fSDmnIDnu4jmj4/ov7DooajmlbDnu4QKICovCgoKZnVuY3Rpb24gZ2V0RGVzY3JpcHRpb25zKGFwaUNvbnRhaW5lcikgewogIHZhciBuYXRpdmVEZXNjcmlwdGlvbnMgPSBnZXROQURlc2NyaXB0aW9ucyhhcGlDb250YWluZXIpOwogIG5hdGl2ZURlc2NyaXB0aW9ucy5mb3JFYWNoKG5vcm1hbGl6ZURlc2NyaXB0aW9uKTsKICByZXR1cm4gbmF0aXZlRGVzY3JpcHRpb25zOwp9Ci8qKgogKiBAZmlsZSAg5Zue6LCD5Ye95pWw5aSE55CG6YC76L6RCiAqIEBhdXRob3IgemhvdWRhbjAzIHRpYW50eTA1CiAqIEBkYXRlIDIwMTkvNi8xMgogKi8KCi8qKgogKiDlronljZPmsqHmnInov5Tlm57lgLzvvIzosIPnlKjlkI7nm7TmjqXpu5jorqTmiJDlip/jgILkv67lpI3ov5nnp43ljoblj7LpgZfnlZkgYnVnIOS4jeS8mumAoOaIkOWFvOWuueaAp+mXrumimO+8jOW6lOivpeS/ruWkjeOAgnRvZG8g5o6o5YqoIOWuouaIt+erryBSRCDmjpLmnJ/kv67lpI0KICogQHJldHVybiB7e3N0YXR1czogbnVtYmVyLCBtZXNzYWdlOiBzdHJpbmd9fQogKi8KCgpmdW5jdGlvbiByZXR1cm5EZWZhdWx0U3VjY2VzcygpIHsKICByZXR1cm4gewogICAgc3RhdHVzOiAwLAogICAgbWVzc2FnZTogJ3N1Y2Nlc3M6IE5BIOaXoOi/lOWbnuS/oeaBr++8jOm7mOiupOaIkOWKnycKICB9Owp9IC8vIOS4jeinhOWImeeahOerr+iDveWKm+i/lOWbnuWAvAoKLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCgp2YXIgaXJyZWd1bGFyUmVzcG9uc2VIYW5kbGVycyA9IHsKICAnZmVlZC51cGRhdGVGYXZvckluZm8nOiByZXR1cm5EZWZhdWx0U3VjY2VzcywKICAnaHlicmlkLnJlbGlhYmlsaXR5TG9nJzogcmV0dXJuRGVmYXVsdFN1Y2Nlc3MsCiAgJ2ZlZWQuc2hvd0Rpc2xpa2UnOiByZXR1cm5EZWZhdWx0U3VjY2VzcywKICAnZWFzeUJyb3dzZXIub3Blbic6IHJldHVybkRlZmF1bHRTdWNjZXNzLAogICdhY2NvdW50LmxvZ2luJzogZnVuY3Rpb24gYWNjb3VudExvZ2luKHJlcykgewogICAgaWYgKHJlcy5kYXRhKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgc3RhdHVzOiByZXMuZGF0YS5zdGF0dXMgPT09ICcxJyA/IDAgOiAxLAogICAgICAgIG1lc3NhZ2U6IHJlcy5kYXRhLnN0YXR1cyA9PT0gJzEnID8gJ2xvZ2luIHN1Y2Nlc3MnIDogJ2xvZ2luIGZhaWwnCiAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIHJlczsKICB9LAogIC8vIGRvYzogaHR0cDovL2NwMDEtaW52b2tlci0zLW1ndDE2MTY1Ny5lcGMuYmFpZHUuY29tOjgwMDcvaW52b2tlcnM/aWQ9NTQ3NmNiMWMzMTliZjhkMzRjZTIwNTJiCiAgJ2RldmljZS5nZXRDVUlEJzogZnVuY3Rpb24gZGV2aWNlR2V0Q1VJRChyZXMpIHsKICAgIC8vIOWkhOeQhmlvc+aJi+eZvmxpdGXlkoznnIvlpJrlpJrkuIvnmoTmg4XlhrUKICAgIGlmIChyZXMgJiYgcmVzLnJlc3VsdCA9PT0gMCkgewogICAgICByZXR1cm4gewogICAgICAgIHN0YXR1czogMCwKICAgICAgICBtZXNzYWdlOiAnc3VjY2VzcycsCiAgICAgICAgZGF0YTogewogICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZQogICAgICAgICAgdW5pcXVlX2lkOiByZXMudW5pcXVlX2lkCiAgICAgICAgfQogICAgICB9OwogICAgfSAvLyDlpITnkIblronljZPkuIvkvY7niYjmnKzov5Tlm54ge2Vycm9yOiAwLCByZXN1bHQ6ICd4eHh4J30KCgogICAgaWYgKHJlcyAmJiByZXMuZXJyb3IgPT09IDApIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBzdGF0dXM6IDAsCiAgICAgICAgbWVzc2FnZTogJ3N1Y2Nlc3MnLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2UKICAgICAgICAgIHVuaXF1ZV9pZDogcmVzLnJlc3VsdAogICAgICAgIH0KICAgICAgfTsKICAgIH0gLy8g5a6J5Y2T55qEIGdldENVSUQg6L+U5Zue5YC85piv5a2X56ym5Liy44CCaU9TIOi/lOWbnuaYr+WvueixoeOAguWJjeerr+WFvOWuueWvuem9kAoKCiAgICBpZiAoaXNBbmRyb2lkICYmICh2ZXJzaW9uQ29tcGFyZShib3hWZXJzaW9uLCAnNy40JykgPj0gMCB8fCAhaXNNYWluQm94KSkgewogICAgICB2YXIgaGFzQ1VJRCA9IHJlcyAmJiByZXMubGVuZ3RoID4gMDsKICAgICAgcmV0dXJuIHsKICAgICAgICBzdGF0dXM6IGhhc0NVSUQgPyAwIDogMSwKICAgICAgICBtZXNzYWdlOiBoYXNDVUlEID8gJ3N1Y2Nlc3MnIDogJ2ZhaWwnLAogICAgICAgIGRhdGE6IGhhc0NVSUQgPyB7CiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2FtZWxjYXNlCiAgICAgICAgICB1bmlxdWVfaWQ6IHJlcwogICAgICAgIH0gOiB7fQogICAgICB9OwogICAgfSAvLyDkvY7niYjmnKznmoTpgLvovpHmmoLml6Dms5Xpqozor4HvvIzlj5boh6rkuo7ljp8gSlNTREvvvIzlj6/kuI7kuJrliqHmlrnnoa7orqQKCgogICAgaWYgKGlzQW5kcm9pZCAmJiB2ZXJzaW9uQ29tcGFyZShib3hWZXJzaW9uLCAnNy40JykgPCAwIHx8IGlzSU9TICYmIHZlcnNpb25Db21wYXJlKGJveFZlcnNpb24sICc4LjQnKSA8IDApIHsKICAgICAgdmFyIG1hdGNoID0gaXNBbmRyb2lkID8gZG9jdW1lbnQuY29va2llLm1hdGNoKC9CQUlEVUNVSUQ9KC4rPyk7LykgOiBVQS5tYXRjaCgvYmFpZHVib3hhcHBcLy4qXC8oXHcrKVwvXGQvKTsKICAgICAgdmFyIGN1aWQgPSBtYXRjaCA/IG1hdGNoWzFdIDogJyc7CiAgICAgIHJldHVybiB7CiAgICAgICAgc3RhdHVzOiBjdWlkID8gMCA6IDEsCiAgICAgICAgbWVzc2FnZTogY3VpZCA/ICdzdWNjZXNzJyA6ICdmYWlsJywKICAgICAgICBkYXRhOiBjdWlkID8gewogICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZQogICAgICAgICAgdW5pcXVlX2lkOiBjdWlkCiAgICAgICAgfSA6IHt9CiAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIHJlczsKICB9LAogICdkZXZpY2UuZ2V0RGV2aWNlSW5mbyc6IGZ1bmN0aW9uIGRldmljZUdldERldmljZUluZm8ocmVzKSB7CiAgICAvLyDmraTnq6/og73lipvnmoTov5Tlm57lgLzlvojnibnmrorvvIzlrqLmiLfnq6/pmr7ku6Xnu5nlh7rmnprkuL7lgLzjgILogIzkuJTnlLHkuo7kuJrliqHmlrnlj6rlhbPms6jmmK8gd2lmaSDov5jmmK/pnZ4gd2lmae+8jOaJgOS7pee7huiKguS4jeWGjea3seeptgogICAgLy8KICAgIC8vIOWuieWNk+eahCAxXzAg5ZKMIGlPUyDnmoQgV2lmaSDku6Pooaggd2lmaQogICAgLy8gaU9TIO+8muS4jeWQjOeahOWNleivjeS7o+ihqOS4jeWQjOeahOe9kee7nOOAgu+8iDRn77yaIFdXQU7vvIkKICAgIC8vIEFuZHJvaWTvvJrkuI3lkIznmoTmlbDlrZfliY3nvIDku6PooajkuI3lkIznmoTnvZHnu5w6CiAgICAvLyAgICDvvIggV0lGSSAx77yMIDNHTkVUIDIx77yMIDNHV0FQIDIy77yMIENNTkVUIDMx77yMIFVOSU5FVCAzMu+8jCBDVE5FVCAzM++8jCBDTVdBUCA0Me+8jCBVTklXQVAgNDLvvIwgQ1RXQVAgNDMg77yJCiAgICBpZiAocmVzLmRhdGEgJiYgcmVzLmRhdGEubmV0SW5mbyAmJiByZXMuZGF0YS5uZXRJbmZvLm5ldHdvcmsgJiYgKHJlcy5kYXRhLm5ldEluZm8ubmV0d29yayA9PT0gJzFfMCcgfHwgcmVzLmRhdGEubmV0SW5mby5uZXR3b3JrID09PSAnV2lmaScpKSB7CiAgICAgIHJlcy5kYXRhLm5ldHdvcmtUeXBlID0gJ3dpZmknOwogICAgfSBlbHNlIHsKICAgICAgcmVzLmRhdGEubmV0d29ya1R5cGUgPSAndW5rbm93bic7CiAgICB9CgogICAgcmV0dXJuIHJlczsKICB9LAogIC8vIDkuMisg54mI5pys5Y+C5pWw6KKr5aSa5bCB6KOF5LqG5LiA5bGC77yI6KKr5bCB6KOF5Zyo5LqGcmVzLmRhdGEucGFyYW1z5Lit77yJ77yM5YmN56uv5Zyo5q2k5YW85a6544CCCiAgJ2ZlZWQuZ2V0U2Vzc2lvbkNsaWNrSUQnOiBmdW5jdGlvbiBmZWVkR2V0U2Vzc2lvbkNsaWNrSUQocmVzKSB7CiAgICByZXR1cm4gewogICAgICBzdGF0dXM6ICtyZXMuc3RhdHVzLAogICAgICBtZXNzYWdlOiByZXMubWVzc2FnZSB8fCAnJywKICAgICAgZGF0YTogcmVzLmRhdGEgJiYgcmVzLmRhdGEucGFyYW1zIHx8IHJlcy5wYXJhbXMgfHwge30KICAgIH07CiAgfSwKICAvLyDlronljZPlpJrkuobml6DnlKjnmoQgZGF0YSDlgLzvvIhzdGF0dXPlkowgbWVzc2FnZe+8ieOAguWJjeerr+WFvOWuueWvuem9kAogICdlYXN5QnJvd3Nlci5wZXJmb3JtYW5jZUZsb3dMb2cnOiBmdW5jdGlvbiBlYXN5QnJvd3NlclBlcmZvcm1hbmNlRmxvd0xvZyhyZXMpIHsKICAgIGlmIChpc0FuZHJvaWQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBzdGF0dXM6ICtyZXMuc3RhdHVzLAogICAgICAgIG1lc3NhZ2U6IHJlcy5tZXNzYWdlIHx8ICcnCiAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIHJlczsKICB9LAogIC8vIHJlcXVlc3QgaU9TIOWBmuS6huWkmuS9meeahOi9rOegge+8jOWvvOiHtOWPjOerr+i/lOWbnuWAvOS4jeS4gOiHtO+8jOS9huaYr+a2ieWPiuWIsOeahOe6v+S4iuS4muWKoeaWuei/h+Wkmu+8jOerr+S4iuaXoOazleS/ruWkjeOAguWJjeerr+WFvOWuueWvuem9kAogICdlYXN5QnJvd3Nlci5yZXF1ZXN0JzogZnVuY3Rpb24gZWFzeUJyb3dzZXJSZXF1ZXN0KHJlcykgewogICAgdmFyIGRhdGE7CgogICAgaWYgKHJlcyAmJiByZXMuZGF0YSAmJiByZXMuZXJybm8gPT09ICcxJykgewogICAgICBkYXRhID0gaXNJT1MgPyBKU09OLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudChyZXMuZGF0YSkpIDogSlNPTi5wYXJzZShyZXMuZGF0YSk7CiAgICB9IGVsc2UgewogICAgICBkYXRhID0gcmVzLmRhdGE7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgc3RhdHVzOiByZXMuZXJybm8gPT09ICcxJyA/IDAgOiByZXMuZXJybm8gPT09ICcwJyA/IDEgOiBwYXJzZUludChyZXMuZXJybm8sIDEwKSwKICAgICAgbWVzc2FnZTogcmVzLm1lc3NhZ2UgfHwgKHJlcy5lcnJubyA9PT0gJzEnID8gJ3N1Y2Nlc3MnIDogJ2ZhaWwnKSwKICAgICAgZGF0YTogZGF0YSB8fCB7fQogICAgfTsKICB9LAogICdlYXN5QnJvd3Nlci53ZWJTdG9yYWdlJzogZnVuY3Rpb24gZWFzeUJyb3dzZXJXZWJTdG9yYWdlKHJlcykgewogICAgLy8g6Kej5Yaz6L+U5Zue5YC85Li656m65pe25qC85byP5LiN5LiA6Ie055qE6Zeu6aKYCiAgICBpZiAoaXNJT1MgJiYgcmVzLnJlc3VsdCA9PT0gMCkgewogICAgICByZXR1cm4gewogICAgICAgIHN0YXR1czogMCwKICAgICAgICBtZXNzYWdlOiByZXMubWVzc2FnZSB8fCByZXMuZXJybXNnLAogICAgICAgIGRhdGE6IHJlcy5kYXRhCiAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIHJlczsKICB9LAogIC8vIGlPUyDnmoTmlbDmja7lpJrkuobkuIDlsYIgY29vcmRzCiAgJ2RldmljZS5nZXRDdXJyZW50TG9jYXRpb24nOiBmdW5jdGlvbiBkZXZpY2VHZXRDdXJyZW50TG9jYXRpb24ocmVzKSB7CiAgICBpZiAoaXNJT1MpIHsKICAgICAgLy8gdG9kbyDljp/pgLvovpEgNDAxCiAgICAgIHJldHVybiB7CiAgICAgICAgc3RhdHVzOiByZXMucmVzdWx0IHx8IHJlcy5zdGF0dXMsCiAgICAgICAgbWVzc2FnZTogcmVzLm1lc3NhZ2UgfHwgKHJlcy5yZXN1bHQgPT09IDAgPyAnc3VjY2VzcycgOiAnZmFpbCcpLAogICAgICAgIGRhdGE6IHJlcy5jb29yZHMgfHwgcmVzLmRhdGEKICAgICAgfTsKICAgIH0gZWxzZSBpZiAoaXNBbmRyb2lkKSB7CiAgICAgIHZhciBzdGF0dXMgPSByZXMuc3Q7IC8vIOWuieWNk+eahCBzdCDlrZfmrrXnlKjmnaXooajnpLrnirbmgIHnoIHvvIzmsqHlv4XopoHmmrTpnLIKCiAgICAgIHZhciBkYXRhID0gcmVzOwogICAgICBkZWxldGUgZGF0YS5zdDsKICAgICAgcmV0dXJuIHsKICAgICAgICBzdGF0dXM6IHN0YXR1cywKICAgICAgICBtZXNzYWdlOiByZXMubWVzc2FnZSB8fCAoc3RhdHVzID09PSAwID8gJ3N1Y2Nlc3MnIDogJ2ZhaWwnKSwKICAgICAgICBkYXRhOiBkYXRhCiAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIHJlczsKICB9LAogIC8vIHJlc3VsdOS4i+S4uuacgOe7iOS/oeaBr++8jOS4jeiDveiiq+i/h+a7pOaOiQogICdmZWVkLmlzV2ViUFN1cHBvcnRlZCc6IGZ1bmN0aW9uIGZlZWRJc1dlYlBTdXBwb3J0ZWQocmVzKSB7CiAgICBpZiAoaXNBbmRyb2lkKSB7CiAgICAgIHJlcy5kYXRhID0gcmVzLnJlc3VsdDsKICAgIH0KCiAgICByZXR1cm4gcmVzOwogIH0KfTsKLyoqCiAqIOWtmOWCqCByZXMg5Lit6Zmk5LqG54q25oCB56CB5ZKM54q25oCB5L+h5oGv5Lul5aSW55qE5YW25LuW5bGe5oCn77yM55So5L2cIGRhdGEg55qE6buY6K6k5YC844CCCiAqIEBwYXJhbSByZXMKICovCgpmdW5jdGlvbiBnZXREZWZhdWx0RGF0YShyZXMpIHsKICB2YXIgZGVmYXVsdERhdGEgPSB7fTsKCiAgZm9yICh2YXIga2V5IGluIHJlcykgewogICAgaWYgKHJlcy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGtleSAhPT0gJ2Vycm5vJyAmJiBrZXkgIT09ICdlcnJtc2cnICYmIGtleSAhPT0gJ3N0YXR1cycgJiYga2V5ICE9PSAnbWVzc2FnZScgJiYga2V5ICE9PSAncmVzdWx0JykgewogICAgICBkZWZhdWx0RGF0YVtrZXldID0gcmVzW2tleV07CiAgICB9CiAgfQoKICByZXR1cm4gZGVmYXVsdERhdGE7Cn0KLyoqCiAqIOagvOW8j+WMluWkhOeQhiByZXNwb25zZeOAgueUqOS6juWFvOWuueS4jeWQjOaXtuacn+eahOWNj+iuruS5i+mXtOWTjeW6lOS/oeaBr+eahOagvOW8j+WtmOWcqOeahOW3ruW8guOAggogKgogKiDov5Tlm57kv6Hmga/moIflh4YKICogc3RhdHVzOiB7bnVtYmVyfSDmlbDlrZfnsbvlnovvvIww5Luj6KGo5oiQ5Yqf77yM6Z2eMOS7o+ihqOWksei0pQogKiBtZXNzYWdlOiB7c3RyaW5nfSDov5Tlm57kv6Hmga/vvIxOQSDmnInliJnpgI/kvKAgTkHvvIzlkKbliJnliY3nq6/ov5Tlm54gc3VjY2VzcyAvIGZhaWwKICogZGF0YTogeyp9IOS7u+aEj+exu+WeiwogKgogKiBAcGFyYW0geyp9IHJlc3BvbnNlIOWTjeW6lOS/oeaBrwogKiBAcGFyYW0ge3N0cmluZ30gaGFuZGxlciDlk43lupTkv6Hmga/nmoTlpITnkIbmoIfor4bvvIzmmK8gZGVzY3JpcHRpb24g5Lit55qEIHJlc0hhbmRsZXIg5a2X5q61CiAqIEByZXR1cm4ge3tzdGF0dXM6IG51bWJlciwgbWVzc2FnZTogKHN0cmluZyksIGRhdGE6ICp9fQogKiBzdGF0dXMg5Li6MOaXtu+8jOihqOekuuaIkOWKn+OAguWFtuS7luWAvOS4uuWksei0pQogKi8KCgpmdW5jdGlvbiBub3JtYWxpemVSZXNwb25zZShyZXNwb25zZSwgaGFuZGxlcikgewogIC8vIHJlc3BvbnNlIOS4uuWuouaIt+err+i/lOWbnuOAgui/lOWbnueahOaWueW8j+acieWkmuenje+8jOWPr+iDveaYr+ebtOaOpei/lOWbnuebuOW6lOaVsOaNrihudW1iZXIgLyBvYmplY3QgLyBhcnJheSAvIHN0cmluZykKICAvLyDkuZ/mnInlj6/og73mmK9KU09OIHN0cmluZyDvvIjku7vkvZXnsbvlnovlr7nlupTnmoRKU09OIHN0cmluZ++8iQogIHZhciByZXM7CgogIHRyeSB7CiAgICByZXMgPSB0eXBlb2YgcmVzcG9uc2UgPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShyZXNwb25zZSkgOiByZXNwb25zZTsKICB9IGNhdGNoIChlKSB7CiAgICByZXMgPSByZXNwb25zZTsKICB9CgogIGlmIChPYmplY3Qua2V5cyhpcnJlZ3VsYXJSZXNwb25zZUhhbmRsZXJzKS5pbmRleE9mKGhhbmRsZXIpID4gLTEpIHsKICAgIC8vIOS4jeebtOaOpSByZXR1cm4g55qE5Y6f5Zug5piv77yM5pyJ5Y+M56uv5a+56b2Q55qE56uv6IO95Yqb77yM5p+Q56uv56ym5ZCI5Lul5LiL6KeE5YiZ77yM6ZyA6KaB5YaN5aSE55CGCiAgICByZXMgPSBpcnJlZ3VsYXJSZXNwb25zZUhhbmRsZXJzW2hhbmRsZXJdKHJlcyk7CiAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVmYXVsdC1jYXNlCgoKICBzd2l0Y2ggKCgwLCBfdHlwZW9mMi5kZWZhdWx0KShyZXMpKSB7CiAgICBjYXNlICd1bmRlZmluZWQnOgogICAgICByZXR1cm4gewogICAgICAgIHN0YXR1czogMSwKICAgICAgICBtZXNzYWdlOiAnZmFpbDogbmEg6L+U5Zue5YC85Li6IHVuZGVmaW5lZCcKICAgICAgfTsKCiAgICBjYXNlICdib29sZWFuJzoKICAgICAgcmV0dXJuIHsKICAgICAgICBzdGF0dXM6IHJlcyA/IDAgOiAxLAogICAgICAgIG1lc3NhZ2U6IHJlcyA/ICdzdWNjZXNzJyA6ICdmYWlsJwogICAgICB9OwoKICAgIGNhc2UgJ251bWJlcic6CiAgICAgIHJldHVybiB7CiAgICAgICAgc3RhdHVzOiByZXMsCiAgICAgICAgbWVzc2FnZTogK3JlcyA9PT0gMCA/ICdzdWNjZXNzJyA6ICdmYWlsJwogICAgICB9OwoKICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgIHJldHVybiB7CiAgICAgICAgc3RhdHVzOiAwLAogICAgICAgIG1lc3NhZ2U6ICdzdWNjZXNzJywKICAgICAgICBkYXRhOiByZXMKICAgICAgfTsKCiAgICBjYXNlICdvYmplY3QnOgogICAgICB7CiAgICAgICAgaWYgKHJlcyA9PT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc3RhdHVzOiAxLAogICAgICAgICAgICBtZXNzYWdlOiAnZmFpbDogTkEg6L+U5Zue5L+h5oGv5Li6IG51bGwnCiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgdmFyIGRlZmF1bHREYXRhID0gZ2V0RGVmYXVsdERhdGEocmVzKTsgLy8gZml4bWU6IOaPkOWPlnJlcy5kYXRh5L2c5Li65ZON5bqU5pWw5o2u55qEIGRhdGHlj6/og73kvJrmnInpo47pmanvvJrogIHml6fnq6/og73lipvml6Dop4TojIPvvIxkYXRhIOWPquaYr+S8l+WkmuWTjeW6lOWAvOWxnuaAp+S4reeahOWFtuS4reS4gOS4quWxnuaApwoKICAgICAgICBpZiAocmVzLmVycm5vICE9IG51bGwpIHsKICAgICAgICAgIC8vIGVycm5vIOS4uiAxIOS7o+ihqOaIkOWKn++8jOS4uiAwIOS7o+ihqOWksei0peOAguWmguaenOi/mOacieWFtuS7luWAvOeahOivne+8jOWImeebtOaOpei1i+e7mSBzdGF0dXPjgIIKICAgICAgICAgIHZhciBlcnJubyA9IHBhcnNlSW50KHJlcy5lcnJubywgMTApOwogICAgICAgICAgdmFyIHN0YXR1cyA9IGVycm5vID09PSAxID8gMCA6IGVycm5vID09PSAwID8gMSA6IGVycm5vOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsCiAgICAgICAgICAgIG1lc3NhZ2U6IHJlcy5lcnJtc2cgfHwgZXJybm8gPT09IDEgPyAnc3VjY2VzcycgOiAnZmFpbCcsCiAgICAgICAgICAgIGRhdGE6IHJlcy5kYXRhIHx8IGRlZmF1bHREYXRhCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSBpZiAocmVzLnN0YXR1cyAhPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzdGF0dXM6ICtyZXMuc3RhdHVzLAogICAgICAgICAgICBtZXNzYWdlOiByZXMubWVzc2FnZSB8fCAoK3Jlcy5zdGF0dXMgPT09IDAgPyAnc3VjY2VzcycgOiAnZmFpbCcpLAogICAgICAgICAgICBkYXRhOiByZXMuZGF0YSB8fCBkZWZhdWx0RGF0YQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKHJlcy5yZXN1bHQgIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc3RhdHVzOiByZXMucmVzdWx0LAogICAgICAgICAgICBtZXNzYWdlOiByZXMucmVzdWx0ID09PSAwID8gJ3N1Y2Nlc3MnIDogJ2ZhaWwnLAogICAgICAgICAgICBkYXRhOiByZXMuZGF0YSB8fCBkZWZhdWx0RGF0YQogICAgICAgICAgfTsKICAgICAgICB9IC8vIOebtOaOpei/lOWbnueahOaXoOeKtuaAgeeggeeahOaVsOaNrgogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHN0YXR1czogMCwKICAgICAgICAgICAgICBtZXNzYWdlOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgZGF0YTogcmVzCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgIH0KICB9CgogIHJldHVybiByZXM7Cn0KLyoqCiAqIEBmaWxlICDlm57osIPlh73mlbDlpITnkIbpgLvovpEKICogQGF1dGhvciB6aG91ZGFuMDMKICogQGRhdGUgMjAxOS82LzUKICogQGRlc2NyaXB0aW9uCiDkuIDnuqflm57osIPnm7jlvZPkuo7nq6/og73lipvosIPnlKjmmK/lkKbmiJDlip/vvIzkuoznuqflm57osIPnm7jlvZPkuo7lvILmraXlpITnkIbkuIDkupvkuovmg4Ug54S25ZCO6L+U5Zue57uT5p6c44CCCgog5a+55LqO5LiA5Liq56uv6IO95Yqb6ICM6KiA77yM5aaC5p6c5Y+q5pyJ5LiA57qn5Zue6LCD77yM5YiZ5Zyo5LiA57qn5Zue6LCD6L+U5Zue5ZCOIOinpuWPkeW8gOWPkeiAheeahCBzdWNjZXNzIOaIluiAhSBmYWls44CC5aaC5p6c5ZCM5pe25pyJIOS4gOe6p+WbnuiwgyDlkozkuoznuqflm57osIPvvIzliJnkvJrlnKjkuIDnuqflm57osIPosIPnlKjmiJDlip/lkI7vvIznrYnlvoXkuoznuqflm57osIPmiafooYzvvIzkuoznuqfmiJDlip/lho3op6blj5Eg5byA5Y+R6ICF55qEIHN1Y2Nlc3PjgIIKCiDlr7nkuo7mnInkuoznuqflm57osIPnmoTmg4XlhrXvvIzkuIDnuqflm57osIPlj6rmmK/lkYrnn6Xnq6/og73lipvpgJrkv6HmmK/lkKbmiJDlip/vvIzlr7nlvIDlj5HogIXmmK/pmpDol4/nmoTvvIzkuI3nlKjlkYror4nlvIDlj5HogIXjgIIKCiDlnKjmiYvnmb7nq6/og73lipvkuK3vvIzkuIDnuqflm57osIPpgJrluLjlj6sgY2FsbGJhY2sg5oiW6ICFIGZ1bmPvvIzmiJbogIXmi4bliIbkuLogc3VjY2Vzc2NhbGxiYWNrIGVycm9yY2FsbGJhY2sgIGZhaWxjYWxsYmFjawog5LqM57qn5Zue6LCD6YCa5bi45rKh5pyJ6KeE6IyD77yM55Sx5b2T5pe255qE5paH5qGj5oiW6ICF5Y+j5aS057qm5a6a44CCCgog44CQ5Li+5L6L44CRCiDkuoznuqflm57osIPlj6sganNjYWxsYmFjawogYmFpZHVib3hhcHA6Ly92NS9kYXRhY2hhbm5lbC9yZWdpc3Rlcj9hY3Rpb249Y29tLmJhaWR1LmNoYW5uZWwudHRzLnN0YXR1c2NoYW5nZSZwYWdlPWRhdGFDaGFubmVsRGVtb1dlYiZqc2NhbGxiYWNrPV9fanNuYV8xJmNhbGxiYWNrPV9fanNuYV8yCgog5LqM57qn5Zue6LCD5Y+rIGNiCiBiYWlkdWJveGFwcDovL3Y0MS9kZXZpY2Uvc3RhcnRBY2NlbGVyb21ldGVyP3BhcmFtcz17ImludGVydmFsIjoiMC4yIiwiY2IiOiJjYiJ9JmNhbGxiYWNrPV9iZGJveF9qc19jYiZ1cGdyYWRlPTAKCiDkuoznuqflm57osIPlj6sgZXZlbnRfY2FsbGJhY2sKIGJhaWR1Ym94YXBwOi8vdjQvY29tbWVudC9zaG93Ym94P3BhcmFtcz17InR5cGUiOjEsInRvcGljX2lkIjoiMTA3MjAwMDAwMTgzODEyMSIsInBsYWNlaG9sZGVyIjoicGxhY2Vob2xkZXIiLCJsb2dpZCI6ImZlZWQiLCJzb3VyY2UiOiJmZWVkIiwicGFnZSI6ImZlZWQiLCJldmVudF9jYWxsYmFjayI6ImNibmFtZSJ9JmNhbGxiYWNrPV9iZGJveF9qc182MTcKCiDlsI/nqIvluo/ph4zkuoznuqflm57osIMgY2Ig5Li65a+56LGhIOeahOS+i+WtkO+8mgogYmFpZHVib3hhcHA6Ly9zd2FuQVBJL2JhY2tncm91bmRBdWRpby9vcGVuP3BhcmFtcz17InNyYyI6Imh0dHA6Ly93cy54eHhxLmNvbS9NNTAwMDAxVmZ2c0oyMXhGcWIubXAzPyIsInNsYXZlSWQiOiI0IiwidGl0bGUiOiLnn7PlrrbluoTkurrmsJHlhbHlkozlm70iLCJlcG5hbWUiOiLmraTml7bmraTliLsiLCJzaW5nZXIiOiLorrjlt40iLCJjb3ZlckltZ1VybCI6Imh0dHA6Ly95Lnh4eHBob3RvX25ldy9UMDAyUjMwMHgzMDBNMDAwMDAzcnNLRjQ0R3lhU2suanBnP21heF9hZ2U9MjU5MjAwMCIsImNiIjp7Im9uQ2FucGxheSI6Il9ia0F1ZGlvX29uQ2FucGxheSIsIm9uUGxheSI6Il9ia0F1ZGlvX29uUGxheSIsIm9uUGF1c2UiOiJfYmtBdWRpb19vblBhdXNlIiwib25TdG9wIjoiX2JrQXVkaW9fb25TdG9wIiwib25FbmRlZCI6Il9ia0F1ZGlvX29uRW5kZWQiLCJvblRpbWVVcGRhdGUiOiJfYmtBdWRpb19vblRpbWVVcGRhdGUiLCJvblByZXYiOiJfYmtBdWRpb19vblByZXYiLCJvbk5leHQiOiJfYmtBdWRpb19vbk5leHQiLCJvbkVycm9yIjoiX2JrQXVkaW9fb25FcnJvciIsIm9uV2FpdGluZyI6Il9ia0F1ZGlvX29uV2FpdGluZyJ9fSZjYWxsYmFjaz1fYmRib3hfanNfNjYmdXBncmFkZT0wCgoKIOebruWJjeacieS4ieexu+S6jOe6p+Wbnuiwgwog56ys5LiA57G777ya5pmu6YCa6KGo56S656uv6IO95Yqb6LCD6LW35oiQ5Yqf55qE5byC5q2l5aSE55CG5pWw5o2u44CC5Y2z55So5Y2z5q+B44CCCiDnrKzkuoznsbvvvJrkuovku7bnm5HlkKzlh73mlbDvvIzlpoIgZXZlbnQub24KIOS6i+S7tuebkeWQrOWHveaVsOmcgOimgemVv+acn+S/neWtmOOAggog5a+55LqO5byA5Y+R6ICF5Lyg6YCS55qE77yM5YiG5Li65YW35ZCN5Ye95pWw5ZKM5Yy/5ZCN5Ye95pWw44CC5Yy/5ZCN5Y+v5Lul55So6Ieq5aKe5Ye95pWw77yM5YW35ZCN6ZyA6KaB5L+d5a2Y5byA5Y+R6ICF55qE5Ye95pWw5ZCN77yM5Lul5L6/IG9mZiDml7bmjIflrpoKIOesrOS4ieexu++8mueCueWHu+S6i+S7tu+8jOWmgiB0b2FzdOOAgWRpYWxvZyDnrYnmnInmjInpkq7nmoTvvIznlLHnlKjmiLfop6blj5EKCiAqIOerr+iDveWKm+eahOi/lOWbnuWAvOacieWkmuenjei/lOWbnuaWueW8j++8mgogKiAxLiDpgJrov4fkuIDnuqflm57osIPvvIzop6blj5HnlKjmiLflm57osIMKICogMi4g6YCa6L+H5LqM57qn5Zue6LCD77yM6Kem5Y+R55So5oi35Zue6LCDCiAqIDMuIOmAmui/hyBqc0ludGVyZmFjZSDlh73mlbDov5Tlm57vvIzop6blj5HnlKjmiLflm57osIMKICoKICoKICog5a+55bqU5LqO5LiK6L+w55qE5aSa56eN6L+U5Zue5pa55byP77yM6YKj5LmI6Kem5Y+R55So5oi35Zue6LCD55qE5pe25py65bqU6K+l5piv77yaCiAqIDEuIOWmguaenOWPquacieS4gOe6p+Wbnuiwg++8jOWImeWcqOS4gOe6p+Wbnuiwg+i/lOWbnuWQju+8jOinpuWPkeW8gOWPkeiAheeahCBzdWNjZXNzIOaIluiAhSBmYWlsCiAqIDIuIOWmguaenOWQjOaXtuaciSDkuIDnuqflm57osIMg5ZKM5LqM57qn5Zue6LCD77yM5YiZ5Lya5Zyo5LiA57qn5Zue6LCD6LCD55So5oiQ5Yqf5ZCO77yM562J5b6F5LqM57qn5Zue6LCD5omn6KGM77yM5LqM57qn5oiQ5Yqf5YaN6Kem5Y+RIOW8gOWPkeiAheeahCBzdWNjZXNz77yb5aaC5p6c5LiA57qn5Zue6LCD6LCD55So5aSx6LSl5YiZ55u05o6lIGZhaWzvvIzml6DpnIDnrYnlvoXkuoznuqflm57osIMKICogMy4g6YCa6L+HIGpzSW50ZXJmYWNlIOWHveaVsOi/lOWbnuWQju+8jOS9v+eUqCBuZXh0VGljayDlu7bov5/op6blj5HnlKjmiLflm57osIPvvIhzdWNjZXNzL2ZhaWzvvIkKICovCgovKioKICog55So5LqO5Zue6LCD5Ye95pWw5YyF6KOF5ZG95ZCN55qE6Ieq5aKeaWQKICoKICogQGlubmVyCiAqIEB0eXBlIHtudW1iZXJ9CiAqLwoKCnZhciBmdW5jSWQgPSAxOwovKioKICog55So5LqO5Zue6LCD5Ye95pWw5YyF6KOF5ZG95ZCN55qE5YmN57yACiAqCiAqIEBpbm5lcgogKiBAY29uc3QKICogQHR5cGUge3N0cmluZ30KICovCgp2YXIgRlVOQ19QUkVGSVggPSAnX19ib3h4Xyc7Ci8qKgogKiDlhajlsYDms6jlhozlh73mlbAKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUg5Ye95pWw5ZCNCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIOWHveaVsAogKi8KCnZhciByZWdpc3Rlckdsb2JhbGx5ID0gZnVuY3Rpb24gcmVnaXN0ZXJHbG9iYWxseShuYW1lLCBmbikgewogIGdsb2JhbCQxW25hbWVdID0gZm47Cn07Ci8qKgogKiDnlJ/miJDkuIDnuqflm57osIPlh73mlbAKICoKICogQHBhcmFtIHtzdHJpbmd9IGRlc2NOYW1lICAgQVBJIOWQjeensAogKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzICDnlKjmiLfnmoTmiJDlip/lm57osIMKICogQHBhcmFtIHtmdW5jdGlvbn0gZmFpbCAgICAg55So5oi355qE5aSx6LSl5Zue6LCDCiAqIEBwYXJhbSB7Ym9vbGVhbn0gaGFzTmV4dCAgIOaYr+WQpuWQq+acieS6jOe6p+WbnuiwgwogKiBAcmV0dXJuIHtGdW5jdGlvbn0KICovCgoKZnVuY3Rpb24gZ2VuZXJhdGVDYWxsYmFjayhkZXNjTmFtZSwgcmVmLCBoYXNOZXh0KSB7CiAgdmFyIHN1Y2Nlc3MgPSByZWYuc3VjY2VzczsKICB2YXIgZmFpbCA9IHJlZi5mYWlsOwogIHJldHVybiBmdW5jdGlvbiBmaXJzdENhbGxiYWNrKHJlcykgewogICAgcmVzID0gbm9ybWFsaXplUmVzcG9uc2UocmVzLCBkZXNjTmFtZSk7IC8vIOWkhOeQhui/lOWbnuWAvO+8iOWmguaenOayoeS6jOe6p+Wbnuiwg++8jOWImeWMuuWIhuaIkOWKn+Wksei0peaJp+ihjOeUqOaIt+Wbnuiwg++8m+WQpuWImeS7gOS5iOS5n+S4jeWBmu+8jOeUseS6jOe6p+Wbnuiwg+adpeWHuuinpuWPkeeUqOaIt+Wbnuiwg++8iQoKICAgIGlmICghaGFzTmV4dCkgewogICAgICBpZiAoK3Jlcy5zdGF0dXMgPT09IDApIHsKICAgICAgICBzdWNjZXNzICYmIHN1Y2Nlc3MocmVzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmYWlsICYmIGZhaWwocmVzKTsKICAgICAgfQogICAgfQogIH07Cn0KLyoqCiAqIOeUn+aIkOS6jOe6p+Wbnuiwg+WHveaVsAogKgogKiBAcGFyYW0ge3N0cmluZ30gZGVzY05hbWUgQVBJIOWQjeensAogKiBAcGFyYW0gc3VjY2VzcyAg55So5oi355qE5oiQ5Yqf5Zue6LCDCiAqIEBwYXJhbSBmYWlsICAgICDnlKjmiLfnmoTlpLHotKXlm57osIMKICogQHJldHVybiB7RnVuY3Rpb259CiAqLwoKCmZ1bmN0aW9uIGdlbmVyYXRlU2Vjb25kQ2FsbGJhY2soZGVzY05hbWUsIHJlZikgewogIHZhciBzdWNjZXNzID0gcmVmLnN1Y2Nlc3M7CiAgdmFyIGZhaWwgPSByZWYuZmFpbDsKICByZXR1cm4gZnVuY3Rpb24gc2Vjb25kQ2FsbGJhY2socmVzKSB7CiAgICByZXMgPSBub3JtYWxpemVSZXNwb25zZShyZXMsIGRlc2NOYW1lKTsgLy8g5aSE55CG6L+U5Zue5YC877yI5a6i5oi356uv55qE6L+U5Zue55qE54q25oCB56CB6YO95piv5a2X56ym5Liy77yJCgogICAgaWYgKCtyZXMuc3RhdHVzID09PSAwKSB7CiAgICAgIHN1Y2Nlc3MgJiYgc3VjY2VzcyhyZXMpOwogICAgfSBlbHNlIHsKICAgICAgZmFpbCAmJiBmYWlsKHJlcyk7CiAgICB9CiAgfTsKfQovKioKICog5Z+65LqO6Ieq5aKe55qE5YC877yM6I635Y+W5ZSv5LiA55qE5Ye95pWw5Y+Y6YeP5ZCNCiAqIEByZXR1cm4ge3N0cmluZ30g5Ye95pWw5ZCNCiAqLwoKCmZ1bmN0aW9uIGdldFVuaXF1ZU5hbWUoKSB7CiAgcmV0dXJuIEZVTkNfUFJFRklYICsgZnVuY0lkKys7Cn0KLyoqCiAqIEBmaWxlICDlnKjkuIvkuIDkuKrml7bpl7TlkajmnJ/ov5DooYzku7vliqHvvIjlj4LogIMgc2Fu77yJCiAqIEBhdXRob3IgemhvdWRhbjAzCiAqIEBkYXRlIDIwMTkvOC8xMgogKi8KCi8qKgogKiDkuIvkuIDkuKrlkajmnJ/opoHmiafooYznmoTku7vliqHliJfooagKICoKICogQGlubmVyCiAqIEB0eXBlIHtBcnJheX0KICovCgoKdmFyIG5leHRUYXNrcyA9IFtdOwovKioKICog5omn6KGM5LiL5LiA5Liq5ZGo5pyf5Lu75Yqh55qE5Ye95pWwCiAqCiAqIEBpbm5lcgogKiBAdHlwZSB7RnVuY3Rpb259CiAqLwoKdmFyIF9uZXh0SGFuZGxlcjsKLyoqCiAqIOa1j+iniOWZqOaYr+WQpuaUr+aMgeWOn+eUn1Byb21pc2UKICog5a+5UHJvbWlzZeWBmuWIpOaWre+8jOaYr+S4uuS6huemgeeUqOS4gOS6m+S4jeS4peiwqOeahFByb21pc2XnmoRwb2x5ZmlsbAogKgogKiBAaW5uZXIKICogQHR5cGUge2Jvb2xlYW59CiAqLwoKCnZhciBpc05hdGl2ZVByb21pc2UgPSB0eXBlb2YgUHJvbWlzZSA9PT0gJ2Z1bmN0aW9uJyAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoUHJvbWlzZSk7Ci8qKgogKiDlnKjkuIvkuIDkuKrml7bpl7TlkajmnJ/ov5DooYzku7vliqEKICoKICogQGlubmVyCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIOimgei/kOihjOeahOS7u+WKoeWHveaVsAogKiBAcGFyYW0ge09iamVjdD19IHRoaXNBcmcgdGhpc+aMh+WQkeWvueixoQogKi8KCmZ1bmN0aW9uIG5leHRUaWNrKGZuLCB0aGlzQXJnKSB7CiAgaWYgKHRoaXNBcmcpIHsKICAgIGZuID0gZm4uYmluZCh0aGlzQXJnKTsKICB9CgogIG5leHRUYXNrcy5wdXNoKGZuKTsKCiAgaWYgKF9uZXh0SGFuZGxlcikgewogICAgcmV0dXJuOwogIH0KCiAgX25leHRIYW5kbGVyID0gZnVuY3Rpb24gbmV4dEhhbmRsZXIoKSB7CiAgICB2YXIgdGFza3MgPSBuZXh0VGFza3Muc2xpY2UoMCk7CiAgICBuZXh0VGFza3MgPSBbXTsKICAgIF9uZXh0SGFuZGxlciA9IG51bGw7CgogICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0YXNrcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdGFza3NbaV0oKTsKICAgIH0KICB9OyAvLyDpnZ7moIflh4bmlrnms5XvvIzkvYbmmK/mraTmlrnms5XpnZ7luLjlkLvlkIjopoHmsYLjgIIKCgogIGlmICh0eXBlb2Ygc2V0SW1tZWRpYXRlID09PSAnZnVuY3Rpb24nKSB7CiAgICBzZXRJbW1lZGlhdGUoX25leHRIYW5kbGVyKTsKICB9IC8vIOeUqE1lc3NhZ2VDaGFubmVs5Y675YGac2V0SW1tZWRpYXRl55qEcG9seWZpbGwKICAvLyDljp/nkIbmmK/lsIbmlrDnmoRtZXNzYWdl5LqL5Lu25Yqg5YWl5Yiw5Y6f5pyJ55qEZG9tIGV2ZW50c+S5i+WQjgogIGVsc2UgaWYgKHR5cGVvZiBNZXNzYWdlQ2hhbm5lbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICB2YXIgY2hhbm5lbCA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpOwogICAgICB2YXIgcG9ydCA9IGNoYW5uZWwucG9ydDI7CiAgICAgIGNoYW5uZWwucG9ydDEub25tZXNzYWdlID0gX25leHRIYW5kbGVyOwogICAgICBwb3J0LnBvc3RNZXNzYWdlKDEpOwogICAgfSAvLyBmb3IgbmF0aXZlIGFwcAogICAgZWxzZSBpZiAoaXNOYXRpdmVQcm9taXNlKSB7CiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbihfbmV4dEhhbmRsZXIpOwogICAgICB9IGVsc2UgewogICAgICAgIHNldFRpbWVvdXQoX25leHRIYW5kbGVyLCAwKTsKICAgICAgfQp9Ci8qKgogKiBAZmlsZSDnlKjkuo7ms6jlhaUganNOYXRpdmUg55qE6Ieq5a6a5LmJIHByb2Nlc3NvcgogKiBAYXV0aG9yIHpob3VkYW4wMwogKiBAZGF0ZSAyMDE5LzUvMjgKICovCgoKdmFyIG1ldGhvZFVuZGVmaW5lZENoZWNrZXJTZW5kZWQgPSBmYWxzZTsKCmZ1bmN0aW9uIGlzQXJyYXkobykgewogIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykgPT09ICdbb2JqZWN0IEFycmF5XSc7Cn0KLyoqCiAqIOi/lOWbnuWOn+WAvOeahOaWueazle+8jOiwg+eUqOi/h+eoi+eahOWFnOW6leWkhOeQhuWHveaVsAogKgogKiBAaW5uZXIKICogQHBhcmFtIHsqfSBzb3VyY2Ug5Y6f5YC8CiAqIEByZXR1cm4geyp9CiAqLwoKCmZ1bmN0aW9uIHJldHVyblJhdyhzb3VyY2UpIHsKICByZXR1cm4gc291cmNlOwp9Ci8qKgogKiDlr7nmlbDnu4Tov5vooYzpgY3ljoYKICoKICogQGlubmVyCiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IOimgemBjeWOhueahOaVsOe7hAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiDpgY3ljoblh73mlbAKICovCgoKZnVuY3Rpb24gZWFjaChhcnJheSwgZm4pIHsKICB2YXIgbGVuID0gYXJyYXkgJiYgYXJyYXkubGVuZ3RoIHx8IDA7CgogIGZvciAodmFyIGkgPSAwLCBsID0gbGVuOyBpIDwgbDsgaSsrKSB7CiAgICBpZiAoZm4oYXJyYXlbaV0sIGkpID09PSBmYWxzZSkgewogICAgICBicmVhazsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGdldFByZWZpeChzY2hlbWUsIGRlc2NyaXB0aW9uKSB7CiAgcmV0dXJuIHNjaGVtZSArIGRlc2NyaXB0aW9uLmF1dGhvcml0eSArIGRlc2NyaXB0aW9uLnBhdGg7Cn0KLyoqCiAqIOiOt+WPlueUqOaIt+WPguaVsO+8jOeUn+aIkOW9ouWmgiBrZXkxPXZhbHVlMSZrZXkyPXZhbHVlMiDnmoQgc3RyaW5nCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIOeUqOaIt+S8oOWPggogKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g6LCD55So5o+P6L+w5a+56LGhCiAqIEByZXR1cm4ge3N0cmluZ30gIOWPguaVsOWtl+espuS4sgogKi8KCgpmdW5jdGlvbiBnZXRBcmdzU3RyaW5nKGFyZ3MsIGRlc2NyaXB0aW9uKSB7CiAgdmFyIGFyZ3NTdHJpbmcgPSAnJzsKCiAgaWYgKGRlc2NyaXB0aW9uLmFyZ3MgJiYgZGVzY3JpcHRpb24uYXJncy5sZW5ndGggPiAwKSB7CiAgICB2YXIgYXJnUmVzdWx0ID0gW107CiAgICBlYWNoKGRlc2NyaXB0aW9uLmFyZ3MsIGZ1bmN0aW9uIChkZWNsYXJhdGlvbiwgaSkgewogICAgICB2YXIgYXJnID0gYXJnc1tpXTsKCiAgICAgIGlmIChhcmcgIT0gbnVsbCkgewogICAgICAgIGFyZ1Jlc3VsdC5wdXNoKGRlY2xhcmF0aW9uLm5hbWUgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoYXJnKSk7CiAgICAgIH0KICAgIH0pOwogICAgYXJnc1N0cmluZyA9IGFyZ1Jlc3VsdC5sZW5ndGggPj0gMCA/IGFyZ1Jlc3VsdC5qb2luKCcmJykgOiAnJzsKICB9CgogIHJldHVybiBhcmdzU3RyaW5nOwp9Ci8qKgogKiDojrflj5bnlKjmiLflj4LmlbDvvIznlJ/miJDlvaLlpoIgcGFyYW1zPWVuY29kZVVSSUNvbXBvbmVudCh7a2V5MTp2YWx1ZTEsa2V5Mjp2YWx1ZX0pIOeahCBzdHJpbmcKICoKICogQHBhcmFtIHtzdHJpbmd9IGFyZ3Mg55So5oi35Lyg5Y+C77yM5bey57uP6KKr5YmN5LiA5Liq5aSE55CG5ZmoIHN0cmluZ2lmeSDov4cKICogQHBhcmFtIHtPYmplY3R9IGRlc2NyaXB0aW9uIOiwg+eUqOaPj+i/sOWvueixoQogKiBAcmV0dXJuIHtzdHJpbmd9IOWPguaVsOWtl+espuS4sgogKi8KCgpmdW5jdGlvbiBnZXRQYXJhbXNTdHJpbmcoYXJncywgZGVzY3JpcHRpb24pIHsKICAvLyDnp7vpmaRhcmdz5LitcXVlcnnpg6jliIYKICBpZiAoYXJncyAmJiBBcnJheS5pc0FycmF5KGRlc2NyaXB0aW9uLmFyZ1F1ZXJ5TGlzdCkpIHsKICAgIHZhciByYXdBcmdzID0gSlNPTi5wYXJzZShhcmdzKTsKICAgIGRlc2NyaXB0aW9uLmFyZ1F1ZXJ5TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChxdWVyeSkgewogICAgICBpZiAocmF3QXJnc1txdWVyeV0pIHsKICAgICAgICBkZWxldGUgcmF3QXJnc1txdWVyeV07CiAgICAgIH0KICAgIH0pOwogICAgYXJncyA9IEpTT04uc3RyaW5naWZ5KHJhd0FyZ3MpOwogIH0KCiAgdmFyIHBhcmFtc05hbWUgPSBkZXNjcmlwdGlvbi5wYXJhbXNOYW1lIHx8ICdwYXJhbXMnOyAvLyDmj4/ov7DnmoQgYXJncyDmnInlj4LmlbDvvIzmiY3pnIDopoHov5nkuYjlgZrjgIIKCiAgcmV0dXJuIGFyZ3MgPyBwYXJhbXNOYW1lICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGFyZ3MpIDogJyc7Cn0KLyoqCiAqIOiOt+WPliBxdWVyeSDlrZfnrKbkuLLjgILlvaLlpoIgYWN0aW9uPWZsb3cg5LmL57G755qE5Zu65a6a5YC8CiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdGlvbiDosIPnlKjmj4/ov7Dlr7nosaEKICogQHJldHVybiB7c3RyaW5nfSBxdWVyeVN0cmluZwogKi8KCgpmdW5jdGlvbiBnZXRRdWVyeVN0cmluZyhkZXNjcmlwdGlvbikgewogIHZhciBxdWVyeVN0ciA9ICcnOwoKICBpZiAoZGVzY3JpcHRpb24ucXVlcnkpIHsKICAgIHZhciBxdWVyeVN0ckFycmF5ID0gW107CgogICAgZm9yICh2YXIga2V5IGluIGRlc2NyaXB0aW9uLnF1ZXJ5KSB7CiAgICAgIGlmIChkZXNjcmlwdGlvbi5xdWVyeS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgcXVlcnlTdHJBcnJheS5wdXNoKGtleSArICc9JyArIGRlc2NyaXB0aW9uLnF1ZXJ5W2tleV0pOwogICAgICB9CiAgICB9CgogICAgcXVlcnlTdHIgPSBxdWVyeVN0ckFycmF5LmpvaW4oJyYnKTsKICB9CgogIHJldHVybiBxdWVyeVN0cjsKfQovKioKICog6I635Y+W5Y+C5pWw5Lit55qEcXVlcnnlrZfnrKbkuLIKICogQHBhcmFtIHtzdHJpbmd9IGFyZ3Mg55So5oi35Lyg5Y+C77yM5bey57uP6KKr5YmN5LiA5Liq5aSE55CG5ZmoIHN0cmluZ2lmeSDov4cKICogQHBhcmFtIHtPYmplY3R9IGRlc2NyaXB0aW9uIOiwg+eUqOaPj+i/sOWvueixoQogKi8KCgpmdW5jdGlvbiBnZXRBcmdRdWVyeVN0cmluZyhhcmdzLCBkZXNjcmlwdGlvbikgewogIHZhciBxdWVyeUFycmF5ID0gW107CgogIGlmIChkZXNjcmlwdGlvbi5hcmdRdWVyeUxpc3QpIHsKICAgIHZhciByYXdBcmdzID0gYXJncyA/IEpTT04ucGFyc2UoYXJncykgOiBbXTsKICAgIGRlc2NyaXB0aW9uLmFyZ1F1ZXJ5TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgaWYgKHJhd0FyZ3Nba2V5XSkgewogICAgICAgIHZhciBxdWVyeVZhbHVlID0gdHlwZW9mIHJhd0FyZ3Nba2V5XSA9PT0gJ3N0cmluZycgPyByYXdBcmdzW2tleV0gOiBKU09OLnN0cmluZ2lmeShyYXdBcmdzW2tleV0pOwogICAgICAgIHF1ZXJ5QXJyYXkucHVzaChrZXkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQocXVlcnlWYWx1ZSkpOwogICAgICB9CiAgICB9KTsKICB9CgogIHJldHVybiBxdWVyeUFycmF5LmpvaW4oJyYnKTsKfQovKioKICog5a+55Y+C5pWw5YC86L+b6KGM5qOA5p+lCiAqCiAqIEBpbm5lcgogKiBAcGFyYW0geyp9IHZhbHVlIOWAvAogKiBAcGFyYW0ge09iamVjdH0gZGVjbGFyYXRpb24g5YC85aOw5piOCiAqIEByZXR1cm4ge251bWJlcn0KICovCgoKZnVuY3Rpb24gY2hlY2tWYWx1ZSh2YWx1ZSwgZGVjbGFyYXRpb24pIHsKICBkZWNsYXJhdGlvbiA9IG5vcm1hbGl6ZVZhbHVlRGVjbGFyYXRpb24oZGVjbGFyYXRpb24pOwoKICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgcmV0dXJuIGRlY2xhcmF0aW9uLmlzUmVxdWlyZWQgJiYgZGVjbGFyYXRpb24udHlwZSAhPT0gJyonID8gMSA6IDA7CiAgfQoKICB2YXIgdmFsaWQgPSBmYWxzZTsKCiAgc3dpdGNoICgoMCwgX3R5cGVvZjIuZGVmYXVsdCkoZGVjbGFyYXRpb24udHlwZSkpIHsKICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgIHN3aXRjaCAoZGVjbGFyYXRpb24udHlwZSkgewogICAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgICAgY2FzZSAnYm9vbGVhbic6CiAgICAgICAgY2FzZSAnbnVtYmVyJzoKICAgICAgICBjYXNlICdmdW5jdGlvbic6CiAgICAgICAgY2FzZSAnb2JqZWN0JzoKICAgICAgICAgIHZhbGlkID0gKDAsIF90eXBlb2YyLmRlZmF1bHQpKHZhbHVlKSA9PT0gZGVjbGFyYXRpb24udHlwZTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdPYmplY3QnOgogICAgICAgICAgdmFsaWQgPSAoMCwgX3R5cGVvZjIuZGVmYXVsdCkodmFsdWUpID09PSAnb2JqZWN0JzsgLy8gY29uc29sZS5sb2coJ3ZhbHVlIHR5cGU6JywgdHlwZW9mIHZhbHVlLCB2YWx1ZSwgdmFsaWQpOwoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdBcnJheSc6CiAgICAgICAgICB2YWxpZCA9IHZhbHVlIGluc3RhbmNlb2YgQXJyYXk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnKic6CiAgICAgICAgICB2YWxpZCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgIHJldHVybiAyOwogICAgICB9CgogICAgICBicmVhazsKCiAgICBjYXNlICdvYmplY3QnOgogICAgICBpZiAodmFsdWUgJiYgKDAsIF90eXBlb2YyLmRlZmF1bHQpKHZhbHVlKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICB2YWxpZCA9IHRydWU7CgogICAgICAgIGZvciAodmFyIGtleSBpbiBkZWNsYXJhdGlvbi50eXBlKSB7CiAgICAgICAgICB2YWxpZCA9ICFjaGVja1ZhbHVlKHZhbHVlW2tleV0sIGRlY2xhcmF0aW9uLnR5cGVba2V5XSk7CgogICAgICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICByZXR1cm4gMjsKICAgICAgfQoKICAgICAgYnJlYWs7CgogICAgZGVmYXVsdDoKICAgICAgaWYgKGRlY2xhcmF0aW9uLm9uZU9mKSB7CiAgICAgICAgZWFjaChkZWNsYXJhdGlvbi5vbmVPZiwgZnVuY3Rpb24gKGV4cGVjdFZhbHVlKSB7CiAgICAgICAgICB2YWxpZCA9IGV4cGVjdFZhbHVlID09PSB2YWx1ZTsKICAgICAgICAgIHJldHVybiAhdmFsaWQ7CiAgICAgICAgfSk7CgogICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgIHJldHVybiAzOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChkZWNsYXJhdGlvbi5vbmVPZlR5cGUpIHsKICAgICAgICBlYWNoKGRlY2xhcmF0aW9uLm9uZU9mVHlwZSwgZnVuY3Rpb24gKGV4cGVjdFR5cGUpIHsKICAgICAgICAgIHZhbGlkID0gIWNoZWNrVmFsdWUodmFsdWUsIGV4cGVjdFR5cGUpOwogICAgICAgICAgcmV0dXJuICF2YWxpZDsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgICAgcmV0dXJuIDQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGRlY2xhcmF0aW9uLmFycmF5T2YpIHsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgICAgdmFsaWQgPSB0cnVlOwogICAgICAgICAgZWFjaCh2YWx1ZSwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIHZhbGlkID0gIWNoZWNrVmFsdWUoaXRlbSwgZGVjbGFyYXRpb24uYXJyYXlPZik7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICAgIHJldHVybiA1OwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gMjsKICAgICAgICB9CiAgICAgIH0KCiAgfQoKICByZXR1cm4gMDsKfQovKioKICog5a+55YC85aOw5piO6L+b6KGM5qCH5YeG5YyW5aSE55CGCiAqCiAqIEBpbm5lcgogKiBAcGFyYW0ge09iamVjdHxzdHJpbmd9IGRlY2xhcmF0aW9uIOWAvOWjsOaYjgogKiBAcmV0dXJuIHtPYmplY3R9CiAqLwoKCmZ1bmN0aW9uIG5vcm1hbGl6ZVZhbHVlRGVjbGFyYXRpb24oZGVjbGFyYXRpb24pIHsKICBpZiAodHlwZW9mIGRlY2xhcmF0aW9uID09PSAnc3RyaW5nJykgewogICAgdmFyIHJlYWxEZWNsYXJhdGlvbiA9IHsKICAgICAgaXNSZXF1aXJlZDogdHJ1ZQogICAgfTsKCiAgICBpZiAoLz0kLy50ZXN0KGRlY2xhcmF0aW9uKSkgewogICAgICByZWFsRGVjbGFyYXRpb24uaXNSZXF1aXJlZCA9IGZhbHNlOwogICAgICBkZWNsYXJhdGlvbiA9IGRlY2xhcmF0aW9uLnNsaWNlKDAsIGRlY2xhcmF0aW9uLmxlbmd0aCAtIDEpOwogICAgfQoKICAgIGlmICgvXFtcXSQvLnRlc3QoZGVjbGFyYXRpb24pKSB7CiAgICAgIHJlYWxEZWNsYXJhdGlvbi5hcnJheU9mID0gZGVjbGFyYXRpb24uc2xpY2UoMCwgZGVjbGFyYXRpb24ubGVuZ3RoIC0gMik7CiAgICB9IGVsc2UgaWYgKGRlY2xhcmF0aW9uLmluZGV4T2YoJ3wnKSA+IDApIHsKICAgICAgcmVhbERlY2xhcmF0aW9uLm9uZU9mVHlwZSA9IGRlY2xhcmF0aW9uLnNwbGl0KCd8Jyk7CiAgICB9IC8vIOS6i+S7tuexu+eahOWHveaVsAogICAgZWxzZSBpZiAoZGVjbGFyYXRpb24gPT09ICdldmVudEZ1bmN0aW9uJykgewogICAgICAgIHJlYWxEZWNsYXJhdGlvbi50eXBlID0gJ2Z1bmN0aW9uJzsKICAgICAgfSBlbHNlIHsKICAgICAgICByZWFsRGVjbGFyYXRpb24udHlwZSA9IGRlY2xhcmF0aW9uOwogICAgICB9CgogICAgcmV0dXJuIHJlYWxEZWNsYXJhdGlvbjsKICB9CgogIHJldHVybiBkZWNsYXJhdGlvbjsKfQovKioKICog5Y+C5pWw5qOA5p+l77yM6ZSZ6K+v55u05o6l5oqb5Ye65byC5bi4CiAqCiAqIEBwYXJhbSB7QXJyYXl9IGFyZ3Mg6LCD55So5Y+C5pWwCiAqIEBwYXJhbSB7QXJyYXl9IGRlY2xhcmF0aW9ucyDlj4LmlbDlo7DmmI7liJfooagKICogQHBhcmFtIHtPYmplY3R9IGFwaUNvbnRhaW5lciBqc05hdGl2ZSDlrrnlmagKICovCgoKZnVuY3Rpb24gY2hlY2tBcmdzKGFyZ3MsIGRlY2xhcmF0aW9ucywgYXBpQ29udGFpbmVyKSB7CiAgLy8gZml4bWUg5aKe5Yqg5LqGIHN1Y2Nlc3Mg5ZKMIGZhaWwg55qE5qCh6aqMICAgICAgIC8vIOWcqOe7n+S4gOeahOWcsOaWueS8oOS4gOS4quS/ruato+i/h+eahOaPj+i/sOihqAogIGRlY2xhcmF0aW9ucyA9IGRlY2xhcmF0aW9ucy5jb25jYXQoW3sKICAgIG5hbWU6ICdzdWNjZXNzJywKICAgIHZhbHVlOiAnZnVuY3Rpb249JwogIH0sIHsKICAgIG5hbWU6ICdmYWlsJywKICAgIHZhbHVlOiAnZnVuY3Rpb249JwogIH1dKTsKICBlYWNoKGRlY2xhcmF0aW9ucywgZnVuY3Rpb24gKGRlY2xhcmF0aW9uLCBpKSB7CiAgICB2YXIgZXJyb3JNc2cgPSAnJzsKICAgIHZhciB2YWx1ZSA9IG5vcm1hbGl6ZVZhbHVlRGVjbGFyYXRpb24oZGVjbGFyYXRpb24udmFsdWUpOwoKICAgIHN3aXRjaCAoY2hlY2tWYWx1ZShhcmdzW2ldLCB2YWx1ZSkpIHsKICAgICAgY2FzZSAxOgogICAgICAgIGVycm9yTXNnID0gJyBpcyByZXF1aXJlZC4nOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAyOgogICAgICAgIC8vIGNvbnNvbGUubG9nKCd0eXBlIGVycm9yIDInLCBhcmdzW2ldLCB2YWx1ZSwgZGVjbGFyYXRpb24pOwogICAgICAgIGVycm9yTXNnID0gJyB0eXBlIGVycm9yLiBtdXN0IGJlICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZS50eXBlIHx8ICdBcnJheScpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAzOgogICAgICAgIGVycm9yTXNnID0gJyB0eXBlIGVycm9yLCBtdXN0IGJlIG9uZU9mICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZS5vbmVPZik7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDQ6CiAgICAgICAgZXJyb3JNc2cgPSAnIHR5cGUgZXJyb3IsIG11c3QgYmUgb25lT2ZUeXBlICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZS5vbmVPZlR5cGUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA1OgogICAgICAgIGVycm9yTXNnID0gJyB0eXBlIGVycm9yLCBtdXN0IGJlIGFycmF5T2YgJyArIEpTT04uc3RyaW5naWZ5KHZhbHVlLmFycmF5T2YpOwogICAgICAgIGJyZWFrOwogICAgfQoKICAgIGlmIChlcnJvck1zZykgewogICAgICB2YXIgdGl0bGUgPSBhcGlDb250YWluZXIgJiYgYXBpQ29udGFpbmVyLm9wdGlvbnMuZXJyb3JUaXRsZSB8fCAnanNOYXRpdmUnOwogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1snICsgdGl0bGUgKyAnIEFyZ3VtZW50IEVycm9yXScgKyBkZWNsYXJhdGlvbi5uYW1lICsgZXJyb3JNc2cpOwogICAgfQogIH0pOwp9Ci8qKgogKiDlsIbosIPnlKjlj4LmlbDlkIjlubbmiJDlr7nosaEKICoKICogQGlubmVyCiAqIEBwYXJhbSB7QXJyYXl9IGFyZ3Mg6LCD55So5Y+C5pWwCiAqIEBwYXJhbSB7QXJyYXl9IGRlY2xhcmF0aW9ucyDlj4LmlbDlo7DmmI7liJfooagKICogQHJldHVybiB7T2JqZWN0fQogKi8KCgpmdW5jdGlvbiBhcmdDb21iaW5lKGFyZ3MsIGRlY2xhcmF0aW9ucykgewogIHZhciByZXN1bHQgPSB7fTsKICBlYWNoKGRlY2xhcmF0aW9ucywgZnVuY3Rpb24gKGRlY2xhcmF0aW9uLCBpKSB7CiAgICB2YXIgYXJnID0gYXJnc1tpXTsKCiAgICBpZiAoYXJnICE9IG51bGwpIHsKICAgICAgcmVzdWx0W2RlY2xhcmF0aW9uLm5hbWVdID0gYXJnOwogICAgfQogIH0pOwogIHJldHVybiByZXN1bHQ7Cn0KLyoqCiAqIOS9v+eUqHByb21wdOiwg+eUqAogKgogKiBAaW5uZXIKICogQHBhcmFtIHtBcnJheX0gZGVzY3JpcHRpb24g5o+P6L+w6KGoCiAqIEBwYXJhbSB7QXJyYXl9IGFyZ3Mg6LCD55So5Y+C5pWwCiAqIEByZXR1cm4ge09iamVjdH0KICovCgoKZnVuY3Rpb24gcHJvbXB0SW52b2tlcihkZXNjcmlwdGlvbiwgYXJncykgewogIHZhciBzZWdtZW50cyA9IGRlc2NyaXB0aW9uLm1ldGhvZC5zcGxpdCgnLicpOwogIHZhciBuZXdBcmdzID0gYXJncyB8fCBbXTsgLy8g5Yik5pat5piv5ZCm5Li65Y+q5ZCr5pyJY2FsbGJhY2vnmoTmg4XlhrUKCiAgaWYgKCFkZXNjcmlwdGlvbi5hcmdzIHx8IGRlc2NyaXB0aW9uLmFyZ3MubGVuZ3RoID09PSAwKSB7CiAgICBuZXdBcmdzID0gbmV3QXJncy5zbGljZSgxKTsKICB9CgogIHZhciBjYWxsZXIgPSB7CiAgICBvYmo6IHNlZ21lbnRzWzBdLAogICAgZnVuYzogc2VnbWVudHMuc2xpY2UoMSkuam9pbignLicpLAogICAgYXJnczogQXJyYXkuaXNBcnJheShuZXdBcmdzKSA/IG5ld0FyZ3MgOiBbbmV3QXJnc10KICB9OwogIGRlYnVnKCd3aW5kb3cucHJvbXB0IEJkYm94QXBwOicgKyBKU09OLnN0cmluZ2lmeShjYWxsZXIpKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWFsZXJ0CgogIHJldHVybiB3aW5kb3cucHJvbXB0KCdCZGJveEFwcDonICsgSlNPTi5zdHJpbmdpZnkoY2FsbGVyKSk7Cn0KLyoqCiAqIOiOt+WPlueUqOaIt+WPguaVsO+8jOeUn+aIkOW9ouWmgiBrZXkxPXZhbHVlMSZrZXkyPXZhbHVlMiDnmoQgc3RyaW5nCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIOeUqOaIt+S8oOWPggogKiBAcGFyYW0ge09iamVjdH0gZGVzY3JpcHRpb24g6LCD55So5o+P6L+w5a+56LGhCiAqIEBwYXJhbSB7T2JqZWN0fSB1c2VyUXVlcnkg55So5oi35Y+C5pWwCiAqIEByZXR1cm4ge3N0cmluZ30gIOWPguaVsOWtl+espuS4sgogKi8KCgpmdW5jdGlvbiBnZXRBcmdzU3RyaW5nV2l0aFVzZXJRdWVyeShhcmdzLCBkZXNjcmlwdGlvbiwgdXNlclF1ZXJ5KSB7CiAgLy8g5bCP56iL5bqP55qEIHF1ZXJ5CiAgdmFyIGFyZ1Jlc3VsdCA9IE9iamVjdC5rZXlzKHVzZXJRdWVyeSkubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgIHJldHVybiBrZXkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQodXNlclF1ZXJ5W2tleV0pOwogIH0pOyAvLyDljY/orq7nmoQgcXVlcnkKCiAgaWYgKGRlc2NyaXB0aW9uLmFyZ3MgJiYgZGVzY3JpcHRpb24uYXJncy5sZW5ndGggPiAwKSB7CiAgICBlYWNoKGRlc2NyaXB0aW9uLmFyZ3MsIGZ1bmN0aW9uIChkZWNsYXJhdGlvbiwgaSkgewogICAgICB2YXIgYXJnID0gYXJnc1tpXTsKCiAgICAgIGlmIChhcmcgIT0gbnVsbCkgewogICAgICAgIGFyZ1Jlc3VsdC5wdXNoKGRlY2xhcmF0aW9uLm5hbWUgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoYXJnKSk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcmV0dXJuIGFyZ1Jlc3VsdC5sZW5ndGggPj0gMCA/IGFyZ1Jlc3VsdC5qb2luKCcmJykgOiAnJzsKfSAvLyBzY2hlbWEg5pyA6ZW/6ZW/5bqm77yMIOi2hei/h+S8muaKpeitpu+8jCDplb/luqbop4TojIPlj4LogIPov5nph4zvvJogaHR0cDovL3dpa2kuYmFpZHUuY29tL3BhZ2VzL3ZpZXdwYWdlLmFjdGlvbj9wYWdlSWQ9MTUyMjQ2ODU2OAoKCnZhciBNQVhfVVJMX0xFTkdUSCA9IDEwMjQgKiAxNTsKdmFyIHByb2Nlc3NvcnMgPSB7CiAgLyoqCiAgICog6Ieq5a6a5LmJ5Y+C5pWw5qCh6aqM55qE5aSE55CG5Zmo44CC5qCh6aqM5Y+C5pWw55qE5pe25YCZ5LiN5a6M5YWo5L6d54Wn5o+P6L+w6KGoCiAgICogQHBhcmFtIHtPYmplY3R9IGRlc2NyaXB0aW9uIOiwg+eUqOaPj+i/sOWvueixoQogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb24g5aSE55CG5Y+C5pWwCiAgICogQHBhcmFtIHtPYmplY3R9IGFwaUNvbnRhaW5lciBqc05hdGl2ZeWuueWZqAogICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAqLwogIEFyZ0NoZWNrV2l0aENhbGxiYWNrOiBmdW5jdGlvbiBBcmdDaGVja1dpdGhDYWxsYmFjayhkZXNjcmlwdGlvbiwgb3B0aW9uLCBhcGlDb250YWluZXIpIHsKICAgIHJldHVybiBmdW5jdGlvbiBwcm9jZXNzb3JBcmdDaGVja1dpdGhDYWxsYmFjayhhcmdzKSB7CiAgICAgIGNoZWNrQXJncyhhcmdzLCBkZXNjcmlwdGlvbi5hcmdzLCBhcGlDb250YWluZXIpOwogICAgICByZXR1cm4gYXJnczsKICAgIH07CiAgfSwKCiAgLyoqCiAgICog5Yib5bu65Y+C5pWw5bqP5YiX5YyW55qE5aSE55CG5Ye95pWw77yM5Yqf6IO95ZKMIGpzLW5hdGl2ZSDkuK3nmoQgQXJnRW5jb2RlIOexu+S8vO+8jOmDveaYr+WvueWPguaVsOi/m+ihjOWtl+espuS4suW6j+WIl+WMluOAggogICAqIOS9huaYr++8jOacrOWHveaVsOWMuuWIhiBzdHJpbmcg5ZKMIG9iamVjdO+8jOS7heWvuSBvYmplY3Qg5YGaIHN0cmluZ2lmee+8jOmBv+WFjeWtl+espuS4suWJjeWQjuWinuWKoCDlj4zlvJXlj7cgIiIg77yM5a+86Ie05a6i5oi356uv5peg5rOV6K+G5Yir44CCCiAgICog5Zug5Li65a6i5oi356uv6Kej5p6QIHNjaGVtZSDljY/orq7ml7bvvIzmmK/noaznvJbnoIHljLnphY0ge30g5om+5YiwSlNPTiDlr7nosaHvvIzlj6rlr7nlhbbov5vooYwgSlNPTiBwYXJzZSDmk43kvZzjgIIKICAgKiDogIzmma7pgJrlrZfnrKbkuLLvvIzliJnmi7/mnaXlsLHnlKjvvIzkuI3kvJogSlNPTiBwYXJzZe+8jOaJgOS7peWmguaenOWtl+espuS4suWcqOWJjeerr+iiqyBzdHJpbmdpZnkg6ICM5bim5LiK5LqG5aSa5L2Z55qE5Y+M5byV5Y+35LqG55qE6K+d77yM5Lya5a+86Ie05a6i5oi356uv5peg5rOV5q2j56Gu6K+G5Yir5pmu6YCa5a2X56ym5Liy44CCCiAgICoKICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gIOi/lOWbnuS4gOS4quWHveaVsO+8jOivpeaOpeWPl+S4iuS4gOS4quWkhOeQhuWZqOeahOi/lOWbnuWAvOS9nOS4uuWPguaVsAogICAqLwogIEFyZ3NFbmNvZGVUb0pTT05FeGNlcHRTdHJpbmc6IGZ1bmN0aW9uIEFyZ3NFbmNvZGVUb0pTT05FeGNlcHRTdHJpbmcoKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gcHJvY2Vzc29yQXJnc0VuY29kZVRvSlNPTkV4Y2VwdFN0cmluZyhhcmdzKSB7CiAgICAgIGVhY2goYXJncywgZnVuY3Rpb24gKGFyZywgaSkgewogICAgICAgIGlmICgoMCwgX3R5cGVvZjIuZGVmYXVsdCkoYXJnKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIGFyZ3NbaV0gPSBKU09OLnN0cmluZ2lmeShhcmcpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBhcmdzOwogICAgfTsKICB9LAoKICAvKioKICAgKiDms6jlhozkuIDkuoznuqflm57osIMgIO+8iOacrOi0qOS4iu+8jOi/meS4qiBwcm9jZXNzb3Ig5bm25rKh5pyJ5a+55Y+C5pWw6L+b6KGM5aSE55CG44CC5L2G5piv55Sx5LqO6ZyA6KaB5Yy65YiGIGludm9rZSDlhrPlrprmmK/lkKbms6jlhozlm57osIPlh73mlbDvvIzlm6DmraTmlL7lnKggcHJvY2Vzc29yIOS4re+8iQogICAqIOS4gOS6jOe6p+Wbnuiwg+eahOeuoeeQhuaWueW8j++8muS9v+eUqOS4gOS4quWvueixoe+8jOS7pSBkZXNjcmlwdGlvbiBuYW1lIOS4uiBrZXkg6K6w5b2V5LiA57qn5Zue6LCD77yb5Lul5LiA57qn5Zue6LCD55qEIG5hbWUg5Li6IGtleSDorrDlvZXkuoznuqflm57osIPjgILku47ogIzlnKjlkI7nu63nq6/og73lipvov5Tlm57lkI7vvIzmib7liLDlubbop6blj5Hlr7nlupTnmoTlm57osIPjgIIKICAgKiBmaXhtZSBhcmdzIOacgOWQjuS4pOS9jeacrOadpeaYryBzdWNjZXNzIOWSjCBmYWls77yM546w5Zyo5Y+Y5oiQ5LiA5LqM57qn5Zue6LCD5LqG77yM5Y+v5Lul5ZCX77yf6ICM5LiUIHBvcCDmmK/kuI3mmK/mnInngrnpmpDmmaYKICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdGlvbiDosIPnlKjmj4/ov7Dlr7nosaEKICAgKiBAcmV0dXJuIHtmdW5jdGlvbigqKTogKn0KICAgKiBAY29uc3RydWN0b3IKICAgKi8KICBSZWdpc3RlckNhbGxiYWNrczogZnVuY3Rpb24gUmVnaXN0ZXJDYWxsYmFja3MoZGVzY3JpcHRpb24pIHsKICAgIHZhciBkZXNjTmFtZSA9IGRlc2NyaXB0aW9uLm5hbWU7CiAgICByZXR1cm4gZnVuY3Rpb24gcHJvY2Vzc29yUmVnaXN0ZXJDYWxsYmFja3MoYXJncykgewogICAgICB2YXIgZmFpbCA9IGFyZ3MucG9wKCk7CiAgICAgIHZhciBzdWNjZXNzID0gYXJncy5wb3AoKTsgLy8g55Sf5oiQ5LqM57qn5Zue6LCD77yI5ZyoIGRlc2NyaXB0aW9uIOS4reaMh+WumuS6hiBuZXh0Q2FsbGJhY2sg77yM5YiZ5Luj6KGo5pyJ5LqM57qn5Zue6LCD77yJCgogICAgICBpZiAoZGVzY3JpcHRpb24ubmV4dENhbGxiYWNrKSB7CiAgICAgICAgdmFyIG5leHRDYWxsYmFjayA9IGdlbmVyYXRlU2Vjb25kQ2FsbGJhY2soZGVzY05hbWUsIHsKICAgICAgICAgIHN1Y2Nlc3M6IHN1Y2Nlc3MsCiAgICAgICAgICBmYWlsOiBmYWlsCiAgICAgICAgfSk7CiAgICAgICAgdmFyIG5leHRDYWxsYmFja0Z1bmNOYW1lID0gZ2V0VW5pcXVlTmFtZSgpOwogICAgICAgIHJlZ2lzdGVyR2xvYmFsbHkobmV4dENhbGxiYWNrRnVuY05hbWUsIG5leHRDYWxsYmFjayk7CiAgICAgICAgYXJncy5wdXNoKG5leHRDYWxsYmFja0Z1bmNOYW1lKTsKICAgICAgfSAvLyDnlJ/miJDkuIDnuqflm57osIMKCgogICAgICB2YXIgZmlyc3RDYWxsYmFja05hbWUgPSBnZXRVbmlxdWVOYW1lKCk7CiAgICAgIHZhciBmaXJzdENhbGxiYWNrID0gZ2VuZXJhdGVDYWxsYmFjayhkZXNjcmlwdGlvbi5uYW1lLCB7CiAgICAgICAgc3VjY2Vzczogc3VjY2VzcywKICAgICAgICBmYWlsOiBmYWlsCiAgICAgIH0sICEhZGVzY3JpcHRpb24ubmV4dENhbGxiYWNrKTsKICAgICAgcmVnaXN0ZXJHbG9iYWxseShmaXJzdENhbGxiYWNrTmFtZSwgZmlyc3RDYWxsYmFjayk7CiAgICAgIGFyZ3MucHVzaChmaXJzdENhbGxiYWNrTmFtZSk7CiAgICAgIHJldHVybiBhcmdzOwogICAgfTsKICB9LAoKICAvKioKICAgKiDliJvlu7rlj4LmlbDlkIjlubbnmoTlpITnkIblh73mlbAKICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdGlvbiDosIPnlKjmj4/ov7Dlr7nosaEKICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9uIOWkhOeQhuWPguaVsAogICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAqLwogIEFyZ0NvbWJpbmVXaXRoQ2FsbGJhY2s6IGZ1bmN0aW9uIEFyZ0NvbWJpbmVXaXRoQ2FsbGJhY2soZGVzY3JpcHRpb24sIG9wdGlvbikgewogICAgdmFyIHNjaGVtZSA9IGFwcFByb3RvTmFtZSArICc6Ly8nOwoKICAgIHN3aXRjaCAob3B0aW9uKSB7CiAgICAgIGNhc2UgJ2JkYm94VVJMJzoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gcHJvY2Vzc29yQXJnQ29tYmluZVdpdGhDYWxsYmFja0JkYm94VVJMKHJlZikgewogICAgICAgICAgdmFyIGFyZ3MgPSByZWZbMF07CiAgICAgICAgICB2YXIgY2FsbGJhY2tGdW5jdGlvbk5hbWUgPSByZWZbMV07CiAgICAgICAgICB2YXIgcHJlZml4ID0gZ2V0UHJlZml4KHNjaGVtZSwgZGVzY3JpcHRpb24pOwogICAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gZ2V0UXVlcnlTdHJpbmcoZGVzY3JpcHRpb24pOwogICAgICAgICAgdmFyIGFyZ1F1ZXJ5U3RyaW5nID0gZ2V0QXJnUXVlcnlTdHJpbmcoYXJncywgZGVzY3JpcHRpb24pOwogICAgICAgICAgdmFyIHBhcmFtc1N0cmluZyA9IGdldFBhcmFtc1N0cmluZyhhcmdzLCBkZXNjcmlwdGlvbik7CiAgICAgICAgICB2YXIgY2FsbGJhY2tTdHJpbmcgPSAoZGVzY3JpcHRpb24uY2FsbGJhY2tOYW1lIHx8IGRlc2NyaXB0aW9uLmNhbGxiYWNrIHx8ICdjYWxsYmFjaycpICsgIj0iICsgY2FsbGJhY2tGdW5jdGlvbk5hbWU7CiAgICAgICAgICB2YXIgcmVzdWx0U3RyID0gW3BhcmFtc1N0cmluZywgcXVlcnlTdHJpbmcsIGFyZ1F1ZXJ5U3RyaW5nLCBjYWxsYmFja1N0cmluZ10uZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtICE9PSAnJzsKICAgICAgICAgIH0pLmpvaW4oJyYnKTsKICAgICAgICAgIHZhciBzY2hlbWVVUkwgPSBwcmVmaXggKyAnPycgKyByZXN1bHRTdHI7CiAgICAgICAgICBjb25zb2xlLmxvZygnc2NoZW1lIFVSTDo6OiAnLCBzY2hlbWVVUkwpOwogICAgICAgICAgcmV0dXJuIHNjaGVtZVVSTDsKICAgICAgICB9OwoKICAgICAgY2FzZSAnVVJMJzoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gcHJvY2Vzc29yQXJnQ29tYmluZVdpdGhDYWxsYmFja1VSTChhcmdzKSB7CiAgICAgICAgICB2YXIgcHJlZml4ID0gZ2V0UHJlZml4KHNjaGVtZSwgZGVzY3JpcHRpb24pOwogICAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gZ2V0UXVlcnlTdHJpbmcoZGVzY3JpcHRpb24pOwogICAgICAgICAgdmFyIGFyZ1F1ZXJ5U3RyaW5nID0gZ2V0QXJnUXVlcnlTdHJpbmcoYXJncywgZGVzY3JpcHRpb24pOyAvLyDkuIDnuqflm57osIPlrZfnrKbkuLIKCiAgICAgICAgICB2YXIgY2FsbGJhY2tOYW1lID0gZGVzY3JpcHRpb24uY2FsbGJhY2tOYW1lIHx8IGRlc2NyaXB0aW9uLmNhbGxiYWNrIHx8ICdjYWxsYmFjayc7CiAgICAgICAgICB2YXIgY2FsbGJhY2tTdHJpbmcgPSBjYWxsYmFja05hbWUgKyAnPScgKyBhcmdzLnBvcCgpOyAvLyDkuoznuqflm57osIPlrZfnrKbkuLIKCiAgICAgICAgICB2YXIgbmV4dENhbGxiYWNrU3RyaW5nID0gZGVzY3JpcHRpb24ubmV4dENhbGxiYWNrID8gZGVzY3JpcHRpb24ubmV4dENhbGxiYWNrICsgJz0nICsgYXJncy5wb3AoKSA6ICcnOyAvLyDlj4LmlbDlrZfnrKbkuLIKCiAgICAgICAgICB2YXIgcGFyYW1zU3RyaW5nID0gZ2V0QXJnc1N0cmluZyhhcmdzLCBkZXNjcmlwdGlvbik7CiAgICAgICAgICB2YXIgcmVzdWx0U3RyID0gW3BhcmFtc1N0cmluZywgbmV4dENhbGxiYWNrU3RyaW5nLCBxdWVyeVN0cmluZywgYXJnUXVlcnlTdHJpbmcsIGNhbGxiYWNrU3RyaW5nXS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW0gIT09ICcnOwogICAgICAgICAgfSkuam9pbignJicpOwogICAgICAgICAgdmFyIHNjaGVtZVVSTCA9IHByZWZpeCArICc/JyArIHJlc3VsdFN0cjsKICAgICAgICAgIGNvbnNvbGUubG9nKCdzY2hlbWUgVVJMOjo6ICcsIHNjaGVtZVVSTCk7CiAgICAgICAgICByZXR1cm4gc2NoZW1lVVJMOwogICAgICAgIH07CgogICAgICBjYXNlICdPYmplY3QnOgogICAgICAgIHJldHVybiBmdW5jdGlvbiBwcm9jZXNzb3JBcmdDb21iaW5lV2l0aENhbGxiYWNrT2JqZWN0KGFyZ3MpIHsKICAgICAgICAgIHZhciByZXF1aXJlQXJncyA9IGRlc2NyaXB0aW9uLmFyZ3M7CiAgICAgICAgICB2YXIgY2FsbGJhY2tGdW5jdGlvbk5hbWUgPSBhcmdzLnBvcCgpOwoKICAgICAgICAgIGlmIChkZXNjcmlwdGlvbi5uZXh0Q2FsbGJhY2spIHsKICAgICAgICAgICAgcmVxdWlyZUFyZ3MgPSByZXF1aXJlQXJncy5jb25jYXQoW3sKICAgICAgICAgICAgICBuYW1lOiBkZXNjcmlwdGlvbi5uZXh0Q2FsbGJhY2ssCiAgICAgICAgICAgICAgdmFsdWU6ICdzdHJpbmcnCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgIH0gLy8g5aaC5p6cQVBJ5LiN5o6l5Y+X5Y+C5pWw77yI6ICM5LiU5Lmf5rKh5LqM57qn5Zue6LCD77yJ77yM5bCx5LiN5Lyg6YCS56m65a+56LGh44CCCiAgICAgICAgICAvLyDlm6DkuLogQW5kcm9pZCDnmoQgSmF2YSDlh73mlbDkvKDlj4LmlbDph4/lhrPlrprkuoblh73mlbDnmoTlrprkuYko5Lyg5Y+C5ZKM5LiN5Lyg5Y+C5piv5Lik5Liq5LiN5ZCM55qE5Ye95pWwKeOAggoKCiAgICAgICAgICBpZiAocmVxdWlyZUFyZ3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBbdW5kZWZpbmVkLCBjYWxsYmFja0Z1bmN0aW9uTmFtZV07CiAgICAgICAgICB9IC8vIOS9v+eUqOaVsOe7hOeahOaWueW8j+S8oOmAkiBbcGFyYW1zLCBjYWxsYmFja10KICAgICAgICAgIC8vIOacieWIqeS6juaJi+eZviA4LjIg5LmL5YmN55qE5a6J5Y2TIEphdmEganNJbnRlcmZhY2Ug5o6l5Y+X5Y+C5pWw55qE5qC85byPIG1vZHVsZS5hY3Rpb24ocGFyYW1zLCBjYWxsYmFjaykKCgogICAgICAgICAgcmV0dXJuIFthcmdDb21iaW5lKGFyZ3MsIHJlcXVpcmVBcmdzKSwgY2FsbGJhY2tGdW5jdGlvbk5hbWVdOwogICAgICAgIH07CgogICAgICBjYXNlICdKU09OU3RyaW5nJzoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gcHJvY2Vzc29yQXJnQ29tYmluZVdpdGhDYWxsYmFja0pTT05TdHJpbmcoYXJncykgewogICAgICAgICAgdmFyIGNhbGxiYWNrRnVuY3Rpb25OYW1lID0gYXJncy5wb3AoKTsKICAgICAgICAgIHZhciByZXF1aXJlQXJncyA9IGRlc2NyaXB0aW9uLmFyZ3M7CgogICAgICAgICAgaWYgKGRlc2NyaXB0aW9uLm5leHRDYWxsYmFjaykgewogICAgICAgICAgICByZXF1aXJlQXJncyA9IHJlcXVpcmVBcmdzLmNvbmNhdChbewogICAgICAgICAgICAgIG5hbWU6IGRlc2NyaXB0aW9uLm5leHRDYWxsYmFjaywKICAgICAgICAgICAgICB2YWx1ZTogJ3N0cmluZycKICAgICAgICAgICAgfV0pOwogICAgICAgICAgfSAvLyDlpoLmnpxBUEnkuI3mjqXlj5flj4LmlbDvvIjogIzkuJTkuZ/msqHkuoznuqflm57osIPvvInvvIzlsLHkuI3kvKDpgJLnqbrlr7nosaHjgIIKICAgICAgICAgIC8vIOWboOS4uiBBbmRyb2lkIOeahCBKYXZhIOWHveaVsOS8oOWPguaVsOmHj+WGs+WumuS6huWHveaVsOeahOWumuS5iSjkvKDlj4LlkozkuI3kvKDlj4LmmK/kuKTkuKrkuI3lkIznmoTlh73mlbAp44CCCgoKICAgICAgICAgIGlmIChyZXF1aXJlQXJncy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIFt1bmRlZmluZWQsIGNhbGxiYWNrRnVuY3Rpb25OYW1lXTsKICAgICAgICAgIH0gLy8g5L2/55So5pWw57uE55qE5pa55byP5Lyg6YCSIFtwYXJhbXMsIGNhbGxiYWNrXQogICAgICAgICAgLy8g5pyJ5Yip5LqO5omL55m+IDguMiDkuYvliY3nmoTlronljZMgSmF2YSBqc0ludGVyZmFjZSDmjqXlj5flj4LmlbDnmoTmoLzlvI8gbW9kdWxlLmFjdGlvbihwYXJhbXMsIGNhbGxiYWNrKQoKCiAgICAgICAgICByZXR1cm4gW0pTT04uc3RyaW5naWZ5KGFyZ0NvbWJpbmUoYXJncywgcmVxdWlyZUFyZ3MpKSwgY2FsbGJhY2tGdW5jdGlvbk5hbWVdOwogICAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIHJldHVyblJhdzsKICB9LAoKICAvKioKICAgKgogICAqIEByZXR1cm4ge2Z1bmN0aW9uKCpbXSk6IGFueVtdfQogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIEFyZ0pTT05TdHJpbmc6IGZ1bmN0aW9uIEFyZ0pTT05TdHJpbmcoKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gcHJvY2Vzc29yQXJnSlNPTlN0cmluZyhyZWYpIHsKICAgICAgdmFyIGFyZ3MgPSByZWZbMF07CiAgICAgIHZhciBjYWxsYmFja0Z1bmN0aW9uTmFtZSA9IHJlZlsxXTsKICAgICAgcmV0dXJuIFtKU09OLnN0cmluZ2lmeShhcmdzKSwgY2FsbGJhY2tGdW5jdGlvbk5hbWVdOwogICAgfTsKICB9LAoKICAvKioKICAgKiDliJvlu7rmlrnms5XosIPnlKjnmoTlpITnkIblh73mlbDvvIjmoLnmja4g55So5oi35Lyg5YWl55qEYXJncyDlhrPlrprosIPnlKjkvKDlj4LvvIzogIzpnZ7mj4/ov7DnmoQgYXJnc+mVv+W6pu+8iQogICAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdGlvbiDosIPnlKjmj4/ov7Dlr7nosaEKICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9uIOWkhOeQhuWPguaVsAogICAqIEByZXR1cm4ge0Z1bmN0aW9ufQogICAqLwoKICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogIENhbGxNZXRob2RCeVVzZXJBcmdzOiBmdW5jdGlvbiBDYWxsTWV0aG9kQnlVc2VyQXJncyhkZXNjcmlwdGlvbiwgb3B0aW9uKSB7CiAgICB2YXIgbWV0aG9kT3duZXI7CiAgICB2YXIgbWV0aG9kTmFtZTsKCiAgICBmdW5jdGlvbiBmaW5kTWV0aG9kKCkgewogICAgICBpZiAoIW1ldGhvZE93bmVyKSB7CiAgICAgICAgdmFyIHNlZ21lbnRzID0gZGVzY3JpcHRpb24ubWV0aG9kLnNwbGl0KCcuJyk7CiAgICAgICAgdmFyIGxhc3RJbmRleCA9IHNlZ21lbnRzLmxlbmd0aCAtIDE7CiAgICAgICAgbWV0aG9kTmFtZSA9IHNlZ21lbnRzW2xhc3RJbmRleF07CiAgICAgICAgbWV0aG9kT3duZXIgPSBnbG9iYWwkMTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXN0SW5kZXg7IGkrKykgewogICAgICAgICAgbWV0aG9kT3duZXIgPSBtZXRob2RPd25lcltzZWdtZW50c1tpXV07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbWV0aG9kVW5kZWZpbmVkQ2hlY2tlcigpIHsKICAgICAgLy8g5Y+q5Y+R6YCB5LiA5qyhCiAgICAgIGlmIChtZXRob2RVbmRlZmluZWRDaGVja2VyU2VuZGVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBtZXRob2RVbmRlZmluZWRDaGVja2VyU2VuZGVkID0gdHJ1ZTsKICAgICAgdmFyIG1ldGhvZEluZm8gPSBbMCwgMCwgMCwgMF07CgogICAgICBpZiAoIXdpbmRvdy5CZGJveF9hbmRyb2lkX2NvbW1vbikgewogICAgICAgIG1ldGhvZEluZm9bMF0gPSAxOwogICAgICB9IGVsc2UgaWYgKCF3aW5kb3cuQmRib3hfYW5kcm9pZF9jb21tb24uc2V0UXVlcnkpIHsKICAgICAgICBtZXRob2RJbmZvWzBdID0gMjsKICAgICAgfQoKICAgICAgaWYgKCF3aW5kb3cuQmRib3hfYW5kcm9pZF9qc2JyaWRnZSkgewogICAgICAgIG1ldGhvZEluZm9bMV0gPSAxOwogICAgICB9IGVsc2UgaWYgKCF3aW5kb3cuQmRib3hfYW5kcm9pZF9qc2JyaWRnZS5kaXNwYXRjaCkgewogICAgICAgIG1ldGhvZEluZm9bMV0gPSAyOwogICAgICB9IC8vIOWtmOWcqCBtZXRob2QtdW5kZWZpbmVkIOaKpemUmeeahCBVQSDnq6/mj4/ov7DooajlvIDlhbPmmK/lkKbmiZPlvIAKCgogICAgICBpZiAoIXdpbmRvdy5fbmEpIHsKICAgICAgICBtZXRob2RJbmZvWzJdID0gMTsKICAgICAgfSBlbHNlIGlmICghd2luZG93Ll9uYS5nZXRBUElzKSB7CiAgICAgICAgbWV0aG9kSW5mb1syXSA9IDI7CiAgICAgIH0gZWxzZSBpZiAoIXdpbmRvdy5fbmEuZ2V0QVBJcygwKSkgewogICAgICAgIG1ldGhvZEluZm9bMl0gPSAzOwogICAgICB9IC8vIOWtmOWcqCBtZXRob2QtdW5kZWZpbmVkIOaKpemUmeeahCBVQSDmmK/lkKbkuLogY2hyb21l5rWP6KeI5ZmoCgoKICAgICAgaWYgKHdpbmRvdy5jaHJvbWUpIHsKICAgICAgICBtZXRob2RJbmZvWzNdID0gMTsKICAgICAgfQoKICAgICAgdmFyIGxzU3RyID0gJyc7CgogICAgICB0cnkgewogICAgICAgIGxzU3RyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ21ldGhvZEluZm8nKSB8fCAnJzsKICAgICAgICB2YXIgbHNBcnIgPSBsc1N0ciA/IGxzU3RyLnNwbGl0KCd8JykgOiBbXTsKICAgICAgICB2YXIgbWV0aG9kSW5mb1N0ciA9IG1ldGhvZEluZm8uam9pbignLCcpOwoKICAgICAgICBpZiAobHNBcnIuaW5kZXhPZihtZXRob2RJbmZvU3RyKSA9PT0gLTEpIHsKICAgICAgICAgIGxzQXJyLnB1c2gobWV0aG9kSW5mb1N0cik7CiAgICAgICAgICBsc1N0ciA9IGxzQXJyLmpvaW4oJ3wnKTsKICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtZXRob2RJbmZvJywgbHNTdHIpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7Ly8gc2FmYXJpIOmakOengeaooeW8j+S4iyBsb2NhbFN0b3JhZ2Ug5Lya5oql6ZSZCiAgICAgIH0KCiAgICAgIHZhciBlcnJvciA9IHsKICAgICAgICBuYW1lOiAnTWV0aG9kVW5kZWZpbmVkJywKICAgICAgICBtZXNzYWdlOiAnTWV0aG9kIHVuZGVmaW5lZCcsCiAgICAgICAgbWV0aG9kOiBkZXNjcmlwdGlvbi5tZXRob2QsCiAgICAgICAgaW5mbzogbWV0aG9kSW5mbywKICAgICAgICBsczogbHNTdHIKICAgICAgfTsKICAgICAgaW5uZXJFdmVudC5lbWl0KCdlcnJvcjptZXRob2QtdW5kZWZpbmVkJywgZXJyb3IpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxNZXRob2QoYXJncykgewogICAgICAvLyDljLrliIbmmK/lkKbmmK/mlbDnu4TmnaXlhrPlrprosIPotbfmlrnlvI8KICAgICAgZmluZE1ldGhvZCgpOwogICAgICB2YXIgbWV0aG9kRGVmaW5lZCA9IG1ldGhvZE93bmVyICYmIG1ldGhvZE93bmVyW21ldGhvZE5hbWVdOyAvLyDov5nph4zlr7nkvY7niYjmnKznmoTlronljZPnq6/lgZrnibnmrorlpITnkIYKICAgICAgLy8gZ2xvYmFsLnByb21wdOabv+S7o21ldGhvZOebtOaOpeiwg+eUqO+8iOWboOS4uuS9jueJiOacrOS4jeaUr+aMgWpzIGludGVyZmFjZe+8iQoKICAgICAgaWYgKGlzQW5kcm9pZCAmJiBpc01haW5Cb3ggJiYgIW1ldGhvZERlZmluZWQpIHsKICAgICAgICByZXR1cm4gcHJvbXB0SW52b2tlcihkZXNjcmlwdGlvbiwgYXJncyk7CiAgICAgIH0KCiAgICAgIGlmICghbWV0aG9kRGVmaW5lZCkgewogICAgICAgIG1ldGhvZFVuZGVmaW5lZENoZWNrZXIoKTsKICAgICAgfSAvLyDkuI3mmK/mlbDnu4TvvIzliJnnm7TmjqXkvKDpgJIKCgogICAgICBpZiAoIWlzQXJyYXkoYXJncykpIHsKICAgICAgICBkZWJ1ZyhkZXNjcmlwdGlvbi5tZXRob2QgKyAnKCcgKyBKU09OLnN0cmluZ2lmeShhcmdzKSArICcpJyk7CiAgICAgICAgcmV0dXJuIG1ldGhvZE93bmVyW21ldGhvZE5hbWVdKGFyZ3MpOwogICAgICB9IC8vIHBhcmFtcyDkuLogdW5kZWZpbmVkIOivgeaYjuS4jemcgOimgeS8oO+8jOenu+mZpOatpOWPguaVsOOAggogICAgICAvLyDlm6DkuLrlronljZPnmoQganNJbnRlcmZhY2Ug5Li6IEphdmEg5Ye95pWw77yM5Y+C5pWw5pWw6YeP5LiN5ZCM5Luj6KGo5LqG5LiN5ZCM55qE5Ye95pWw77yM5Lyg6YCS5LqG5LiN6K+l5Lyg55qE5Y+C5pWw44CC5Lya5a+86Ie05a6J5Y2T5oql6ZSZ5om+5LiN5Yiw5Ye95pWwCgoKICAgICAgaWYgKGFyZ3NbMF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIGFyZ3Muc2hpZnQoKTsKICAgICAgfQoKICAgICAgZGVidWcoZGVzY3JpcHRpb24ubWV0aG9kICsgJygnICsgSlNPTi5zdHJpbmdpZnkoYXJncykgKyAnKScpOyAvLyDmgKfog73kvJjljJbvvJrlr7nkuo7pq5jpopHnmoTlj4LmlbDkuLow44CBMeOAgTLjgIEz55qE5oOF5Ya177yM55u05o6l6LCD55So44CC5YeP5bCRIGFwcGx5IOW4puadpeeahOaAp+iDveaNn+WksQoKICAgICAgc3dpdGNoIChhcmdzLmxlbmd0aCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJldHVybiBtZXRob2RPd25lclttZXRob2ROYW1lXSgpOwoKICAgICAgICBjYXNlIDE6CiAgICAgICAgICByZXR1cm4gbWV0aG9kT3duZXJbbWV0aG9kTmFtZV0oYXJnc1swXSk7CgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHJldHVybiBtZXRob2RPd25lclttZXRob2ROYW1lXShhcmdzWzBdLCBhcmdzWzFdKTsKCiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcmV0dXJuIG1ldGhvZE93bmVyW21ldGhvZE5hbWVdKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIG1ldGhvZE93bmVyW21ldGhvZE5hbWVdLmFwcGx5KG1ldGhvZE93bmVyLCBhcmdzKTsKICAgICAgfQogICAgfQoKICAgIHN3aXRjaCAob3B0aW9uKSB7CiAgICAgIGNhc2UgJ2NhbGxiYWNrJzoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gcHJvY2Vzc29yQ2FsbE1ldGhvZEJ5VXNlckFyZ3NXaXRoQ2FsbGJhY2soYXJncykgewogICAgICAgICAgcmV0dXJuIGNhbGxNZXRob2QoYXJncyk7CiAgICAgICAgfTsKCiAgICAgIGNhc2UgJ25vQ2FsbGJhY2snOgogICAgICAgIHJldHVybiBmdW5jdGlvbiBwcm9jZXNzb3JDYWxsTWV0aG9kQnlVc2VyQXJnc1dpdGhvdXRDYWxsYmFjayhhcmdzKSB7CiAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzLnBvcCgpOwogICAgICAgICAgdmFyIHJlcyA9IGNhbGxNZXRob2QoYXJncyk7IC8vIOWvueS6juebtOaOpei/lOWbnuWAvOeahCBqc0ludGVyZmFjZe+8jOmcgOimgeS9v+eUqCBuZXh0VGljayDmnaXkvb/lvpflm57osIPog73lvILmraXmiafooYwKCiAgICAgICAgICBuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGdsb2JhbCQxW2NhbGxiYWNrXShyZXMpOwogICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIHByb2Nlc3NvckNhbGxNZXRob2RCeVVzZXJBcmdzRGVmYXVsdChhcmdzKSB7CiAgICAgICAgICByZXR1cm4gY2FsbE1ldGhvZChhcmdzKTsKICAgICAgICB9OwogICAgfQogIH0sCiAgQ2hlY2tVUkw6IGZ1bmN0aW9uIENoZWNrVVJMKCkgewogICAgcmV0dXJuIGZ1bmN0aW9uIHByb2Nlc3NvckNoZWNrVVJMKHVybCkgewogICAgICB2YXIgYXJncyA9IFtdLAogICAgICAgICAgbGVuJDEgPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgICAgIHdoaWxlIChsZW4kMS0tID4gMCkgewogICAgICAgIGFyZ3NbbGVuJDFdID0gYXJndW1lbnRzW2xlbiQxICsgMV07CiAgICAgIH0KCiAgICAgIHRyeSB7CiAgICAgICAgZGVidWcoJ3NjaGVtYTonLCB1cmwpOwogICAgICAgIHZhciBsZW4gPSB1cmwubGVuZ3RoOwoKICAgICAgICBpZiAobGVuID4gTUFYX1VSTF9MRU5HVEgpIHsKICAgICAgICAgIGlubmVyRXZlbnQuZW1pdCgnZXJyb3I6dXJsLXRvby1sb25nJywgewogICAgICAgICAgICBuYW1lOiAnVVJMVG9vTG9uZycsCiAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGUgdXJsIGlzIHRvbyBsb25nJywKICAgICAgICAgICAgbGVuZ3RoOiBsZW4sCiAgICAgICAgICAgIHVybDogdXJsCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciB1bmV4cGVjdGVkS2V5d29yZE1hdGNoID0gLyhOYU58bnVsbHx1bmRlZmluZWQpLy5leGVjKHVybCk7CgogICAgICAgIGlmICh1bmV4cGVjdGVkS2V5d29yZE1hdGNoKSB7CiAgICAgICAgICBpbm5lckV2ZW50LmVtaXQoJ2Vycm9yOnVybC1pbmNsdWRlLXVuZXhwZWN0ZWQta2V5d29yZCcsIHsKICAgICAgICAgICAgbmFtZTogJ1VSTEVycm9yJywKICAgICAgICAgICAgbWVzc2FnZTogJ1RoZSB1cmwgaW5jbHVkZSBhbiB1bmV4cGVjdGVkIGtleXdvcmQnLAogICAgICAgICAgICBrZXl3b3JkOiB1bmV4cGVjdGVkS2V5d29yZE1hdGNoWzBdLAogICAgICAgICAgICB1cmw6IHVybAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsvLyBlbXB0eQogICAgICB9CgogICAgICByZXR1cm4gdXJsOwogICAgfTsKICB9LAoKICAvKioKICAgKiDliJvlu7ogb3BlblN3YW7vvIjmiZPlvIDlsI/nqIvluo/nmoTvvInnmoTlj4LmlbDlkIjlubbnmoTlpITnkIblh73mlbAKICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdGlvbiDosIPnlKjmj4/ov7Dlr7nosaEKICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0KICAgKi8KICBTd2FuU2NoZW1lQ29tYmluZTogZnVuY3Rpb24gU3dhblNjaGVtZUNvbWJpbmUoZGVzY3JpcHRpb24pIHsKICAgIHZhciBzY2hlbWUgPSBhcHBQcm90b05hbWUgKyAnOi8vJzsKICAgIHJldHVybiBmdW5jdGlvbiBwcm9jZXNzb3JTd2FuU2NoZW1lQ29tYmluZShhcmdzKSB7CiAgICAgIHZhciBhcHBLZXkgPSBhcmdzWzBdOwogICAgICB2YXIgYXBwUGF0aCA9IGFyZ3NbMV0gfHwgJyc7IC8vIGFwcFBhdGgg5byA5aS05a2X56ym5LiN5pivLwoKICAgICAgaWYgKGFwcFBhdGguaW5kZXhPZignLycpICE9PSAwKSB7CiAgICAgICAgZGVidWcoJ3hjeF9wYXRoOiAnICsgYXBwUGF0aCArICcg5b+F6aG75pivL+W8gOWktCcpOwogICAgICAgIHZhciB0YWlsU3RyID0gYXBwS2V5LnN1YnN0cihhcHBLZXkubGVuZ3RoIC0gMSwgMSk7IC8vIGFwcEtleSDnu5PlsL7kuI3ljIXlkKsv5pe277yMYXBwUGF0aCDlvIDlpLTpnIDopoHooaXlhYUvCgogICAgICAgIGFwcFBhdGggPSB0YWlsU3RyID09PSAnLycgPyBhcHBQYXRoIDogJy8nICsgYXBwUGF0aDsKICAgICAgfQoKICAgICAgdmFyIHF1ZXJ5ID0gYXJnc1syXSAmJiBKU09OLnBhcnNlKGFyZ3NbMl0pIHx8IHt9OwogICAgICBhcmdzWzBdID0gdW5kZWZpbmVkOwogICAgICBhcmdzWzFdID0gdW5kZWZpbmVkOwogICAgICBhcmdzWzJdID0gdW5kZWZpbmVkOyAvLyDkuIDnuqflm57osIPlrZfnrKbkuLIKCiAgICAgIHZhciBjYWxsYmFja05hbWUgPSBkZXNjcmlwdGlvbi5jYWxsYmFja05hbWUgfHwgZGVzY3JpcHRpb24uY2FsbGJhY2sgfHwgJ2NhbGxiYWNrJzsKICAgICAgdmFyIGNhbGxiYWNrU3RyaW5nID0gY2FsbGJhY2tOYW1lICsgJz0nICsgYXJncy5wb3AoKTsgLy8g5LqM57qn5Zue6LCD5a2X56ym5LiyCgogICAgICB2YXIgbmV4dENhbGxiYWNrU3RyaW5nID0gZGVzY3JpcHRpb24ubmV4dENhbGxiYWNrID8gZGVzY3JpcHRpb24ubmV4dENhbGxiYWNrICsgJz0nICsgYXJncy5wb3AoKSA6ICcnOwogICAgICB2YXIgcHJlZml4ID0gc2NoZW1lICsgZGVzY3JpcHRpb24uYXV0aG9yaXR5ICsgJy8nICsgYXBwS2V5ICsgYXBwUGF0aDsKICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gZ2V0UXVlcnlTdHJpbmcoZGVzY3JpcHRpb24pOwogICAgICB2YXIgcGFyYW1zU3RyaW5nID0gZ2V0QXJnc1N0cmluZ1dpdGhVc2VyUXVlcnkoYXJncywgZGVzY3JpcHRpb24sIHF1ZXJ5KTsKICAgICAgdmFyIHJlc3VsdFN0ciA9IFtwYXJhbXNTdHJpbmcsIG5leHRDYWxsYmFja1N0cmluZywgcXVlcnlTdHJpbmcsIGNhbGxiYWNrU3RyaW5nXS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbSAhPT0gJyc7CiAgICAgIH0pLmpvaW4oJyYnKTsKICAgICAgdmFyIHNjaGVtZVVSTCA9IHByZWZpeCArICc/JyArIHJlc3VsdFN0cjsKICAgICAgY29uc29sZS5sb2coJ3NjaGVtZSBVUkw6OjogJywgc2NoZW1lVVJMKTsKICAgICAgcmV0dXJuIHNjaGVtZVVSTDsKICAgIH07CiAgfQp9OwovKioKICogQGZpbGUg55So5LqO5rOo5YWlIGpzTmF0aXZlIOeahOiHquWumuS5iSBwcm9jZXNzb3IKICogQGF1dGhvciB6aG91ZGFuMDMKICogQGRhdGUgMjAxOS81LzI4CiAqLwoKdmFyIGluaXRQcm9jZXNzb3IgPSBmdW5jdGlvbiBpbml0UHJvY2Vzc29yKGFwaUNvbnRhaW5lcikgewogIGZvciAodmFyIGtleSBpbiBwcm9jZXNzb3JzKSB7CiAgICBpZiAocHJvY2Vzc29ycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgIHRyeSB7CiAgICAgICAgYXBpQ29udGFpbmVyLmFkZFByb2Nlc3NvckNyZWF0b3Ioa2V5LCBwcm9jZXNzb3JzW2tleV0pOwogICAgICB9IGNhdGNoIChlKSB7Ly8gZG8gbm90aGluZwogICAgICB9CiAgICB9CiAgfQp9OwovKioKKiBAZmlsZSBldmVudC5vbiBldmVudC5vZmYganNjYWxsYmFjayDlj4LmlbDph43lhpkKKgoqIOeUseS6jiBldmVudCDnmoTlm57osIPnrqHnkIbmr5TovoPnibnmrorvvIzkuI3lsZ7kuo7ljbPnlKjljbPmr4HnmoTnsbvlnovvvIzlm6DmraTlnKjmraTph43lhpkKKgoqIOebruWJjeerr+S4iuS6i+S7tumAmuS/oeiuvuiuoeeahOe8uumZtwoxLiB3ZWJ2aWV3IOWIt+aWsOWQju+8jOWPkemAgea2iOaBr++8jOerr+S4iuS7jeeEtuiwg+eUqOS5i+WJjeazqOWGjOeahOS6i+S7tu+8jOivgeaYjuerr+S4iuW5tuayoeacieWcqCB3ZWJ2aWV3IOWIt+aWsOWQjumHjee9rueKtuaAgeOAguS4jeespuWQiCB3ZWJ2aWV3IOeahOeUn+WRveWRqOacn+OAggoyLiDnm67liY3kuovku7bpgJrov4flrZfnrKbkuLLkvKDpgJLvvIzlr7zoh7TliY3nq6/lkozlrqLmiLfnq6/pnIDopoHliIbliKvnrqHnkIbkuovku7bvvIzliY3nq6/lv4XpobvlhajlsYDmjILovb3kuovku7bkvpvnq6/osIPnlKjvvIzljbTkuI3nn6XpgZPkvZXml7bog73np7vpmaTjgILkvJrlr7zoh7TliY3nq6/lhoXlrZjms4TpnLLjgILmm7TlkIjnkIbnmoTop6PlhrPlip7ms5XlupTor6XmmK/kvb/nlKgganNCaW5kaW5nIOeahOaWueW8j+i/m+ihjOmAmuS/oe+8jOeUseWuouaIt+err+e7n+S4gCBHQ+OAggoqCioKKiBUT0RPIOWvueS6jiBjYWxsYmFjayDnmoTplb/mnJ/kv53mjIHpnIDmsYLvvIzpmaTkuoYgZXZlbnQg5Lul5aSW77yM6L+Y5pyJ5Yir55qE56uv6IO95Yqb44CC55uu5YmN55qE6Kej5Yaz5pa55qGI5piv6YeN5YaZ77yM5b6F5Ye6546wNOS4quS7peS4iuWQju+8jOWGjei/m+ihjOaAu+e7k+WPiuWwgeijhQoqLwoKLyoqCiAqIOeUqOS6juWbnuiwg+WHveaVsOWMheijheWRveWQjeeahOiHquWinmlkCiAqCiAqIEBpbm5lcgogKiBAdHlwZSB7bnVtYmVyfQogKi8KCgp2YXIgZnVuY0lkJDEgPSAxOwovKioKICog55So5LqO5Zue6LCD5Ye95pWw5YyF6KOF5ZG95ZCN55qE5YmN57yACiAqCiAqIEBpbm5lcgogKiBAY29uc3QKICogQHR5cGUge3N0cmluZ30KICovCgp2YXIgRlVOQ19QUkVGSVgkMSA9ICdfX2JveHhfZXZlbnRfJzsKCmZ1bmN0aW9uIGd1aWQoKSB7CiAgcmV0dXJuIEZVTkNfUFJFRklYJDEgKyBmdW5jSWQkMSsrOwp9CgpmdW5jdGlvbiB3cmFwRnVuY3Rpb24oZm4pIHsKICB2YXIgaWQgPSBndWlkKCk7CgogIGdsb2JhbCQxW2lkXSA9IGZ1bmN0aW9uIChhY3Rpb24sIGRhdGEpIHsKICAgIGZuKGFjdGlvbiwgZGF0YSk7CiAgfTsKCiAgcmV0dXJuIGlkOwp9Ci8qKgogKiDmr5TovoPnlKjmiLfkvKDlj4LnmoTms6jlhowv5Y+N5rOo5YaM55qE5LqL5Lu2ICDmmK/lkKblkozlrZjlgqjnmoTkuovku7bmnInlkIzkuIDkuKoKICog5Yik5pat5p2h5Lu25Yy65YiG5a6J5Y2T5ZKMIGlPUwogKgogKiBAcGFyYW0gaW5mbwogKiBAcGFyYW0gb3B0aW9ucwogKiBAcmV0dXJuIHtib29sZWFufQogKi8KCgpmdW5jdGlvbiBpc1NhbWVFdmVudChpbmZvLCBvcHRpb25zKSB7CiAgLy8g5a6J5Y2TIOmcgOimgeeciyBwYWdlIOWSjCBhY3Rpb24g55qE57uE5ZCICiAgaWYgKGlzQW5kcm9pZCkgewogICAgaWYgKG9wdGlvbnMuanNjYWxsYmFjaykgewogICAgICByZXR1cm4gaW5mby5wYWdlID09PSBvcHRpb25zLnBhZ2UgJiYgaW5mby5hY3Rpb24gPT09IG9wdGlvbnMuYWN0aW9uICYmIGluZm8uZm4gPT09IG9wdGlvbnMuanNjYWxsYmFjazsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBpbmZvLnBhZ2UgPT09IG9wdGlvbnMucGFnZSAmJiBpbmZvLmFjdGlvbiA9PT0gb3B0aW9ucy5hY3Rpb247CiAgICB9CiAgfSAvLyBpb3Mg5Y+q55yLIGFjdGlvbgogIGVsc2UgaWYgKG9wdGlvbnMuanNjYWxsYmFjaykgewogICAgICByZXR1cm4gaW5mby5hY3Rpb24gPT09IG9wdGlvbnMuYWN0aW9uICYmIGluZm8uZm4gPT09IG9wdGlvbnMuanNjYWxsYmFjazsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBpbmZvLmFjdGlvbiA9PT0gb3B0aW9ucy5hY3Rpb247CiAgICB9Cn0KCnZhciBmbkNvbnRhaW5lciA9IFtdOwoKZnVuY3Rpb24gaGFzTm9SZWZlcmVuY2UoZm4pIHsKICByZXR1cm4gIWZuQ29udGFpbmVyLnNvbWUoZnVuY3Rpb24gKGl0ZW0pIHsKICAgIHJldHVybiBmbiA9PT0gaXRlbS5mbjsKICB9KTsKfQovKioKICogZXZlbnQub24vZXZlbnQub2ZmIGpzY2FsbGJhY2sg5Y+C5pWw5aSE55CGCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAqIEByZXR1cm5zIHtPYmplY3R9CiAqLwovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXN0YXRlbWVudHMKCgpmdW5jdGlvbiBldmVudFBhcmFtc0ZpbHRlcih0eXBlLCBvcHRpb25zKSB7CiAgaWYgKHR5cGUgPT09ICdldmVudC5vbicpIHsKICAgIHZhciBmbiA9IG9wdGlvbnMuanNjYWxsYmFjazsKCiAgICBpZiAodHlwZW9mIGZuID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gb3B0aW9uczsKICAgIH0KCiAgICB2YXIgZm5TdHJpbmc7CiAgICB2YXIgaXNVbmlxdWVFdmVudCA9IHRydWU7CiAgICB2YXIgaXNVbmlxdWVGdW5jdGlvbiA9IHRydWU7IC8vIOWFgeiuuOmHjeWkjeazqOWGjOOAgumBjeWOhuaJvuS4i+acieayoeacieS4gOagt+eahOOAggoKICAgIHZhciBldmVudEl0ZW07CiAgICB2YXIgbGVuID0gZm5Db250YWluZXIubGVuZ3RoOwoKICAgIHdoaWxlIChsZW4tLSkgewogICAgICBldmVudEl0ZW0gPSBmbkNvbnRhaW5lcltsZW5dOyAvLyDlrozlhajnm7jlkIzvvJrph43lpI3ms6jlhozvvIzml6DpnIAgcHVzaOOAggoKICAgICAgaWYgKGlzU2FtZUV2ZW50KGV2ZW50SXRlbSwgb3B0aW9ucykpIHsKICAgICAgICBmblN0cmluZyA9IGV2ZW50SXRlbS5mblN0cmluZzsKICAgICAgICBpc1VuaXF1ZUZ1bmN0aW9uID0gZmFsc2U7CiAgICAgICAgaXNVbmlxdWVFdmVudCA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgICB9IC8vIOacieWQjOagt+eahOWHveaVsO+8jOWImeS9v+eUqOWQjOWQjeeahAogICAgICBlbHNlIGlmIChldmVudEl0ZW0uZm4gPT09IG9wdGlvbnMuanNjYWxsYmFjaykgewogICAgICAgICAgZm5TdHJpbmcgPSBldmVudEl0ZW0uZm5TdHJpbmc7CiAgICAgICAgICBpc1VuaXF1ZUZ1bmN0aW9uID0gZmFsc2U7CiAgICAgICAgICBpc1VuaXF1ZUV2ZW50ID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoaXNVbmlxdWVGdW5jdGlvbikgewogICAgICBmblN0cmluZyA9IHdyYXBGdW5jdGlvbihvcHRpb25zLmpzY2FsbGJhY2spOwogICAgfQoKICAgIGlmIChpc1VuaXF1ZUV2ZW50KSB7CiAgICAgIGZuQ29udGFpbmVyLnB1c2goewogICAgICAgIHBhZ2U6IG9wdGlvbnMucGFnZSwKICAgICAgICBhY3Rpb246IG9wdGlvbnMuYWN0aW9uLAogICAgICAgIGZuOiBvcHRpb25zLmpzY2FsbGJhY2ssCiAgICAgICAgZm5TdHJpbmc6IGZuU3RyaW5nCiAgICAgIH0pOwogICAgfQoKICAgIHZhciByYXdBcmdzID0gewogICAgICBwYWdlOiBvcHRpb25zLnBhZ2UsCiAgICAgIGFjdGlvbjogb3B0aW9ucy5hY3Rpb24sCiAgICAgIGpzY2FsbGJhY2s6IGZuU3RyaW5nLAogICAgICBybm1zZzogb3B0aW9ucy5ybm1zZywKICAgICAgYWxsb3dEdXBsaWNhdGU6IG9wdGlvbnMuYWxsb3dEdXBsaWNhdGUKICAgIH07CiAgICBvcHRpb25zLnN1Y2Nlc3MgJiYgKHJhd0FyZ3Muc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2Vzcyk7CiAgICBvcHRpb25zLmZhaWwgJiYgKHJhd0FyZ3MuZmFpbCA9IG9wdGlvbnMuZmFpbCk7CiAgICByZXR1cm4gcmF3QXJnczsKICB9IGVsc2UgaWYgKHR5cGUgPT09ICdldmVudC5vZmYnKSB7CiAgICB2YXIgZm4kMSA9IG9wdGlvbnMuanNjYWxsYmFjazsKCiAgICBpZiAoIWZuJDEgfHwgdHlwZW9mIGZuJDEgPT09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiBvcHRpb25zOwogICAgfQoKICAgIHZhciBpc0V4aXN0ZW50RXZlbnQgPSBmYWxzZTsKICAgIHZhciBsZW4kMSA9IGZuQ29udGFpbmVyLmxlbmd0aDsKCiAgICB3aGlsZSAobGVuJDEtLSkgewogICAgICB2YXIgZXZlbnRJbmZvID0gZm5Db250YWluZXJbbGVuJDFdOwoKICAgICAgaWYgKGlzU2FtZUV2ZW50KGV2ZW50SW5mbywgb3B0aW9ucykpIHsKICAgICAgICBmbkNvbnRhaW5lci5zcGxpY2UobGVuJDEsIDEpOyAvLyDliKTmlq3kuIvmlbTkuKrmlbDnu4TvvIwg5aaC5p6c5rKh5pyJ5Yir55qE5Ye95pWw5byV55So77yM5bCx5LuOIOWFqOWxgOWvueixoSDkuIrnp7vpmaTor6UgZnVuY3Rpb24KCiAgICAgICAgaWYgKGhhc05vUmVmZXJlbmNlKGV2ZW50SW5mby5mbikpIHsKICAgICAgICAgIGRlbGV0ZSBnbG9iYWwkMVtldmVudEluZm8uZm5TdHJpbmddOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJhd0FyZ3MkMSA9IHsKICAgICAgICAgIHBhZ2U6IG9wdGlvbnMucGFnZSwKICAgICAgICAgIGFjdGlvbjogb3B0aW9ucy5hY3Rpb24sCiAgICAgICAgICBybm1zZzogb3B0aW9ucy5ybm1zZywKICAgICAgICAgIGpzY2FsbGJhY2s6IGV2ZW50SW5mby5mblN0cmluZwogICAgICAgIH07CiAgICAgICAgb3B0aW9ucy5zdWNjZXNzICYmIChyYXdBcmdzJDEuc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2Vzcyk7CiAgICAgICAgb3B0aW9ucy5mYWlsICYmIChyYXdBcmdzJDEuZmFpbCA9IG9wdGlvbnMuZmFpbCk7CiAgICAgICAgaXNFeGlzdGVudEV2ZW50ID0gdHJ1ZTsKICAgICAgICByZXR1cm4gcmF3QXJncyQxOwogICAgICB9CiAgICB9CgogICAgaWYgKCFpc0V4aXN0ZW50RXZlbnQpIHsKICAgICAgLy8gZml4bWUg5a+55LqO5LiN5ZyoIG9uIOeahOWIl+ihqOWGheeahOS6i+S7tu+8jOaLpuaIquS6hiBvZmYg77yM6K+l6YC76L6R6K6+6K6h5Y+v5LiO5Lia5Yqh5pa55ZWG5qa3CiAgICAgIGNvbnNvbGUuZXJyb3IoJ2Vycm9y77ya5bCd6K+V56e76Zmk5LiA5Liq5pyq6KKr5rOo5YaM55qE5LqL5Lu25Ye95pWwJyk7CiAgICAgIG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBvcHRpb25zLmZhaWwgJiYgb3B0aW9ucy5mYWlsKHsKICAgICAgICAgIHN0YXR1czogMSwKICAgICAgICAgIG1lc3NhZ2U6ICdyZW1vdmVzIGEgZnVuY3Rpb24gdGhhdCBoYXMgbm90IGJlIHJlZ2lzdGVyZWQnCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICBkZWxldGUgb3B0aW9ucy5qc2NhbGxiYWNrOwogICAgICByZXR1cm4gb3B0aW9uczsKICAgIH0KICB9CgogIHJldHVybiBvcHRpb25zOwp9Ci8qKgogKiBAZmlsZSAg5YWl5Y+C5aSE55CG6YC76L6RCiAqIEBhdXRob3IgemhvdWRhbjAzIHRpYW55dTA1CiAqIEBkYXRlIDIwMTkvNi8xMgogKiBAZGVzY3JpcHRpb24KICovCgoKdmFyIGlycmVndWxhclBhcmFtc0hhbmRsZXJzID0gewogICdzZWFyY2guc2V0UXVlcnknOiBmdW5jdGlvbiBzZWFyY2hTZXRRdWVyeShwYXJhbXMsIGRlc2NOYW1lKSB7CiAgICB2YXIgYXV0aG9yaXR5ID0gYXBpQ29udGFpbmVyLmFwaXNbYXBpQ29udGFpbmVyLmFwaUluZGV4W2Rlc2NOYW1lXV0uYXV0aG9yaXR5OyAvLyDlronljZPpq5jniYjmnKznlLFqc0ludGVyZmFjZeaWueazleS/ruato+S4unNlYXJjaGZyYW1l5pa55byP77yM5LiU6ZyA6KaBaGlzdG9yeeS4uuW4g+WwlOexu+WeiwoKICAgIGlmIChpc0FuZHJvaWQgJiYgYXV0aG9yaXR5ID09PSAnc2VhcmNoZnJhbWUnKSB7CiAgICAgIHBhcmFtcy5oaXN0b3J5ID0gQm9vbGVhbihwYXJhbXMuaGlzdG9yeSk7CiAgICAgIHBhcmFtcyA9IHsKICAgICAgICBzZWFyY2hUeXBlOiBKU09OLnN0cmluZ2lmeShwYXJhbXMpCiAgICAgIH07CiAgICB9IC8vIGlvc+imgeaxgmhpc3RvcnnkuLrmlbDlgLznsbvlnosKICAgIGVsc2UgaWYgKGlzSU9TKSB7CiAgICAgICAgcGFyYW1zLmhpc3RvcnkgPSBOdW1iZXIocGFyYW1zLmhpc3RvcnkpOwogICAgICB9CgogICAgcmV0dXJuIHBhcmFtczsKICB9LAogIC8vIOS9jueJiOacrOerr+iDveWKm++8jOacquWvueWkluaatOmcsu+8jOi9rOWMluaWsOeJiOerr+iDveWKm+eahOWPguaVsAogICdhY2NvdW50Lm9wZW5Mb2dpbkRpYWxvZyc6IGZ1bmN0aW9uIGFjY291bnRPcGVuTG9naW5EaWFsb2cocGFyYW1zKSB7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2FtZWxjYXNlCiAgICBwYXJhbXMudGhpcmRfbG9naW4gPSBwYXJhbXMuc2hvd1RoaXJkTG9naW47IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2UKCiAgICBwYXJhbXMubG9naW5fdHlwZSA9IHBhcmFtcy5sb2dpblR5cGU7CiAgICByZXR1cm4gcGFyYW1zOwogIH0sCiAgJ2FwcC5mZWVkYmFjayc6IGZ1bmN0aW9uIGFwcEZlZWRiYWNrKHBhcmFtcykgewogICAgLy8g5Zyo5a6J5Y2T56uv77yM6K+l56uv6IO95Yqb6buY6K6k5YC85Li6MgogICAgaWYgKGlzQW5kcm9pZCkgewogICAgICBwYXJhbXMudHlwZSA9IHBhcmFtcy50eXBlIHx8ICcyJzsKICAgIH0KCiAgICByZXR1cm4gcGFyYW1zOwogIH0sCiAgJ2Vhc3lCcm93c2VyLnJlcXVlc3QnOiBmdW5jdGlvbiBlYXN5QnJvd3NlclJlcXVlc3QocGFyYW1zKSB7CiAgICBwYXJhbXMuaGVhZGVyID0gcGFyYW1zLmhlYWRlciB8fCB7fTsKICAgIHBhcmFtcy5kYXRhID0gcGFyYW1zLmRhdGEgfHwge307CgogICAgaWYgKGlzQW5kcm9pZCkgewogICAgICBwYXJhbXMuaGVhZGVyID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zLmhlYWRlcik7CiAgICAgIHBhcmFtcy5kYXRhID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zLmRhdGEpOwogICAgICByZXR1cm4gcGFyYW1zOwogICAgfQoKICAgIHJldHVybiBwYXJhbXM7CiAgfSwKICAnY29tbW9uVUkuc2hvd1RvYXN0T2xkJzogZnVuY3Rpb24gY29tbW9uVUlTaG93VG9hc3RPbGQocGFyYW1zKSB7CiAgICBwYXJhbXMgPSBwYXJhbXMgfHwge307CiAgICBwYXJhbXMuc3RyaW5nID0gcGFyYW1zLm1lc3NhZ2U7CiAgICByZXR1cm4gcGFyYW1zOwogIH0sCiAgLy8gdG9kbyDnoa7orqTov5nkuKrpgLvovpHlrZjlnKjnmoTlv4XopoHmgKfjgILml6fniYjmnKwgIG9uUGVyZm9ybWFuY2VGbG93RXZlbnQg56uv6IO95Yqb5Zyo5a6J5Y2T5b+F6aG75Lyg5Y+CIG1pbl92CiAgJ2Vhc3lCcm93c2VyLm9uUGVyZm9ybWFuY2VGbG93RXZlbnQnOiBmdW5jdGlvbiBlYXN5QnJvd3Nlck9uUGVyZm9ybWFuY2VGbG93RXZlbnQocGFyYW1zKSB7CiAgICBpZiAoaXNBbmRyb2lkKSB7CiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2UKICAgICAgcGFyYW1zLm1pbl92ID0gJzE2Nzg5NTA0JzsKICAgIH0KCiAgICByZXR1cm4gcGFyYW1zOwogIH0sCiAgJ2Vhc3lCcm93c2VyLm9wZW5IeWJyaWQnOiBmdW5jdGlvbiBlYXN5QnJvd3Nlck9wZW5IeWJyaWQocGFyYW1zKSB7CiAgICBwYXJhbXMgPSBwYXJhbXMgfHwge307CiAgICBwYXJhbXMudHlwZSA9ICdIeWJyaWQnOwogICAgcGFyYW1zLmJhY2t1cCAmJiBwYXJhbXMuYmFja3VwLnVybCAmJiAocGFyYW1zLmJhY2t1cC51cmwgPSBlbmNvZGVVUklDb21wb25lbnQocGFyYW1zLmJhY2t1cC51cmwpKTsKICAgIHJldHVybiBwYXJhbXM7CiAgfSwKICAvLyB0b2RvIOS9v+eUqOS9jueJiOacrOaJi+eZviDmoKHpqowg5L2O54mI5pys55qE5omT5byAIGh5YnJpZCDnmoTljoblj7LpgLvovpHjgIIKICAnZWFzeUJyb3dzZXIub3Blbkh5YnJpZE9sZCc6IGZ1bmN0aW9uIGVhc3lCcm93c2VyT3Blbkh5YnJpZE9sZChwYXJhbXMpIHsKICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7fTsKCiAgICBpZiAoaXNBbmRyb2lkKSB7CiAgICAgIHZhciBiYWNrdXBVUkwgPSBwYXJhbXMuYmFja3VwICYmIHBhcmFtcy5iYWNrdXAudXJsIHx8ICcnOwogICAgICB2YXIgdG9vbFRJRHMgPSBwYXJhbXMuc3R5bGUgJiYgcGFyYW1zLnN0eWxlLnRvb2xiYXJpY29ucyAmJiBwYXJhbXMuc3R5bGUudG9vbGJhcmljb25zLnRpZHMgfHwgJyc7CiAgICAgIHZhciBpbnRlbnQgPSBbJ1MuYmFja3VwPScgKyBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgdXJsOiBlbmNvZGVVUklDb21wb25lbnQoYmFja3VwVVJMKQogICAgICB9KSwgJ2NvbXBvbmVudD1jb20uYmFpZHUuc2VhcmNoYm94Ly5ob21lLmZlZWQuRmVlZERldGFpbEFjdGl2aXR5JywgJ1MudG9vbGJhcmljb25zPScgKyBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgIHRvb2xpZHM6IHRvb2xUSURzCiAgICAgIH0pKSwgJ1MubWVudW1vZGU9JyArIChwYXJhbXMubWVudW1vZGUgfHwgJycpXS5qb2luKCc7Jyk7CiAgICAgIHJldHVybiB7CiAgICAgICAgaW50ZW50OiAnaW50ZW50OiNJbnRlbnQ7JyArIGludGVudCArICc7ZW5kJywKICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2FtZWxjYXNlCiAgICAgICAgbWluX3Y6IHBhcmFtcy5taW5fdiB8fCAnMTY3ODM2MjknLAogICAgICAgIG1vZGU6ICcwJwogICAgICB9OwogICAgfSAvLyDljoblj7LpgLvovpEKICAgIC8vIDEuIOWSjCB1cmwg5a2X5q6144CC77yI5LiN5Yig5pyJ5b2x5ZON5ZCX77yf77yJCiAgICAvLyAyLiB0aWRzIOimgeaYr+ayoeWAvO+8jOWwseS4jeS8oCB0b29sYmFyICDvvIjkvKDkuobmnInlvbHlk43lkJfvvJ/vvIkKICAgIC8vIDMuIOWmguaenOS8oOS6hui9u+W6lOeUqGFwcGlk77yM6YKj6buY6K6k572uIGlzbGEg5Li6MSDvvIjorqnnlKjmiLfkvKDlsLHlpb3kuobvvIkKICAgIGVsc2UgaWYgKGlzSU9TKSB7CiAgICAgICAgdmFyIHRvb2xUSURzJDEgPSBwYXJhbXMuc3R5bGUgJiYgcGFyYW1zLnN0eWxlLnRvb2xiYXJpY29ucyAmJiBwYXJhbXMuc3R5bGUudG9vbGJhcmljb25zLnRpZHMgfHwgJyc7CiAgICAgICAgcGFyYW1zLnRvb2xiYXIgPSBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICB0b29saWRzOiB0b29sVElEcyQxCiAgICAgICAgfSk7CiAgICAgICAgcGFyYW1zLnR5cGUgPSAnSHlicmlkJzsKICAgICAgICBwYXJhbXMub3BlbnVybCA9IGVuY29kZVVSSUNvbXBvbmVudChwYXJhbXMudXJsKTsKICAgICAgICBwYXJhbXMuaXNsYSA9IHBhcmFtcy5pc2xhOwogICAgICAgIHBhcmFtcy5taW52ZXIgPSAnNS4zLjAuMCc7CiAgICAgICAgcGFyYW1zLm9wZW50eXBlID0gMTsKICAgICAgICBwYXJhbXMuYXBwZW5kID0gMDsKICAgICAgICBwYXJhbXMucmJ0bnN0eWxlID0gMjsgLy8g5Y6G5Y+y6YC76L6ROiAgc3R5bGUg5a2X5q615omA5pyJ5YWD57Sg6YO96ZyA6KaB5pWj5Zyo5aSW6Z2iOyDliKDpmaTmjokgc3R5bGUg5a2X5q6144CC77yI5pWj5Zyo5aSW6Z2i77yM5LiN5Lya6KaG55uW5o6J5aSW5bGC55qE5YC85ZCX77yfdG9kbyDnoa7orqTmraTkuL7mhI/kuYnvvIkKCiAgICAgICAgaWYgKHBhcmFtcy5zdHlsZSAmJiAoMCwgX3R5cGVvZjIuZGVmYXVsdCkocGFyYW1zLnN0eWxlKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIHZhciBzdHlsZSA9IHBhcmFtcy5zdHlsZTsKCiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gc3R5bGUpIHsKICAgICAgICAgICAgaWYgKHN0eWxlLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICBwYXJhbXNba2V5XSA9IHN0eWxlW2tleV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBkZWxldGUgcGFyYW1zLnN0eWxlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHBhcmFtczsKICAgICAgfQoKICAgIHJldHVybiBwYXJhbXM7CiAgfSwKICAvLyDmraTnq6/og73lipvkvJrnlKjkuo4gZ2V0TmV0d29ya1R5cGUgQVBJIOeahOS9jueJiOacrOaUr+aMgQogICdkZXZpY2UuZ2V0RGV2aWNlSW5mbyc6IGZ1bmN0aW9uIGRldmljZUdldERldmljZUluZm8ocGFyYW1zKSB7CiAgICBwYXJhbXMua2V5cyA9IHBhcmFtcy5rZXlzIHx8IFsnbmV0SW5mbycsICdzY3JlZW5JbmZvJ107CiAgICByZXR1cm4gcGFyYW1zOwogIH0sCiAgJ2V2ZW50Lm9uJzogZnVuY3Rpb24gZXZlbnRPbihwYXJhbXMpIHsKICAgIHBhcmFtcyA9IGV2ZW50UGFyYW1zRmlsdGVyKCdldmVudC5vbicsIHBhcmFtcyk7CgogICAgaWYgKHBhcmFtcy5hY3Rpb24gPT09ICdnbG9iYWxTZXR0aW5nQ2hhbmdlJykgewogICAgICAvLyDliKTmlq3mnInml6BfQm94X+Wvueixoe+8jOayoeacieWImeazqOWFpei/m+WOuwoKICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZXJzY29yZS1kYW5nbGUgKi8KCiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgIGlmICghd2luZG93Ll9Cb3hfKSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICB3aW5kb3cuX0JveF8gPSB7fTsKICAgICAgfQogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKCiAgICAgIGlmICghd2luZG93Ll9Cb3hfLmV2ZW50KSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICB3aW5kb3cuX0JveF8uZXZlbnQgPSB7fTsKICAgICAgfQogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKCiAgICAgIGlmICghd2luZG93Ll9Cb3hfLmV2ZW50LmJyb2FkY2FzdCkgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgd2luZG93Ll9Cb3hfLmV2ZW50LmJyb2FkY2FzdCA9IGJyb2FkY2FzdDsKICAgICAgfQogICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXVuZGVyc2NvcmUtZGFuZ2xlICovCgoKICAgICAgd2luZG93Ll9Cb3hfLmV2ZW50LmJyb2FkY2FzdC5vbihwYXJhbXMuYWN0aW9uLCBwYXJhbXMuanNjYWxsYmFjayA/IHdpbmRvd1twYXJhbXMuanNjYWxsYmFja10gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgLyogZW1wdHkgKi8KICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIHBhcmFtczsKICB9LAogICdldmVudC5vZmYnOiBmdW5jdGlvbiBldmVudE9mZihwYXJhbXMpIHsKICAgIGlmIChwYXJhbXMuYWN0aW9uID09PSAnZ2xvYmFsU2V0dGluZ0NoYW5nZScgJiYgd2luZG93Ll9Cb3hfKSB7CiAgICAgIGRlbGV0ZSB3aW5kb3cuX0JveF87CiAgICB9CgogICAgcGFyYW1zID0gZXZlbnRQYXJhbXNGaWx0ZXIoJ2V2ZW50Lm9mZicsIHBhcmFtcyk7CiAgICByZXR1cm4gcGFyYW1zOwogIH0KfTsKLyoqCiAqIOagvOW8j+WMluWkhOeQhiBwYXJhbXPnlKjkuo7lhbzlrrnkuI3lkIzml7bmnJ/nmoTljY/orq7kuYvpl7Tlk43lupTkv6Hmga/nmoTmoLzlvI/lrZjlnKjnmoTlt67lvILjgIIKICoKICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyDlhaXlj4Lkv6Hmga8KICogQHBhcmFtIHtzdHJpbmd9IGhhbmRsZXIg5ZON5bqU5L+h5oGv55qE5aSE55CG5qCH6K+G77yI5L2/55So55qE5pivIGRlc2NOYW1lIOagh+ivhu+8iQogKiBAcmV0dXJuIHtPYmplY3R9IOWkhOeQhuWQjueahOWPguaVsAogKi8KCmZ1bmN0aW9uIG5vcm1hbGl6ZVBhcmFtcyhwYXJhbXMsIGhhbmRsZXIpIHsKICBpZiAoT2JqZWN0LmtleXMoaXJyZWd1bGFyUGFyYW1zSGFuZGxlcnMpLmluZGV4T2YoaGFuZGxlcikgPiAtMSkgewogICAgcmV0dXJuIGlycmVndWxhclBhcmFtc0hhbmRsZXJzW2hhbmRsZXJdKHBhcmFtcywgaGFuZGxlcik7CiAgfQoKICByZXR1cm4gcGFyYW1zOwp9Ci8qKgogKiBAZmlsZSDliJ3lp4vljJbmjILovb3miYDmnIkgQVBJCiAqIEBhdXRob3IgemhvdWRhbjAzCiAqIEBkYXRlIDIwMTkvNi8xCiAqLwoKLyoqCiAqIOS7jueUqOaIt+WPguaVsOS4re+8jOiOt+WPliDnlKjkuo7kvKDpgJLnu5kganNOYXRpdmUg55qE77yM5LiOIGFyZ3Mg6aG65bqP5LiA5LiA5a+55bqU55qE5Y+C5pWw5YC855qE5pWw57uEIO+8iGpzTmF0aXZl5o6l5Y+X55qE5piv5pWw57uE44CC77yJCiAqIHsKICogICAgIGtleTE6IHZhbHVlMSwKICogICAgIGtleTI6IHZhbHVlMiwKICogICAgIHN1Y2Nlc3MoKXt9LAogKiAgICAgZmFpbCgpe30KICogfQogKgogKiA9PiAgW3ZhbHVlMSwgdmFsdWUyLCBzdWNjZXNzLCBmYWlsXQogKiA9PiAgW3VuZGVmaW5lZCwgdmFsdWUyLCB1bmRlZmluZWRdCiAqIGZpeG1lLCDnlKjmiLflj4LmlbDmsqHmnInnmoQg5L2G5o+P6L+w6KGo55qE5pe25YCZICDkv53or4HmlbDnu4Tplb/luqbkuIDoh7TmgKcgLiDogIzkuI3lupTor6Xov5Tlm57nqbrmlbDnu4QKICoKICogQHBhcmFtIHtPYmplY3R9IHVzZXJBcmdzIOeUqOaIt+WPguaVsOWvueixoQogKiBAcGFyYW0ge0FycmF5fSBkZXNjQXJncyDmj4/ov7DooajkuK3opoHmsYLnmoTlj4LmlbDmlbDnu4QKICogQHJldHVybiB7QXJyYXl9IOeUqOaIt+WPguaVsOWAvOaVsOe7hAogKi8KCgpmdW5jdGlvbiBnZXRQYXJhbXNBcnJheSh1c2VyQXJncywgZGVzY0FyZ3MpIHsKICB2YXIgcGFyYW1zID0gW107IC8vIGZpeG1lIHN1Y2Nlc3Mg5ZKMIGZhaWwg5L2c5Li6IGFyZ3Mg5Lyg5YWl44CC6IO95ZCm5pyJ57uf5LiA55qE5L+u5q2j5o+P6L+w6KGo55qE5Zyw5pa5CgogIHZhciByZXF1aXJlQXJncyA9IGRlc2NBcmdzLmNvbmNhdChbewogICAgbmFtZTogJ3N1Y2Nlc3MnLAogICAgdmFsdWU6ICdmdW5jdGlvbj0nCiAgfSwgewogICAgbmFtZTogJ2ZhaWwnLAogICAgdmFsdWU6ICdmdW5jdGlvbj0nCiAgfV0pOwoKICBpZiAodXNlckFyZ3MgJiYgcmVxdWlyZUFyZ3MubGVuZ3RoID4gMCkgewogICAgcGFyYW1zID0gcmVxdWlyZUFyZ3MubWFwKGZ1bmN0aW9uIChhcmcpIHsKICAgICAgcmV0dXJuIHVzZXJBcmdzW2FyZy5uYW1lXTsKICAgIH0pOwogIH0KCiAgcmV0dXJuIHBhcmFtczsKfQovKioKICog6LCD6LW35a+55bqU56uv6IO95YqbCiAqLwoKCmZ1bmN0aW9uIGdldEludm9rZXIoYXBpQ29udGFpbmVyLCBkZXNjTmFtZSwgdXNlckFyZ3MsIGRlc2NBcmdzLCBldmVudCwgbmVlZFRocm93RXJyb3IpIHsKICAvLyDlhoXpg6jmnInmiqXplJnnm7TmjqXpgI/kvKDnu5nlpJbpg6jvvIwg5L2/5b6X5Lia5Yqh5Y+v5Lul5ou/5Yiw6ZSZ6K+v5L+h5oGvCiAgLy8g6L+Z5Liq5Li76KaB6ZKI5a+56Z2eIHRocm93IOeahOmUmeivr+a2iOaBr++8jCDlkIzml7bkvJrooaXlhYXlr7nlupTnmoQgYXBpIOWPiiBzdGFjayDkv6Hmga8KICBmdW5jdGlvbiBpbm5lckVycm9ySGFuZGxlKGV2ZW50TmFtZSwgZXJyb3IpIHsKICAgIGVycm9yLmFwaSA9IGRlc2NOYW1lOwogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KCiAgICBpZiAoIWVycm9yLnN0YWNrKSB7CiAgICAgIHZhciB0bXBFcnJvciA9IG5ldyBFcnJvcihlcnJvci5tZXNzYWdlCiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgIHx8ICdbSW52b2tlIEVycm9yXScpOwogICAgICBlcnJvci5zdGFjayA9IHRtcEVycm9yLnN0YWNrOwogICAgfQoKICAgIGFkZEVudkluZm8oZXJyb3IpOyAvLyDmn5Dkupvkuovku7bpnIDopoHlu7bov5/op6blj5EKCiAgICBpZiAoZXJyb3IubmVlZERlbGF5RW1pdCkgewogICAgICBlcnJvci5kZWxheUVtaXRDYWxsYmFjayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBkZWxldGUgZXJyb3IubmVlZERlbGF5RW1pdDsKICAgICAgICBkZWxldGUgZXJyb3IuZGVsYXlFbWl0Q2FsbGJhY2s7CiAgICAgICAgZXZlbnQuZW1pdChldmVudE5hbWUsIGVycm9yKTsKICAgICAgfTsKCiAgICAgIHJldHVybjsKICAgIH0KCiAgICBldmVudC5lbWl0KGV2ZW50TmFtZSwgZXJyb3IpOwogIH0KCiAgdHJ5IHsKICAgIC8vIOaKm+WHuuiwg+eUqOS6i+S7tu+8jOe7n+iuoeiwg+eUqOmHjwogICAgZXZlbnQuZW1pdCgnaW52b2tlOnN0YXJ0JywgYWRkRW52SW5mbyh7CiAgICAgIGFwaTogZGVzY05hbWUsCiAgICAgIGFyZ3M6IHVzZXJBcmdzCiAgICB9KSk7IC8vIOWkhOeQhuWPjOerr+WFpeWPguaciWRpZmbmg4XlhrUKCiAgICB2YXIgbm9ybWFsaXplZFVzZXJBcmdzID0gbm9ybWFsaXplUGFyYW1zKHVzZXJBcmdzLCBkZXNjTmFtZSk7CiAgICB2YXIgcGFyYW1zID0gZ2V0UGFyYW1zQXJyYXkobm9ybWFsaXplZFVzZXJBcmdzLCBkZXNjQXJncyk7CiAgICBpbm5lckV2ZW50Lm9uKCdlcnJvcjoqJywgaW5uZXJFcnJvckhhbmRsZSk7CiAgICBhcGlDb250YWluZXIuaW52b2tlKGRlc2NOYW1lLCBwYXJhbXMpOwogICAgaW5uZXJFdmVudC5vZmYoJ2Vycm9yOionLCBpbm5lckVycm9ySGFuZGxlKTsKICB9IGNhdGNoIChlcnJvcikgewogICAgaW5uZXJFdmVudC5vZmYoJ2Vycm9yOionLCBpbm5lckVycm9ySGFuZGxlKTsKICAgIHZhciBuZXdFcnJvciA9IGVycm9yOwogICAgdmFyIGV2ZW50TmFtZSA9ICd1bmtub3duJzsKICAgIHZhciBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlIHx8ICcnOwoKICAgIGlmICgvXlxbLis/IEFyZ3VtZW50IEVycm9yXF0vLnRlc3QoZXJyb3JNZXNzYWdlKSkgewogICAgICBldmVudE5hbWUgPSAnYXJnLWludmFsaWQnOwogICAgICB2YXIgYXJnTmFtZSA9IGVycm9yTWVzc2FnZS5zcGxpdCgnXScpWzFdLnNwbGl0KCcgJylbMF07CiAgICAgIG5ld0Vycm9yID0gewogICAgICAgIG5hbWU6ICdBcmdJbnZhbGlkRXJyb3InLAogICAgICAgIG1lc3NhZ2U6IGVycm9yTWVzc2FnZSwKICAgICAgICBzdGFjazogZXJyb3Iuc3RhY2ssCiAgICAgICAgYXJnOiBhcmdOYW1lCiAgICAgIH07CiAgICB9IC8vIG5ld0Vycm9yIOaYryBudW1iZXIgc3RyaW5nIOetieWfuuacrOexu+Wei+aXtu+8jCDmt7vliqDlrZfmrrXkvJrmiqXplJkKCgogICAgdHJ5IHsKICAgICAgbmV3RXJyb3IuYXBpID0gZGVzY05hbWU7CiAgICB9IGNhdGNoIChlcnIpIHsvLyBlbXB0eQogICAgfQoKICAgIGFkZEVudkluZm8obmV3RXJyb3IpOwogICAgZXZlbnQuZW1pdCgiZXJyb3I6IiArIGV2ZW50TmFtZSwgbmV3RXJyb3IpOwoKICAgIGlmIChuZWVkVGhyb3dFcnJvcikgewogICAgICB0aHJvdyBlcnJvcjsKICAgIH0KICB9Cn0KLyoqCiAqIOiOt+WPliBhcGkg5a+55bqU55qE5aSE55CG5Ye95pWwCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBhcGlDb250YWluZXIganNOYXRpdmXlrrnlmagKICogQHBhcmFtIHtPYmplY3R9IGRlc2Mg5o+P6L+w6KGoCiAqIEByZXR1cm4ge0Z1bmN0aW9ufSDlvIDlj5HogIXosIPnlKgg5LiA5Liq5YW35L2T55qEIEFQSSDnmoTlpITnkIblh73mlbDjgIIKICogICAgICAgICBGdW5jdGlvbi5wYXJhbXMge09iamVjdH0gdXNlckFyZ3MgIOivpeWHveaVsOaOpeWPl+eahOWPguaVsCB1c2VyQXJncyDkuLrnlKjmiLflj4LmlbAKICovCgoKdmFyIGdlbmVyYXRlQ2FsbEFwaSA9IGZ1bmN0aW9uIGdlbmVyYXRlQ2FsbEFwaShhcGlDb250YWluZXIsIGV2ZW50KSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChkZXNjTmFtZSwgdXNlckFyZ3MpIHsKICAgIGRlYnVnKCfmkJzntKLnpoHmraLkvb/nlKggY2FsbCDmlrnms5XosIPnlKjnq6/og73lipvvvIzor7flhYjliKTmlq1jYW5JdXNl5LmL5ZCO5L2/55So6K+t5LmJ5YyWIGFwaSDosIPnlKgnKTsKICAgIHZhciBpbmRleCA9IGFwaUNvbnRhaW5lci5hcGlJbmRleFtkZXNjTmFtZV07CgogICAgaWYgKGluZGV4ID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFyIG1lc3NhZ2UgPSAn5pqC5LiN5pSv5oyBIEFQSTogWycgKyBkZXNjTmFtZSArICddJzsKICAgICAgdmFyIGVycm9yID0gbmV3IEVycm9yKG1lc3NhZ2UpOyAvLyDnlKjmiLfosIPnlKjkuYvliY3mnKrliKTmlq1jYW5JVXNl77yM5YiZ5oqb5Ye65byC5bi4CgogICAgICBldmVudC5lbWl0KCdlcnJvcjphcGktbWlzc2VkJywgYWRkRW52SW5mbyh7CiAgICAgICAgbmFtZTogJ0FQSU1pc3NlZEVycm9yJywKICAgICAgICBhcGk6IGRlc2NOYW1lLAogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrCiAgICAgIH0pKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBkZXNjID0gYXBpQ29udGFpbmVyLmFwaXNbaW5kZXhdOwogICAgZ2V0SW52b2tlcihhcGlDb250YWluZXIsIGRlc2NOYW1lLCB1c2VyQXJncywgZGVzYy5hcmdzLCBldmVudCwgZmFsc2UpOwogIH07Cn07IC8vIOagueaNruaPj+i/sOihqOWQjeensO+8jOeUn+aIkOS4jeWQjOeahOmAmuS/oemAu+i+kSAoICJhLmIuYyIgPT4gYm94eC5hLmIuYykKCgp2YXIgZ2V0U2luZ2xlSW52b2tlciA9IGZ1bmN0aW9uIGdldFNpbmdsZUludm9rZXIoYXBpQ29udGFpbmVyLCBkZXNjLCBldmVudCkgewogIHJldHVybiBmdW5jdGlvbiAodXNlckFyZ3MpIHsKICAgIGdldEludm9rZXIoYXBpQ29udGFpbmVyLCBkZXNjLm5hbWUsIHVzZXJBcmdzLCBkZXNjLmFyZ3MsIGV2ZW50LCB0cnVlKTsKICB9Owp9OwovKioKICog5qC55o2u5o+P6L+w6KGo5ZCN56ew77yM55Sf5oiQ5LiN5ZCM55qE6YCa5L+h6YC76L6RICggImEuYi5jIiA9PiBib3h4LmEuYi5jKQogKgogKiBAcGFyYW0ge09iamVjdH0gYm94eCBBUEnlrrnlmagKICogQHBhcmFtIHtPYmplY3R9IGFwaUNvbnRhaW5lciBqc05hdGl2ZeWuueWZqAogKiBAcGFyYW0ge3N0cmluZ30gYXBpTmFtZSBhcGnlkI3np7AKICogQHBhcmFtIHtzdHJpbmd9IGRlc2Mg5o+P6L+w6KGoCiAqLwoKCmZ1bmN0aW9uIGdlbmVyYXRlU2luZ2xlQVBJKGJveHgsIGFwaUNvbnRhaW5lciwgYXBpTmFtZSwgZGVzYywgZXZlbnQpIHsKICBpZiAoYXBpTmFtZS5pbmRleE9mKCcuJykgPiAwKSB7CiAgICB2YXIgYXBpTmFtZVNlZ21lbnRzID0gYXBpTmFtZS5zcGxpdCgnLicpOwogICAgdmFyIG1ldGhvZE93bmVyID0gYm94eDsKICAgIHZhciBpID0gMDsKICAgIHZhciBsZW4gPSBhcGlOYW1lU2VnbWVudHMubGVuZ3RoIC0gMTsKCiAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIHZhciBzZWdtZW50ID0gYXBpTmFtZVNlZ21lbnRzW2ldOwogICAgICBtZXRob2RPd25lcltzZWdtZW50XSA9IG1ldGhvZE93bmVyW3NlZ21lbnRdIHx8IHt9OwogICAgICBtZXRob2RPd25lciA9IG1ldGhvZE93bmVyW3NlZ21lbnRdOwogICAgfQoKICAgIG1ldGhvZE93bmVyW2FwaU5hbWVTZWdtZW50c1tpXV0gPSBnZXRTaW5nbGVJbnZva2VyKGFwaUNvbnRhaW5lciwgZGVzYywgZXZlbnQpOwogIH0gZWxzZSB7CiAgICBib3h4W2FwaU5hbWVdID0gZ2V0U2luZ2xlSW52b2tlcihhcGlDb250YWluZXIsIGRlc2MsIGV2ZW50KTsKICB9Cn0KLyoqCiAqIOWIneWni+WMluavj+S4querr+iDveWKmyBBUEkKICovCgoKdmFyIGluaXRBUElzID0gZnVuY3Rpb24gaW5pdEFQSXMoYm94eCwgYXBpQ29udGFpbmVyLCBldmVudCkgewogIHZhciBhcGlzID0gYXBpQ29udGFpbmVyLmFwaXM7IC8vIOeUn+aIkOaPj+i/sOihqOWvueW6lOeahCBhcGkKCiAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFwaXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgIHZhciBkZXNjID0gYXBpc1tpXTsKICAgIHZhciBhcGlOYW1lID0gZGVzYy5uYW1lOwoKICAgIGlmIChhcGlOYW1lICYmIGRlc2MuaW52b2tlKSB7CiAgICAgIGdlbmVyYXRlU2luZ2xlQVBJKGJveHgsIGFwaUNvbnRhaW5lciwgZGVzYy5uYW1lLCBkZXNjLCBldmVudCk7CiAgICB9CiAgfQp9OwovKioKICogQGZpbGUgIOeUn+aIkCBjYW5JVXNlIEFQSQogKiBAYXV0aG9yIHpob3VkYW4wMwogKiBAZGF0ZSAyMDE5LzgvOQogKi8KCgpmdW5jdGlvbiBnZW5lcmF0ZUNhbklVc2UoYXBpQ29udGFpbmVyKSB7CiAgLyoqCiAgICogY2FuSVVzZSDlh73mlbDvvIznlKjkuo7liKTmlq0gQVBJIOaYr+WQpuWtmOWcqO+8jOWFgeiuuOS4pOenjeWGmeazle+8mmJveHguY2FuSVVzZSgnQUJUZXN0LmdldFNpZExpc3QnKSDmiJYgYm94eC5jYW5JVXNlKCdib3h4LkFCVGVzdC5nZXRTaWRMaXN0JykKICAgKgogICAqIEBwYXJhbSB7c3RyaW5nfSBhcGlOYW1lICBhcGnlkI3np7DlrZfnrKbkuLIKICAgKiBAcGFyYW0ge2Jvb2xlYW59IGFwaVN3aXRjaCAgYXBp5byA5YWz77yM5aaC5bCP56iL5bqP6ZmN57qn5byA5YWzCiAgICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZSDku6PooajlrZjlnKjvvIxmYWxzZSDkuI3ku6PooajkuI3lrZjlnKgKICAgKi8KICByZXR1cm4gZnVuY3Rpb24gY2FuSVVzZShhcGlOYW1lLCBhcGlTd2l0Y2gpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyICYmICFhcGlTd2l0Y2gpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJldHVybiBhcGlDb250YWluZXIuYXBpSW5kZXhbYXBpTmFtZV0gPiAtMTsKICB9Owp9Ci8qKgogKiBAZmlsZSDph43lrprlkJEgQVBJIOS7peWcqOS9jueJiOacrOaJi+eZvuS4iiDmmKDlsIQgQVBJIOWIsOS9jueJiOacrOerr+iDveWKmyDvvIwg5ZCM5pe25Yig6Zmk5L2O54mI5pys55qE5pq06ZyyCiAqIEBhdXRob3IgemhvdWRhbjAzCiAqIEBkYXRlIDIwMTkvOC85CiAqLwovLyBrZXkg5Li65a+55aSW6L6T5Ye655qEIEFQSSDlkI3np7DvvIzlkIzml7bkuZ/mmK/pq5jniYjmnKzlrZjlnKjnmoTnq6/og73lipvnmoQgbmFtZQovLyB2YWx1ZSDkuLrlhbfmnInlkIzmoLflip/og73nmoTkvY7niYjmnKznq6/og73lipvvvIzku4Xlr7nlhoXkvZzkuLrkvY7niYjmnKzlhbzlrrnmiYvmrrXvvIzkuI3lr7nlpJbmmrTpnLIKCgp2YXIgY29tcGF0aWJsZU1hcCA9IHsKICAnYWNjb3VudC5sb2dpbic6ICdhY2NvdW50Lm9wZW5Mb2dpbkRpYWxvZycsCiAgJ2FsYnVtLmltYWdlLm9wZW4nOiAnYWxidW0uaW1hZ2Uub3Blbk9sZCcsCiAgJ2NvbW1vblVJLmNsb3NlTG9hZGluZyc6ICdjb21tb25VSS5jbG9zZUxvYWRpbmdPbGQnLAogICdjb21tb25VSS5zaG93VG9hc3QnOiAnY29tbW9uVUkuc2hvd1RvYXN0T2xkJywKICAnZWFzeUJyb3dzZXIub3Blbkh5YnJpZCc6ICdlYXN5QnJvd3Nlci5vcGVuSHlicmlkT2xkJywKICAnZWFzeUJyb3dzZXIucGVyZm9ybWFuY2VGbG93TG9nJzogJ2Vhc3lCcm93c2VyLm9uUGVyZm9ybWFuY2VGbG93RXZlbnQnLAogICdkZXZpY2UuZ2V0TmV0d29ya1R5cGUnOiAnZGV2aWNlLmdldERldmljZUluZm8nCn07Ci8qKgogKiDojrflj5blh73mlbDlkI3np7AKICogQHBhcmFtIHtPYmplY3R9IGJveHggQVBJ5a655ZmoCiAqIEBwYXJhbSB7c3RyaW5nfSBhcGlOYW1lIOavlOWmgiBhbGJ1bS5pbWFnZS5vcGVuCiAqIEByZXR1cm4ge09iamVjdH0g6L+U5Zue5a+56LGh55qE5Y6f5Zug5piv6YG/5YWNIOWmgiBhbGJ1bS5pbWFnZS5vcGVuIOWcqGpz5omn6KGM6L+H56iL5Lit77yM5Lya6KKr5om+5byV55So5YWz57O777yM5om+5LiN5Yiw5Lya5oql6ZSZ44CCCiAqIOWboOatpOS8oOmAkiBhbGJ1bS5pbWFnZSDlkowgb3BlbiDnlKjkuo7miafooYzml7blho3lr7kgb3BlbiDotYvlgLwKICovCgpmdW5jdGlvbiBnZXRGdW5jdGlvbk5hbWUoYm94eCwgYXBpTmFtZSkgewogIGlmIChhcGlOYW1lLmluZGV4T2YoJy4nKSA+IDApIHsKICAgIHZhciBhcGlOYW1lU2VnbWVudHMgPSBhcGlOYW1lLnNwbGl0KCcuJyk7CiAgICB2YXIgbWV0aG9kT3duZXIgPSBib3h4OwogICAgdmFyIGkgPSAwOwogICAgdmFyIGxlbiA9IGFwaU5hbWVTZWdtZW50cy5sZW5ndGggLSAxOwoKICAgIGZvciAoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgdmFyIHNlZ21lbnQgPSBhcGlOYW1lU2VnbWVudHNbaV07CiAgICAgIG1ldGhvZE93bmVyW3NlZ21lbnRdID0gbWV0aG9kT3duZXJbc2VnbWVudF0gfHwge307CiAgICAgIG1ldGhvZE93bmVyID0gbWV0aG9kT3duZXJbc2VnbWVudF07CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgbWV0aG9kT3duZXI6IG1ldGhvZE93bmVyLAogICAgICBtZXRob2ROYW1lOiBhcGlOYW1lU2VnbWVudHNbaV0KICAgIH07CiAgfSBlbHNlIHsKICAgIHJldHVybiB7CiAgICAgIG1ldGhvZE93bmVyOiBib3h4LAogICAgICBtZXRob2ROYW1lOiBhcGlOYW1lCiAgICB9OwogIH0KfQovKioKICog5bCG5L2O54mI5pysIEFQSSDlh73mlbDlvJXnlKjmjILovb3liLDpq5jniYjmnKznmoQgQVBJIOWQjeensOS4iu+8jOS7peWcqOS9jueJiOacrOS4iuiDveS9v+eUqOaXp+err+iDveWKm+i+vuWIsOWQjOagt+eahOWKn+iDveaUr+aMgeOAggogKiDlkIzml7bliKDpmaTkvY7niYjmnKwgQVBJIOeahOW8leeUqO+8jOS4jeWvueWkluaatOmcsgogKiBAcGFyYW0ge09iamVjdH0gYm94eCBBUEnlrrnlmagKICovCgoKZnVuY3Rpb24gYmVDb21wYXRpYmxlV2l0aExvd1ZlcnNpb24oYm94eCkgewogIGZvciAodmFyIGtleSBpbiBjb21wYXRpYmxlTWFwKSB7CiAgICBpZiAoY29tcGF0aWJsZU1hcC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgIC8vIOWmguaenOS4jeaUr+aMgemrmOeJiOacrO+8jOS4lOaUr+aMgeS9jueJiOacrO+8jOWImeWBmuS4quaYoOWwhAogICAgICBpZiAoIWJveHguY2FuSVVzZShrZXkpICYmIGJveHguY2FuSVVzZShjb21wYXRpYmxlTWFwW2tleV0pKSB7CiAgICAgICAgdmFyIG5ld0FQSU9iaiA9IGdldEZ1bmN0aW9uTmFtZShib3h4LCBrZXkpOwogICAgICAgIHZhciBvbGRBUElPYmogPSBnZXRGdW5jdGlvbk5hbWUoYm94eCwgY29tcGF0aWJsZU1hcFtrZXldKTsKICAgICAgICBuZXdBUElPYmoubWV0aG9kT3duZXJbbmV3QVBJT2JqLm1ldGhvZE5hbWVdID0gb2xkQVBJT2JqLm1ldGhvZE93bmVyW29sZEFQSU9iai5tZXRob2ROYW1lXTsKICAgICAgICBkZWxldGUgb2xkQVBJT2JqLm1ldGhvZE93bmVyW29sZEFQSU9iai5tZXRob2ROYW1lXTsKICAgICAgfSAvLyDlpoLmnpzmlK/mjIHpq5jniYjmnKzvvIzliJnnm7TmjqXliKDpmaTkvY7niYjmnKznq6/og73lipsKICAgICAgZWxzZSBpZiAoYm94eC5jYW5JVXNlKGtleSkgJiYgYm94eC5jYW5JVXNlKGNvbXBhdGlibGVNYXBba2V5XSkpIHsKICAgICAgICAgIHZhciBvbGRBUElPYmokMSA9IGdldEZ1bmN0aW9uTmFtZShib3h4LCBjb21wYXRpYmxlTWFwW2tleV0pOwogICAgICAgICAgZGVsZXRlIG9sZEFQSU9iaiQxLm1ldGhvZE93bmVyW29sZEFQSU9iaiQxLm1ldGhvZE5hbWVdOwogICAgICAgIH0KICAgIH0KICB9Cn0KLyoqCiAqIEBmaWxlICDlsIHoo4UgYWRkQVBJIOaWueazle+8jOWFgeiuuOeUqOaIt+a3u+WKoOaPj+i/sOihqOeUn+aIkOaPj+i/sOihqAogKiBAYXV0aG9yIHpob3VkYW4wMwogKiBAZGF0ZSAyMDE5LzkvMjAKICovCgovKioKICog5re75Yqg55So5oi355qE5o+P6L+w6KGoCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBib3h4IGFwaeWuueWZqAogKiBAcGFyYW0ge09iamVjdH0gYXBpQ29udGFpbmVyIGpzTmF0aXZl5a655ZmoCiAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdGlvbiDmj4/ov7DooagKICovCgoKZnVuY3Rpb24gYWRkKGFwaUNvbnRhaW5lciwgZGVzY3JpcHRpb24pIHsKICBpZiAoIWlzQ2FwYWNpdHlFeGlzdGluZyhkZXNjcmlwdGlvbikpIHsKICAgIHJldHVybjsKICB9CgogIG5vcm1hbGl6ZURlc2NyaXB0aW9uKGRlc2NyaXB0aW9uKTsKCiAgaWYgKCFkZXNjcmlwdGlvbi5pbnZva2UpIHsKICAgIHRocm93IEVycm9yKCdbYm94eF0gJyArIGRlc2NyaXB0aW9uLm5hbWUgKyAnOiBtdXN0IHNwZWNpZnkgcmlnaHQgaW52b2tlIHR5cGUgaW4gZGVzY3JpcHRpb24nKTsKICB9CgogIGFwaUNvbnRhaW5lci5hZGQoZGVzY3JpcHRpb24pOwp9Ci8qKgogKiDlvJXlhaXlhZzlupXmj4/ov7Dooajmlrnms5UKICogQHBhcmFtIHsqfSBkZXNjcmlwdGlvbnMg5YWc5bqV5o+P6L+w6KGoCiAqLwoKCmZ1bmN0aW9uIHNldERlZmF1bHREZXNjcmlwdGlvbihkZXNjcmlwdGlvbnMpIHsKICBpZiAoZGVzY3JpcHRpb25zICYmIE9iamVjdC5rZXlzKGRlc2NyaXB0aW9ucykubGVuZ3RoID4gMCkgewogICAgdmFyIGRlc2NyaXB0aW9uc0xpc3QgPSBnZXRMb2NhbERlc2NyaXB0aW9ucyhkZXNjcmlwdGlvbnMpOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGVzY3JpcHRpb25zTGlzdC5sZW5ndGg7IGkrKykgewogICAgICBhZGQoYXBpQ29udGFpbmVyLCBkZXNjcmlwdGlvbnNMaXN0W2ldKTsKICAgIH0KICB9IC8vIOivreS5ieWMliBhcGkg5aSE55CGCgoKICBpbml0QVBJcyh0aGlzLCBhcGlDb250YWluZXIsIGV2ZW50KTsgLy8g6YeN5a6a5ZCR54m55q6KIEFQSQoKICBiZUNvbXBhdGlibGVXaXRoTG93VmVyc2lvbih0aGlzKTsKfQovKioKICogQGZpbGUg5Li75qih5Z2X5ZKM5omA5pyJ5a2Q5qih5Z2X55qE5YWl5Y+j5paH5Lu277yM55So5LqO55Sf5oiQYm94eOWNleS+iwogKiBAYXV0aG9yIGNoZW5xaTE0CiAqIEBkYXRhIDIwMTkvMTAvMDgKICovCgovKioKICogaW5pdCBib3h4CiAqCiAqIEByZXR1cm5zIHtvYmplY3R9IGJveHgKICovCgoKZnVuY3Rpb24gYWRkQXBpKCkgewogIHZhciBib3h4ID0ge307IC8vIOaMgui9veeOr+Wig+WPmOmHjwoKICBib3h4LmVudiA9IGVudjsKICBib3h4LmNhbklVc2UgPSBnZW5lcmF0ZUNhbklVc2UoYXBpQ29udGFpbmVyKTsKICBib3h4LmNhbGwgPSBnZW5lcmF0ZUNhbGxBcGkoYXBpQ29udGFpbmVyLCBldmVudCk7CiAgYm94eC5zZXREZWZhdWx0RGVzY3JpcHRpb24gPSBzZXREZWZhdWx0RGVzY3JpcHRpb24uYmluZChib3h4KTsKICBib3h4Lm9uID0gZXZlbnQub247CiAgYm94eC5vZmYgPSBldmVudC5vZmY7CiAgYm94eC5vbmNlID0gZXZlbnQub25jZTsKICBib3h4LnNldERlYnVnID0gc2V0RGVidWc7CiAgcmV0dXJuIGJveHg7Cn0KLyoqCiAqIOazqOWFpeWFnOW6leaPj+i/sOihqOW5tuWIneWni+WMlgogKgogKiBAcGFyYW0ge29iamVjdH0gYm94eAogKi8KCgpmdW5jdGlvbiBhZGREZWZhdWx0ZERlc2NyaXB0aW9uKGJveHgpIHsKICB2YXIgZGVmYXVsdERlc2NyaXB0aW9ucyA9IHt9OwoKICB0cnkgewogICAgZGVmYXVsdERlc2NyaXB0aW9ucyA9IGRvY3VtZW50ICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWZvcj1ib3h4LWRlc2NyaXB0aW9uXScpICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWZvcj1ib3h4LWRlc2NyaXB0aW9uXScpWzBdICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWZvcj1ib3h4LWRlc2NyaXB0aW9uXScpWzBdLmlubmVySFRNTCAmJiBKU09OLnBhcnNlKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWZvcj1ib3h4LWRlc2NyaXB0aW9uXScpWzBdLmlubmVySFRNTCkgfHwge307CgogICAgaWYgKE9iamVjdC5rZXlzKGRlZmF1bHREZXNjcmlwdGlvbnMpLmxlbmd0aCA+IDApIHsKICAgICAgaXNIaXRMb2NEZXNjKHRydWUpOwogICAgfSBlbHNlIHsKICAgICAgaXNIaXRMb2NEZXNjKGZhbHNlKTsKICAgIH0KICB9IGNhdGNoIChlcnJvcikgewogICAgZGVmYXVsdERlc2NyaXB0aW9ucyA9IHt9OwogICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgfQoKICBib3h4LnNldERlZmF1bHREZXNjcmlwdGlvbihkZWZhdWx0RGVzY3JpcHRpb25zKTsKfQovKioKICogY3JlYXRlIGJveHgKICoKICogQHJldHVybnMge29iamVjdH0gYm94eCBpbnN0YW5jZQogKi8KCgpmdW5jdGlvbiBjcmVhdGVCb3goKSB7CiAgaW5pdFByb2Nlc3NvcihhcGlDb250YWluZXIpOyAvLyDljoLllYbmtY/op4jlmajmj4/ov7DooajvvIzpnIDopoHlr7nmj4/ov7DooajnmoTlrZfmrrXmoIflh4bljJblpITnkIYKCiAgYnJvd3NlckRlc2NyaXB0aW9uTGlzdC5mb3JFYWNoKG5vcm1hbGl6ZURlc2NyaXB0aW9uKTsgLy8g6Iul5b2T5YmN546v5aKD5pSv5oyB5Y6C5ZWG5rWP6KeI5Zmo77yM5YiZ5L2/55SoYnJvd3NlckRlc2NyaXB0aW9uTGlzdO+8jOWQpuWImeS9v+eUqOerr+aPj+i/sOihqAoKICB2YXIgZGVzY3JpcHRpb25zTGlzdCA9IGlzU3VwcG9ydFN3YW5JbkJyb3dzZXIgPyBicm93c2VyRGVzY3JpcHRpb25MaXN0IDogZ2V0RGVzY3JpcHRpb25zKGFwaUNvbnRhaW5lcik7CiAgYXBpQ29udGFpbmVyLmFkZChkZXNjcmlwdGlvbnNMaXN0KTsKICB2YXIgYm94eCA9IGFkZEFwaSgpOwogIGFkZERlZmF1bHRkRGVzY3JpcHRpb24oYm94eCk7CiAgcmV0dXJuIGJveHg7Cn0KLyoqCiAqIEBmaWxlIGJveHgg5omL55m+56uv6IO95YqbanPlupMg5YWl5Y+j5paH5Lu2CiAqIEBhdXRob3IgbGlodWFueXUwMQogKiBAZGF0ZSAyMDIxLzUvMjUKICovCi8vIOe7mSBqc05hdGl2ZSDms6jlhaXlhZzlupXmj4/ov7DooagKCgp2YXIgYm94eCA9IGNyZWF0ZUJveCgpOwp2YXIgX2RlZmF1bHQgPSBib3h4OwpleHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDs="},{"version":3,"sources":["/Users/a2012/Desktop/list/node_modules/@baidu/boxx/dist/boxx.esm.js"],"names":["ADAPTVERSION","lite","android","ios","tomas","baiduboxvision","baiduboxsenior","knews","global$1","globalThis","window","self","debugInstance","messageList","setDebug","debug","forEach","item","apply","args","len","arguments","length","push","INFINITYVERSION","versionCompare","version1","version2","toNumber","Error","versionArray1","split","map","versionArray2","i","Math","max","inBrowser","UA","navigator","userAgent","toLowerCase","getOSVersion","options","isIOS","isAndroid","result","androidMatch","match","iosMatch","replace","getAdaptVersion","boxType","realBoxVersion","versionList","adaptVersionKeys","Object","keys","sort","reverse","adaptVersionKey","getRealBoxVersion","isBdApp","appProtoName","bdappMatch","RegExp","exec","baiduboxapp_version","oldMatch","join","getMainBoxVersion","isLiteBox","getUAInfo","test","indexOf","OS","OSVersion","isBoxSeries","schemaHeadReg","appSchemaHead","isSupportSwanInBrowser","_na","isSupportSwan","getSchemeHeader","isMainBox","isMissionBox","adaptBoxType","boxBrowserType","assign","boxVersion","ref","addEnvInfo","data","ex","isHitLocDesc","isLocalDesc","isApp","isBdBox","isLiteApp","appType","realAppVersion","env","freeze","__proto__","_cache","broadcast","fire","type","listeners","slice","call","splice","concat","listener","callback","scope","on","types","off","tmp","removeAll","EventEmitter","handlers","eventName","fn","hasOwnProperty","handlerList","index","once","this$1","only","emit","len$1","arr","key","handleEmitEvent","event","innerEvent","browserDescriptionList","name","invoke","value","from","notinhis","srcAppId","extraData","ext","srcAppPage","ubc","navi","backwardURL","authority","scheme","commonjsGlobal","global","createCommonjsModule","module","exports","jsNative","root","each","array","l","returnRaw","source","returnJSONDecode","JSON","parse","checkArgs","declarations","apiContainer","declaration","errorMsg","normalizeValueDeclaration","checkValue","stringify","oneOf","oneOfType","arrayOf","title","errorTitle","realDeclaration","isRequired","valid","Array","expectValue","expectType","wrapDecodeFuncArgs","arg","wrapDecodeFuncArg","wrapArgFunc","wrapFunc","funcId","FUNC_PREFIX","funcName","argJSONEncode","argCombine","callPrompt","prompt","callLocation","url","location","href","callIframe","iframe","document","createElement","src","body","appendChild","removeChild","mapAPIName","mapAPI","INVOKE_SHORTCUT","INVOKE_CALL_MAP","method","message","INVOKE_BEFORE_MAP","JSONStringInTurn","JSONString","JSONObject","URL","BUILTIN_DESCRIPTION_PROPS","path","handler","descriptionPropMerger","target","normalizeDescription","description","propMerger","n","v","normalizeInvoke","schema","check","before","after","APIContainer","processorCreators","ArgCheck","option","ArgFuncArgDecode","ArgFuncEncode","ArgEncode","ArgAdd","argLen","ArgCombine","prefix","encodeURIComponent","queryStr","CallMethod","methodOwner","methodName","findMethod","segs","lastIndex","CallPrompt","CallIframe","CallLocation","CallMessage","webkit","messageHandlers","postMessage","ReturnDecode","namingConflict","apis","apisLen","apiIndex","config","add","realDesc","fromNative","invokeDescription","apiObject","api","apiName","apiNameSegs","j","ns","seg","buildAPIMethod","invokeAPI","addProcessorCreator","processorCreator","setExternalDescriptionProps","props","code","prop","Function","getProcessors","processors","processName","dotIndex","processor","process","prototype","version","createContainer","jsNative_1","naGetAPIDesc","addDefaultFields","nativeDescriptions","defaultsFields","desc","deleteDescriptions","descriptions","getNADescriptions","getAPIs","resultDescriptions","amendDescriptions","nativeSlices","totalSlices","defaults","getAmendAPIs","amendDescJsonStrOrArray","console","log","e","error","isArray","amendDesc","i$1","getVersionByEnv","adaptAppType","getVersionByBoxtypeInEnv","isAdapted","startedVersion","adaptVersion","filterVersion","appVersion","filter","isCapacityExisting","getDefaultDescription","defaultDecs","getCompatibilityDescription","iosCompatibility","androidCompatibility","getLocalDescriptions","defaultDescriptions","compatibilityDescriptions","mergedDefaultDescriptions","getDescriptions","returnDefaultSuccess","status","irregularResponseHandlers","res","unique_id","hasCUID","cookie","cuid","netInfo","network","networkType","params","errno","decodeURIComponent","parseInt","errmsg","coords","st","getDefaultData","defaultData","normalizeResponse","response","registerGlobally","generateCallback","descName","hasNext","success","fail","firstCallback","generateSecondCallback","secondCallback","getUniqueName","nextTasks","nextHandler","isNativePromise","Promise","nextTick","thisArg","bind","tasks","setImmediate","MessageChannel","channel","port","port2","port1","onmessage","resolve","then","setTimeout","methodUndefinedCheckerSended","o","toString","getPrefix","getArgsString","argsString","argResult","getParamsString","argQueryList","rawArgs","query","paramsName","getQueryString","queryStrArray","getArgQueryString","queryArray","queryValue","promptInvoker","segments","newArgs","caller","obj","func","getArgsStringWithUserQuery","userQuery","MAX_URL_LENGTH","ArgCheckWithCallback","processorArgCheckWithCallback","ArgsEncodeToJSONExceptString","processorArgsEncodeToJSONExceptString","RegisterCallbacks","processorRegisterCallbacks","pop","nextCallback","nextCallbackFuncName","firstCallbackName","ArgCombineWithCallback","processorArgCombineWithCallbackBdboxURL","callbackFunctionName","queryString","argQueryString","paramsString","callbackString","callbackName","resultStr","schemeURL","processorArgCombineWithCallbackURL","nextCallbackString","processorArgCombineWithCallbackObject","requireArgs","undefined","processorArgCombineWithCallbackJSONString","ArgJSONString","processorArgJSONString","CallMethodByUserArgs","methodUndefinedChecker","methodInfo","Bdbox_android_common","setQuery","Bdbox_android_jsbridge","dispatch","chrome","lsStr","localStorage","getItem","lsArr","methodInfoStr","setItem","err","info","ls","callMethod","methodDefined","shift","processorCallMethodByUserArgsWithCallback","processorCallMethodByUserArgsWithoutCallback","processorCallMethodByUserArgsDefault","CheckURL","processorCheckURL","unexpectedKeywordMatch","keyword","SwanSchemeCombine","processorSwanSchemeCombine","appKey","appPath","tailStr","substr","initProcessor","funcId$1","FUNC_PREFIX$1","guid","wrapFunction","id","action","isSameEvent","jscallback","page","fnContainer","hasNoReference","some","eventParamsFilter","fnString","isUniqueEvent","isUniqueFunction","eventItem","rnmsg","allowDuplicate","fn$1","isExistentEvent","eventInfo","rawArgs$1","irregularParamsHandlers","history","Boolean","searchType","Number","third_login","showThirdLogin","login_type","loginType","header","string","min_v","backup","backupURL","toolTIDs","style","toolbaricons","tids","intent","toolids","menumode","mode","toolTIDs$1","toolbar","openurl","isla","minver","opentype","append","rbtnstyle","_Box_","normalizeParams","getParamsArray","userArgs","descArgs","getInvoker","needThrowError","innerErrorHandle","stack","tmpError","needDelayEmit","delayEmitCallback","normalizedUserArgs","newError","errorMessage","argName","generateCallApi","getSingleInvoker","generateSingleAPI","boxx","apiNameSegments","segment","initAPIs","generateCanIUse","canIUse","apiSwitch","compatibleMap","getFunctionName","beCompatibleWithLowVersion","newAPIObj","oldAPIObj","oldAPIObj$1","setDefaultDescription","descriptionsList","addApi","addDefaultdDescription","querySelectorAll","innerHTML","createBox"],"mappings":"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","sourcesContent":["/**\n * boxx.js \n * v3.0.69\n */\n\nvar ADAPTVERSION = {\n\tlite: {\n\t\t\"5.24.0.0\": {\n\t\t\tandroid: \"13.2.0.0\",\n\t\t\tios: \"13.2.1.0\"\n\t\t},\n\t\t\"5.21.0.0\": {\n\t\t\tandroid: \"12.28.0.0\",\n\t\t\tios: \"12.28.2.0\"\n\t\t},\n\t\t\"5.15.0.0\": {\n\t\t\tandroid: \"12.21.0.0\",\n\t\t\tios: \"12.21.0.0\"\n\t\t},\n\t\t\"5.6.0.0\": {\n\t\t\tandroid: \"12.13.0.0\",\n\t\t\tios: \"12.13.0.0\"\n\t\t},\n\t\t\"5.0.0.0\": {\n\t\t\tandroid: \"12.1.0.0\",\n\t\t\tios: \"12.1.0.0\"\n\t\t},\n\t\t\"4.21.0.0\": {\n\t\t\tandroid: \"11.24.0.0\",\n\t\t\tios: \"11.24.0.0\"\n\t\t},\n\t\t\"4.17.0.0\": {\n\t\t\tandroid: \"11.22.0.0\",\n\t\t\tios: \"11.22.0.0\"\n\t\t}\n\t},\n\ttomas: {\n\t\t\"1.13.0.0\": {\n\t\t\tandroid: \"12.19.0.0\",\n\t\t\tios: \"12.19.0.0\"\n\t\t},\n\t\t\"1.0.0.0\": {\n\t\t\tandroid: \"12.1.0.0\",\n\t\t\tios: \"12.1.0.0\"\n\t\t}\n\t},\n\tbaiduboxvision: {\n\t\t\"2.0.0.0\": {\n\t\t\tandroid: \"12.15.0.0\",\n\t\t\tios: \"12.15.0.0\"\n\t\t},\n\t\t\"1.0.0.0\": {\n\t\t\tandroid: \"11.25.9.10\",\n\t\t\tios: \"11.25.5.15\"\n\t\t}\n\t},\n\tbaiduboxsenior: {\n\t\t\"1.0.0.0\": {\n\t\t\tandroid: \"12.1.0.0\",\n\t\t\tios: \"12.1.0.0\"\n\t\t}\n\t},\n\tknews: {\n\t\t\"2.0.0.0\": {\n\t\t\tandroid: \"12.13.0.0\",\n\t\t\tios: \"12.13.0.0\"\n\t\t}\n\t}\n};\n\n/**\n * @file  获取全局对象\n * @author zhoudan03\n * @date 2019/8/6\n * @description 获取当前环境的全局对象, @todo 有必要这么判断么？\n */\n/* global globalThis */\n\nvar global$1 =\n    /* eslint-disable no-negated-condition */\n    typeof globalThis !== 'undefined'\n        ? globalThis\n        : typeof window !== 'undefined'\n            ? window\n            // eslint-disable-next-line no-use-before-define\n            : typeof global$1 !== 'undefined'\n                // eslint-disable-next-line no-use-before-define\n                ? global$1\n                : typeof self !== 'undefined' ? self : {};\n    /* eslint-enable no-negated-condition */\n\n/**\n * @file: debug.js\n * @description 开发环境输出日志信息，便于调试\n */\nvar debugInstance = null;\n\nvar messageList = [];\n\nfunction setDebug(debug) {\n    debugInstance = debug;\n    messageList.forEach(function (item) {\n        debugInstance.apply(void 0, item);\n    });\n    messageList = [];\n}\n\nfunction debug() {\n    var args = [], len = arguments.length;\n    while ( len-- ) args[ len ] = arguments[ len ];\n\n    if (!debugInstance) {\n        messageList.push(args);\n        return;\n    }\n    debugInstance.apply(void 0, args);\n}\n\n/**\n * @file  环境判断的变量及函数\n * @author zhoudan03\n * @date 2019/8/15\n */\n// 矩阵产品的端能力适配，端发版对齐新的主线版本时，这里需要新增\n// 矩阵映射表：http://wiki.baidu.com/pages/viewpage.action?pageId=1649977238\n// ADAPTVERSION 数据如需要更新，执行npm run updateAdapteInfo\n// 表示无穷大的版本\nvar INFINITYVERSION = '99999';\n/**\n * 比较两个参数版本大小\n *\n * @param {string} version1 v1\n * @param {string} version2 v2\n * @return {number} 1 v1 > v2 ; -1 v1 < v2 ; 0 v1 = v2\n */\nfunction versionCompare(version1, version2) {\n    if (version1 === version2) {\n        return 0;\n    }\n\n    function toNumber(item) {\n        if (!(+item >= 0)) {\n            throw new Error('传递了非法版本号:: ' + item);\n        }\n        return +item;\n    }\n\n    var versionArray1 = ('' + version1).split('.').map(toNumber);\n    var versionArray2 = ('' + version2).split('.').map(toNumber);\n\n    var i = 0;\n    var len = Math.max(versionArray1.length, versionArray2.length);\n\n    for (; i < len; i++) {\n        if ((versionArray1[i] > versionArray2[i]) ||\n            versionArray1[i] && !versionArray2[i] && versionArray1[i] > 0) {\n            return 1;\n        }\n        else if ((versionArray1[i] < versionArray2[i]) ||\n            (versionArray2[i] && !versionArray1[i] && versionArray2[i] > 0)) {\n            return -1;\n        }\n    }\n    return 0;\n}\n\nvar inBrowser = typeof window !== 'undefined';\nvar UA = inBrowser && window.navigator.userAgent.toLowerCase();\n\n/**\n * 获取iOS/Android操作系统版本号\n *\n * @return {number}\n */\nfunction getOSVersion(options) {\n    var UA = options.UA;\n    var isIOS = options.isIOS;\n    var isAndroid = options.isAndroid;\n    var result = 0;\n    if (isAndroid) {\n        var androidMatch = UA.match(/(android);?\\s+([\\d.]+)?/);\n        // 优先判断android并且提前 return，避免 android 的仿 IOS 系统，例如'android 1.1 xxxIOS 1.0'情况被识别为 ios 系统并返回错误版本\n        return androidMatch && androidMatch[2];\n    }\n    if (isIOS) {\n        var iosMatch = UA.match(/(ipad|iphone|ipod).*os\\s([\\d_]+)/);\n        return iosMatch && iosMatch[2].replace(/_/g, '.');\n    }\n    return result;\n}\n\n\n/**\n * 获取当前 UA 适配的版本信息，该方法依赖适配信息ADAPTVERSION，即时外部调用也可以保证在ADAPTVERSION的适配范围内\n * @param {string} bdversion 当前 UA 的真实版本\n * @param {string} uaType 当前 UA 的真实类型: 'main'、'mission'、'lite'、'tomas'、'baiduboxvision'、'unknown'，伴随矩阵产品的增加会越来越多\n * @return {string}\n */\nfunction getAdaptVersion(options) {\n    var boxType = options.boxType;\n    var realBoxVersion = options.realBoxVersion;\n    var isIOS = options.isIOS;\n    // 获取适配信息中的版本list\n    var versionList = ADAPTVERSION[boxType] || {};\n    var adaptVersionKeys = Object.keys(versionList);\n    var len = adaptVersionKeys.length;\n    // ADAPTVERSION中没有适配信息的 UA，返回'', 表示不支持端能力，若需要支持boxxx，需要在ADAPTVERSION中增加配置\n    if (len === 0) {\n        return '';\n    }\n    // 获取适配前的版本list，并且从高到底排序\n    adaptVersionKeys.sort(versionCompare).reverse();\n    for (var i = 0; i < adaptVersionKeys.length; i++) {\n        var adaptVersionKey = adaptVersionKeys[i];\n        if (versionCompare(realBoxVersion, adaptVersionKey) >= 0) {\n            if (typeof versionList[adaptVersionKey] !== 'string') {\n                return isIOS ? versionList[adaptVersionKey].ios : versionList[adaptVersionKey].android;\n            }\n            return versionList[adaptVersionKey];\n        }\n    }\n    // 低于ADAPTVERSION中的最低版本的app，表示没有对齐主线，返回''\n    return '';\n}\n\n/**\n * 获取当前环境真实版本号，后续打点中需要使用\n * @returns {string}\n */\nfunction getRealBoxVersion(options) {\n    var isBdApp = options.isBdApp;\n    var UA = options.UA;\n    var appProtoName = options.appProtoName;\n    if (isBdApp) {\n        var bdappMatch = (new RegExp(appProtoName + '/([\\\\d+.]+)')).exec(UA);\n        if (bdappMatch && bdappMatch[1]) {\n            return bdappMatch[1];\n        }\n    }\n    // 现代手百，包含main和lite\n    var match = /baiduboxapp\\/([\\d+.]+)/.exec(UA);\n    if (match && match[1]) {\n        return match[1];\n    }\n\n    // 某个历史版本手百\n    if (global$1.baiduboxapp_version) {\n        return global$1.baiduboxapp_version;\n    }\n\n    // 某个历史版本手百\n    var oldMatch = /([\\d+.]+)_(?:diordna|enohpi)_/.exec(UA);\n    return oldMatch && oldMatch[1] && oldMatch[1].split('.').reverse()\n        .join('.') || 0;\n}\n\n/**\n * 获取适配主线的版本号，大字版、青春版、关怀版、lite返回适配后的主线版本，主线其真实版本\n * @return {string}\n */\nfunction getMainBoxVersion(options) {\n    var isBdApp = options.isBdApp;\n    var isLiteBox = options.isLiteBox;\n    var realBoxVersion = options.realBoxVersion;\n    // bdapp 和 lite 矩阵产品使用对齐主线的版本\n    if (isBdApp || isLiteBox) {\n        return getAdaptVersion(options);\n    }\n    return realBoxVersion;\n}\n\n\n/**\n * 获取 UA 相关的信息\n * @param {string} UA\n * @returns {string}\n */\nfunction getUAInfo(UA) {\n    var isIOS = UA && /iphone|ipad|ipod|ios/.test(UA);\n    var isAndroid = UA && UA.indexOf('android') > 0;\n    // 系统优先判断 android, 避免 android 的仿 IOS 系统，例如'android 1.1 xxxIOS 1.0'情况被识别为 ios 系统\n    var OS = isAndroid ? 'android' : (isIOS ? 'ios' : 'unknown');\n    var options = {\n        UA: UA,\n        isIOS: isIOS,\n        isAndroid: isAndroid\n    };\n    // 操作系统版本\n    var OSVersion = getOSVersion(options);\n    // 手百系列产品\n    var isBoxSeries = / baiduboxapp\\//i.test(UA) || / bdapp\\//i.test(UA);\n    // bdapp协议的手百矩阵产品\n    var isBdApp = / bdapp\\//i.test(UA);\n    // 获取bdapp协议头\n    var schemaHeadReg = / bdapp\\/\\d+[.\\d+]*\\s\\((\\w+)[;]?\\s?(\\w+)?\\)/g;\n    var appSchemaHead = schemaHeadReg.exec(UA);\n    // 浏览器是否支持小程序\n    var isSupportSwanInBrowser = inBrowser && window && window._na\n        && window._na.isSupportSwan && window._na.getSchemeHeader && window._na.isSupportSwan();\n    // 若浏览器支持小程序，获取对应的端能力协议头\n    var appProtoName = isSupportSwanInBrowser\n        ? window._na.getSchemeHeader()\n        : (appSchemaHead ? (appSchemaHead[2] || appSchemaHead[1]) : 'baiduboxapp');\n    // 手百主版本\n    var isMainBox = / baiduboxapp\\//i.test(UA) && !/ (lite|info|pro|mission) baiduboxapp/.test(UA) && !isBdApp;\n    // 手百极速版（在 iOS，极速版的关键词是 info; 在 Android，极速版的 UA 关键字是 lite。其他也为 info 的产品为 lite 的前身，可以忽略）\n    // wiki:  http://wiki.baidu.com/pages/viewpage.action?pageId=418333914\n    var isLiteBox = (isIOS && / info baiduboxapp\\//i.test(UA)) || (isAndroid && / lite baiduboxapp\\//i.test(UA));\n    // 手百看多多\n    var isMissionBox = / mission baiduboxapp\\//i.test(UA);\n    // 手百类型    'main'主版  'mission'看多多  'lite'极速版\n    var boxType = isMainBox\n        ? 'main'\n        : (isMissionBox ? 'mission' : (isLiteBox ? 'lite' : (appProtoName || 'unknown')));\n    // 适配后的手百类型\n    var adaptBoxType = 'main';\n    // 浏览器框架  light：轻浏览器框架；search：主（搜索）浏览器框架; imagesearch mian: 多模半屏webview\n    var boxBrowserType = /imagesearch[\\s\\S]+main/i.test(UA)\n        ? 'imageseach'\n        : /light/i.test(UA) ? 'light' : 'search';\n    Object.assign(options, {\n        isBdApp: isBdApp,\n        boxType: boxType,\n        appProtoName: appProtoName\n    });\n    // 获取当前 UA 对应的真实版本号，后续打点中需要使用\n    var realBoxVersion = getRealBoxVersion(options);\n    Object.assign(options, {\n        realBoxVersion: realBoxVersion,\n        isLiteBox: isLiteBox\n    });\n    // 获取当前 UA 适配主线的版本号，大字版、青春版、关怀版返回适配后的主线版本，主线和lite返回其真实版本\n    var boxVersion = getMainBoxVersion(options);\n    return {\n        isIOS: isIOS,\n        isAndroid: isAndroid,\n        OS: OS,\n        OSVersion: OSVersion,\n        isBoxSeries: isBoxSeries,\n        isBdApp: isBdApp,\n        isSupportSwanInBrowser: isSupportSwanInBrowser,\n        appProtoName: appProtoName,\n        isMainBox: isMainBox,\n        isLiteBox: isLiteBox,\n        isMissionBox: isMissionBox,\n        boxType: boxType,\n        adaptBoxType: adaptBoxType,\n        boxBrowserType: boxBrowserType,\n        realBoxVersion: realBoxVersion,\n        boxVersion: boxVersion\n    };\n}\n\nvar ref = getUAInfo(UA);\nvar isIOS = ref.isIOS;\nvar isAndroid = ref.isAndroid;\nvar OS = ref.OS;\nvar OSVersion = ref.OSVersion;\nvar isBoxSeries = ref.isBoxSeries;\nvar isBdApp = ref.isBdApp;\nvar isSupportSwanInBrowser = ref.isSupportSwanInBrowser;\nvar appProtoName = ref.appProtoName;\nvar isMainBox = ref.isMainBox;\nvar isLiteBox = ref.isLiteBox;\nvar isMissionBox = ref.isMissionBox;\nvar boxType = ref.boxType;\nvar adaptBoxType = ref.adaptBoxType;\nvar boxBrowserType = ref.boxBrowserType;\nvar realBoxVersion = ref.realBoxVersion;\nvar boxVersion = ref.boxVersion;\n\n/**\n * 为某一对象数据上添加环境信息： app 类型， app 版本\n *     一般用来做统计， 比如在错误事件数据上添加\n *\n * @param {Object} data 原数据\n */\nfunction addEnvInfo(data) {\n    try {\n        data.boxType = boxType;\n        data.boxVersion = realBoxVersion;\n    }\n    catch (ex) {\n        // nothind\n    }\n\n    return data;\n}\n\n/**\n * 主线 12.16 以下以及其它矩阵产品均使用兜底描述表\n * 矩阵产品开启端描述表下发以后，这个需要同步变更\n * @param {*} isLocalDesc 是否命中兜底描述表\n * @param {*} options UA 相关参数，options由于编译问题不能与全局变量同名\n */\nfunction isHitLocDesc(isLocalDesc, options) {\n    if ( options === void 0 ) options = {\n    isApp: isMainBox,\n    isBdBox: isBdApp,\n    isLiteApp: isLiteBox,\n    appType: boxType,\n    realAppVersion: realBoxVersion\n};\n\n    var isApp = options.isApp;\n    var isBdBox = options.isBdBox;\n    var isLiteApp = options.isLiteApp;\n    var appType = options.appType;\n    var realAppVersion = options.realAppVersion;\n    if (isLocalDesc) {\n        if (isApp && versionCompare(realAppVersion, '12.16') < 0\n        || isBdBox || isLiteApp) {\n            debug(appType + realAppVersion + '使用兜底描述表，符合预期');\n        }\n        else {\n            debug(appType + realAppVersion + '使用兜底描述表，！！！不符合预期，请加抽样验证效果！！！');\n        }\n    }\n    else if (isApp) {\n        if (versionCompare(realAppVersion, '12.16') > 0) {\n            debug(appType + realAppVersion + '使用端描述表，符合预期');\n        }\n        else {\n            debug(appType + realAppVersion + '使用端描述表，！！！不符合预期，请去掉抽样使用兜底描述表验证效果！！！');\n        }\n    }\n    else {\n        // 线上矩阵产品不会命中抽样，一直使用兜底描述表\n        debug('矩阵产品' + appType + realAppVersion + '线上无法命中联动实验，不会使用端描述表，！！！不需要加抽样验证，请去掉抽样使用兜底描述表验证效果！！！');\n    }\n}\n\nvar env = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    INFINITYVERSION: INFINITYVERSION,\n    versionCompare: versionCompare,\n    inBrowser: inBrowser,\n    UA: UA,\n    getUAInfo: getUAInfo,\n    isIOS: isIOS,\n    isAndroid: isAndroid,\n    OS: OS,\n    OSVersion: OSVersion,\n    isBoxSeries: isBoxSeries,\n    isBdApp: isBdApp,\n    isSupportSwanInBrowser: isSupportSwanInBrowser,\n    appProtoName: appProtoName,\n    isMainBox: isMainBox,\n    isLiteBox: isLiteBox,\n    isMissionBox: isMissionBox,\n    boxType: boxType,\n    adaptBoxType: adaptBoxType,\n    boxBrowserType: boxBrowserType,\n    realBoxVersion: realBoxVersion,\n    boxVersion: boxVersion,\n    addEnvInfo: addEnvInfo,\n    isHitLocDesc: isHitLocDesc\n});\n\n/**\n * 广播事件处理\n * @description 目标: 为了尽可能的减少模块之间业务逻辑的耦合度, 而开发了这个eventbus, 主要用于业务逻辑的事件传递\n * 使用规范: 每个js模块尽可能通过事件去通信, 减少模块之间的直接调用和依赖(耦合)\n *\n * @author chenqi14\n */\nvar _cache = {};\nvar broadcast = {\n\n    /**\n     * 派发\n     * @param  {String} type 事件类型\n     * @param  {...*} data 回调数据，支持连续传递\n     * @return {this}   this   broadcast对象\n     * @example\n     * Bdbox.event.broadcast.fire('some event', arg1, arg2)\n     */\n    fire: function fire(type, data) {\n        var listeners = _cache[type];\n        var len = 0;\n        if (listeners) {\n            // eslint-disable-next-line prefer-rest-params\n            var args = [].slice.call(arguments, 0); // 后面补单测时请删除上面的 disable 注释\n            args = args.length > 2 ? args.splice(2, args.length - 1) : [];\n            args = [type, data].concat(args);\n\n            len = listeners.length;\n            for (var i = 0; i < len; i++) {\n                var listener = listeners[i];\n                if (listener && listener.callback) {\n                    args = args.concat(listener.args);\n                    listener.callback.apply(listener.scope, args);\n                }\n            }\n        }\n        return this;\n    },\n\n    /**\n     * 订阅广播事件\n     * @param  {String}   types     事件类型，支持`,`分隔符\n     * @param  {Function} callback 回调函数\n     * @param  {Object}   [scope=undefined]    回调函数上下文\n     * @return {this}    this broadcast\n     * @example\n     * Bdbox.event.broadcast.on('some event,someevent2', function(arg1, arg2){\n     *     console.log(arg1, arg2);\n     * });\n     */\n    on: function on(types, callback, scope) {\n        types = types || [];\n        // eslint-disable-next-line prefer-rest-params\n        var args = [].slice.call(arguments); // 后面补单测时请删除上面的 disable 注释\n\n\n        if (typeof types === 'string') {\n            types = types.split(',');\n        }\n        var len = types.length;\n        if (len === 0) {\n            return this;\n        }\n        args = args.length > 3 ? args.splice(3, args.length - 1) : [];\n        for (var i = 0; i < len; i++) {\n            var type = types[i];\n            _cache[type] = _cache[type] || [];\n            _cache[type].push({\n                callback: callback,\n                scope: scope,\n                args: args\n            });\n        }\n        return this;\n    },\n\n    /**\n     * 退订\n     * @param  {String}   type     退订服务的类型\n     * @param  {Function} callback 假如传入则移出传入的监控事件，否则移出全部\n     * @return {this} this broadcast\n     * @example\n     * Bdbox.event.broadcast.off('some event', callback);\n     */\n    off: function off(type, callback, scope) {\n        var listeners = _cache[type];\n        if (!listeners) {\n            return this;\n        }\n        if (callback) {\n            var len = listeners.length;\n            var tmp = [];\n\n            for (var i = 0; i < len; i++) {\n                var listener = listeners[i];\n                if (listener.callback !== callback || listener.scope !== scope) {\n                    tmp.push(listener);\n                }\n            }\n            _cache[type] = tmp;\n        }\n        else {\n            listeners.length = 0;\n        }\n        return this;\n    },\n\n    /**\n     * 移出所有事件\n     * @return {this} this broadcast对象\n     */\n    removeAll: function removeAll() {\n        _cache = {};\n        return this;\n    }\n};\n\nfunction EventEmitter() {\n    var handlers = {};\n    return {\n        on: function on(eventName, fn) {\n            if (handlers.hasOwnProperty(eventName)) {\n                handlers[eventName].indexOf(fn) === -1\n                && handlers[eventName].push(fn);\n            }\n            else {\n                handlers[eventName] = [fn];\n            }\n        },\n\n        off: function off(eventName, fn) {\n            var handlerList = handlers[eventName] || [];\n            var index = handlerList.indexOf(fn);\n            if (index > -1) {\n                handlers[eventName].splice(index, 1);\n            }\n        },\n\n        once: function once(eventName, fn) {\n            var this$1 = this;\n\n            var only = function () {\n                var args = [], len = arguments.length;\n                while ( len-- ) args[ len ] = arguments[ len ];\n\n                this$1.off(eventName, only);\n                fn.apply.apply(fn, [ this$1 ].concat( args ));\n            };\n            this.on(eventName, only);\n        },\n\n        emit: function emit(eventName) {\n            var args = [], len$1 = arguments.length - 1;\n            while ( len$1-- > 0 ) args[ len$1 ] = arguments[ len$1 + 1 ];\n\n            var arr = eventName.split(':');\n            var len = arr.length;\n\n            // 不允许直接 emit('xxx:*')\n            if (len === 2 && arr[1] === '*') {\n                return;\n            }\n\n            // emit ('xxx:*')事件\n            if (len > 1) {\n                var key = arr[0] + ':*';\n                handleEmitEvent.apply(void 0, [ handlers, key, eventName ].concat( args ));\n            }\n\n            // 执行eventName事件\n            handleEmitEvent.apply(void 0, [ handlers, eventName ].concat( args ));\n        }\n    };\n\n}\n\nfunction handleEmitEvent(handlers, key) {\n    var args = [], len = arguments.length - 2;\n    while ( len-- > 0 ) args[ len ] = arguments[ len + 2 ];\n\n    if (handlers.hasOwnProperty(key)) {\n        handlers[key].forEach(function (fn) {\n            fn.apply(void 0, args);\n        });\n    }\n}\n\n/**\n * 暴露给外部事件\n */\nvar event = new EventEmitter();\n\n/**\n * 暴露给内部事件\n */\nvar innerEvent = new EventEmitter();\n\n/**\n * @file 厂商浏览器端能力描述表list\n * @author lihuanyu01\n * @data 2021/10/08\n * @wiki 厂商浏览器需要按照此规范接入：http://wiki.baidu.com/pages/viewpage.action?pageId=1685360555\n * @desc 搜索可以维护10个以内的描述表，当描述表较多时，必须推动厂商自行下发描述表\n */\nvar browserDescriptionList = [{\n    name: 'swan.open',\n    invoke: 'iframe.openSwan',\n    args: [{\n        name: 'appKey',\n        value: 'string'\n    }, {\n        name: 'path',\n        value: 'string='\n    }, {\n        name: 'query',\n        value: 'Object='\n    }, {\n        name: '_baiduboxapp',\n        value: {\n            type: {\n                from: 'string=',\n                notinhis: 'string=',\n                srcAppId: 'string=',\n                extraData: 'Object=',\n                ext: 'Object=',\n                srcAppPage: 'string=',\n                ubc: 'Object=',\n                navi: 'string=',\n                backwardURL: 'string='\n            }\n        }\n    }, {\n        name: 'third_ext',\n        value: 'string='\n    }, {\n        name: 'abtest',\n        value: 'string='\n    }, {\n        name: 'oauthType',\n        value: 'string='\n    }, {\n        name: '_swaninfo',\n        value: 'string='\n    }, {\n        name: 'downloadUrl',\n        value: 'string='\n    }, {\n        name: 'udid',\n        value: 'string='\n    }, {\n        name: 'host',\n        value: 'string='\n    }, {\n        name: 'cb',\n        value: 'string='\n    }, {\n        name: 'port',\n        value: 'string='\n    }],\n    authority: 'swan',\n    scheme: window && window._na && window._na.getSchemeHeader && window._na.getSchemeHeader()\n}];\n\nvar commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar jsNative = createCommonjsModule(function (module, exports) {\n/**\n * @file js-native 通信管理\n * @author errorrik(errorrik@gmail.com)\n * @author houyu(785798835@qq.com)\n */\n\n(function (root) {\n\n    /**\n     * 对数组进行遍历\n     *\n     * @inner\n     * @param {Array} array 要遍历的数组\n     * @param {Function} fn 遍历函数\n     */\n    function each(array, fn) {\n        var len = array && array.length || 0;\n\n        for (var i = 0, l = len; i < l; i++) {\n            if (fn(array[i], i) === false) {\n                break;\n            }\n        }\n    }\n\n    /**\n     * 返回原值的方法，调用过程的兜底处理函数\n     *\n     * @inner\n     * @param {*} source 原值\n     * @return {*}\n     */\n    function returnRaw(source) {\n        return source;\n    }\n\n    /**\n     * 对返回值进行 JSON 解码（反序列化）处理的函数\n     *\n     * @inner\n     * @param {*} source 原值\n     * @return {*}\n     */\n    function returnJSONDecode(source) {\n        return typeof source === 'string' ? JSON.parse(source) : source;\n    }\n\n\n    /**\n     * 参数检查，错误直接抛出异常\n     *\n     * @inner\n     * @param {Array} args 调用参数\n     * @param {Array} declarations 参数声明列表\n     */\n    function checkArgs(args, declarations, apiContainer) {\n        each(declarations, function (declaration, i) {\n            var errorMsg;\n            var value = normalizeValueDeclaration(declaration.value);\n\n            switch (checkValue(args[i], value)) {\n                case 1:\n                    errorMsg = ' is required.';\n                    break;\n\n                case 2:\n                    errorMsg = ' type error. must be ' + JSON.stringify(value.type || 'Array');\n                    break;\n\n                case 3:\n                    errorMsg = ' type error, must be oneOf ' + JSON.stringify(value.oneOf);\n                    break;\n\n                case 4:\n                    errorMsg = ' type error, must be oneOfType ' + JSON.stringify(value.oneOfType);\n                    break;\n\n                case 5:\n                    errorMsg = ' type error, must be arrayOf ' + JSON.stringify(value.arrayOf);\n                    break;\n            }\n\n            if (errorMsg) {\n                var title = apiContainer && apiContainer.options.errorTitle || 'jsNative';\n                throw new Error('[' + title + ' Argument Error]' + declaration.name + errorMsg);\n            }\n        });\n    }\n\n    /**\n     * 对值声明进行标准化处理\n     *\n     * @inner\n     * @param {Object|string} declaration 值声明\n     * @return {Object}\n     */\n    function normalizeValueDeclaration(declaration) {\n        if (typeof declaration === 'string') {\n            var realDeclaration = {isRequired: true};\n\n\n            if (/=$/.test(declaration)) {\n                realDeclaration.isRequired = false;\n                declaration = declaration.slice(0, declaration.length - 1);\n            }\n\n            if (/\\[\\]$/.test(declaration)) {\n                realDeclaration.arrayOf = declaration.slice(0, declaration.length - 2);\n            }\n            else if (declaration.indexOf('|') > 0) {\n                realDeclaration.oneOfType = declaration.split('|');\n            }\n            else {\n                realDeclaration.type = declaration;\n            }\n\n            return realDeclaration;\n        }\n\n        return declaration;\n    }\n\n\n    /**\n     * 对参数值进行检查\n     *\n     * @inner\n     * @param {*} value 值\n     * @param {Object} declaration 值声明\n     * @return {number}\n     */\n    function checkValue(value, declaration) {\n        declaration = normalizeValueDeclaration(declaration);\n        if (value == null) {\n            return declaration.isRequired && declaration.type !== '*' ? 1 : 0;\n        }\n\n\n        var valid = false;\n        switch (typeof declaration.type) {\n            case 'string':\n                switch (declaration.type) {\n                    case 'string':\n                    case 'boolean':\n                    case 'number':\n                    case 'function':\n                    case 'object':\n                        valid = typeof value === declaration.type;\n                        break;\n\n                    case 'Object':\n                        valid = typeof value === 'object';\n                        break;\n\n                    case 'Array':\n                        valid = value instanceof Array;\n                        break;\n\n                    case '*':\n                        valid = true;\n                        break;\n                }\n\n                if (!valid) {\n                    return 2;\n                }\n                break;\n\n            case 'object':\n                if (value && typeof value === 'object') {\n                    valid = true;\n                    for (var key in declaration.type) {\n                        valid = !checkValue(value[key], declaration.type[key]);\n\n                        if (!valid) {\n                            break;\n                        }\n                    }\n                }\n\n                if (!valid) {\n                    return 2;\n                }\n                break;\n\n            default:\n\n                if (declaration.oneOf) {\n\n                    each(declaration.oneOf, function (expectValue) {\n                        valid = expectValue === value;\n                        return !valid;\n                    });\n\n                    if (!valid) {\n                        return 3;\n                    }\n\n                }\n                else if (declaration.oneOfType) {\n\n                    each(declaration.oneOfType, function (expectType) {\n                        valid = !checkValue(value, expectType);\n                        return !valid;\n                    });\n\n                    if (!valid) {\n                        return 4;\n                    }\n\n                }\n                else if (declaration.arrayOf) {\n\n                    if (value instanceof Array) {\n                        valid = true;\n                        each(value, function (item) {\n                            return (valid = !checkValue(item, declaration.arrayOf));\n                        });\n\n                        if (!valid) {\n                            return 5;\n                        }\n                    }\n                    else {\n                        return 2;\n                    }\n\n                }\n        }\n\n        return 0;\n    }\n\n    /**\n     * 对调用参数中的所有回调函数，进行参数解码（反序列化）包装\n     *\n     * @inner\n     * @param {Array} args 调用参数\n     * @return {Array}\n     */\n    function wrapDecodeFuncArgs(args) {\n        each(args, function (arg, i) {\n            if (typeof arg === 'function') {\n                args[i] = wrapDecodeFuncArg(arg);\n            }\n        });\n\n        return args;\n    }\n\n    /**\n     * 对回调函数的参数进行解码（反序列化）包装\n     *\n     * @inner\n     * @param {Function} fn 回调函数\n     * @return {Function}\n     */\n    function wrapDecodeFuncArg(fn) {\n        return function (arg) {\n            fn(typeof arg === 'string' ? JSON.parse(arg) : arg);\n        };\n    }\n\n    /**\n     * 对调用参数中的所有回调函数，进行序列化包装\n     *\n     * @inner\n     * @param {Array} args 调用参数\n     * @return {Array}\n     */\n    function wrapArgFunc(args) {\n        each(args, function (arg, i) {\n            if (typeof arg === 'function') {\n                args[i] = wrapFunc(arg);\n            }\n        });\n\n        return args;\n    }\n\n    /**\n     * 用于回调函数包装命名的自增id\n     *\n     * @inner\n     * @type {number}\n     */\n    var funcId = 1;\n\n    /**\n     * 用于回调函数包装命名的前缀\n     *\n     * @inner\n     * @const\n     * @type {string}\n     */\n    var FUNC_PREFIX = '__jsna_';\n\n    /**\n     * 对回调函数，进行序列化包装\n     *\n     * @inner\n     * @param {Function} fn 回调函数\n     * @return {string}\n     */\n    function wrapFunc(fn) {\n        var funcName = FUNC_PREFIX + (funcId++);\n\n        root[funcName] = function (arg) {\n            delete root[funcName];\n            fn(arg);\n        };\n\n        return funcName;\n    }\n\n    /**\n     * 对调用参数中的所有参数进行JSON序列化\n     *\n     * @inner\n     * @param {Array} args 调用参数\n     * @return {Array}\n     */\n    function argJSONEncode(args) {\n        each(args, function (arg, i) {\n            args[i] = JSON.stringify(arg);\n        });\n\n        return args;\n    }\n\n    /**\n     * 将调用参数合并成对象\n     *\n     * @inner\n     * @param {Array} args 调用参数\n     * @param {Array} declarations 参数声明列表\n     * @return {Object}\n     */\n    function argCombine(args, declarations) {\n        var result = {};\n        each(declarations, function (declaration, i) {\n            var arg = args[i];\n            if (arg != null) {\n                result[declaration.name] = arg;\n            }\n        });\n\n        return result;\n    }\n\n    /**\n     * 通过 prompt 对话框进行 Native 调用\n     *\n     * @inner\n     * @param {string} source 要传递的数据字符串\n     * @return {string}\n     */\n    function callPrompt(source) {\n        return root.prompt(source);\n    }\n\n    /**\n     * 通过 location.href 进行 Native 调用\n     *\n     * @inner\n     * @param {string} url 要传递的url字符串\n     */\n    function callLocation(url) {\n        root.location.href = url;\n    }\n\n    /**\n     * 通过 iframe 进行 Native 调用\n     *\n     * @inner\n     * @param {string} url 要传递的url字符串\n     */\n    function callIframe(url) {\n        var iframe = document.createElement('iframe');\n        iframe.src = url;\n        document.body.appendChild(iframe);\n        document.body.removeChild(iframe);\n    }\n\n    /**\n     * 映射调用对象描述中的名称\n     *\n     * @inner\n     * @param {Object|Function} mapAPI 调用描述对象名称的映射表或映射函数\n     * @param {string} name 调用描述对象中的名称\n     * @return {string}\n     */\n    function mapAPIName(mapAPI, name) {\n        if (typeof mapAPI === 'function') {\n            return mapAPI(name);\n        }\n\n        return mapAPI[name];\n    }\n\n    /**\n     * 调用描述对象的 invoke 属性为字符串时的快捷映射表\n     *\n     * @inner\n     * @const\n     * @type {Object}\n     */\n    var INVOKE_SHORTCUT = {\n        'method': [\n            'ArgCheck',\n            'CallMethod'\n        ],\n\n        'method.json': [\n            'ArgCheck',\n            'ArgFuncArgDecode:JSON',\n            'ArgFuncEncode',\n            'ArgEncode:JSON',\n            'CallMethod',\n            'ReturnDecode:JSON'\n        ],\n\n        'prompt.json': [\n            'ArgCheck',\n            'ArgFuncArgDecode:JSON',\n            'ArgFuncEncode',\n            'ArgAdd:name',\n            'ArgCombine:JSONString',\n            'CallPrompt',\n            'ReturnDecode:JSON'\n        ],\n\n\n        'prompt.url': [\n            'ArgCheck',\n            'ArgFuncArgDecode:JSON',\n            'ArgFuncEncode',\n            'ArgEncode:JSON',\n            'ArgCombine:URL',\n            'CallPrompt',\n            'ReturnDecode:JSON'\n        ],\n\n\n        'location': [\n            'ArgCheck',\n            'ArgFuncArgDecode:JSON',\n            'ArgFuncEncode',\n            'ArgEncode:JSON',\n            'ArgCombine:URL',\n            'CallLocation'\n        ],\n\n        'iframe': [\n            'ArgCheck',\n            'ArgFuncArgDecode:JSON',\n            'ArgFuncEncode',\n            'ArgEncode:JSON',\n            'ArgCombine:URL',\n            'CallIframe'\n        ],\n\n        'message': [\n            'ArgCheck',\n            'ArgFuncArgDecode:JSON',\n            'ArgFuncEncode',\n            'ArgAdd:name',\n            'ArgCombine:Object',\n            'CallMessage'\n        ]\n    };\n\n    /**\n     * 调用描述对象的 invoke 属性为 Object时，call 字段对应的映射表\n     *\n     * @inner\n     * @const\n     * @type {Object}\n     */\n    var INVOKE_CALL_MAP = {\n        method: 'CallMethod',\n        prompt: 'CallPrompt',\n        location: 'CallLocation',\n        iframe: 'CallIframe',\n        message: 'CallMessage'\n    };\n\n    /**\n     * 调用描述对象的 invoke 属性为 Object时，before 字段对应的映射表\n     *\n     * @inner\n     * @const\n     * @type {Object}\n     */\n    var INVOKE_BEFORE_MAP = {\n        JSONStringInTurn: [\n            'ArgFuncArgDecode:JSON',\n            'ArgFuncEncode',\n            'ArgEncode:JSON'\n        ],\n\n        JSONString: [\n            'ArgFuncArgDecode:JSON',\n            'ArgFuncEncode',\n            'ArgAdd:name',\n            'ArgCombine:JSONString'\n        ],\n\n        JSONObject: [\n            'ArgFuncArgDecode:JSON',\n            'ArgFuncEncode',\n            'ArgAdd:name',\n            'ArgCombine:Object'\n        ],\n\n        URL: [\n            'ArgFuncArgDecode:JSON',\n            'ArgFuncEncode',\n            'ArgEncode:JSON',\n            'ArgCombine:URL'\n        ]\n    };\n\n    var BUILTIN_DESCRIPTION_PROPS = {\n        name: 1,\n        args: 1,\n        invoke: 1,\n        method: 1,\n        scheme: 1,\n        authority: 1,\n        path: 1,\n        handler: 1\n    };\n\n    function descriptionPropMerger(target, source) {\n        for (var key in source) {\n            if (source.hasOwnProperty(key) && !BUILTIN_DESCRIPTION_PROPS[key]) {\n                target[key] = source[key];\n            }\n        }\n\n        return target;\n    }\n\n    /**\n     * 对调用描述对象进行标准化处理\n     *\n     * @inner\n     * @param {Object} description 调用描述对象\n     * @param {Function?} propMerger 属性合并方法，默认实现为for...in，APIContainer可用于提升性能\n     * @return {Object}\n     */\n    function normalizeDescription(description, propMerger) {\n        var args = [];\n        if (description.args instanceof Array) {\n            for (var i = 0; i < description.args.length; i++) {\n                var arg = description.args[i];\n\n                args.push({\n                    name: arg.name || arg.n,\n                    value: arg.value || arg.v\n                });\n            }\n        }\n\n        propMerger = propMerger || descriptionPropMerger;\n        return propMerger(\n            {\n                name: description.name,\n                args: args,\n                invoke: normalizeInvoke(description.invoke),\n                method: description.method,\n                scheme: description.scheme || description.schema,\n                authority: description.authority,\n                path: description.path,\n                handler: description.handler\n            }, \n            description\n        );\n    }\n\n    /**\n     * 对 description 中的 invoke 属性进行标准化处理\n     *\n     * @inner\n     * @param {Array|Object|string} invoke description的invoke属性\n     * @return {Array?}\n     */\n    function normalizeInvoke(invoke) {\n        if (invoke instanceof Array) {\n            return invoke;\n        }\n\n        switch (typeof invoke) {\n            case 'string':\n                return INVOKE_SHORTCUT[invoke];\n\n            case 'object':\n                var result = [];\n\n                if (invoke.check) {\n                    result.push('ArgCheck');\n                }\n\n                if (invoke.before) {\n                    result = result.concat(INVOKE_BEFORE_MAP[invoke.before]);\n                }\n\n                result.push(INVOKE_CALL_MAP[invoke.call]);\n\n                if (invoke.after === 'JSON') {\n                    result.push('ReturnDecode:JSON');\n                }\n\n                return result;\n\n        }\n    }\n\n    function APIContainer(options) {\n        /**\n         * processor 创建方法集合\n         *\n         * @inner\n         * @type {Object}\n         */\n        var processorCreators = {\n\n            /**\n             * 创建参数检查处理函数\n             *\n             * @param {Object} description 调用描述对象\n             * @return {Function}\n             */\n            ArgCheck: function (description, option, apiContainer) {\n                return function (args) {\n                    checkArgs(args, description.args, apiContainer);\n                    return args;\n                };\n            },\n\n            /**\n             * 创建解码回调函数参数包装的处理函数\n             *\n             * @param {Object} description 调用描述对象\n             * @param {string} option 处理参数\n             * @return {Function}\n             */\n            ArgFuncArgDecode: function (description, option) {\n                return option === 'JSON'\n                    ? wrapDecodeFuncArgs\n                    : returnRaw;\n            },\n\n            /**\n             * 创建回调函数序列化的处理函数\n             *\n             * @return {Function}\n             */\n            ArgFuncEncode: function () {\n                return wrapArgFunc;\n            },\n\n            /**\n             * 创建参数序列化的处理函数\n             *\n             * @param {Object} description 调用描述对象\n             * @param {string} option 处理参数\n             * @return {Function}\n             */\n            ArgEncode: function (description, option) {\n                return option === 'JSON'\n                    ? argJSONEncode\n                    : returnRaw;\n            },\n\n            /**\n             * 创建从调用描述对象中添加额外参数的处理函数\n             *\n             * @param {Object} description 调用描述对象\n             * @param {string} option 处理参数\n             * @return {Function}\n             */\n            ArgAdd: function (description, option) {\n                var argLen = description.args.length;\n\n                description.args.push({\n                    name: '_' + option,\n                    value: '*'\n                });\n\n                var value = description[option];\n                return function (args) {\n                    args[argLen] = value;\n                    return args;\n                };\n            },\n\n            /**\n             * 创建参数合并的处理函数\n             *\n             * @param {Object} description 调用描述对象\n             * @param {string} option 处理参数\n             * @return {Function}\n             */\n            ArgCombine: function (description, option) {\n                switch (option) {\n                    case 'URL':\n                        var prefix = description.scheme + '://' + description.authority + description.path;\n                        return function (args) {\n                            var result = [];\n\n                            each(description.args, function (declaration, i) {\n                                var arg = args[i];\n                                if (arg != null) {\n                                    result.push(declaration.name + '=' + encodeURIComponent(arg));\n                                }\n                            });\n\n                            var queryStr = result.join('&');\n\n                            return queryStr ? prefix + '?' + queryStr : prefix;\n                        };\n\n                    case 'Object':\n                        return function (args) {\n                            return argCombine(args, description.args);\n                        };\n\n                    case 'JSONString':\n                        return function (args) {\n                            return JSON.stringify(argCombine(args, description.args));\n                        };\n                }\n\n                return returnRaw;\n            },\n\n            /**\n             * 创建方法调用的处理函数\n             *\n             * @param {Object} description 调用描述对象\n             * @param {string} option 处理参数\n             * @return {Function}\n             */\n            CallMethod: function (description, option) {\n                var methodOwner;\n                var methodName;\n\n                function findMethod() {\n                    if (!methodOwner) {\n                        var segs = description.method.split('.');\n                        var lastIndex = segs.length - 1;\n\n                        methodName = segs[lastIndex];\n                        methodOwner = root;\n                        for (var i = 0; i < lastIndex; i++) {\n                            methodOwner = methodOwner[segs[i]];\n                        }\n                    }\n                }\n\n                return function (args) {\n                    findMethod();\n\n                    switch (description.args.length) {\n                        case 0:\n                            return methodOwner[methodName]();\n                        case 1:\n                            return methodOwner[methodName](args[0]);\n                        case 2:\n                            return methodOwner[methodName](args[0], args[1]);\n                        case 3:\n                            return methodOwner[methodName](args[0], args[1], args[2]);\n                    }\n\n                    return methodOwner[methodName].apply(methodOwner, args);\n                };\n            },\n\n            /**\n             * 创建 prompt 调用的处理函数\n             *\n             * @return {Function}\n             */\n            CallPrompt: function () {\n                return callPrompt;\n            },\n\n            /**\n             * 创建 iframe 调用的处理函数\n             *\n             * @return {Function}\n             */\n            CallIframe: function () {\n                return callIframe;\n            },\n\n            /**\n             * 创建 location 调用的处理函数\n             *\n             * @return {Function}\n             */\n            CallLocation: function () {\n                return callLocation;\n            },\n\n            /**\n             * 创建 postMessage 调用的处理函数\n             *\n             * @param {Object} description 调用描述对象\n             * @return {Function}\n             */\n            CallMessage: function (description) {\n                return function (args) {\n                    root.webkit.messageHandlers[description.handler].postMessage(args);\n                };\n            },\n\n            /**\n             * 创建对返回值进行解码的处理函数\n             *\n             * @param {Object} description 调用描述对象\n             * @param {string} option 处理参数\n             * @return {Function}\n             */\n            ReturnDecode: function (description, option) {\n                return option === 'JSON'\n                    ? returnJSONDecode\n                    : returnRaw;\n            }\n        };\n\n        var apiContainer = {\n            options: {\n                errorTitle: 'jsNative',\n                namingConflict: 'error'\n            },\n\n            apis: [],\n            apisLen: 0,\n            apiIndex: {},\n\n            /**\n             * 配置参数，设置的参数将被合并到现有参数中\n             *\n             * @param {Object} options 参数对象\n             * @param {string=} options.errorTitle 显示报错信息的标题\n             * @param {string=} options.namingConflict 名字冲突时的处理策略\n             * @return {APIContainer}\n             */\n            config: function (options) {\n                options = options || {};\n                // 再多就不能这么干了\n                this.options.errorTitle = options.errorTitle || this.options.errorTitle;\n                this.options.namingConflict = options.namingConflict || this.options.namingConflict;\n\n                return this;\n            },\n\n            /**\n             * 添加调用API\n             *\n             * @param {Object|Array} description 调用描述对象\n             * @return {APIContainer}\n             */\n            add: function (description) {\n                if (description instanceof Array) {\n                    for (var i = 0; i < description.length; i++) {\n                        this.add(description[i]);\n                    }\n                }\n                else if (typeof description === 'object') {\n                    var name = description.name;\n\n                    if (this.apiIndex[name] != null) {\n                        switch (this.options.namingConflict) {\n                            /* jshint ignore:start */\n                            case 'override':\n                                this.apis[this.apiIndex[name]] = normalizeDescription(\n                                    description, \n                                    this.descriptionPropMerger\n                                );\n\n                            case 'ignore':\n                                break;\n                            /* jshint ignore:end */\n\n                            case 'error':\n                            default:\n                                throw new Error('[' + this.options.errorTitle + '] API exists: ' + name);\n                        }\n                    }\n                    else {\n                        var realDesc = normalizeDescription(description, this.descriptionPropMerger);\n\n                        this.apiIndex[name] = this.apisLen;\n                        this.apis[this.apisLen++] = realDesc;\n                    }\n                }\n\n                return this;\n            },\n\n            /**\n             * 从一次 Native 的调用结果中添加调用API\n             *\n             * @param {Object} description 调用描述对象\n             * @return {APIContainer}\n             */\n            fromNative: function (description) {\n                return this.add(invokeDescription(normalizeDescription(description, this.descriptionPropMerger)));\n            },\n\n\n            /**\n             * 通过描述对象的 name 属性进行调用\n             *\n             * @param {string} name 调用描述对象名\n             * @param {Array=} args 调用参数\n             * @return {*}\n             */\n            invoke: function (name, args) {\n                return invokeDescription(this.apis[this.apiIndex[name]], args);\n            },\n\n            /**\n             * 生成一个对象，其上的方法是 API 容器对象中调用描述对象编译成的，可被直接调用的函数\n             *\n             * @param {Object|Function} mapAPI 调用描述对象名称的映射表或映射函数\n             * @return {Object}\n             */\n            map: function (mapAPI) {\n                mapAPI = mapAPI || function (name) {\n                    return name;\n                };\n\n                var apiObject = {};\n\n\n                for (var i = 0; i < this.apis.length; i++) {\n                    var api = this.apis[i];\n                    var apiName = mapAPIName(mapAPI, api.name);\n\n                    if (apiName && api.invoke) {\n                        if (apiName.indexOf('.') > 0) {\n                            var apiNameSegs = apiName.split('.');\n                            var j = 0;\n                            var ns = apiObject;\n\n                            for (; j < apiNameSegs.length - 1; j++) {\n                                var seg = apiNameSegs[j];\n                                \n                                ns[seg] = ns[seg] || {};\n                                ns = ns[seg];\n\n                                // 无聊留个精简写法\n                                // ns = ns[apiNameSegs[j]] = ns[apiNameSegs[j]] || {};\n                            }\n\n                            ns[apiNameSegs[j]] = buildAPIMethod(api);\n                        }\n                        else {\n                            apiObject[apiName] = buildAPIMethod(api);\n                        }\n                    }\n                }\n\n                return apiObject;\n            },\n\n            /**\n             * 通过调用描述对象进行调用\n             *\n             * @param {Object} description 调用描述对象\n             * @param {Array} args 调用参数\n             * @return {*}\n             */\n            invokeAPI: function (description, args) {\n                return invokeDescription(normalizeDescription(description, this.descriptionPropMerger), args);\n            },\n\n            /**\n             * 开发者补充processorsCreators的自定义集(TIPS:不能刷掉内置的processorCreators)\n             *\n             * @param {string} name 注册的processorCreator名称\n             * @param {Function} 需要注册的processorCreator，此函数返回值需要是一个函数\n             * @return {APIContainer}\n             */\n            addProcessorCreator: function (name, processorCreator) {\n                if (processorCreators[name]) {\n                    throw new Error('[' + this.options.errorTitle + '] processorCreators exists: ' + name);\n                }\n                processorCreators[name] = processorCreator;\n                return this;\n            },\n\n            /**\n             * 设置 description 额外的属性列表\n             * 若设置了description 额外的属性列表，不在列表中的属性将被忽略\n             * 该接口应仅用于性能优化，不应改变默认行为\n             *\n             * @param {Array.<string>} props description额外的属性列表\n             */\n            setExternalDescriptionProps: function (props) {\n                var code = '';\n\n                for (var i = 0; i < props.length; i++) {\n                    var prop = props[i];\n                    code += 'target[\"' + prop + '\"] = source[\"' + prop + '\"];';\n                }\n\n                this.descriptionPropMerger = new Function('target', 'source', code + 'return target;');\n            }\n        };\n\n        apiContainer.config(options);\n        return apiContainer;\n\n        /**\n         * 生成调用过程处理函数的列表\n         *\n         * @inner\n         * @param {Object} description 调用描述对象\n         * @return {Function[]}\n         */\n        function getProcessors(description) {\n            var processors = [];\n\n            if (!description.invoke) {\n                throw new Error('[' + apiContainer.options.errorTitle + '] invoke undefined: ' + description.name);\n            }\n\n            each(description.invoke, function (processName) {\n                var dotIndex = processName.indexOf(':');\n                var option;\n\n                if (dotIndex > 0) {\n                    option = processName.slice(dotIndex + 1);\n                    processName = processName.slice(0, dotIndex);\n                }\n\n                var processor = processorCreators[processName](description, option, apiContainer);\n                if (typeof processor === 'function') {\n                    processors.push(processor);\n                }\n            });\n\n            return processors;\n        }\n\n        /**\n         * 通过调用描述对象进行调用\n         *\n         * @inner\n         * @param {Object} description 调用描述对象\n         * @param {Array} args 调用参数\n         * @return {*} 处理完成结果\n         */\n        function invokeDescription(description, args) {\n            if (description) {\n                args = args || [];\n\n                each(getProcessors(description), function (processor) {\n                    args = processor(args);\n                });\n\n                return args;\n            }\n        }\n\n        /**\n         * 把调用描述对象编译成可被直接调用的函数\n         *\n         * @inner\n         * @param {Object} description 调用描述对象\n         * @return {Function}\n         */\n        function buildAPIMethod(description) {\n            var processors = getProcessors(description);\n\n            function process(args) {\n                each(processors, function (processor) {\n                    args = processor(args);\n                });\n\n                return args;\n            }\n\n            return function () {\n                return process(Array.prototype.slice.call(arguments, 0, description.args.length));\n            };\n        }\n    }\n\n    // export object ===========\n\n    /**\n     * 默认的 API Container 实例\n     *\n     * @type {APIContainer}\n     */\n    var jsNative = new APIContainer();\n\n    /**\n     * 版本号\n     *\n     * @type {string}\n     */\n    jsNative.version = '1.2.4';\n\n    /**\n     * 创建 API Container\n     *\n     * @param {Object=} options 创建的参数\n     * @return {APIContainer}\n     */\n    jsNative.createContainer = function (options) {\n        return new APIContainer(options);\n    };\n\n    // export ==============\n    root.jsNative = jsNative;\n\n    // for Commonjs\n    {\n        exports.jsNative = jsNative;\n    }\n\n})(\n    typeof window !== 'undefined'\n        ? window\n        : typeof commonjsGlobal !== 'undefined'\n            ? commonjsGlobal\n            : commonjsGlobal\n);\n});\nvar jsNative_1 = jsNative.jsNative;\n\n/**\n * @file 创建 API 容器\n * @author zhoudan03\n * @date 2019/6/2\n */\n\nvar apiContainer = jsNative_1.createContainer().config({\n    errorTitle: 'boxx',\n    namingConflict: 'override'\n});\n\n/**\n * @file NA 上获取 description 的接口\n * @author zhoudan03\n * @date 2019/5/27\n */\n\n\n/**\n * getAPIs 接口描述\n * @params {number=0} fragmentIndex 索引值\n * @returns {Object} res 返回值\n * @returns {String} res.totalSlices 总片段数\n * @returns {Object} res.currentIndex 当前索引\n * @returns {Object} res.descriptions 描述表数组\n */\nvar naGetAPIDesc = {\n    invoke: [\n        'ArgFuncArgDecode:JSON',\n        'ArgFuncEncode',\n        'CallMethod',\n        'ReturnDecode:JSON'\n    ],\n    name: 'na.getAPIs',\n    method: '_na.getAPIs',\n    args: [{name: 'fragmentIndex', value: 'number='}]\n};\n\n/**\n * @file invoke简称\n * @description 以下每个 invoke 都对应着一个函数处理栈，会依次对用户参数进行处理、然后拼接并用于对客户端的通信。所有的函数的实现逻辑均位于 processor.js 或 js-native 文件中。\n *\n * @author zhoudan03\n * @date 2019/5/28\n */\n\n\n/**\n * ArgFuncArgDecode:JSON     对调用参数中的所有回调函数，进行参数解码（反序列化）包装（因为回调是端上触发，传递参数通常是序列化后的 JSON 对象）\n * ArgFuncEncode:  对调用参数中的所有回调函数，进行序列化包装 。决定了是否把 func 拼接进去\n * ArgsEncodeToJSONExceptString  对于每个需要拼接在协议中的参数(除了string以外的类型)，进行JSON序列化\n * ArgCombine:URL  将参数拼接为协议\n * ArgCombine:JSONString 将参数拼接为一个 JSON 对象\n *  eg. [] ====ArgcCombine==> {} ====JSNOString====> \"{}\"\n *  eg. ['value1', 'value2'] ===> {key1:value1, key2:value2}  ===> \"{\"key1\":\"value1\",\"key2\":\"value2\"}\"\n *\n */\n\n// ArgFuncArgDecode wrapDecodeFuncArg  fixme 去掉 jsnative 回调函数的反序列化包装 。因为有二级回调函数，返回值是字符串。不能被 parse\n\nvar INVOKE_SHORTCUT = {\n    // bdboxURL 特指参数合并为 JSONString 的。参数可能通过 params 传递，也可能通过 options 传递\n    'iframe.bdboxURL': [\n        'ArgCheckWithCallback', // 校验API的参数 (包括 success 和 fail)\n        'RegisterCallbacks', // 注册一二级回调函数（用于执行 success 和 fail）\n        'ArgFuncArgDecode:JSON', // 对API参数中的回调函数的参数值进行 JSON 解码\n        'ArgFuncEncode', // 对API参数中的函数进行序列化包装（转为随机字符串并挂在全局）\n        'ArgCombineWithCallback:Object', // 将参数数组合并为用于params值的对象。透传一级回调\n        'ArgJSONString', // 对 params stringify；透传一级回调\n        'ArgCombineWithCallback:bdboxURL', // 拼协议（在协议中，注入一级回调）\n        'CheckURL', // 检查 URL 长度及特殊关键字\n        'CallIframe' // 使用 iframe 的方式发协议\n    ],\n\n    'iframe.url': [\n        'ArgCheckWithCallback', // 校验API的参数 (包括 success 和 fail)\n        'RegisterCallbacks', // 注册一二级回调函数（用于执行 success 和 fail）\n        'ArgFuncArgDecode:JSON', // 对API参数中的回调函数的参数值进行 JSON 解码\n        'ArgFuncEncode', // 对API参数中的函数进行序列化包装（转为随机字符串并挂在全局）\n        'ArgsEncodeToJSONExceptString', // 对于每个需要拼接在协议中的参数(除了string以外的类型)，进行转码。\n        'ArgCombineWithCallback:URL', // 拼协议（在协议中，注入一级回调）\n        'CheckURL', // 检查 URL 长度及特殊关键字\n        'CallIframe' // 使用 iframe 的方式发协议\n    ],\n\n    'method.args-json+callback': [\n        'ArgCheckWithCallback', // 校验API的参数 (包括 success 和 fail)\n        'RegisterCallbacks', // 注册一二级回调函数\n        'ArgCombineWithCallback:JSONString', // 8.2 之前的接口要求，JSON 类型必须通过JSON.stringify 后传入。 返回值是数组\n        'CallMethodByUserArgs:callback' // 调用安卓的 JS bridge\n    ],\n\n    'method.args-json': [\n        'ArgCheckWithCallback', // 校验API的参数 (包括 success 和 fail)\n        'RegisterCallbacks', // 没有 callback，但是也把 success 和 fail 包进去 callbacks 方便执行\n        'ArgCombineWithCallback:JSONString', // 8.2 之前的接口要求，JSON 类型必须通过JSON.stringify 后传入\n        'CallMethodByUserArgs:noCallback' // 调用安卓的 JS bridge. 不接受 callback 作为参数，响应通过函数直接返回。\n    ],\n\n    'method.bdboxURL': [\n        'ArgCheckWithCallback', // 校验API的参数 (包括 success 和 fail)\n        'RegisterCallbacks', // 注册一二级回调函数\n        'ArgFuncArgDecode:JSON', // 对API参数中的回调函数的参数值进行 JSON 解码\n        'ArgFuncEncode', // 对API参数中的函数进行序列化包装（转为随机字符串并挂在全局）\n        'ArgCombineWithCallback:Object', // 将参数数组合并为用于params值的对象。输入数组，输出对象（包括一级回调）\n        'ArgJSONString', // 对 params stringify；透传一级回调\n        'ArgCombineWithCallback:bdboxURL', // 拼协议（在协议中，注入一级回调）\n        'CheckURL', // 检查 URL 长度及特殊关键字\n        'CallMethodByUserArgs:callback' // 接受的参数为数组\n    ],\n\n    'method.url': [\n        'ArgCheckWithCallback', // 校验API的参数 (包括 success 和 fail)\n        'RegisterCallbacks', // 注册一二级回调函数（用于执行 success 和 fail）\n        'ArgFuncArgDecode:JSON', // 对API参数中的回调函数的参数值进行 JSON 解码\n        'ArgFuncEncode', // 对API参数中的函数进行序列化包装（转为随机字符串并挂在全局）\n        'ArgsEncodeToJSONExceptString', // 对于每个需要拼接在协议中的参数(除了string以外的类型)，进行转码。\n        'ArgCombineWithCallback:URL', // 拼协议（在协议中，注入一级回调）\n        'CheckURL', // 检查 URL 长度及特殊关键字\n        'CallMethodByUserArgs:callback' // 接受的参数为数组\n    ],\n\n    'method.openSwan': [\n        'ArgCheckWithCallback', // 校验API的参数 (包括 success 和 fail)\n        'RegisterCallbacks', // 注册一二级回调函数（用于执行 success 和 fail）\n        'ArgsEncodeToJSONExceptString', // 对于每个需要拼接在协议中的参数(除了string以外的类型)，进行转码。\n        'SwanSchemeCombine', // 小程序特有的拼接方式\n        'CheckURL', // 检查 URL 长度及特殊关键字\n        'CallMethodByUserArgs:callback' // 接受的参数为数组\n    ],\n\n    'iframe.openSwan': [\n        'ArgCheckWithCallback', // 校验API的参数 (包括 success 和 fail)\n        'RegisterCallbacks', // 注册一二级回调函数（用于执行 success 和 fail）\n        'ArgsEncodeToJSONExceptString', // 对于每个需要拼接在协议中的参数(除了string以外的类型)，进行转码。\n        'SwanSchemeCombine', // 小程序特有的拼接方式\n        'CheckURL', // 检查 URL 长度及特殊关键字\n        'CallIframe' // 使用 iframe 的方式发协议\n    ]\n};\n\n/**\n * @file 合并生成一份使用的 description 数组\n * @author zhoudan03\n * @date 2019/5/27\n */\n\n/**\n * 根据公参信息里的 “默认字段” 给每个description 增加默认值\n *\n * @param {Array} nativeDescriptions  na描述表\n * @param {Object} defaultsFields\n * @return {Array} 描述表\n */\nfunction addDefaultFields(nativeDescriptions, defaultsFields) {\n\n    // fixme 安卓在开关关闭时，仍然返回有一个元素的数组，导致判断失效。临时 hard code，11.3.5 @邵颖慧 修复后就删掉。\n    if (nativeDescriptions.length === 1) {\n        return [];\n    }\n\n    return nativeDescriptions.map(function (desc) {\n        for (var key in defaultsFields) {\n            if (defaultsFields.hasOwnProperty(key)) {\n                desc[key] = desc[key] || defaultsFields[key];\n            }\n        }\n\n        return desc;\n    });\n}\n\n/**\n * 删除描述表\n * 只有 name 字段时，认为是无效的描述表，需要删除，ps: 从后往前遍历删除不会影响下标\n * @param {Array} descriptions 描述表\n * @return {void}\n */\nfunction deleteDescriptions(descriptions) {\n    for (var i = descriptions.length - 1; i >= 0; i--) {\n        var keys = Object.keys(descriptions[i]);\n        if (keys.length === 1 && keys[0] === 'name') {\n            descriptions.splice(i, 1);\n        }\n    }\n}\n\n/**\n * 从客户端获取 API\n *\n * @param {Object} apiContainer 由jsNative创建的 APIContainer 实例\n * @return {Array} 返回 NA 的描述表数组\n */\nfunction getNADescriptions(apiContainer) {\n    if (typeof _na === 'undefined' || _na === null || !_na.getAPIs) {\n        debug('端描述表开关已关闭');\n        return [];\n    }\n    debug('端描述表开关已打开， 端上会注入描述表， 但如果此时同时引入了兜底描述表， 则会被兜底描述表覆盖，目前矩阵（lite、tomas、青春版）产品属于该种情况');\n    var nativeDescriptions = [];\n    var resultDescriptions = [];\n    var amendDescriptions = [];\n    var nativeSlices;\n    var defaultsFields;\n    var i = 0;\n\n    do {\n        var ref = apiContainer.invokeAPI(naGetAPIDesc, [i]);\n        var totalSlices = ref.totalSlices;\n        var descriptions = ref.descriptions;\n        var defaults = ref.defaults;\n        defaultsFields = defaults;\n        nativeSlices = totalSlices;\n        i++;\n        nativeDescriptions = nativeDescriptions.concat(descriptions);\n    } while (i < nativeSlices);\n\n    nativeDescriptions = addDefaultFields(nativeDescriptions, defaultsFields);\n\n    // 获取修复描述表，做merge\n    if (_na && _na.getAmendAPIs) {\n        var amendDescJsonStrOrArray = _na.getAmendAPIs();\n        if (amendDescJsonStrOrArray && typeof amendDescJsonStrOrArray === 'string') {\n            try {\n                amendDescriptions = JSON.parse(amendDescJsonStrOrArray);\n\n                /* istanbul ignore next */\n                if (\"production\" === 'development' || \"production\" === 'development-mock') {\n                    console.log('----------------修复描述表信息-------------------');\n                    console.log('amend descriptions:: ', amendDescriptions);\n                    console.log('-----------------------------------');\n                }\n            }\n            catch (e) {\n                /* istanbul ignore next */\n                console.error(e);\n            }\n        }\n        else if (Array.isArray(amendDescJsonStrOrArray)) {\n            amendDescriptions = amendDescJsonStrOrArray;\n        }\n        if (amendDescriptions && amendDescriptions.length > 0) {\n            var amendDesc = {};\n            amendDescriptions.forEach(function (item) {\n                amendDesc[item.name] = item;\n            });\n            // 存在云控的name，需要删除端下发的描述表\n            for (var i$1 = nativeDescriptions.length - 1; i$1 >= 0; i$1--) {\n                if (amendDesc[nativeDescriptions[i$1].name]) {\n                    nativeDescriptions.splice(i$1, 1);\n                }\n            }\n        }\n    }\n\n    resultDescriptions = nativeDescriptions.concat( amendDescriptions);\n\n    // 只有name字段，删除空的描述表\n    deleteDescriptions(resultDescriptions);\n\n    return resultDescriptions;\n}\n\n/**\n * 获取某个描述表支持的版本号\n * @param {Object} env 环境值\n * @return {string} 版本号\n */\nfunction getVersionByEnv(env, options) {\n    var appType = options.appType;\n    var adaptAppType = options.adaptAppType;\n    // 根据当前 UA 类型 boxType获取兜底描述表 env 中的配置版本\n    var version = getVersionByBoxtypeInEnv(env, appType);\n    // 优先使用兜底描述表中配置的信息\n    // 1、若配置了支持的版本，例如：'2.0'，优先使用该配置信息\n    // 2、若配置了false，表示需要裁剪掉该端能力\n    // 3、若没有配置相关信息undefined，则使用适配主线以后的版本\n    if (version || version === false) {\n        return {\n            isAdapted: false,\n            startedVersion: version\n        };\n    }\n    // 根据适配后的 UA 类型 adaptBoxType获取兜底描述表 env 中的适配版本\n    var adaptVersion = getVersionByBoxtypeInEnv(env, adaptAppType);\n    // 其次使用适配主线的版本\n    if (adaptVersion) {\n        return {\n            isAdapted: true,\n            startedVersion: adaptVersion\n        };\n    }\n    // 没有对齐主线的矩阵会走到该逻辑\n    return {\n        isAdapted: false,\n        startedVersion: INFINITYVERSION\n    };\n}\n\n/**\n * 保留 没有标注版本号的，以及 标注的起始版本号 小于当前手百版本号的\n * @param {Array} descriptions 描述表\n * @return {Array} 过滤后的描述表\n */\nfunction filterVersion(descriptions) {\n    // 为了避免全局变量被修改，这里对象的属性重命名，与全局变量名不同\n    var options = {\n        appType: boxType,\n        adaptAppType: adaptBoxType,\n        realAppVersion: realBoxVersion,\n        appVersion: boxVersion\n    };\n    return descriptions.filter(function (description) {\n        return isCapacityExisting(description, options);\n    });\n}\n\n/**\n * 获取前端预置描述表（根据版本、平台等不同，输出的描述表不同）\n *\n * @return {Array} 描述表\n */\nfunction getDefaultDescription(defaultDecs) {\n    var descriptions = isIOS ? defaultDecs.ios : defaultDecs.android;\n\n    return descriptions && descriptions.length > 0 ? filterVersion(descriptions) : [];\n}\n\n/**\n * 获取前端用于兼容的低版本预置描述表\n *\n * @return {Array} 描述表\n */\nfunction getCompatibilityDescription(defaultDecs) {\n    var descriptions = isIOS ? defaultDecs.iosCompatibility : defaultDecs.androidCompatibility;\n\n    return filterVersion(descriptions || []);\n}\n/**\n * 根据矩阵产品类型获取env中的版本配置\n */\nfunction getVersionByBoxtypeInEnv(env, boxType) {\n    return env && env[boxType] && env[boxType][boxBrowserType];\n}\n/**\n * 该端能力是存在的（根据和当前手百版本号比对而得）\n * @param {Object} description 描述表\n * @return {boolean}  true 存在，false 不存在\n */\nfunction isCapacityExisting(description, options) {\n    if ( options === void 0 ) options = {\n    appType: boxType,\n    adaptAppType: adaptBoxType,\n    realAppVersion: realBoxVersion,\n    appVersion: boxVersion\n};\n\n    // 变量命名不要与全局变量同名，否则全局变量会被修改\n    var realAppVersion = options.realAppVersion;\n    var appVersion = options.appVersion;\n    var ref = getVersionByEnv(description.env, options);\n    var isAdapted = ref.isAdapted;\n    var startedVersion = ref.startedVersion;\n    // 若兜底描述表中配置了false，则表示不支持\n    if (!startedVersion) {\n        return false;\n    }\n    // 若兜底描述表中存在配置信息，使用真实版本对比，不存在使用适配版本\n    var version = isAdapted\n        ? appVersion\n        : realAppVersion;\n    return version\n        ? versionCompare(version, startedVersion) >= 0\n        : false;\n}\n\n\n/**\n * 对描述表的字段标准化处理：invoke 从缩写 => processor 数组\n *\n * @param {Object} description 描述表\n * @return {Object} 标准化处理后的描述表\n */\nfunction normalizeDescription(description) {\n    description.invoke = INVOKE_SHORTCUT[description.invoke] || description.invoke;\n    description.path = description.path || '';\n    return description;\n}\n\nfunction getLocalDescriptions(defaultDecs) {\n    var defaultDescriptions = getDefaultDescription(defaultDecs);\n\n    // 兼容性的描述表，仅存在于前端。不参与和 NA 的 merge 策略，merge 完后直接拼接\n    var compatibilityDescriptions = getCompatibilityDescription(defaultDecs);\n\n    var mergedDefaultDescriptions = defaultDescriptions.concat(compatibilityDescriptions);\n\n    mergedDefaultDescriptions.forEach(normalizeDescription);\n\n    return mergedDefaultDescriptions;\n}\n\n/**\n * 获取端下发的描述表\n *\n * @param {Object} apiContainer 由jsNative创建的 APIContainer 实例\n * @return {Array} 最终描述表数组\n */\nfunction getDescriptions(apiContainer) {\n    var nativeDescriptions = getNADescriptions(apiContainer);\n    nativeDescriptions.forEach(normalizeDescription);\n    return nativeDescriptions;\n}\n\n/**\n * @file  回调函数处理逻辑\n * @author zhoudan03 tianty05\n * @date 2019/6/12\n */\n\n/**\n * 安卓没有返回值，调用后直接默认成功。修复这种历史遗留 bug 不会造成兼容性问题，应该修复。todo 推动 客户端 RD 排期修复\n * @return {{status: number, message: string}}\n */\nfunction returnDefaultSuccess() {\n    return {\n        status: 0,\n        message: 'success: NA 无返回信息，默认成功'\n    };\n}\n\n// 不规则的端能力返回值\n/* istanbul ignore next */\nvar irregularResponseHandlers = {\n    'feed.updateFavorInfo': returnDefaultSuccess,\n    'hybrid.reliabilityLog': returnDefaultSuccess,\n    'feed.showDislike': returnDefaultSuccess,\n    'easyBrowser.open': returnDefaultSuccess,\n\n    'account.login': function (res) {\n        if (res.data) {\n            return {\n                status: res.data.status === '1' ? 0 : 1,\n                message: res.data.status === '1' ? 'login success' : 'login fail'\n            };\n        }\n\n        return res;\n    },\n\n\n    // doc: http://cp01-invoker-3-mgt161657.epc.baidu.com:8007/invokers?id=5476cb1c319bf8d34ce2052b\n    'device.getCUID': function (res) {\n        // 处理ios手百lite和看多多下的情况\n        if (res && res.result === 0) {\n            return {\n                status: 0,\n                message: 'success',\n                data: {\n                    // eslint-disable-next-line camelcase\n                    unique_id: res.unique_id\n                }\n            };\n        }\n        // 处理安卓下低版本返回 {error: 0, result: 'xxxx'}\n        if (res && res.error === 0) {\n            return {\n                status: 0,\n                message: 'success',\n                data: {\n                    // eslint-disable-next-line camelcase\n                    unique_id: res.result\n                }\n            };\n        }\n\n        // 安卓的 getCUID 返回值是字符串。iOS 返回是对象。前端兼容对齐\n        if (isAndroid && (versionCompare(boxVersion, '7.4') >= 0 || !isMainBox)) {\n            var hasCUID = res && res.length > 0;\n            return {\n                status: hasCUID ? 0 : 1,\n                message: hasCUID ? 'success' : 'fail',\n                data: hasCUID\n                    ? {\n                        // eslint-disable-next-line camelcase\n                        unique_id: res\n                    }\n                    : {}\n            };\n        }\n\n        // 低版本的逻辑暂无法验证，取自于原 JSSDK，可与业务方确认\n        if (\n            (isAndroid && versionCompare(boxVersion, '7.4') < 0)\n            || (isIOS && versionCompare(boxVersion, '8.4') < 0)\n        ) {\n            var match = isAndroid\n                ? document.cookie.match(/BAIDUCUID=(.+?);/)\n                : UA.match(/baiduboxapp\\/.*\\/(\\w+)\\/\\d/);\n            var cuid = match ? match[1] : '';\n            return {\n                status: cuid ? 0 : 1,\n                message: cuid ? 'success' : 'fail',\n                data: cuid\n                    ? {\n                        // eslint-disable-next-line camelcase\n                        unique_id: cuid\n                    }\n                    : {}\n            };\n        }\n\n        return res;\n    },\n\n    'device.getDeviceInfo': function (res) {\n        // 此端能力的返回值很特殊，客户端难以给出枚举值。而且由于业务方只关注是 wifi 还是非 wifi，所以细节不再深究\n        //\n        // 安卓的 1_0 和 iOS 的 Wifi 代表 wifi\n        // iOS ：不同的单词代表不同的网络。（4g： WWAN）\n        // Android：不同的数字前缀代表不同的网络:\n        //    （ WIFI 1， 3GNET 21， 3GWAP 22， CMNET 31， UNINET 32， CTNET 33， CMWAP 41， UNIWAP 42， CTWAP 43 ）\n        if (res.data && res.data.netInfo && res.data.netInfo.network\n            && (res.data.netInfo.network === '1_0' || res.data.netInfo.network === 'Wifi')) {\n            res.data.networkType = 'wifi';\n        }\n        else {\n            res.data.networkType = 'unknown';\n        }\n\n        return res;\n    },\n\n    // 9.2+ 版本参数被多封装了一层（被封装在了res.data.params中），前端在此兼容。\n    'feed.getSessionClickID': function (res) {\n        return {\n            status: +res.status,\n            message: res.message || '',\n            data: (res.data && res.data.params) || res.params || {}\n        };\n    },\n\n    // 安卓多了无用的 data 值（status和 message）。前端兼容对齐\n    'easyBrowser.performanceFlowLog': function (res) {\n        if (isAndroid) {\n            return {\n                status: +res.status,\n                message: res.message || ''\n            };\n        }\n        return res;\n    },\n\n    // request iOS 做了多余的转码，导致双端返回值不一致，但是涉及到的线上业务方过多，端上无法修复。前端兼容对齐\n    'easyBrowser.request': function (res) {\n        var data;\n        if (res && res.data && res.errno === '1') {\n            data = isIOS ? JSON.parse(decodeURIComponent(res.data)) : JSON.parse(res.data);\n        }\n        else {\n            data = res.data;\n        }\n\n        return {\n            status: res.errno === '1' ? 0 : (res.errno === '0' ? 1 : parseInt(res.errno, 10)),\n            message: res.message || (res.errno === '1' ? 'success' : 'fail'),\n            data: data || {}\n        };\n    },\n    'easyBrowser.webStorage': function (res) {\n        // 解决返回值为空时格式不一致的问题\n        if (isIOS && res.result === 0) {\n            return {\n                status: 0,\n                message: res.message || res.errmsg,\n                data: res.data\n            };\n        }\n        return res;\n    },\n    // iOS 的数据多了一层 coords\n    'device.getCurrentLocation': function (res) {\n        if (isIOS) {\n            // todo 原逻辑 401\n            return {\n                status: res.result || res.status,\n                message: res.message || (res.result === 0 ? 'success' : 'fail'),\n                data: res.coords || res.data\n            };\n        }\n        else if (isAndroid) {\n            var status = res.st;\n\n            // 安卓的 st 字段用来表示状态码，没必要暴露\n            var data = res;\n            delete data.st;\n\n            return {\n                status: status,\n                message: res.message || (status === 0 ? 'success' : 'fail'),\n                data: data\n            };\n        }\n        return res;\n    },\n    // result下为最终信息，不能被过滤掉\n    'feed.isWebPSupported': function (res) {\n        if (isAndroid) {\n            res.data = res.result;\n        }\n        return res;\n    }\n};\n\n/**\n * 存储 res 中除了状态码和状态信息以外的其他属性，用作 data 的默认值。\n * @param res\n */\nfunction getDefaultData(res) {\n    var defaultData = {};\n\n    for (var key in res) {\n        if (res.hasOwnProperty(key)\n            && key !== 'errno' && key !== 'errmsg'\n            && key !== 'status' && key !== 'message'\n            && key !== 'result') {\n            defaultData[key] = res[key];\n        }\n    }\n    return defaultData;\n}\n\n/**\n * 格式化处理 response。用于兼容不同时期的协议之间响应信息的格式存在的差异。\n *\n * 返回信息标准\n * status: {number} 数字类型，0代表成功，非0代表失败\n * message: {string} 返回信息，NA 有则透传 NA，否则前端返回 success / fail\n * data: {*} 任意类型\n *\n * @param {*} response 响应信息\n * @param {string} handler 响应信息的处理标识，是 description 中的 resHandler 字段\n * @return {{status: number, message: (string), data: *}}\n * status 为0时，表示成功。其他值为失败\n */\nfunction normalizeResponse(response, handler) {\n\n    // response 为客户端返回。返回的方式有多种，可能是直接返回相应数据(number / object / array / string)\n    // 也有可能是JSON string （任何类型对应的JSON string）\n    var res;\n    try {\n        res = typeof response === 'string' ? JSON.parse(response) : response;\n    }\n    catch (e) {\n        res = response;\n    }\n\n    if (Object.keys(irregularResponseHandlers).indexOf(handler) > -1) {\n        // 不直接 return 的原因是，有双端对齐的端能力，某端符合以下规则，需要再处理\n        res = irregularResponseHandlers[handler](res);\n    }\n\n    // eslint-disable-next-line default-case\n    switch (typeof res) {\n        case 'undefined':\n            return {\n                status: 1,\n                message: 'fail: na 返回值为 undefined'\n            };\n        case 'boolean':\n            return {\n                status: res ? 0 : 1,\n                message: res ? 'success' : 'fail'\n            };\n\n        case 'number':\n            return {\n                status: res,\n                message: +res === 0 ? 'success' : 'fail'\n            };\n\n        case 'string':\n            return {\n                status: 0,\n                message: 'success',\n                data: res\n            };\n\n        case 'object': {\n            if (res === null) {\n                return {\n                    status: 1,\n                    message: 'fail: NA 返回信息为 null'\n                };\n            }\n\n            var defaultData = getDefaultData(res);\n\n            // fixme: 提取res.data作为响应数据的 data可能会有风险：老旧端能力无规范，data 只是众多响应值属性中的其中一个属性\n            if (res.errno != null) {\n                // errno 为 1 代表成功，为 0 代表失败。如果还有其他值的话，则直接赋给 status。\n                var errno = parseInt(res.errno, 10);\n                var status = errno === 1\n                    ? 0\n                    : errno === 0 ? 1 : errno;\n\n                return {\n                    status: status,\n                    message: res.errmsg || errno === 1 ? 'success' : 'fail',\n                    data: res.data || defaultData\n                };\n            }\n            else if (res.status != null) {\n                return {\n                    status: +res.status,\n                    message: res.message || (+res.status === 0 ? 'success' : 'fail'),\n                    data: res.data || defaultData\n                };\n            }\n            else if (res.result != null) {\n                return {\n                    status: res.result,\n                    message: res.result === 0 ? 'success' : 'fail',\n                    data: res.data || defaultData\n                };\n            }\n            // 直接返回的无状态码的数据\n            else {\n                return {\n                    status: 0,\n                    message: 'success',\n                    data: res\n                };\n            }\n        }\n    }\n\n    return res;\n}\n\n/**\n * @file  回调函数处理逻辑\n * @author zhoudan03\n * @date 2019/6/5\n * @description\n 一级回调相当于端能力调用是否成功，二级回调相当于异步处理一些事情 然后返回结果。\n\n 对于一个端能力而言，如果只有一级回调，则在一级回调返回后 触发开发者的 success 或者 fail。如果同时有 一级回调 和二级回调，则会在一级回调调用成功后，等待二级回调执行，二级成功再触发 开发者的 success。\n\n 对于有二级回调的情况，一级回调只是告知端能力通信是否成功，对开发者是隐藏的，不用告诉开发者。\n\n 在手百端能力中，一级回调通常叫 callback 或者 func，或者拆分为 successcallback errorcallback  failcallback\n 二级回调通常没有规范，由当时的文档或者口头约定。\n\n 【举例】\n 二级回调叫 jscallback\n baiduboxapp://v5/datachannel/register?action=com.baidu.channel.tts.statuschange&page=dataChannelDemoWeb&jscallback=__jsna_1&callback=__jsna_2\n\n 二级回调叫 cb\n baiduboxapp://v41/device/startAccelerometer?params={\"interval\":\"0.2\",\"cb\":\"cb\"}&callback=_bdbox_js_cb&upgrade=0\n\n 二级回调叫 event_callback\n baiduboxapp://v4/comment/showbox?params={\"type\":1,\"topic_id\":\"1072000001838121\",\"placeholder\":\"placeholder\",\"logid\":\"feed\",\"source\":\"feed\",\"page\":\"feed\",\"event_callback\":\"cbname\"}&callback=_bdbox_js_617\n\n 小程序里二级回调 cb 为对象 的例子：\n baiduboxapp://swanAPI/backgroundAudio/open?params={\"src\":\"http://ws.xxxq.com/M500001VfvsJ21xFqb.mp3?\",\"slaveId\":\"4\",\"title\":\"石家庄人民共和国\",\"epname\":\"此时此刻\",\"singer\":\"许巍\",\"coverImgUrl\":\"http://y.xxxphoto_new/T002R300x300M000003rsKF44GyaSk.jpg?max_age=2592000\",\"cb\":{\"onCanplay\":\"_bkAudio_onCanplay\",\"onPlay\":\"_bkAudio_onPlay\",\"onPause\":\"_bkAudio_onPause\",\"onStop\":\"_bkAudio_onStop\",\"onEnded\":\"_bkAudio_onEnded\",\"onTimeUpdate\":\"_bkAudio_onTimeUpdate\",\"onPrev\":\"_bkAudio_onPrev\",\"onNext\":\"_bkAudio_onNext\",\"onError\":\"_bkAudio_onError\",\"onWaiting\":\"_bkAudio_onWaiting\"}}&callback=_bdbox_js_66&upgrade=0\n\n\n 目前有三类二级回调\n 第一类：普通表示端能力调起成功的异步处理数据。即用即毁。\n 第二类：事件监听函数，如 event.on\n 事件监听函数需要长期保存。\n 对于开发者传递的，分为具名函数和匿名函数。匿名可以用自增函数，具名需要保存开发者的函数名，以便 off 时指定\n 第三类：点击事件，如 toast、dialog 等有按钮的，由用户触发\n\n * 端能力的返回值有多种返回方式：\n * 1. 通过一级回调，触发用户回调\n * 2. 通过二级回调，触发用户回调\n * 3. 通过 jsInterface 函数返回，触发用户回调\n *\n *\n * 对应于上述的多种返回方式，那么触发用户回调的时机应该是：\n * 1. 如果只有一级回调，则在一级回调返回后，触发开发者的 success 或者 fail\n * 2. 如果同时有 一级回调 和二级回调，则会在一级回调调用成功后，等待二级回调执行，二级成功再触发 开发者的 success；如果一级回调调用失败则直接 fail，无需等待二级回调\n * 3. 通过 jsInterface 函数返回后，使用 nextTick 延迟触发用户回调（success/fail）\n */\n\n/**\n * 用于回调函数包装命名的自增id\n *\n * @inner\n * @type {number}\n */\nvar funcId = 1;\n\n/**\n * 用于回调函数包装命名的前缀\n *\n * @inner\n * @const\n * @type {string}\n */\nvar FUNC_PREFIX = '__boxx_';\n\n/**\n * 全局注册函数\n * @param {string} name 函数名\n * @param {Function} fn 函数\n */\nvar registerGlobally = function (name, fn) {\n    global$1[name] = fn;\n};\n\n/**\n * 生成一级回调函数\n *\n * @param {string} descName   API 名称\n * @param {function} success  用户的成功回调\n * @param {function} fail     用户的失败回调\n * @param {boolean} hasNext   是否含有二级回调\n * @return {Function}\n */\nfunction generateCallback(descName, ref, hasNext) {\n    var success = ref.success;\n    var fail = ref.fail;\n\n\n    return function firstCallback(res) {\n\n        res = normalizeResponse(res, descName);\n\n        // 处理返回值（如果没二级回调，则区分成功失败执行用户回调；否则什么也不做，由二级回调来出触发用户回调）\n        if (!hasNext) {\n            if (+res.status === 0) {\n                success && success(res);\n            }\n            else {\n                fail && fail(res);\n            }\n        }\n    };\n}\n\n/**\n * 生成二级回调函数\n *\n * @param {string} descName API 名称\n * @param success  用户的成功回调\n * @param fail     用户的失败回调\n * @return {Function}\n */\nfunction generateSecondCallback(descName, ref) {\n    var success = ref.success;\n    var fail = ref.fail;\n\n    return function secondCallback(res) {\n\n        res = normalizeResponse(res, descName);\n\n        // 处理返回值（客户端的返回的状态码都是字符串）\n        if (+res.status === 0) {\n            success && success(res);\n        }\n        else {\n            fail && fail(res);\n        }\n    };\n}\n\n/**\n * 基于自增的值，获取唯一的函数变量名\n * @return {string} 函数名\n */\nfunction getUniqueName() {\n    return FUNC_PREFIX + (funcId++);\n}\n\n/**\n * @file  在下一个时间周期运行任务（参考 san）\n * @author zhoudan03\n * @date 2019/8/12\n */\n\n\n/**\n * 下一个周期要执行的任务列表\n *\n * @inner\n * @type {Array}\n */\nvar nextTasks = [];\n\n/**\n * 执行下一个周期任务的函数\n *\n * @inner\n * @type {Function}\n */\nvar nextHandler;\n\n/**\n * 浏览器是否支持原生Promise\n * 对Promise做判断，是为了禁用一些不严谨的Promise的polyfill\n *\n * @inner\n * @type {boolean}\n */\nvar isNativePromise = typeof Promise === 'function' && /native code/.test(Promise);\n\n\n/**\n * 在下一个时间周期运行任务\n *\n * @inner\n * @param {Function} fn 要运行的任务函数\n * @param {Object=} thisArg this指向对象\n */\nfunction nextTick(fn, thisArg) {\n\n    if (thisArg) {\n        fn = fn.bind(thisArg);\n    }\n\n    nextTasks.push(fn);\n\n    if (nextHandler) {\n        return;\n    }\n\n    nextHandler = function () {\n        var tasks = nextTasks.slice(0);\n        nextTasks = [];\n        nextHandler = null;\n\n        for (var i = 0, l = tasks.length; i < l; i++) {\n            tasks[i]();\n        }\n    };\n\n    // 非标准方法，但是此方法非常吻合要求。\n    if (typeof setImmediate === 'function') {\n        setImmediate(nextHandler);\n    }\n    // 用MessageChannel去做setImmediate的polyfill\n    // 原理是将新的message事件加入到原有的dom events之后\n    else if (typeof MessageChannel === 'function') {\n        var channel = new MessageChannel();\n        var port = channel.port2;\n        channel.port1.onmessage = nextHandler;\n        port.postMessage(1);\n    }\n    // for native app\n    else if (isNativePromise) {\n        Promise.resolve().then(nextHandler);\n    }\n    else {\n        setTimeout(nextHandler, 0);\n    }\n}\n\n/**\n * @file 用于注入 jsNative 的自定义 processor\n * @author zhoudan03\n * @date 2019/5/28\n */\n\nvar methodUndefinedCheckerSended = false;\n\nfunction isArray(o) {\n    return Object.prototype.toString.call(o) === '[object Array]';\n}\n\n/**\n * 返回原值的方法，调用过程的兜底处理函数\n *\n * @inner\n * @param {*} source 原值\n * @return {*}\n */\nfunction returnRaw(source) {\n    return source;\n}\n\n/**\n * 对数组进行遍历\n *\n * @inner\n * @param {Array} array 要遍历的数组\n * @param {Function} fn 遍历函数\n */\nfunction each(array, fn) {\n    var len = array && array.length || 0;\n\n    for (var i = 0, l = len; i < l; i++) {\n        if (fn(array[i], i) === false) {\n            break;\n        }\n    }\n}\n\nfunction getPrefix(scheme, description) {\n    return scheme + description.authority + description.path;\n\n}\n\n/**\n * 获取用户参数，生成形如 key1=value1&key2=value2 的 string\n *\n * @param {Object} args 用户传参\n * @param {Object} description 调用描述对象\n * @return {string}  参数字符串\n */\nfunction getArgsString(args, description) {\n    var argsString = '';\n\n    if (description.args && description.args.length > 0) {\n        var argResult = [];\n        each(description.args, function (declaration, i) {\n            var arg = args[i];\n            if (arg != null) {\n                argResult.push(declaration.name + '=' + encodeURIComponent(arg));\n            }\n        });\n        argsString = argResult.length >= 0 ? argResult.join('&') : '';\n    }\n\n    return argsString;\n}\n\n/**\n * 获取用户参数，生成形如 params=encodeURIComponent({key1:value1,key2:value}) 的 string\n *\n * @param {string} args 用户传参，已经被前一个处理器 stringify 过\n * @param {Object} description 调用描述对象\n * @return {string} 参数字符串\n */\nfunction getParamsString(args, description) {\n    // 移除args中query部分\n    if (args && Array.isArray(description.argQueryList)) {\n        var rawArgs = JSON.parse(args);\n        description.argQueryList.forEach(function (query) {\n            if (rawArgs[query]) {\n                delete rawArgs[query];\n            }\n        });\n        args = JSON.stringify(rawArgs);\n    }\n\n    var paramsName = description.paramsName || 'params';\n\n    // 描述的 args 有参数，才需要这么做。\n    return args ? (paramsName + '=' + encodeURIComponent(args)) : '';\n}\n\n/**\n * 获取 query 字符串。形如 action=flow 之类的固定值\n *\n * @param {Object} description 调用描述对象\n * @return {string} queryString\n */\nfunction getQueryString(description) {\n    var queryStr = '';\n    if (description.query) {\n        var queryStrArray = [];\n        for (var key in description.query) {\n            if (description.query.hasOwnProperty(key)) {\n                queryStrArray.push(key + '=' + description.query[key]);\n            }\n        }\n        queryStr = queryStrArray.join('&');\n    }\n    return queryStr;\n}\n\n/**\n * 获取参数中的query字符串\n * @param {string} args 用户传参，已经被前一个处理器 stringify 过\n * @param {Object} description 调用描述对象\n */\nfunction getArgQueryString(args, description) {\n    var queryArray = [];\n    if (description.argQueryList) {\n        var rawArgs = args ? JSON.parse(args) : [];\n        description.argQueryList.forEach(function (key) {\n            if (rawArgs[key]) {\n                var queryValue = (typeof rawArgs[key] === 'string') ? rawArgs[key] : JSON.stringify(rawArgs[key]);\n                queryArray.push(key + '=' + encodeURIComponent(queryValue));\n            }\n        });\n    }\n    return queryArray.join('&');\n}\n\n/**\n * 对参数值进行检查\n *\n * @inner\n * @param {*} value 值\n * @param {Object} declaration 值声明\n * @return {number}\n */\nfunction checkValue(value, declaration) {\n    declaration = normalizeValueDeclaration(declaration);\n    if (value == null) {\n        return declaration.isRequired && declaration.type !== '*' ? 1 : 0;\n    }\n\n    var valid = false;\n    switch (typeof declaration.type) {\n        case 'string':\n            switch (declaration.type) {\n                case 'string':\n                case 'boolean':\n                case 'number':\n                case 'function':\n                case 'object':\n                    valid = typeof value === declaration.type;\n                    break;\n\n                case 'Object':\n                    valid = typeof value === 'object';\n                    // console.log('value type:', typeof value, value, valid);\n                    break;\n\n                case 'Array':\n                    valid = value instanceof Array;\n                    break;\n\n                case '*':\n                    valid = true;\n                    break;\n            }\n\n            if (!valid) {\n                return 2;\n            }\n            break;\n\n        case 'object':\n            if (value && typeof value === 'object') {\n                valid = true;\n                for (var key in declaration.type) {\n                    valid = !checkValue(value[key], declaration.type[key]);\n\n                    if (!valid) {\n                        break;\n                    }\n                }\n            }\n\n            if (!valid) {\n                return 2;\n            }\n            break;\n\n        default:\n\n            if (declaration.oneOf) {\n\n                each(declaration.oneOf, function (expectValue) {\n                    valid = expectValue === value;\n                    return !valid;\n                });\n\n                if (!valid) {\n                    return 3;\n                }\n\n            }\n            else if (declaration.oneOfType) {\n\n                each(declaration.oneOfType, function (expectType) {\n                    valid = !checkValue(value, expectType);\n                    return !valid;\n                });\n\n                if (!valid) {\n                    return 4;\n                }\n\n            }\n            else if (declaration.arrayOf) {\n\n                if (value instanceof Array) {\n                    valid = true;\n                    each(value, function (item) {\n                        return (valid = !checkValue(item, declaration.arrayOf));\n                    });\n\n                    if (!valid) {\n                        return 5;\n                    }\n                }\n                else {\n                    return 2;\n                }\n\n            }\n    }\n\n    return 0;\n}\n\n/**\n * 对值声明进行标准化处理\n *\n * @inner\n * @param {Object|string} declaration 值声明\n * @return {Object}\n */\nfunction normalizeValueDeclaration(declaration) {\n    if (typeof declaration === 'string') {\n        var realDeclaration = {isRequired: true};\n\n\n        if (/=$/.test(declaration)) {\n            realDeclaration.isRequired = false;\n            declaration = declaration.slice(0, declaration.length - 1);\n        }\n\n        if (/\\[\\]$/.test(declaration)) {\n            realDeclaration.arrayOf = declaration.slice(0, declaration.length - 2);\n        }\n        else if (declaration.indexOf('|') > 0) {\n            realDeclaration.oneOfType = declaration.split('|');\n        }\n\n        // 事件类的函数\n        else if (declaration === 'eventFunction') {\n            realDeclaration.type = 'function';\n        }\n\n        else {\n            realDeclaration.type = declaration;\n        }\n\n        return realDeclaration;\n    }\n\n    return declaration;\n}\n\n/**\n * 参数检查，错误直接抛出异常\n *\n * @param {Array} args 调用参数\n * @param {Array} declarations 参数声明列表\n * @param {Object} apiContainer jsNative 容器\n */\nfunction checkArgs(args, declarations, apiContainer) {\n\n    // fixme 增加了 success 和 fail 的校验       // 在统一的地方传一个修正过的描述表\n    declarations = declarations.concat([{\n        name: 'success',\n        value: 'function='\n    }, {\n        name: 'fail',\n        value: 'function='\n    }]);\n\n    each(declarations, function (declaration, i) {\n        var errorMsg = '';\n        var value = normalizeValueDeclaration(declaration.value);\n\n        switch (checkValue(args[i], value)) {\n            case 1:\n                errorMsg = ' is required.';\n                break;\n\n            case 2:\n                // console.log('type error 2', args[i], value, declaration);\n                errorMsg = ' type error. must be ' + JSON.stringify(value.type || 'Array');\n                break;\n\n            case 3:\n                errorMsg = ' type error, must be oneOf ' + JSON.stringify(value.oneOf);\n                break;\n\n            case 4:\n                errorMsg = ' type error, must be oneOfType ' + JSON.stringify(value.oneOfType);\n                break;\n\n            case 5:\n                errorMsg = ' type error, must be arrayOf ' + JSON.stringify(value.arrayOf);\n                break;\n        }\n\n        if (errorMsg) {\n            var title = apiContainer && apiContainer.options.errorTitle || 'jsNative';\n            throw new Error('[' + title + ' Argument Error]' + declaration.name + errorMsg);\n        }\n    });\n}\n\n\n/**\n * 将调用参数合并成对象\n *\n * @inner\n * @param {Array} args 调用参数\n * @param {Array} declarations 参数声明列表\n * @return {Object}\n */\nfunction argCombine(args, declarations) {\n    var result = {};\n    each(declarations, function (declaration, i) {\n        var arg = args[i];\n        if (arg != null) {\n            result[declaration.name] = arg;\n        }\n    });\n\n    return result;\n}\n\n/**\n * 使用prompt调用\n *\n * @inner\n * @param {Array} description 描述表\n * @param {Array} args 调用参数\n * @return {Object}\n */\nfunction promptInvoker(description, args) {\n    var segments = description.method.split('.');\n    var newArgs = args || [];\n\n    // 判断是否为只含有callback的情况\n    if (!description.args || (description.args.length === 0)) {\n        newArgs = newArgs.slice(1);\n    }\n\n    var caller = {\n        obj: segments[0],\n        func: segments.slice(1).join('.'),\n        args: Array.isArray(newArgs) ? newArgs : [newArgs]\n    };\n    debug('window.prompt BdboxApp:' + JSON.stringify(caller));\n    // eslint-disable-next-line no-alert\n    return window.prompt('BdboxApp:' + JSON.stringify(caller));\n}\n\n\n/**\n * 获取用户参数，生成形如 key1=value1&key2=value2 的 string\n *\n * @param {Object} args 用户传参\n * @param {Object} description 调用描述对象\n * @param {Object} userQuery 用户参数\n * @return {string}  参数字符串\n */\nfunction getArgsStringWithUserQuery(args, description, userQuery) {\n\n    // 小程序的 query\n    var argResult = Object.keys(userQuery)\n        .map(function (key) { return (key + \"=\" + (encodeURIComponent(userQuery[key]))); });\n\n    // 协议的 query\n    if (description.args && description.args.length > 0) {\n        each(description.args, function (declaration, i) {\n            var arg = args[i];\n            if (arg != null) {\n                argResult.push(declaration.name + '=' + encodeURIComponent(arg));\n            }\n        });\n\n    }\n\n    return argResult.length >= 0 ? argResult.join('&') : '';\n}\n\n// schema 最长长度， 超过会报警， 长度规范参考这里： http://wiki.baidu.com/pages/viewpage.action?pageId=1522468568\nvar MAX_URL_LENGTH = 1024 * 15;\n\nvar processors = {\n\n    /**\n     * 自定义参数校验的处理器。校验参数的时候不完全依照描述表\n     * @param {Object} description 调用描述对象\n     * @param {string} option 处理参数\n     * @param {Object} apiContainer jsNative容器\n     * @return {Function}\n     */\n    ArgCheckWithCallback: function ArgCheckWithCallback(description, option, apiContainer) {\n        return function processorArgCheckWithCallback(args) {\n            checkArgs(args, description.args, apiContainer);\n            return args;\n        };\n    },\n\n    /**\n     * 创建参数序列化的处理函数，功能和 js-native 中的 ArgEncode 类似，都是对参数进行字符串序列化。\n     * 但是，本函数区分 string 和 object，仅对 object 做 stringify，避免字符串前后增加 双引号 \"\" ，导致客户端无法识别。\n     * 因为客户端解析 scheme 协议时，是硬编码匹配 {} 找到JSON 对象，只对其进行 JSON parse 操作。\n     * 而普通字符串，则拿来就用，不会 JSON parse，所以如果字符串在前端被 stringify 而带上了多余的双引号了的话，会导致客户端无法正确识别普通字符串。\n     *\n     * @return {Function}  返回一个函数，该接受上一个处理器的返回值作为参数\n     */\n    ArgsEncodeToJSONExceptString: function ArgsEncodeToJSONExceptString() {\n        return function processorArgsEncodeToJSONExceptString(args) {\n            each(args, function (arg, i) {\n                if (typeof arg === 'object') {\n                    args[i] = JSON.stringify(arg);\n                }\n            });\n\n            return args;\n        };\n    },\n\n    /**\n     * 注册一二级回调  （本质上，这个 processor 并没有对参数进行处理。但是由于需要区分 invoke 决定是否注册回调函数，因此放在 processor 中）\n     * 一二级回调的管理方式：使用一个对象，以 description name 为 key 记录一级回调；以一级回调的 name 为 key 记录二级回调。从而在后续端能力返回后，找到并触发对应的回调。\n     * fixme args 最后两位本来是 success 和 fail，现在变成一二级回调了，可以吗？而且 pop 是不是有点隐晦\n     *\n     * @param {Object} description 调用描述对象\n     * @return {function(*): *}\n     * @constructor\n     */\n    RegisterCallbacks: function RegisterCallbacks(description) {\n\n        var descName = description.name;\n\n        return function processorRegisterCallbacks(args) {\n\n            var fail = args.pop();\n            var success = args.pop();\n\n            // 生成二级回调（在 description 中指定了 nextCallback ，则代表有二级回调）\n            if (description.nextCallback) {\n                var nextCallback = generateSecondCallback(descName, {success: success, fail: fail});\n                var nextCallbackFuncName = getUniqueName();\n                registerGlobally(nextCallbackFuncName, nextCallback);\n                args.push(nextCallbackFuncName);\n            }\n\n            // 生成一级回调\n            var firstCallbackName = getUniqueName();\n            var firstCallback = generateCallback(description.name, {success: success, fail: fail}, !!description.nextCallback);\n\n            registerGlobally(firstCallbackName, firstCallback);\n            args.push(firstCallbackName);\n\n\n            return args;\n        };\n    },\n\n    /**\n     * 创建参数合并的处理函数\n     *\n     * @param {Object} description 调用描述对象\n     * @param {string} option 处理参数\n     * @return {Function}\n     */\n    ArgCombineWithCallback: function ArgCombineWithCallback(description, option) {\n        var scheme = appProtoName + '://';\n        switch (option) {\n            case 'bdboxURL':\n\n                return function processorArgCombineWithCallbackBdboxURL(ref) {\n                    var args = ref[0];\n                    var callbackFunctionName = ref[1];\n\n\n                    var prefix = getPrefix(scheme, description);\n                    var queryString = getQueryString(description);\n                    var argQueryString = getArgQueryString(args, description);\n                    var paramsString = getParamsString(args, description);\n\n                    var callbackString = (description.callbackName || description.callback || 'callback') + \"=\" + callbackFunctionName;\n\n                    var resultStr = [paramsString, queryString, argQueryString, callbackString]\n                        .filter(function (item) { return item !== ''; })\n                        .join('&');\n\n                    var schemeURL = prefix + '?' + resultStr;\n\n                    console.log('scheme URL::: ', schemeURL);\n\n                    return schemeURL;\n                };\n            case 'URL':\n\n                return function processorArgCombineWithCallbackURL(args) {\n                    var prefix = getPrefix(scheme, description);\n                    var queryString = getQueryString(description);\n                    var argQueryString = getArgQueryString(args, description);\n\n                    // 一级回调字符串\n                    var callbackName = description.callbackName || description.callback || 'callback';\n                    var callbackString = callbackName + '=' + args.pop();\n\n                    // 二级回调字符串\n                    var nextCallbackString = description.nextCallback\n                        ? (description.nextCallback + '=' + args.pop())\n                        : '';\n\n                    // 参数字符串\n                    var paramsString = getArgsString(args, description);\n\n                    var resultStr = [paramsString, nextCallbackString, queryString, argQueryString, callbackString]\n                        .filter(function (item) { return item !== ''; })\n                        .join('&');\n\n                    var schemeURL = prefix + '?' + resultStr;\n\n                    console.log('scheme URL::: ', schemeURL);\n\n                    return schemeURL;\n                };\n\n            case 'Object':\n                return function processorArgCombineWithCallbackObject(args) {\n\n                    var requireArgs = description.args;\n                    var callbackFunctionName = args.pop();\n\n                    if (description.nextCallback) {\n                        requireArgs = requireArgs.concat([{\n                            name: description.nextCallback,\n                            value: 'string'\n                        }]);\n                    }\n\n                    // 如果API不接受参数（而且也没二级回调），就不传递空对象。\n                    // 因为 Android 的 Java 函数传参数量决定了函数的定义(传参和不传参是两个不同的函数)。\n                    if (requireArgs.length === 0) {\n                        return [undefined, callbackFunctionName];\n                    }\n\n                    // 使用数组的方式传递 [params, callback]\n                    // 有利于手百 8.2 之前的安卓 Java jsInterface 接受参数的格式 module.action(params, callback)\n                    return [argCombine(args, requireArgs), callbackFunctionName];\n                };\n\n            case 'JSONString':\n                return function processorArgCombineWithCallbackJSONString(args) {\n\n                    var callbackFunctionName = args.pop();\n\n                    var requireArgs = description.args;\n                    if (description.nextCallback) {\n                        requireArgs = requireArgs.concat([{\n                            name: description.nextCallback,\n                            value: 'string'\n                        }]);\n                    }\n\n                    // 如果API不接受参数（而且也没二级回调），就不传递空对象。\n                    // 因为 Android 的 Java 函数传参数量决定了函数的定义(传参和不传参是两个不同的函数)。\n                    if (requireArgs.length === 0) {\n                        return [undefined, callbackFunctionName];\n                    }\n\n                    // 使用数组的方式传递 [params, callback]\n                    // 有利于手百 8.2 之前的安卓 Java jsInterface 接受参数的格式 module.action(params, callback)\n                    return [JSON.stringify(argCombine(args, requireArgs)), callbackFunctionName];\n                };\n        }\n\n        return returnRaw;\n    },\n\n\n    /**\n     *\n     * @return {function(*[]): any[]}\n     * @constructor\n     */\n    ArgJSONString: function ArgJSONString() {\n        return function processorArgJSONString(ref) {\n            var args = ref[0];\n            var callbackFunctionName = ref[1];\n\n            return [JSON.stringify(args), callbackFunctionName];\n        };\n    },\n\n    /**\n     * 创建方法调用的处理函数（根据 用户传入的args 决定调用传参，而非描述的 args长度）\n     * @param {Object} description 调用描述对象\n     * @param {string} option 处理参数\n     * @return {Function}\n     */\n    /* istanbul ignore next */\n    CallMethodByUserArgs: function CallMethodByUserArgs(description, option) {\n        var methodOwner;\n        var methodName;\n\n        function findMethod() {\n            if (!methodOwner) {\n                var segments = description.method.split('.');\n                var lastIndex = segments.length - 1;\n\n                methodName = segments[lastIndex];\n                methodOwner = global$1;\n                for (var i = 0; i < lastIndex; i++) {\n                    methodOwner = methodOwner[segments[i]];\n                }\n            }\n        }\n\n        function methodUndefinedChecker() {\n            // 只发送一次\n            if (methodUndefinedCheckerSended) {\n                return;\n            }\n            methodUndefinedCheckerSended = true;\n\n            var methodInfo = [0, 0, 0, 0];\n            if (!window.Bdbox_android_common) {\n                methodInfo[0] = 1;\n            }\n            else if (!window.Bdbox_android_common.setQuery) {\n                methodInfo[0] = 2;\n            }\n            if (!window.Bdbox_android_jsbridge) {\n                methodInfo[1] = 1;\n            }\n            else if (!window.Bdbox_android_jsbridge.dispatch) {\n                methodInfo[1] = 2;\n            }\n            // 存在 method-undefined 报错的 UA 端描述表开关是否打开\n            if (!window._na) {\n                methodInfo[2] = 1;\n            }\n            else if (!window._na.getAPIs) {\n                methodInfo[2] = 2;\n            }\n            else if (!window._na.getAPIs(0)) {\n                methodInfo[2] = 3;\n            }\n            // 存在 method-undefined 报错的 UA 是否为 chrome浏览器\n            if (window.chrome) {\n                methodInfo[3] = 1;\n            }\n            var lsStr = '';\n            try {\n                lsStr = localStorage.getItem('methodInfo') || '';\n                var lsArr = lsStr ? lsStr.split('|') : [];\n                var methodInfoStr = methodInfo.join(',');\n                if (lsArr.indexOf(methodInfoStr) === -1) {\n                    lsArr.push(methodInfoStr);\n                    lsStr = lsArr.join('|');\n                    localStorage.setItem('methodInfo', lsStr);\n                }\n            }\n            catch (err) {\n                // safari 隐私模式下 localStorage 会报错\n            }\n            var error = {\n                name: 'MethodUndefined',\n                message: 'Method undefined',\n                method: description.method,\n                info: methodInfo,\n                ls: lsStr\n            };\n            innerEvent.emit('error:method-undefined', error);\n        }\n\n        function callMethod(args) {\n            // 区分是否是数组来决定调起方式\n            findMethod();\n\n            var methodDefined = methodOwner && methodOwner[methodName];\n\n            // 这里对低版本的安卓端做特殊处理\n            // global.prompt替代method直接调用（因为低版本不支持js interface）\n            if (isAndroid && isMainBox && !methodDefined) {\n                return promptInvoker(description, args);\n            }\n\n            if (!methodDefined) {\n                methodUndefinedChecker();\n            }\n\n            // 不是数组，则直接传递\n            if (!isArray(args)) {\n                debug(description.method + '(' + JSON.stringify(args) + ')');\n                return methodOwner[methodName](args);\n            }\n\n            // params 为 undefined 证明不需要传，移除此参数。\n            // 因为安卓的 jsInterface 为 Java 函数，参数数量不同代表了不同的函数，传递了不该传的参数。会导致安卓报错找不到函数\n            if (args[0] === undefined) {\n                args.shift();\n            }\n\n            debug(description.method + '(' + JSON.stringify(args) + ')');\n            // 性能优化：对于高频的参数为0、1、2、3的情况，直接调用。减少 apply 带来的性能损失\n            switch (args.length) {\n                case 0:\n                    return methodOwner[methodName]();\n                case 1:\n                    return methodOwner[methodName](args[0]);\n                case 2:\n                    return methodOwner[methodName](args[0], args[1]);\n                case 3:\n                    return methodOwner[methodName](args[0], args[1], args[2]);\n                default:\n                    return methodOwner[methodName].apply(methodOwner, args);\n            }\n        }\n\n        switch (option) {\n            case 'callback':\n                return function processorCallMethodByUserArgsWithCallback(args) {\n                    return callMethod(args);\n                };\n            case 'noCallback':\n                return function processorCallMethodByUserArgsWithoutCallback(args) {\n                    var callback = args.pop();\n                    var res = callMethod(args);\n\n                    // 对于直接返回值的 jsInterface，需要使用 nextTick 来使得回调能异步执行\n                    nextTick(function () {\n                        global$1[callback](res);\n                    });\n                };\n            default:\n                return function processorCallMethodByUserArgsDefault(args) {\n                    return callMethod(args);\n                };\n        }\n    },\n\n    CheckURL: function CheckURL() {\n        return function processorCheckURL(url) {\n            var args = [], len$1 = arguments.length - 1;\n            while ( len$1-- > 0 ) args[ len$1 ] = arguments[ len$1 + 1 ];\n\n            try {\n                debug('schema:', url);\n                var len = url.length;\n                if (len > MAX_URL_LENGTH) {\n                    innerEvent.emit('error:url-too-long', {\n                        name: 'URLTooLong',\n                        message: 'The url is too long',\n                        length: len,\n                        url: url\n                    });\n                }\n\n                var unexpectedKeywordMatch = /(NaN|null|undefined)/.exec(url);\n                if (unexpectedKeywordMatch) {\n                    innerEvent.emit('error:url-include-unexpected-keyword', {\n                        name: 'URLError',\n                        message: 'The url include an unexpected keyword',\n                        keyword: unexpectedKeywordMatch[0],\n                        url: url\n                    });\n                }\n            }\n            catch (err) {\n                // empty\n            }\n\n            return url;\n        };\n    },\n\n    /**\n     * 创建 openSwan（打开小程序的）的参数合并的处理函数\n     *\n     * @param {Object} description 调用描述对象\n     * @return {Function}\n     */\n    SwanSchemeCombine: function SwanSchemeCombine(description) {\n        var scheme = appProtoName + '://';\n\n        return function processorSwanSchemeCombine(args) {\n            var appKey = args[0];\n            var appPath = args[1] || '';\n            // appPath 开头字符不是/\n            if (appPath.indexOf('/') !== 0) {\n                debug('xcx_path: ' + appPath + ' 必须是/开头');\n                var tailStr = appKey.substr(appKey.length - 1, 1);\n                // appKey 结尾不包含/时，appPath 开头需要补充/\n                appPath = tailStr === '/' ? appPath : '/' + appPath;\n            }\n            var query = args[2] && JSON.parse(args[2]) || {};\n\n            args[0] = undefined;\n            args[1] = undefined;\n            args[2] = undefined;\n\n\n            // 一级回调字符串\n            var callbackName = description.callbackName || description.callback || 'callback';\n            var callbackString = callbackName + '=' + args.pop();\n\n            // 二级回调字符串\n            var nextCallbackString = description.nextCallback ? (description.nextCallback + '=' + args.pop()) : '';\n\n            var prefix = scheme + description.authority + '/' + appKey + appPath;\n            var queryString = getQueryString(description);\n            var paramsString = getArgsStringWithUserQuery(args, description, query);\n\n            var resultStr = [paramsString, nextCallbackString, queryString, callbackString]\n                .filter(function (item) { return item !== ''; })\n                .join('&');\n\n            var schemeURL = prefix + '?' + resultStr;\n\n            console.log('scheme URL::: ', schemeURL);\n\n            return schemeURL;\n        };\n    }\n};\n\n/**\n * @file 用于注入 jsNative 的自定义 processor\n * @author zhoudan03\n * @date 2019/5/28\n */\n\nvar initProcessor = function (apiContainer) {\n    for (var key in processors) {\n        if (processors.hasOwnProperty(key)) {\n            try {\n                apiContainer.addProcessorCreator(key, processors[key]);\n            }\n            catch (e) {\n                // do nothing\n            }\n        }\n    }\n};\n\n/**\n* @file event.on event.off jscallback 参数重写\n*\n* 由于 event 的回调管理比较特殊，不属于即用即毁的类型，因此在此重写\n*\n* 目前端上事件通信设计的缺陷\n1. webview 刷新后，发送消息，端上仍然调用之前注册的事件，证明端上并没有在 webview 刷新后重置状态。不符合 webview 的生命周期。\n2. 目前事件通过字符串传递，导致前端和客户端需要分别管理事件，前端必须全局挂载事件供端调用，却不知道何时能移除。会导致前端内存泄露。更合理的解决办法应该是使用 jsBinding 的方式进行通信，由客户端统一 GC。\n*\n*\n* TODO 对于 callback 的长期保持需求，除了 event 以外，还有别的端能力。目前的解决方案是重写，待出现4个以上后，再进行总结及封装\n*/\n\n/**\n * 用于回调函数包装命名的自增id\n *\n * @inner\n * @type {number}\n */\nvar funcId$1 = 1;\n\n/**\n * 用于回调函数包装命名的前缀\n *\n * @inner\n * @const\n * @type {string}\n */\nvar FUNC_PREFIX$1 = '__boxx_event_';\n\nfunction guid() {\n    return FUNC_PREFIX$1 + (funcId$1++);\n}\n\nfunction wrapFunction(fn) {\n    var id = guid();\n\n    global$1[id] = function (action, data) {\n        fn(action, data);\n    };\n\n    return id;\n}\n\n/**\n * 比较用户传参的注册/反注册的事件  是否和存储的事件有同一个\n * 判断条件区分安卓和 iOS\n *\n * @param info\n * @param options\n * @return {boolean}\n */\nfunction isSameEvent(info, options) {\n    // 安卓 需要看 page 和 action 的组合\n    if (isAndroid) {\n        if (options.jscallback) {\n            return (info.page === options.page\n                && info.action === options.action\n                && info.fn === options.jscallback);\n        }\n        else {\n            return info.page === options.page\n                && info.action === options.action;\n        }\n    }\n\n    // ios 只看 action\n    else if (options.jscallback) {\n        return (info.action === options.action\n                && info.fn === options.jscallback);\n    }\n    else {\n        return info.action === options.action;\n    }\n}\n\nvar fnContainer = [];\n\n\nfunction hasNoReference(fn) {\n    return !fnContainer.some(function (item) {\n        return fn === item.fn;\n    });\n}\n\n/**\n * event.on/event.off jscallback 参数处理\n *\n * @param {String} type\n * @param {Object} options\n * @returns {Object}\n */\n// eslint-disable-next-line max-statements\nfunction eventParamsFilter(type, options) {\n    if (type === 'event.on') {\n        var fn = options.jscallback;\n        if (typeof fn === 'string') {\n            return options;\n        }\n        var fnString;\n\n        var isUniqueEvent = true;\n        var isUniqueFunction = true;\n\n        // 允许重复注册。遍历找下有没有一样的。\n        var eventItem;\n        var len = fnContainer.length;\n        while (len--) {\n            eventItem = fnContainer[len];\n\n            // 完全相同：重复注册，无需 push。\n            if (isSameEvent(eventItem, options)) {\n                fnString = eventItem.fnString;\n                isUniqueFunction = false;\n                isUniqueEvent = false;\n                break;\n            }\n            // 有同样的函数，则使用同名的\n            else if (eventItem.fn === options.jscallback) {\n                fnString = eventItem.fnString;\n                isUniqueFunction = false;\n                isUniqueEvent = true;\n                break;\n            }\n        }\n\n        if (isUniqueFunction) {\n            fnString = wrapFunction(options.jscallback);\n        }\n\n        if (isUniqueEvent) {\n            fnContainer.push({\n                page: options.page,\n                action: options.action,\n                fn: options.jscallback,\n                fnString: fnString\n            });\n        }\n\n        var rawArgs = {\n            page: options.page,\n            action: options.action,\n            jscallback: fnString,\n            rnmsg: options.rnmsg,\n            allowDuplicate: options.allowDuplicate\n        };\n\n        options.success && (rawArgs.success = options.success);\n        options.fail && (rawArgs.fail = options.fail);\n\n        return rawArgs;\n    }\n    else if (type === 'event.off') {\n        var fn$1 = options.jscallback;\n\n        if (!fn$1 || (typeof fn$1 === 'string')) {\n            return options;\n        }\n\n        var isExistentEvent = false;\n        var len$1 = fnContainer.length;\n        while (len$1--) {\n            var eventInfo = fnContainer[len$1];\n\n            if (isSameEvent(eventInfo, options)) {\n                fnContainer.splice(len$1, 1);\n\n                // 判断下整个数组， 如果没有别的函数引用，就从 全局对象 上移除该 function\n                if (hasNoReference(eventInfo.fn)) {\n                    delete global$1[eventInfo.fnString];\n                }\n\n                var rawArgs$1 = {\n                    page: options.page,\n                    action: options.action,\n                    rnmsg: options.rnmsg,\n                    jscallback: eventInfo.fnString\n                };\n\n                options.success && (rawArgs$1.success = options.success);\n                options.fail && (rawArgs$1.fail = options.fail);\n\n                isExistentEvent = true;\n                return rawArgs$1;\n            }\n        }\n\n        if (!isExistentEvent) {\n            // fixme 对于不在 on 的列表内的事件，拦截了 off ，该逻辑设计可与业务方商榷\n            console.error('error：尝试移除一个未被注册的事件函数');\n\n            nextTick(function () {\n                options.fail && options.fail({\n                    status: 1,\n                    message: 'removes a function that has not be registered'\n                });\n            });\n\n            delete options.jscallback;\n            return options;\n        }\n    }\n    return options;\n}\n\n/**\n * @file  入参处理逻辑\n * @author zhoudan03 tianyu05\n * @date 2019/6/12\n * @description\n */\n\nvar irregularParamsHandlers = {\n    'search.setQuery': function (params, descName) {\n        var authority = apiContainer.apis[apiContainer.apiIndex[descName]].authority;\n        // 安卓高版本由jsInterface方法修正为searchframe方式，且需要history为布尔类型\n        if (isAndroid && authority === 'searchframe') {\n            params.history = Boolean(params.history);\n            params = {\n                searchType: JSON.stringify(params)\n            };\n        }\n        // ios要求history为数值类型\n        else if (isIOS) {\n            params.history = Number(params.history);\n        }\n        return params;\n    },\n    // 低版本端能力，未对外暴露，转化新版端能力的参数\n    'account.openLoginDialog': function (params) {\n        // eslint-disable-next-line camelcase\n        params.third_login = params.showThirdLogin;\n        // eslint-disable-next-line camelcase\n        params.login_type = params.loginType;\n        return params;\n    },\n    'app.feedback': function (params) {\n        // 在安卓端，该端能力默认值为2\n        if (isAndroid) {\n            params.type = params.type || '2';\n        }\n        return params;\n    },\n\n    'easyBrowser.request': function (params) {\n        params.header = params.header || {};\n        params.data = params.data || {};\n\n        if (isAndroid) {\n            params.header = JSON.stringify(params.header);\n            params.data = JSON.stringify(params.data);\n            return params;\n        }\n        return params;\n    },\n\n    'commonUI.showToastOld': function (params) {\n        params = params || {};\n        params.string = params.message;\n        return params;\n    },\n\n    // todo 确认这个逻辑存在的必要性。旧版本  onPerformanceFlowEvent 端能力在安卓必须传参 min_v\n    'easyBrowser.onPerformanceFlowEvent': function (params) {\n        if (isAndroid) {\n            // eslint-disable-next-line camelcase\n            params.min_v = '16789504';\n        }\n        return params;\n    },\n\n    'easyBrowser.openHybrid': function (params) {\n        params = params || {};\n        params.type = 'Hybrid';\n        params.backup && params.backup.url && (params.backup.url = encodeURIComponent(params.backup.url));\n        return params;\n    },\n\n    // todo 使用低版本手百 校验 低版本的打开 hybrid 的历史逻辑。\n    'easyBrowser.openHybridOld': function (params) {\n        params = params || {};\n\n        if (isAndroid) {\n            var backupURL = params.backup && params.backup.url || '';\n            var toolTIDs = params.style && params.style.toolbaricons && params.style.toolbaricons.tids || '';\n            var intent = [\n                'S.backup=' + JSON.stringify({url: encodeURIComponent(backupURL)}),\n                'component=com.baidu.searchbox/.home.feed.FeedDetailActivity',\n                'S.toolbaricons=' + encodeURIComponent(JSON.stringify({toolids: toolTIDs})),\n                'S.menumode=' + (params.menumode || '')\n            ].join(';');\n            return {\n                intent: 'intent:#Intent;' + intent + ';end',\n                // eslint-disable-next-line camelcase\n                min_v: params.min_v || '16783629',\n                mode: '0'\n            };\n        }\n\n        // 历史逻辑\n        // 1. 和 url 字段。（不删有影响吗？）\n        // 2. tids 要是没值，就不传 toolbar  （传了有影响吗？）\n        // 3. 如果传了轻应用appid，那默认置 isla 为1 （让用户传就好了）\n        else if (isIOS) {\n            var toolTIDs$1 = params.style && params.style.toolbaricons && params.style.toolbaricons.tids || '';\n            params.toolbar = JSON.stringify({toolids: toolTIDs$1});\n\n            params.type = 'Hybrid';\n            params.openurl = encodeURIComponent(params.url);\n            params.isla =  params.isla;\n            params.minver = '5.3.0.0';\n            params.opentype = 1;\n            params.append = 0;\n            params.rbtnstyle = 2;\n\n            // 历史逻辑:  style 字段所有元素都需要散在外面; 删除掉 style 字段。（散在外面，不会覆盖掉外层的值吗？todo 确认此举意义）\n            if (params.style && typeof params.style === 'object') {\n                var style = params.style;\n                for (var key in style) {\n                    if (style.hasOwnProperty(key)) {\n                        params[key] = style[key];\n                    }\n                }\n                delete params.style;\n            }\n            return params;\n        }\n        return params;\n    },\n\n    // 此端能力会用于 getNetworkType API 的低版本支持\n    'device.getDeviceInfo': function (params) {\n        params.keys = params.keys || ['netInfo', 'screenInfo'];\n\n        return params;\n    },\n\n    'event.on': function (params) {\n        params = eventParamsFilter('event.on', params);\n        if (params.action === 'globalSettingChange') {\n            // 判断有无_Box_对象，没有则注入进去\n            /* eslint-disable no-underscore-dangle */\n            /* istanbul ignore next */\n            if (!window._Box_) {\n                /* istanbul ignore next */\n                window._Box_ = {};\n            }\n            /* istanbul ignore next */\n            if (!window._Box_.event) {\n                /* istanbul ignore next */\n                window._Box_.event = {};\n            }\n            /* istanbul ignore next */\n            if (!window._Box_.event.broadcast) {\n                /* istanbul ignore next */\n                window._Box_.event.broadcast = broadcast;\n            }\n            /* eslint-enable no-underscore-dangle */\n            window._Box_.event.broadcast.on(\n                params.action,\n                params.jscallback ? window[params.jscallback] : function () {/* empty */}\n            );\n        }\n        return params;\n    },\n    'event.off': function (params) {\n        if (params.action === 'globalSettingChange' && window._Box_) {\n            delete window._Box_;\n        }\n        params = eventParamsFilter('event.off', params);\n        return params;\n    }\n};\n\n/**\n * 格式化处理 params用于兼容不同时期的协议之间响应信息的格式存在的差异。\n *\n * @param {Object} params 入参信息\n * @param {string} handler 响应信息的处理标识（使用的是 descName 标识）\n * @return {Object} 处理后的参数\n */\nfunction normalizeParams(params, handler) {\n\n    if (Object.keys(irregularParamsHandlers).indexOf(handler) > -1) {\n        return irregularParamsHandlers[handler](params, handler);\n    }\n\n    return params;\n}\n\n/**\n * @file 初始化挂载所有 API\n * @author zhoudan03\n * @date 2019/6/1\n */\n\n/**\n * 从用户参数中，获取 用于传递给 jsNative 的，与 args 顺序一一对应的参数值的数组 （jsNative接受的是数组。）\n * {\n *     key1: value1,\n *     key2: value2,\n *     success(){},\n *     fail(){}\n * }\n *\n * =>  [value1, value2, success, fail]\n * =>  [undefined, value2, undefined]\n * fixme, 用户参数没有的 但描述表的时候  保证数组长度一致性 . 而不应该返回空数组\n *\n * @param {Object} userArgs 用户参数对象\n * @param {Array} descArgs 描述表中要求的参数数组\n * @return {Array} 用户参数值数组\n */\nfunction getParamsArray(userArgs, descArgs) {\n    var params = [];\n\n    // fixme success 和 fail 作为 args 传入。能否有统一的修正描述表的地方\n    var requireArgs = descArgs.concat([\n        {name: 'success', value: 'function='},\n        {name: 'fail', value: 'function='}\n    ]);\n\n    if (userArgs && requireArgs.length > 0) {\n        params = requireArgs.map(function (arg) {\n            return userArgs[arg.name];\n        });\n    }\n\n    return params;\n}\n\n/**\n * 调起对应端能力\n */\nfunction getInvoker(apiContainer, descName, userArgs, descArgs, event, needThrowError) {\n    // 内部有报错直接透传给外部， 使得业务可以拿到错误信息\n    // 这个主要针对非 throw 的错误消息， 同时会补充对应的 api 及 stack 信息\n    function innerErrorHandle(eventName, error) {\n        error.api = descName;\n        /* istanbul ignore else */\n        if (!error.stack) {\n            var tmpError = new Error(\n                error.message\n                /* istanbul ignore next */\n                || '[Invoke Error]'\n            );\n            error.stack = tmpError.stack;\n        }\n\n        addEnvInfo(error);\n\n        // 某些事件需要延迟触发\n        if (error.needDelayEmit) {\n            error.delayEmitCallback = function () {\n                delete error.needDelayEmit;\n                delete error.delayEmitCallback;\n                event.emit(eventName, error);\n            };\n            return;\n        }\n\n        event.emit(eventName, error);\n    }\n\n    try {\n        // 抛出调用事件，统计调用量\n        event.emit('invoke:start', addEnvInfo({\n            api: descName,\n            args: userArgs\n        }));\n\n        // 处理双端入参有diff情况\n        var normalizedUserArgs = normalizeParams(userArgs, descName);\n        var params = getParamsArray(normalizedUserArgs, descArgs);\n\n        innerEvent.on('error:*', innerErrorHandle);\n        apiContainer.invoke(descName, params);\n        innerEvent.off('error:*', innerErrorHandle);\n    }\n    catch (error) {\n        innerEvent.off('error:*', innerErrorHandle);\n        var newError = error;\n        var eventName = 'unknown';\n        var errorMessage = error.message || '';\n\n        if (/^\\[.+? Argument Error\\]/.test(errorMessage)) {\n            eventName = 'arg-invalid';\n            var argName = errorMessage.split(']')[1].split(' ')[0];\n            newError = {\n                name: 'ArgInvalidError',\n                message: errorMessage,\n                stack: error.stack,\n                arg: argName\n            };\n        }\n\n        // newError 是 number string 等基本类型时， 添加字段会报错\n        try {\n            newError.api = descName;\n        }\n        catch (err) {\n            // empty\n        }\n\n        addEnvInfo(newError);\n\n        event.emit((\"error:\" + eventName), newError);\n\n        if (needThrowError) {\n            throw error;\n        }\n    }\n}\n\n/**\n * 获取 api 对应的处理函数\n *\n * @param {Object} apiContainer jsNative容器\n * @param {Object} desc 描述表\n * @return {Function} 开发者调用 一个具体的 API 的处理函数。\n *         Function.params {Object} userArgs  该函数接受的参数 userArgs 为用户参数\n */\nvar generateCallApi = function (apiContainer, event) {\n    return function (descName, userArgs) {\n        debug('搜索禁止使用 call 方法调用端能力，请先判断canIuse之后使用语义化 api 调用');\n        var index = apiContainer.apiIndex[descName];\n        if (index === undefined) {\n            var message = '暂不支持 API: [' + descName + ']';\n            var error = new Error(message);\n            // 用户调用之前未判断canIUse，则抛出异常\n            event.emit('error:api-missed', addEnvInfo({\n                name: 'APIMissedError',\n                api: descName,\n                message: message,\n                stack: error.stack\n            }));\n            return;\n        }\n\n        var desc = apiContainer.apis[index];\n        getInvoker(apiContainer, descName, userArgs, desc.args, event, false);\n    };\n};\n\n// 根据描述表名称，生成不同的通信逻辑 ( \"a.b.c\" => boxx.a.b.c)\nvar getSingleInvoker = function (apiContainer, desc, event) {\n    return function (userArgs) {\n        getInvoker(apiContainer, desc.name, userArgs, desc.args, event, true);\n    };\n};\n\n/**\n * 根据描述表名称，生成不同的通信逻辑 ( \"a.b.c\" => boxx.a.b.c)\n *\n * @param {Object} boxx API容器\n * @param {Object} apiContainer jsNative容器\n * @param {string} apiName api名称\n * @param {string} desc 描述表\n */\nfunction generateSingleAPI(boxx, apiContainer, apiName, desc, event) {\n    if (apiName.indexOf('.') > 0) {\n        var apiNameSegments = apiName.split('.');\n        var methodOwner = boxx;\n        var i = 0;\n        var len = apiNameSegments.length - 1;\n        for (; i < len; i++) {\n            var segment = apiNameSegments[i];\n            methodOwner[segment] = methodOwner[segment] || {};\n            methodOwner = methodOwner[segment];\n        }\n        methodOwner[apiNameSegments[i]] = getSingleInvoker(apiContainer, desc, event);\n    }\n    else {\n        boxx[apiName] = getSingleInvoker(apiContainer, desc, event);\n    }\n}\n\n/**\n * 初始化每个端能力 API\n */\nvar initAPIs = function (boxx, apiContainer, event) {\n    var apis = apiContainer.apis;\n    // 生成描述表对应的 api\n    for (var i = 0, len = apis.length; i < len; i++) {\n        var desc = apis[i];\n        var apiName = desc.name;\n        if (apiName && desc.invoke) {\n            generateSingleAPI(boxx, apiContainer, desc.name, desc, event);\n        }\n    }\n};\n\n/**\n * @file  生成 canIUse API\n * @author zhoudan03\n * @date 2019/8/9\n */\n\nfunction generateCanIUse(apiContainer) {\n\n    /**\n     * canIUse 函数，用于判断 API 是否存在，允许两种写法：boxx.canIUse('ABTest.getSidList') 或 boxx.canIUse('boxx.ABTest.getSidList')\n     *\n     * @param {string} apiName  api名称字符串\n     * @param {boolean} apiSwitch  api开关，如小程序降级开关\n     * @return {boolean} true 代表存在，false 不代表不存在\n     */\n    return function canIUse(apiName, apiSwitch) {\n        if (arguments.length === 2 && !apiSwitch) {\n            return false;\n        }\n        return apiContainer.apiIndex[apiName] > -1;\n    };\n}\n\n/**\n * @file 重定向 API 以在低版本手百上 映射 API 到低版本端能力 ， 同时删除低版本的暴露\n * @author zhoudan03\n * @date 2019/8/9\n */\n\n// key 为对外输出的 API 名称，同时也是高版本存在的端能力的 name\n// value 为具有同样功能的低版本端能力，仅对内作为低版本兼容手段，不对外暴露\nvar compatibleMap = {\n    'account.login': 'account.openLoginDialog',\n    'album.image.open': 'album.image.openOld',\n    'commonUI.closeLoading': 'commonUI.closeLoadingOld',\n    'commonUI.showToast': 'commonUI.showToastOld',\n    'easyBrowser.openHybrid': 'easyBrowser.openHybridOld',\n    'easyBrowser.performanceFlowLog': 'easyBrowser.onPerformanceFlowEvent',\n    'device.getNetworkType': 'device.getDeviceInfo'\n};\n\n/**\n * 获取函数名称\n * @param {Object} boxx API容器\n * @param {string} apiName 比如 album.image.open\n * @return {Object} 返回对象的原因是避免 如 album.image.open 在js执行过程中，会被找引用关系，找不到会报错。\n * 因此传递 album.image 和 open 用于执行时再对 open 赋值\n */\nfunction getFunctionName(boxx, apiName) {\n    if (apiName.indexOf('.') > 0) {\n        var apiNameSegments = apiName.split('.');\n        var methodOwner = boxx;\n\n        var i = 0;\n        var len = apiNameSegments.length - 1;\n        for (; i < len; i++) {\n            var segment = apiNameSegments[i];\n\n            methodOwner[segment] = methodOwner[segment] || {};\n            methodOwner = methodOwner[segment];\n        }\n\n        return {\n            methodOwner: methodOwner,\n            methodName: apiNameSegments[i]\n        };\n    }\n    else {\n        return {\n            methodOwner: boxx,\n            methodName: apiName\n        };\n    }\n}\n\n/**\n * 将低版本 API 函数引用挂载到高版本的 API 名称上，以在低版本上能使用旧端能力达到同样的功能支持。\n * 同时删除低版本 API 的引用，不对外暴露\n * @param {Object} boxx API容器\n */\nfunction beCompatibleWithLowVersion(boxx) {\n    for (var key in compatibleMap) {\n        if (compatibleMap.hasOwnProperty(key)) {\n            // 如果不支持高版本，且支持低版本，则做个映射\n            if (!boxx.canIUse(key) && boxx.canIUse(compatibleMap[key])) {\n                var newAPIObj = getFunctionName(boxx, key);\n                var oldAPIObj = getFunctionName(boxx, compatibleMap[key]);\n\n                newAPIObj.methodOwner[newAPIObj.methodName] = oldAPIObj.methodOwner[oldAPIObj.methodName];\n\n                delete oldAPIObj.methodOwner[oldAPIObj.methodName];\n            }\n            // 如果支持高版本，则直接删除低版本端能力\n            else if (boxx.canIUse(key) && boxx.canIUse(compatibleMap[key])) {\n                var oldAPIObj$1 = getFunctionName(boxx, compatibleMap[key]);\n                delete oldAPIObj$1.methodOwner[oldAPIObj$1.methodName];\n            }\n        }\n    }\n}\n\n/**\n * @file  封装 addAPI 方法，允许用户添加描述表生成描述表\n * @author zhoudan03\n * @date 2019/9/20\n */\n\n/**\n * 添加用户的描述表\n *\n * @param {Object} boxx api容器\n * @param {Object} apiContainer jsNative容器\n * @param {Object} description 描述表\n */\nfunction add(apiContainer, description) {\n\n    if (!isCapacityExisting(description)) {\n        return;\n    }\n\n    normalizeDescription(description);\n\n    if (!description.invoke) {\n        throw Error('[boxx] ' + description.name + ': must specify right invoke type in description');\n    }\n\n    apiContainer.add(description);\n}\n\n/**\n * 引入兜底描述表方法\n * @param {*} descriptions 兜底描述表\n */\nfunction setDefaultDescription(descriptions) {\n    if (descriptions && Object.keys(descriptions).length > 0) {\n        var descriptionsList = getLocalDescriptions(descriptions);\n        for (var i = 0; i < descriptionsList.length; i++) {\n            add(apiContainer, descriptionsList[i]);\n        }\n    }\n\n    // 语义化 api 处理\n    initAPIs(this, apiContainer, event);\n    // 重定向特殊 API\n    beCompatibleWithLowVersion(this);\n}\n\n/**\n * @file 主模块和所有子模块的入口文件，用于生成boxx单例\n * @author chenqi14\n * @data 2019/10/08\n */\n/**\n * init boxx\n *\n * @returns {object} boxx\n */\nfunction addApi() {\n    var boxx = {};\n    // 挂载环境变量\n    boxx.env = env;\n    boxx.canIUse = generateCanIUse(apiContainer);\n    boxx.call = generateCallApi(apiContainer, event);\n    boxx.setDefaultDescription = setDefaultDescription.bind(boxx);\n    boxx.on = event.on;\n    boxx.off = event.off;\n    boxx.once = event.once;\n    boxx.setDebug = setDebug;\n    return boxx;\n}\n\n/**\n * 注入兜底描述表并初始化\n *\n * @param {object} boxx\n */\nfunction addDefaultdDescription(boxx) {\n    var defaultDescriptions = {};\n    try {\n        defaultDescriptions = document\n        && document.querySelectorAll('[data-for=boxx-description]')\n        && document.querySelectorAll('[data-for=boxx-description]')[0]\n        && document.querySelectorAll('[data-for=boxx-description]')[0].innerHTML\n        && JSON.parse(document.querySelectorAll('[data-for=boxx-description]')[0].innerHTML)\n        || {};\n        if (Object.keys(defaultDescriptions).length > 0) {\n            isHitLocDesc(true);\n        }\n        else {\n            isHitLocDesc(false);\n        }\n    }\n    catch (error) {\n        defaultDescriptions = {};\n        console.error(error);\n    }\n    boxx.setDefaultDescription(defaultDescriptions);\n}\n\n/**\n * create boxx\n *\n * @returns {object} boxx instance\n */\nfunction createBox() {\n    initProcessor(apiContainer);\n    // 厂商浏览器描述表，需要对描述表的字段标准化处理\n    browserDescriptionList.forEach(normalizeDescription);\n    // 若当前环境支持厂商浏览器，则使用browserDescriptionList，否则使用端描述表\n    var descriptionsList = isSupportSwanInBrowser\n        ? browserDescriptionList\n        : getDescriptions(apiContainer);\n    apiContainer.add(descriptionsList);\n\n    var boxx = addApi();\n    addDefaultdDescription(boxx);\n\n    return boxx;\n}\n\n/**\n * @file boxx 手百端能力js库 入口文件\n * @author lihuanyu01\n * @date 2021/5/25\n */\n\n\n// 给 jsNative 注入兜底描述表\nvar boxx = createBox();\n\nexport default boxx;\n"]}]}