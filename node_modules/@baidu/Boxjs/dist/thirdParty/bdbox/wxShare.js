
var $ = require('@baidu/Boxjs/dist/utils/_bdboxWrapper')
/* jshint -W033 */
var defaultConfig = {
    image: '',
    url: location.href,
    content: '',
    title: ''
};
/**
 * 分享到微信
 * @memberOf Bdbox
 * @namespace Bdbox.wxShare
 * @param  {Object} shareConfig 分享对象image/url/content/title/callback/readyCallback
 */
return function(shareConfig) {
    var config = {};
    for (var i in defaultConfig) {
        config[i] = shareConfig[i] ? shareConfig[i] : defaultConfig[i];
    }
    var wxJSBridge = window.WeixinJSBridge;
    var doc = document;

    if (wxJSBridge && $.isObject(wxJSBridge) && $.isFunction(wxJSBridge.invoke)) {
        invokeShare();
    } else {
        doc.addEventListener ? doc.addEventListener('WeixinJSBridgeReady', invokeShare, !1) : doc.attachEvent && (doc.attachEvent('WeixinJSBridgeReady', invokeShare), doc.attachEvent('onWeixinJSBridgeReady', invokeShare))
    }

    var cb = function() {
        if ($.isFunction(config.callback)) {
            try {

                config.callback();
            } catch (e) {}
        }
    };

    function invokeShare() {
        try {
            WeixinJSBridge.on('menu:share:timeline', function() {
                WeixinJSBridge.invoke('shareTimeline', {
                    img_url: config.image,
                    img_width: 55,
                    img_height: 55,
                    link: $.isFunction(config.url) ? config.url(1) : config.url,
                    desc: config.content,
                    title: config.title
                }, cb)
            });
            /android/i.test(navigator.userAgent) ? WeixinJSBridge.on('menu:share:weibo', function() {
                WeixinJSBridge.invoke('shareWeibo', {
                    url: $.isFunction(config.url) ? config.url(2) : config.url,
                    content: config.title + ':' + config.content
                }, cb)
            }) : WeixinJSBridge.on('menu:share:weibo', function() {
                WeixinJSBridge.invoke('shareWeibo', {
                    img_url: config.image,
                    img_width: 55,
                    img_height: 55,
                    link: $.isFunction(config.url) ? config.url(2) : config.url,
                    desc: config.content,
                    title: config.title
                }, cb)
            });
            WeixinJSBridge.on('menu:share:appmessage', function() {
                WeixinJSBridge.invoke('sendAppMessage', {
                    img_url: config.image,
                    img_width: 55,
                    img_height: 55,
                    link: $.isFunction(config.url) ? config.url(3) : config.url,
                    desc: config.content,
                    title: config.title
                }, cb)
            });
            $.isFunction(config.readycallback) && config.readycallback();
        } catch (b) {}
    }
}
