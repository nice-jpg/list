
var $ = require('@baidu/Boxjs/dist/utils/_bdboxWrapper')
/* eslint-disable */
/**
 * ios调起新接口板，因为需要创建iframe，所以回调是异步的请求
 * @memberOf Bdbox.ios
 * @function
 * @name invoke
 * @param {String} schema schema协议，比如`baiduboxappv5`
 * @param  {String}   action   调用的action，例如`downloadnovel`
 * @param  {Object}   params   参数对象
 * @param  {Function} callback 回调函数
 * @version $Id: invoke.js 286585 2016-03-15 11:57:15Z wangyongqing01 $
 */
return function(schema, action, params, callback) {
    if (!action || !$.$isBox() || !schema) {
        return;
    }

    var url = [];
    if ($.isFunction(params)) {
        callback = params;
    } else {
        for (var i in params) {
            url.push(i + '=' + params[i]);
        }
    }
    if ($.isFunction(callback)) {
        var funcName = '_bdbox_js_' + $.getId();
        window[funcName] = function() {
            callback.apply(window, ([]).slice.call(arguments, 0));
            /*delete window[funcName];*/
        };
        url.push('func=' + funcName);
    } else {
        if (callback) {
            url.push('func=' + callback);
        }

    }
    url = schema + '://' + action + '?' + url.join('&');
    var id = '_bdbox_ios_jsbridge';
    var $node = $.byId(id);
    if ($node) {
        $node.src = url;
    } else {
        $node = document.createElement('iframe');
        $node.style.display = 'none';
        $node.id = id;
        $node.src = url;
        (document.body || document.getElementsByTagName('body')[0]).appendChild($node);
    }
};
