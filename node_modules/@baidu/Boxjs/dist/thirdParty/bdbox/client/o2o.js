
var $ = require('@baidu/Boxjs/dist/utils/_bdboxWrapper')
/* eslint-disable */
/**
 * 调起o2o框架，支持轻应用（直达号）调起
 * @memberOf Bdbox.client
 * @name o2o
 * @param  {string} url 调起的url
 * @param  {object} opt 调起的参数
 * @return {object}     Bdbox
 *
 * @author wangyongqing01
 * @version $Id: o2o.js 289534 2016-04-07 06:00:51Z yupeng07 $
 *
 * @example
 * ```js
 * //例如：调起o2o打开百度首页
 * Box.o2o('http://m.baidu.com', {color:'0000ff'});
 * //调起o2o框架，打开首页，并且指定顶框黑条颜色改变成0000ff(16进制颜色值)
 * Box.o2o('http://m.baidu.com', {color:'0000ff'});
 * //调起直达号
 * Bdbox.client.o2o('http://m.baidu.com', {appid:xxxx})
 * ```
 */
var andInvoke = require('../android/invokeApp');
var iosInvoke = require('../ios/invokeApp');
var encode = encodeURIComponent;
var each = require('../each');

var o2o = $.$isAndroid() ? function o2o(url, opt) {
    //android
    if ($.isObject(url)) {
        opt = url;
        url = url.url;
        delete opt.url;
    }
    var intent = [
        'S.bdsb_light_start_url=' + encode(url)
    ];

    if ($.isObject(opt)) {
        //android intent中不能传递不认参数，不然会报错,因为他们只是透传 intent,没有处理，所以要把多于参数去掉。
        ////2016.04.07
        var min_v = opt.min_v;
        delete opt.min_v;
        var alias = {
            color: 'i.extra_actionbar_color_id',
            appid: 'S.bdsb_wallet_appid'
        };
        each(opt, function(value, key) {
            if (key === 'color') {
                value = parseInt('0x' + value) | 0xff000000;
            }
            key = alias[key] || key;
            intent.push(key + '=' + value);
        });
    }
    intent = intent.join(';');
    var params = {
        intent: 'intent:#Intent;' + intent + ';end',
        min_v: min_v && min_v != '' ? min_v : '16783629',
        mode: '0'
    };
    //android需要统计各种O2O打开时长，扩展了几个O2O 框架，需要传component参数来区分，以及版本信息，参数不能向下兼容。
    //当参数存在component时，不设置class,因为端需要做统计使用的class不一样，为了统一以后都只传 component参数就OK。为了兼容之前的代码如果为空时class保持不变。
    //2016.04.07
    if(!opt || !opt.component || opt.component == ''){
        params.class = 'com.baidu.searchbox.wallet.WalletServiceActivity'
    }
    andInvoke('Bdbox_android_utils', 'command', [JSON.stringify(params)]);
} : function(url, opt) {
    //ios
    if ($.isObject(url)) {
        opt = url;
        url = url.url;
        delete opt.url;
    }
    var obj = {
        openurl: encode(url),
        minver: '5.3.0.0',
        isla: 0,
        opentype: 1,
        append: 0,
        rbtnstyle: 2
    };
    if ($.isObject(opt)) {
        var alias = {
            color: 'barcolor'
        }
        each(opt, function(value, key) {
            key = alias[key] || key;
            obj[key] = value;
        });
    }
    if (obj.appid) {
        obj.isla = 1;
    }
    iosInvoke('easybrowse', obj);
}

return o2o;
