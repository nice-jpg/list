
var $ = require('@baidu/Boxjs/dist/utils/_bdboxWrapper')
/* eslint-disable */
/**
 * @file 调起框小说；
 * @memberOf Bdbox.client
 * @name invokeNovel
 *
 */
var getVersion = require('../utils/getVersion')
var versionCompare = require('../utils/version_compare')
var iosInvokeApp = require('../ios/invokeApp')
var androidInvokeApp = require('../android/invokeApp')
var invokeNovel = {}

/**
 * 扩展对象
 * @param  {Object} defaultOpts [原始对象]
 * @param  {Object} opts        [目标对象]
 * @return {Object}             [返回扩展后的对象]
 */
function extendOptions (defaultOpts, opts) {
  for (var attr in defaultOpts) {
    if (!opts.hasOwnProperty(attr)) {
      opts[attr] = defaultOpts[attr]
    }
  }
  return opts
}
// 判断是否在框内
if ($.$isBox()) {
    // 判断是ios系统还是安卓系统
  if ($.$isIOS()) {
        // 调起小说阅读器
    var openNovel = function () {
      if (versionCompare(getVersion(), '5.4.5') >= 0) {
        iosInvokeApp('novel', {
          minver: '5.4.5'
        })
      }
    }
        // 调起排行旁、分类等二级页面
    var openSubpage = function (options) {
      if (versionCompare(getVersion(), '5.4.5') >= 0) {
        var schemaurl = 'baiduboxapp://novel?action=openSubPage&param=' + encodeURIComponent(JSON.stringify(options)) + '&minver=5.4.5.0'
        $.schema(schemaurl, function (isTimeout) {})
      }
    }

        // 调起小说详情页
    var openDetail = function (options) {
      var opts = JSON.stringify(options)
      try {
        iosInvokeApp('novel', {
          action: 'openSubPage',
          param: encodeURIComponent(opts),
          minver: '5.4.5'
        })
      } catch (e) {}
    }
  } else {
        // 安卓调起小说阅读器
    var openNovel = function () {
      if (versionCompare(getVersion(), '6.3') >= 0) {
        var intent = '#Intent;component=com.baidu.searchbox/.discovery.novel.'
                + 'NovelHomeActivity;S.invoke_fragment=DiscoveryNovelHomeFragment;end'
        androidInvokeApp('Bdbox_android_send_intent', 'send', intent)
      }
    }

        /**
         * [调起小说排行榜、分类等二级页面]
         * @param {Object} options 需要用到的参数
         */
    var openSubpage = function (options) {
      if (versionCompare(getVersion(), '5.0') >= 0) {
        androidInvokeApp('Bdbox_android_novel', 'openSubPage', [JSON.stringify(options)])
      }
    }

        /**
         * 调起小说详情页
         * @param {Object} options 调起框小说详情页面
         */
    var openDetail = function (options) {
      var opts = JSON.stringify(options)
      androidInvokeApp('Bdbox_android_novel', 'openSubPage', [opts])
    }
  }
}

invokeNovel.openNovel = openNovel
invokeNovel.openSubpage = function (type, options) {
  if (!type) {
    return
  }
  if (options.type) {
    delete options.type
  }
  if (type == 'category' || type == 'rank') {
    delete options.args
  }
  var url = 'http://m.baidu.com/searchbox?action=novel&type=' + type
  var defaultOpts = {
    title: encodeURIComponent('排行榜'),
    url: url,
    method: 'post',
    needParams: '1',
    pagetype: 1,
    args: ''
  }
  if (options) {
    options = extendOptions(defaultOpts, options)
  } else {
    options = defaultOpts
  }
  if ($.isFunction(openSubpage)) {
    openSubpage(options)
  }
}

invokeNovel.openDetail = function (src, params) {
  var url = 'http://m.baidu.com/searchbox?action=novel&type=detail'
  var options = {
    title: '书籍详情',
    url: url + '&src=' + src,
    method: 'post',
    needParams: '1',
    pagetype: 1,
    args: 'data=' + JSON.stringify(params.args)
  }
  if ($.isFunction(openDetail)) {
    openDetail(options)
  }
}

invokeNovel.test = function (string) {
  Bdbox.ios.invokeApp('search', {'word': 'test', 'minver': '3.8.0.0'}, '')
}

return invokeNovel

