
var $ = require('@baidu/Boxjs/dist/utils/_bdboxWrapper')
/* eslint-disable */
/**
 * 获取cuid；
 * 手百android6.5+才提供，低版本的安卓从cookie获取的加密的cuid，ios直接从userAgent获取
 * @memberOf Bdbox.client
 * @name getCuid
 * @example:
 * Bdbox.client.getCuid();
 *
 * @version: $Id: getCuid.js 286585 2016-03-15 11:57:15Z wangyongqing01 $
 */
var getVersion = require('../utils/getVersion'),
    version_compare = require('../utils/version_compare'),
    A_NAMESPACE = 'Bdbox_android_utils',
    android_invokeApp = require('../android/invokeApp'),
    ios_invokeApp = require('../ios/invokeApp');

var self = function(callback) {
    var cuid;
    if ($.$isIOS()) {
        if (($.$isBox() && version_compare(getVersion(), '8.4') > 0) || $.$isLiteBox()) {
            ios_invokeApp('utils', {
                action: 'getCUID'
            }, function(data) {
                try {
                    // 非加密
                    cuid = JSON.parse(data).unique_id;
                } catch (e) {}
                callback && callback(cuid);
            });
            return;
        }
        var reg = /baiduboxapp\/.*\/(\w+)\/\d/,
            ua = navigator.userAgent,
            list = ua.match(reg);
        // 非加密
        cuid = list ? list[1] : '';
    } else {
        if (($.$isBox() && version_compare(getVersion(), '6.5') >= 0) || $.$isLiteBox()) {
            // 非加密
            cuid = android_invokeApp(A_NAMESPACE, 'getcuid').result;
        } else {
            // 加密
            var match = document.cookie.match(/BAIDUCUID=(.+?);/);
            cuid = match ? match[1] : '';
        }
    }
    callback && callback(cuid);
    return cuid;
};
return self;
