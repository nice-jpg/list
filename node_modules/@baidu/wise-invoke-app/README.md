
# wise-invoke-app
通用调起组件使用场景

## 安装
`npm --registry=http://registry.npm.baidu-int.com i @baidu/wise-invoke-app`

## 发布
`npm run publish-alpha` 发布tag(alpha)测试包,@baidu/wise-invoke-app@x.y.z-tag.k,x.y.z表示基于的正式版本,k表示当前的tag版本
`npm run publish-apmjs` 发布正式包

## API
### IvkAppCreator
`IvkAppCreator`对外暴露mcp调起构造器，业务方根据场景传入策略信息来创建调起实例，实现设置公参、拉取策略信息、判断退场状态、执行调起等api。
注意：页面初始化构造器时，需调用构造器上setCommonParams设置公参（具体字段参考demo以及询问rd），方便打点参数使用。

#### IvkAppCreator参数
| 参数    |是否必须 | 类型 | 说明 | 默认值|
| :----:     | :----: | :----: | :----: | :----: |
| pos |   是   | string | 调起策略位 |-|
| opt |   是   | array | 调起参数（mcp返回） |具体字段详见下方[opt参数](http://wiki.baidu.com/pages/viewpage.action?pageId=1062729699)|
| logId | 是  | string | 打点日志id |-|
| index | 否  | number | 要判断的物料索引，默认设为第一位，不用传 |0|

##### **`opt`某物料配置参数**
| 参数 | 类型 | 说明 | 默认值|
| :----:     | :----: | :----: | :----: | :----: |
| sid | string | 命中的小流量sid sid 或者 "all" |  |-|
| action_flag | number |  1:直接调起 2:走新增 0:不处理 |  |-|
| app_name |  string | 被调端名字 | -|
| scheme | string | 被调端和落地页相关scheme |-|
| jump_id | number | 失败后处理方式，1:failedUrl 2:应用商店 3:不处理 |-|
| jump_url | string | 失败后的url |-|
| channel_conf | string | 包含调起新增剪贴板渠道号 等统计信息 |-|
| display_desc | string | 前端策略控制字段 |-|
| ext | string | 自定义字段，可用于打点透传 |-|
| combined | string | 对象中是一份完整配置，用于组合调起 |-|
| token | string | 用于复制粘贴板token |-|
| click_interval | number | 对象中是一份完整配置，用于组合调起 |-|

#### demo示例
```js
import {IvkAppCreator} from '@baidu/wise-invoke-app';
const mcpObj = {
    log_id: "3892222819",
    action_rule: {
        pos_3: [{
            sid: "145752",
            action_flag: 1,
            app_name: "baiduboxapp",
            scheme: "baiduboxapp://common?action=easybrowse&toolbaricons=%7B%22toolids%22%3A%5B%224%22%2C%221%22%2C%222%22%2C%223%22%5D%7D&menumode=2&minver=7.2.5.0&params=%7B%22opentype%22%3A%221%22%2C%22tpl_id%22%3A%22landing_app.html%22%2C%22context%22%3A%22%257b%2522nid%2522%253a%2522news_9988804847645579397%2522%257d%22%2C+%22newbrowser%22%3A%221%22%2C%22type%22%3A%22Hybrid%22%2C+%22sfrom%22%3A%22feed%22%2C+%22ch_url%22%3A%22https%253A%252F%252Fmbd.baidu.com%252Fnewspage%252Fdata%252Flandingreact%253FpageType%253D2%2526nid%253Dnews_9988804847645579397%2526select_title%253D1%2526sid%253D%22%2C+%22slog%22%3Anull%2C+%22commentInfo%22%3A%7B%22topic_id%22%3A%221033000029840940%22%2C%22opentype%22%3A%222%22%7D%7D&logargs=%7B%22source%22%3A%221023908x%22%2C%22channel%22%3A%221023908z%22%7D",
            jump_url: "",
            jump_id: "",
            channel_conf: {"from":"1023908x","channel":"1023908z"},
            token: "^T#mNcT4D1f^",
            display_desc: "",
            ext: "",
            combined: null,
            click_interval: 480
        }]
    }
};
const pos = 'pos_3';
const logId = mcpObj['log_id'];
const opt = mcpObj['action_rule'][pos];
const index = 0;
// 创建构造器
const creator = new IvkAppCreator();
// 设置公参
creator.setCommonParams({
    app: 'wise',
    scene: 'sharepage'
});

const options = {
    pos,
    opt,
    logId,
    index
};
// 初始化一个mcp调起实例
const ivkMcpInst = creator.create(options);
// 该pos是否走mcp策略
const hitMcp = ivkMcpInst.hitMcp();
// 该pos是否走屏蔽策略
const hitActionFlag = ivkMcpInst.getActionFlag();
// 获取该pos退场状态
const extInfo = ivkMcpInst.getExitInfo();
// 执行pos调起
ivkMcpInst.execInvoke();
// 执行pos调起并支持回调获取调起状态
ivkMcpInst.execInvoke({
        sucCb:(msg) => {
            // doSomething
        },
        failCb:(msg) => {
            // doSomething
        }
    }
);
```
---