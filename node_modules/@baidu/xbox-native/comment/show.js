/**
 * @file 调起评论面板
 * @module comment
 * @author wangyongqing <wangyongqing01@baidu.com>
 */
import {isBox, isAndroid, version_compare, getBoxVersion} from '../detect';
import {isPlainObject} from '../utils';
import {prompt} from '../android';
import {invokeApp} from '../ios';
import {COMMAND_NOT_EXIST} from '../const';

import stringify from '../stringify';
const version = getBoxVersion();
const isLiteOrInfo = isBox('lite') || isBox('info') || isBox('mission');
/**
 * 显示评论面板
 * @function show
 * @param {object} params - 显示评论面板参数对象，data 部分
 * @return {Promise}
 */
export default params => {
    if ((isBox() && version_compare(version, '8.0') >= 0) || isLiteOrInfo) {
        if (params && isPlainObject(params)) {
            if (version_compare(version, '8.2') < 0 || isLiteOrInfo) {
                delete params.rename;
            }
            if (version_compare(version, '8.5') < 0 || isLiteOrInfo) {
                delete params.placeholder;
            }
            if (isAndroid()) {
                prompt('Bdbox_android_comment', 'showCommentBox', [stringify(params), '']);
            } else {
                invokeApp(
                    'comment',
                    {
                        action: 'showCommentBox',
                        params: stringify(params, true),
                        minver: '8.0.0.0'
                    },
                    ''
                );
            }
            return Promise.resolve();
        }
    }
    return Promise.reject(COMMAND_NOT_EXIST);
};
