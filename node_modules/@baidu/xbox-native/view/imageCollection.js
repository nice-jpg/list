/**
 * @module view
 * @file 打开图集落地页
 * @author wangyongqing <wangyongqing01@baidu.com>
 */
import {isBox, isAndroid, isMatrix} from '../detect';
import stringify from '../stringify';
import invoke from '../ios/index';
import {command} from '../android/index';
/**
 * 打开图集落地页
 * @function imageCollection
 * @param {string} nid - nid
 * @param {string} [from="feed"] - 来源
 * @return {Promise}
 */
export default (nid, from = 'feed') => {
    if (isBox() || isMatrix()) {
        const toolids = stringify({toolids: ['4', '1', '2', '3']}, true);
        let cmd = '';
        if (isAndroid()) {
            const intent = [
                `intent:#Intent;S.toolbaricons=${toolids}`,
                'S.menumode=2',
                'launchFlags=0x10000000',
                'component=com.baidu.searchbox/.discovery.picture.PictureBrowseActivity',
                'S.context=' + stringify({nid}, true),
                'S.sfrom=' + from,
                'end'
            ].join(';');
            /* eslint-disable max-len */
            command(intent, 0, 'com.baidu.searchbox.discovery.picture.PictureBrowseActivity', isMatrix('baiduboxvision') ? '1' : '16789248');
            return Promise.resolve();
            /* eslint-enable max-len */
        } else {
            cmd = [
                'baiduboxapp://common?action=imagecollection&params='
                + stringify({context: {nid}, sfrom: from}, true),
                'minver=7.2.5.0',
                'toolbaricons=' + toolids,
                'menumode=2'
            ].join('&');
            invoke(cmd);
            return Promise.resolve();
        }
    }
    return Promise.reject({
        errCode: 902,
        errMsg: '手百外无法调用端能力'
    });
};
