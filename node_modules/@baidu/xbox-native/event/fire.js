/**
 * @file fire
 * @author panming
 * @date 2019-01-25 20:05:12
 */

import register from '../register';
import {fire, paramsFilter} from './index';
// import {isPlainObject} from '@baidu/xbox/is';
import {invokeP} from '../invoke';
import {isMatrix} from '../detect';

register('datachannel/sendbroadcast', {
    v: 5,
    versionRange: ['8.4'],
    iosinfoVersionRange: ['1.3'],
    androidliteVersionRange: ['2.2.0.10'],
    filter: function (data) {
        return {
            data: paramsFilter(data)
        };
    }
});

export default params => {
    if (isMatrix('baiduboxvision')) {
        const invokeParams = paramsFilter(params, false);
        return invokeP('v5/datachannel/sendbroadcast', {
            ...invokeParams,
            data: invokeParams.data && invokeParams.data.data
        });
    }
    return fire(params);
};
