/**
 * @file on
 * @author panming
 * @date 2019-01-25 20:16:16
 */

import register from '../register';
import {on, paramsFilter} from './index';
// import {isPlainObject} from '@baidu/xbox/is';
import invoke from '../invoke';
import {isMatrix} from '../detect';
import {json2query} from '@baidu/xbox';

register('datachannel/register', {
    v: 5,
    versionRange: ['8.4'],
    hasCB: false,
    iosinfoVersionRange: ['1.3.1.10'],
    androidliteVersionRange: ['2.2.0.10'],
    iosmissionVersionRange: ['1.0'],
    androidmissionVersionRange: ['1.0'],
    filter: data => {
        return {
            data: paramsFilter(data)
        };
    }
});

export default params => {
    if (isMatrix('baiduboxvision')) {
        const invokeParams = paramsFilter(params, false);
        if (invokeParams.data) {
            Object.assign(invokeParams, invokeParams.data);
            delete invokeParams.data;
        }

        invoke(`baiduboxapp://v5/datachannel/register?${json2query({
            ...invokeParams
        })}`);
        return Promise.resolve();
    }
    return on(params);
};
