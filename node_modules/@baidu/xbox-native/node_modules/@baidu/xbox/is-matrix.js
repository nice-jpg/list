/**
 * @file 判断是不是矩阵app，符合新的规范，规范地址：
 * @link http://agroup.baidu.com/share/md/0d6d1cc6b1c7417e8071057fb436001b
 * @author wangyongqing <wangyongqing01@baidu.com>
 */
import UA from './ua';
/**
 * 是否是手百矩阵产品，需要符合新的ua规范
 * @function isMatrix
 * @param {''|'youjia'} [subName=''] - 手百矩阵产品标识
 * @param {string} ua - 传入的 userAgent，如果不传则取 navigator.userAgent
 * @return { boolean} 是否是手百判断结果
 * @example
 * isMatrix()
 * isMatrix('youjia')
 * isMatrix('youjia', 'fdafafdafaf pro baiduboxapp')
 */
export default (subName = '', ua = UA) => {
    if (subName === 'main') {
        subName = '';
    }
    const matrixUaExp = /\bbdapp\/\d+\.\d+\s+\((\w+);\s*(\w+)\)/;
    /**
     * Android示例	Mozilla/5.0 (.83 Mobile Safari/537.36 T7/11.16 light/1.0 bdapp/1.0 (youjia; youjia) youjia/1.0.1 (Baidu; P1 8.0.0)
     *  na 网络：Dalvik/2.1.0 (Linux; U; Android 8.0.0; MHA-AL00 Build/HUAWEIMHA-AL00) okhttp/3.11.0 bdapp/1.0 (youjia; youjia) youjia/1.0.1 (Baidu; P1 8.0.0)
        iOS示例	Mozilla/5.0 (iPhone; C.1.15 (KHTML, like Gecko) Mobile/15E148 main/1.0 SP-engine/2.14.0 NABar/1.0 bdapp/1.0 (youjia; youjia) youjia/1.0.1 (Baidu; P2 13.3)
        na网络：Mozilla/5.0 (iPho5.1.15 (KHTML, like Gecko) Mobile/15E148 youjia/1.0.1 (Baidu; P2 13.3)
     */
    if (subName === '') {
        let m = /\s(lite|pro|info|mission)\sbaiduboxapp\//.exec(ua);
        if (m) {
            return true;
        }
        // 只判断bdapp/1.0
        if (/\bbdapp\/\d+\.\d+\s/.test(ua)) {
            return true;
        }
    } else if (subName === false) {
        // 这里判断是新的matrix格式，即youjia这类，不包含lite info这类
        let m = ua.match(matrixUaExp);
        if (m && m[1]) {
            return true;
        }
    } else {
        // TODO 判断老的
        if (new RegExp(new RegExp(`\\s${subName}\\sbaiduboxapp\/`)).test(ua)) {
            return true;
        }
        let m = ua.match(matrixUaExp);
        if (m && m[1] && m[1] === subName) {
            return true;
        }
    }

    return false;
};
