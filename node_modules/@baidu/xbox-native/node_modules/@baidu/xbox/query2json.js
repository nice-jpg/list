/**
 * @file 对传入url query 部分转成json格式
 * @author wangyongqing <wangyongqing01@baidu.com>
 */
import decode from './decode-uri-component';
/**
 * 对传入url query 部分转成json格式
 * @function query2json
 * @param {string} url  - 待处理的url
 * @param {boolean} [safe = true]- 是否启用安全 decode 模式，默认 true
 * @return {Object} obj - 返回处理后的json
 */
export default (url, safe = true) => {
    const locse = url.split('?');

    const search = locse[1] ? locse[1] : locse[0];
    const pairs = search.split('&');
    const result = {};
    pairs.forEach(pair => {
        pair = pair.split('=');
        if (pair[0].length > 0) {
            let resultPair = '';
            try {
                resultPair = (safe ? decode(pair[1]) : decodeURIComponent(pair[1])) || '';
            } catch (e) {
                console.log(e);
            }
            result[pair[0]] = resultPair;
        }
    });
    return result;
};
