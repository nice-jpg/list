/**
 * @file 通过端能力获取头像数据
 * @module account
 * @author panming
 */

import {invokeP} from '../invoke';
import stringify from '../stringify';
import {COMMAND_NOT_EXIST} from '../const';
import {version_compare as versionCompare, getBoxVersion, isIOS, isAndroid, isMaybeBox} from '../detect';

/**
 * @function modify
 * @param {object} options - 调起参数，{avatarCallback: xxx}
 * @param {number} upgrade - 低版本是否强制升级，默认是**强制**
 * @return {Promise} promise - Promise
 * 获取当前登录用户头像（仅iOS支持)
 * http://wiki.baidu.com/pages/viewpage.action?pageId=258969081
 */
export default (options, upgrade = 1) => {
    const version = getBoxVersion();
    if (isIOS() && versionCompare(version, 9.2) >= 0
        || isMaybeBox('info,baiduboxvision')
        || (isAndroid() && versionCompare(version, 11.0) >= 0)) {
        return invokeP('v13/account/profile/getAvatar', {
            params: stringify(options, true),
            upgrade
        });
    }
    return Promise.reject(COMMAND_NOT_EXIST);
};
