/**
 * @file 打开 profileShowMore 界面
 * @module account
 * @author panming <panming@baidu.com>
 */

import {invokeP} from '../invoke';
import {version_compare, getBoxVersion, isMaybeBox} from '../detect';
import stringify from '../stringify';
import type from '@baidu/xbox/type';
import {COMMAND_NOT_EXIST} from '../const';
import json2query from '@baidu/xbox/json2query';
import {isIOS} from '@baidu/xbox/os';
/**
 * @function profileShowMore
 * @param {object} options - 调起参数，{uk:xxx}
 * @param {number} upgrade - 低版本是否强制升级，默认是**强制**
 * @param {Boolean} reScheme - 返回拼好的scheme
 * @return {Promise} promise - Promise
 */
export default (options, upgrade = 1) => {
    const version = getBoxVersion();
    if (version_compare(version, '9.0') >= 0 || isMaybeBox('lite,info,mission,baiduboxvision')) {
        const callback = options.showmoreCallback || options.callback;
        delete options.callback;
        let data = {
            params: stringify(options, true),
            upgrade,
            callback: callback
        };
        if (version_compare(version, 9.2) >= 0 || (isMaybeBox('info,mission,baiduboxvision') && isIOS())) {
            options.showmoreCallback = callback;
            delete data.callback;
            data.params = stringify(options, true);
        }

        if (options && options.reScheme && type(options) === 'object') {
            delete options.reScheme;
            return `baiduboxapp://v9/account/profile/showmore?${json2query(data)}`;
        }
        return invokeP('v9/account/profile/showmore', data);
    }
    return Promise.reject(COMMAND_NOT_EXIST);
};