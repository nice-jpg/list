/**
 * @file 获取远端信息
 * @author zhangsiyuan(zhangsiyuan@baidu.com)
 */

import {request} from '../request/Fly';
import {getCommonParams} from './commonParams';
import {host} from '../config/requestUrl';
// 内部的调起配置
// 存起来给模板标记调用
export let invokeConf = {};

/**
 * 获取策略配置信息
 *
 * @param {Object} invokeConfig 调起id等配置
 * @param {Object} selectIndex 调起id增量顺序
 * @param {string} url 请求地址, 默认不传
 *
 * @returns {Promise<*>}
 */
export async function getInvokeInfo(invokeConfig = {}, selectIndex = {}, url) {
    const {app, scene, ...rest} = getCommonParams();
    // 请求数据体
    /* eslint-disable */
    let data = {app, scene, ...rest, ...invokeConfig, select_index: selectIndex};
    /* eslint-enable */

    try {
        const requestUrl = url || `${host}/mcp/${app}/${scene}`;
        let res = await request.post(requestUrl, data, {
            headers: {
                'Content-Type': 'text/plain'
            }
        });

        if (res.data.errno === 0) {
            return res.data.data;
        }
    }
    catch (e) {
        console.log(e);
        // todo 请求失败 打点
        // todo 请求异常，怎么返回给业务方？
    }
}




