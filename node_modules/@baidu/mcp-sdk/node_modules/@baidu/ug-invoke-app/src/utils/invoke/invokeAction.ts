/**
 * @file schema 调起
 * @author zhuzhibo <zhuzhibo@baidu.com>
 * @author zsy
 */
import {notMatchedIframe} from '../../config/rules/invokeTypeRules';
import {getHostInfo} from '../detect/getHostInfo';
import {AppName} from '../../config/app/appConfigMap';

/**
 *
 * invokeAction包含了
 * 直接使用location = scheme
 * 和iframe两种方式
 *
 */
export function invokeAction(scheme: string, appName: AppName) {
    const {browser} = getHostInfo();
    // 注意这里的appName，如果以后有规则匹配
    // 要去确认下!!!会不会影响单独的api  invokeMarket!!!
    if (notMatchedIframe(browser, appName)) {
        console.warn('调起方式为：window.top.location.href');
        window.top.location.href = scheme;
        return;
    }
    // 其余一律走iframe调起
    console.warn('调起方式为：iframe');
    let node = document.createElement('iframe');
    node.style.display = 'none';
    node.src = scheme;
    const body = document.body;
    body.appendChild(node);
    // 销毁 iframe
    setTimeout(() => {
        body.removeChild(node);
        // @ts-ignore
        node = null;
    }, 0);
}
