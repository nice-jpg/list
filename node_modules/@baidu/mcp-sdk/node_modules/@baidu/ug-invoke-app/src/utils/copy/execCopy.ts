import {copyText} from './copyText';
import {invokeNaCopy} from './naCopy';
import {Status} from '../../config/Status';
import {InnerInvokeConfig} from '../../api/invokeApp';
import {sendH5ErrLog} from '../log/errorLog';

export async function execCopy(options: InnerInvokeConfig) {
    try {
        await copyText(options.token);
    }
    catch (e) {
        // 手百端内  可以试试  端能力写剪贴板
        let naCopyRes = false;
        if (options.browser === 'baiduboxapp') {
            try {
                await invokeNaCopy(options.token);
                naCopyRes = true;
            }
            catch (err) {
                // todo  考虑上报吗？
                console.log(err);
            }
        }
        // 复制失败以后
        if (!naCopyRes) {
            sendH5ErrLog(options, Status.COPY_FAILED);
            // 打开这个选项的，直接中断调起流程，返回错误
            if (options.checkTokenCopied) {
                return Promise.reject(Status.COPY_FAILED);
            }
        }
    }
}
