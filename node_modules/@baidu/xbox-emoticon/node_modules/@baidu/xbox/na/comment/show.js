/**
 * @file 调起评论面板
 * @module comment
 * @author wangyongqing <wangyongqing01@baidu.com>
 */
import version_compare from '../../version_compare';
import getBoxVersion from '../../get-box-version';
import isMatrix from '../../is-matrix';
import stringify from '../../stringify';
import {isPlainObject} from '../../is';
import {isBox, isAndroid} from '../../browser/detect';
import {prompt} from '../android';
import {invokeApp} from '../ios';
import {COMMAND_NOT_EXIST} from '../const';

const version = getBoxVersion();
const isLiteOrInfo = isMatrix();

/**
 * 显示评论面板
 * @function show
 * @param {Object} params - 显示评论面板参数对象，data 部分
 * @return {Promise}
 */
export default params => {
    if ((isBox() && version_compare(version, '8.0') >= 0) || isLiteOrInfo) {
        if (params && isPlainObject(params)) {
            if (version_compare(version, '8.2') < 0 || isLiteOrInfo) {
                delete params.rename;
            }
            if (version_compare(version, '8.5') < 0 || isLiteOrInfo) {
                delete params.placeholder;
            }
            if (isAndroid()) {
                prompt('Bdbox_android_comment', 'showCommentBox', [stringify(params), '']);
            } else {
                invokeApp(
                    'comment',
                    {
                        action: 'showCommentBox',
                        params: stringify(params, true),
                        minver: '8.0.0.0'
                    },
                    '',
                    'baiduboxapp'
                );
            }
            return Promise.resolve();
        }
    }
    return Promise.reject(COMMAND_NOT_EXIST);
};
