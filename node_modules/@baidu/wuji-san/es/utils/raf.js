/**
 * @file raf, caf - requestAnimationFrame, cancelAnimationFrame polyfill
 * @author baozhixin <baozhixin@baidu.com>
 */

let root = typeof window === 'undefined' ? global : window;

let requestAnimationFrame = root.requestAnimationFrame || root.webkitRequestAnimationFrame;
let cancelAnimationFrame = root.cancelAnimationFrame || root.webkitCancelAnimationFrame;

if (!requestAnimationFrame) {
    const fps = 60; // 设置为60帧
    const everyTime = 1000 / fps;
    let lastTime = 0;

    requestAnimationFrame = callback => {
        let currTime = Date.now();
        let delay = Math.max(0, everyTime - currTime + lastTime);
        let id = setTimeout(callback, delay);

        lastTime = currTime + delay;
        return id;
    };

    cancelAnimationFrame = id => {
        clearTimeout(id);
    };
}

export function raf(callback) {
    return requestAnimationFrame.call(root, callback);
}

export function caf(id) {
    id && cancelAnimationFrame.call(root, id);
}
