/**
 * @file 组件 WujiIcon 无极-图标
 * @author baozhixin <baozhixin@baidu.com>
 */

import './style/index.less';
import {Component, DataTypes} from 'san';
import isNumeric from '../utils/is-numeric';
import pr2rem from '../utils/pr2rem';

const prefixCls = 'w-icon';

export default class WujiIcon extends Component {
    static template = /* html */ `
        <svg class="{{iconClass}}" style="{{iconStyle}}" on-click="handleClick">
            {{use | raw}}
        </svg>
    `;

    static dataTypes = {
        color: DataTypes.string,
        type: DataTypes.string,
        name: DataTypes.string,
        size: DataTypes.oneOfType([
            DataTypes.number,
            DataTypes.string,
            DataTypes.oneOf([
                'auto',
                'half',
            ]),
        ]),
    };

    static computed = {
        iconClass() {
            const size = this.data.get('size');

            return [
                prefixCls,
                size === 'auto' && `${prefixCls}-auto`,
                size === 'half' && `${prefixCls}-half`,
            ].filter(
                c => c
            );
        },
        iconStyle() {
            let style = {};
            const color = this.data.get('color');
            const size = this.data.get('size');

            if (color) {
                style.fill = color;
            }

            if (isNumeric(size)) {
                const width = `${pr2rem(size)}rem`;
                style.width = style.height = width;
            }

            return style;
        },
        use() {
            const type = this.data.get('type') || this.data.get('name');
            return `<use xlink:href="#${type}"/>`;
        },
    };

    handleClick(event) {
        this.fire('click', {event});
    }
}
