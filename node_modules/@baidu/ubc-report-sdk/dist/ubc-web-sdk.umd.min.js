!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["ubc-web-sdk"]=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function a(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function i(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?a(Object(n),!0).forEach((function(a){t(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function n(e,t){if(null==e)return{};var a,i,n=function(e,t){if(null==e)return{};var a,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)a=o[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)a=o[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function o(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}var r=/^(?:(\w+)\.)?(?:(\w+)\.)?(\w+)$/;function d(e){var t=r.exec(e[0]);if(null==t||4!==t.length)throw"UBC SDK error inputs";if(this.trackerName=t[1]||"t0",this.pluginName=t[2]||"",this.methodName=t[3],this.fields=[].slice.call(e,1),this.isCreateCommand="init"===this.methodName,this.isConfigCommand="config"===this.methodName,this.isEventCommand="event"===this.methodName||"pv"===this.methodName,this.isTimingCommand="timing"===this.methodName,!this.methodName)throw"UBC SDK methodName can not be empty!";if(this.isCreateCommand&&!this.fields[0])throw"UBC SDK serverId can not be empty!"}var m=window.navigator.userAgent,c=/ (lite|info) baiduboxapp\//i.test(m),s=/ mission baiduboxapp\//i.test(m),u=/ baiduboxapp\//i.test(m)&&!c&&!s,f=function(t,a){if(!Array.isArray(t)||!Array.isArray(a))return{};for(var i={},n=Math.min(t.length+1,a.length),o=0;o<n;o++)if("object"===e(a[o]))for(var p in i[t[o]]={},a[o])a[o].hasOwnProperty(p)&&(i[t[o]][p]=a[o][p]);else o<t.length&&(i[t[o]]=a[o]);return i};function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href,a=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i");if(t.split("?")[1]){var i=t.split("?")[1].match(a);return null!=i?decodeURIComponent(i[2]):null}return null}function g(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t)return"";var a="";for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];null==n?n="":"object"===e(n)&&(n=JSON.stringify(n)),a+="&"+encodeURIComponent(i)+"="+encodeURIComponent(n)}return a.slice(1)}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+(~e.indexOf("?")?"&":"?")+g(t)}function h(t){var a=e(t);return"function"===a||!!t&&"object"===a}function y(e){return!0===e||!1===e}function v(){}function w(e,t){try{if("function"==typeof e.find)return e.find(t);for(var a=0;a<e.length;a++)if(t(e[a],a,e))return e[a]}catch(e){}}var k={cmdQueue:[],init:function(){k.cmdQueue=[]},run:function(e){var t=e.map((function(e){return k.toCommands.apply(k,[e])})),a=k.cmdQueue.concat(t);for(k.cmdQueue=[];a.length>0;)k.runCommand.apply(this,[a[0]])&&k.cmdQueue.push(a[0]),a.shift()},toCommands:function(e){return new d(e)},runCommand:function(e){if(e.isCreateCommand)this.create.apply(this,[e.trackerName].concat(o(e.fields)));else if(e.isConfigCommand){var t=this.getByName(e.trackerName);if(!t)throw"不存在"+e.trackerName+"实例";var a=e.fields[0];for(var i in a)a.hasOwnProperty(i)&&(h(a[i])?t.set(i,Object.assign({},t.get(i),a[i])):t.set(i,a[i]))}else if(e.isEventCommand){var n=this.getByName(e.trackerName);if(!n)throw"不存在"+e.trackerName+"实例";n.send.call(n,{type:"event",fields:e.fields})}else if(e.isTimingCommand){var p=this.getByName(e.trackerName);if(!p)throw"不存在"+e.trackerName+"实例";var r=e.fields[0],d=[].slice.call(e.fields,1);"start"===r?p.regestTimingReportor(d):"end"===r&&p.endTimingReportor(d)}}};k.init();var T={http:"http://mbd.baidu.com/tcbox?action=pblog",https:"https://mbd.baidu.com/tcbox?action=pblog"}["https:"===document.location.protocol?"https":"http"];function x(e,t,a,i){var n=function(e){var t=document.createElement("img");return t.width=1,t.height=1,t.src=e,t}(e=b(e,{data:t})),o=!1;setTimeout((function(){a&&!o&&(a(i),o=!0)}),100),n.onload=n.onerror=function(){n=null,a&&!o&&(a(i),o=!0)}}function j(e,t,a,i){e=b(e,{data:t}),window.navigator.sendBeacon(e),a(i)}function I(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;return"function"==typeof window.navigator.sendBeacon&&(n.model.useSendBeacon&&0===i||1===i)?j(e,t,a,n):x(e,t,a,n)}var O,N,A=[{appname:"baiduboxmission",reg:/\bmission\sbaiduboxapp\b/i,appid:"10006"},{appname:"baiduboxlite",reg:/\b(?:lite|info) baiduboxapp\b/i,appid:"10001"},{appname:"baiduboxapp",reg:/\bbaiduboxapp\b/i,appid:"1"},{appname:"tieba",reg:/\btieba\b/i,appid:"11001"},{appname:"haokan",reg:/\bhaokan\b/i,appid:"11000"},{appname:"quanmin",reg:/\bbdminivideo\b/i,appid:"12022"},{appname:"bdmap",reg:/\bbaidumap_/i,appid:"11006"},{appname:"wangpan",reg:/\bnetdisk;/i,appid:"12018"},{appname:"askmybaby",reg:/\bmybaby\//i,appid:"12019"},{appname:"xifan",reg:/\bbdxifan\//i,appid:"12006"},{appid:"12031",appname:"sowhat"},{appid:"12010",appname:"lemon",reg:/lemonapp/i},{appid:"12015",appname:"baijiahao"},{appid:"12012",appname:"fanle"},{appid:"12013",appname:"zhaocaimao"},{appid:"12014",appname:"gamenow"},{appid:"12016",appname:"iqiyi"},{appid:"12017",appname:"baike"},{appid:"12023",appname:"flow"},{appid:"12026",appname:"dutaxi"},{appid:"12011",appname:"youjia"},{appid:"12020",appname:"feedsunion"},{appid:"12021",appname:"album"},{appid:"12024",appname:"webgame"},{appid:"12027",appname:"hmi_passenger"},{appid:"12028",appname:"bdwenku"},{appid:"12029",appname:"fanyi"},{appid:"12030",appname:"iknow"},{appid:"12025",appname:"duxiaoxiao"},{appid:"12032",appname:"baiduhanyu"},{appid:"12034",appname:"exp"},{appid:"12036",appname:"demo"},{appid:"12037",appname:"baiduyuedu"},{appid:"12038",appname:"cdm"},{appid:"12040",appname:"weiba"},{appid:"12041",appname:"baiduboxvision"},{appid:"12042",appname:"hiphop"},{appid:"12043",appname:"robobus-panel"},{appid:"12044",appname:"wenkustudent"},{appid:"12045",appname:"pc_live"},{appid:"12049",appname:"yunshangbaidu"},{appid:"12050",appname:"baiduwenku_pc"},{appid:"12051",appname:"yinci"},{appid:"12052",appname:"novel"},{appid:"12054",appname:"yoopu"},{appid:"12057",appname:"yinbo"},{appid:"12062",appname:"aiqicha"},{appid:"12066",appname:"Bamboo_Health"},{appid:"12067",appname:"Bamboo_Health_Dr"},{appid:"12073",appname:"superduer"},{appid:"12074",appname:"baidujiankangapp"},{appid:"12075",appname:"bdcrm_aifanfan"},{appid:"12077",appname:"muzhidoctor"},{appid:"12079",appname:"apollogo"},{appid:"12080",appname:"lvlin"},{appid:"12083",appname:"aipurchase"},{appid:"12088",appname:"BaiDuCarLife"},{appid:"12090",appname:"baidujiankangtt"},{appid:"12092",appname:"infoflow",reg:/\bbaiduhi/i},{appid:"12094",appname:"hmi_driver"},{appid:"12095",appname:"vr_expo"},{appid:"12096",appname:"content_ecommerce"},{appid:"12097",appname:"play_control"},{appid:"12098",appname:"aipurchaser"},{appid:"12101",appname:"ditutaojin"},{appid:"12102",appname:"hp_location"},{appid:"12106",appname:"chatroom"},{appid:"12107",appname:"gaia"},{appid:"12108",appname:"ubi"},{appid:"12109",appname:"yiju"},{appid:"12111",appname:"bml"},{appid:"12112",appname:"aihome"},{appid:"12113",appname:"aihome_children"},{appid:"12114",appname:"mobsecurity"},{appid:"12117",appname:"tomas"},{appid:"12118",appname:"baidu_flutter"},{appid:"12120",appname:"wepod"},{appid:"12121",appname:"yy"},{appid:"12122",appname:"kidedu"},{appid:"12123",appname:"wangpan_faster"},{appid:"12124",appname:"wepod_mobile"},{appid:"12125",appname:"baidu_vr_classroom_launcher"}],B=["type","value","ext"];function C(e){(this.model={},function(e,t){e.trackerName=t.trackerName,e.trackerId=t.trackerId||"",e.timingId=t.config&&t.config.timingId||"",e.useSendBeacon=t.config&&t.config.useSendBeacon||!1,e.version=t.config&&t.config.version||"1.0",t.config&&y(t.config.ifHeartbeatTime)?e.ifHeartbeatTime=t.config.ifHeartbeatTime:e.ifHeartbeatTime=!0;t.config&&y(t.config.testMode)?e.testMode=t.config.testMode:e.testMode=!1;e.testUrl=t.config&&t.config.testUrl||"",t.config&&y(t.config.autoPvTrack)?e.autoPvTrack=t.config.autoPvTrack:e.autoPvTrack=!1;t.config&&y(t.config.autoTimingTrack)?e.autoTimingTrack=t.config.autoTimingTrack:e.autoTimingTrack=!1;e.queryParams=t.config&&t.config.queryParams||{},e.version&&(e.queryParams.v=e.version,e.queryParams.appname=e.queryParams.appname||"baiduboxapp");e.appid=t.config&&t.config.appid||"1",e.cateid=t.config&&t.config.cateid||"99",e.actiontype=t.config&&t.config.actiontype||"0",e.from=t.config&&t.config.from||"act",e.duration=t.config&&t.config.duration||3,e.source=t.config&&t.config.source||"",e.inBox=u?"1":"0",e.abtest=t.config&&t.config.abtest||"",e.network=t.config&&t.config.network||"",e.page=t.config&&t.config.page||"",e.baiduTongJiId=t.config&&t.config.baiduTongJiId,e.isBaiduTongJi=!(!t.config||!t.config.baiduTongJiId),e.timingTasks=[],e.apptype=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t={appname:"other",appid:"12133"};if(e){return w(A,(function(t){return e===t.appname}))||t}var a,i=(null===(a=navigator)||void 0===a?void 0:a.userAgent)||"";return w(A,(function(e){return e.reg?e.reg.test(i):-1!==i.search(e.appname)}))||t}().appid}(this.model,e),this.get("isBaiduTongJi"))&&(window._hmt=window._hmt||[],function(e){if(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=e;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a)}}("https://hm.baidu.com/hm.js?"+this.get("baiduTongJiId")));this.get("autoPvTrack")&&this.send({type:"event",fields:["pageAutoPv"]}),this.get("autoTimingTrack")&&this.regestTimingReportor(["pageAutoTiming"])}C.prototype.set=function(e,t){this.model[e]=t},C.prototype.get=function(e){return this.model[e]},C.prototype.send=function(e){var t,a,o,p=e.type,r=e.fields,d=0;if("event"===p){if(r&&h(r[0])?(o=r[0],function(e){return"function"==typeof e}(r[1])&&(t=r[1])):o=f(B,r),a=function(e,t){var a={cateid:e.cateid,actiondata:{id:e.trackerId,type:"0",timestamp:Date.now(),content:i(i({page:e.page||window.location.hostname+window.location.pathname,source:e.source||l("idfrom")||"",from:e.from},t),{},{ext:i({apptype:e.apptype},t.ext)})}};"1.0"===e.version&&(a.actiondata.abtest=e.abtest,a.actiondata.inBox=e.inBox,a.actiondata.network=e.network,a.appid=e.appid,a.actiontype=e.actiontype);return a}(this.model,o),o.useSendBeacon&&(d=o.useSendBeacon),this.get("isBaiduTongJi")){var m=a.actiondata.content||{},c=m.page,s=m.type,u=m.value;window._hmt.push(["_trackEvent",c,s,u])}}else"timing"===p&&(a=function(e,t){var a=t.starttime,o=t.ext,p=n(t,["starttime","ext"]),r={cateid:e.cateid,actiondata:{id:e.timingId,type:"1",timestamp:Date.now(),starttime:a,content:{duration:e.duration,option:i(i({page:e.page||window.location.hostname+window.location.pathname,source:e.source||l("idfrom")||"",from:e.from},p),{},{ext:i({apptype:e.apptype},o)})}}};e.ifHeartbeatTime||(r.actiondata.endtime=Date.now(),r.actiondata.content.duration=(r.actiondata.endtime-r.actiondata.starttime)/1e3);"1.0"===e.version&&(r.actiondata.abtest=e.abtest,r.actiondata.inBox=e.inBox,r.actiondata.network=e.network,r.appid=e.appid,r.actiontype=e.actiontype);return r}(this.model,r));var g=this.get("testMode")?"http://bjyz-mco-searchbox201609-m12xi3-044.bjyz.baidu.com:8080/tcbox?action=pblog":T;"2.0"===this.model.version&&(g=this.get("testMode")?"http://bjyz-mco-searchbox201609-m12xi3-044.bjyz.baidu.com:8080/ztbox?action=zpblog":"https://h2tcbox.baidu.com/ztbox?action=zpblog",g=b(g=this.model.testUrl||g,this.model.queryParams)),I.apply(this,[g,a,t,d,this])},C.prototype.regestTimingReportor=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.get("timingId"))throw"timing ID is required!";var a=this.get("timingTasks"),n=this.get("duration"),o=this.get("ifHeartbeatTime"),p={};p=t&&h(t[1])?i({type:t[0]},t[1]):f(B,t);var r=w(a,(function(e){return e.eventName===t[0]}));if(p.starttime=Date.now(),!r){var d=0;o&&(this.send({type:"timing",fields:p}),d=setInterval((function(){e.send({type:"timing",fields:p})}),1e3*n)),a.push({timingIntevalId:d,isReporting:!0,eventName:t[0],fields:p})}},C.prototype.stopAllTimingReportor=function(){var e=this;this.get("timingTasks").forEach((function(t){e.send({type:"timing",fields:t.fields}),t.isReporting=!1,clearInterval(t.timingIntevalId)}))},C.prototype.startAllTimingReportor=function(){var e=this,t=this.get("timingTasks"),a=this.get("duration"),i=this.get("ifHeartbeatTime");t.forEach((function(t){t.isReporting||(t.isReporting=!0,t.fields.starttime=Date.now(),i&&(e.send({type:"timing",fields:t.fields}),t.timingIntevalId=setInterval((function(){e.send({type:"timing",fields:t.fields})}),1e3*a)))}))},C.prototype.endTimingReportor=function(e){var t=this,a={};e&&h(e[1])&&(a=e[1]);var n=this.get("timingTasks"),o=[];n.forEach((function(n){var p=n.timingIntevalId;n.eventName===e[0]?(t.send({type:"timing",fields:i(i({},n.fields),a)}),clearInterval(p)):o.push(n),t.set("timingTasks",o)}))},C.prototype.removeAllTimingReportor=function(){var e=this,t=this.get("timingTasks");t.forEach((function(t){e.send({type:"timing",fields:t.fields}),clearInterval(t.timingIntevalId)})),t=[]},void 0!==document.hidden?(O="hidden",N="visibilitychange"):void 0!==document.msHidden?(O="msHidden",N="msvisibilitychange"):(void 0!==document.webkitHidden||void 0!==document.baiduboxappvisibilitychange)&&(O="webkitHidden",N="webkitvisibilitychange");var P=[],_={},S=["trackerName","trackerId","config"];function E(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];k.run.call(window.ubc,[t])}return E.create=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var i=f(S,[].slice.call(t)),n=i.trackerName;if(_[n])return _[n];var o=new C(i);return _[n]=o,P.push(o),o},E.remove=function(e){for(var t=P.length,a=0;a<t;a++)if(P[a][e]===e){P.splice(a,1),_[e]=null;break}},E.main=function(){var e=window.ubc,t=e&&e.q;e&&"function"==typeof e.getAll&&(E=window.ubc),Array.isArray(t)&&(k.run.apply(E,[t]),e.q=[]),E.startTime=e&&e.l||1*new Date,E.loaded=!0,window.ubc=E},E.getByName=function(e){return _[e]},E.getAll=function(){return P.slice()},E.main(),function(e){void 0!==document.addEventListener&&void 0!==O&&document.addEventListener(N,(function(){e.getAll().forEach((function(e){var t=e.get("timingTasks");Array.isArray(t)&&(document[O]?e.stopAllTimingReportor():e.startAllTimingReportor())}))}),!1)}(E),E}));
