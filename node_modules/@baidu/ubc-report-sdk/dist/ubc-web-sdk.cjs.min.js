"use strict";function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(a)}function a(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function t(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,i)}return t}function i(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?t(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function n(e,a){if(null==e)return{};var t,i,n=function(e,a){if(null==e)return{};var t,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}function o(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,a){if(!e)return;if("string"==typeof e)return p(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return p(e,a)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var r=/^(?:(\w+)\.)?(?:(\w+)\.)?(\w+)$/;function d(e){var a=r.exec(e[0]);if(null==a||4!==a.length)throw"UBC SDK error inputs";if(this.trackerName=a[1]||"t0",this.pluginName=a[2]||"",this.methodName=a[3],this.fields=[].slice.call(e,1),this.isCreateCommand="init"===this.methodName,this.isConfigCommand="config"===this.methodName,this.isEventCommand="event"===this.methodName||"pv"===this.methodName,this.isTimingCommand="timing"===this.methodName,!this.methodName)throw"UBC SDK methodName can not be empty!";if(this.isCreateCommand&&!this.fields[0])throw"UBC SDK serverId can not be empty!"}var m=window.navigator.userAgent,c=/ (lite|info) baiduboxapp\//i.test(m),s=/ mission baiduboxapp\//i.test(m),u=/ baiduboxapp\//i.test(m)&&!c&&!s,f=function(a,t){if(!Array.isArray(a)||!Array.isArray(t))return{};for(var i={},n=Math.min(a.length+1,t.length),o=0;o<n;o++)if("object"===e(t[o]))for(var p in i[a[o]]={},t[o])t[o].hasOwnProperty(p)&&(i[a[o]][p]=t[o][p]);else o<a.length&&(i[a[o]]=t[o]);return i};function g(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href,t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i");if(a.split("?")[1]){var i=a.split("?")[1].match(t);return null!=i?decodeURIComponent(i[2]):null}return null}function l(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!a)return"";var t="";for(var i in a)if(a.hasOwnProperty(i)){var n=a[i];null==n?n="":"object"===e(n)&&(n=JSON.stringify(n)),t+="&"+encodeURIComponent(i)+"="+encodeURIComponent(n)}return t.slice(1)}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+(~e.indexOf("?")?"&":"?")+l(a)}function h(a){var t=e(a);return"function"===t||!!a&&"object"===t}function y(e){return!0===e||!1===e}function v(){}function w(e,a){try{if("function"==typeof e.find)return e.find(a);for(var t=0;t<e.length;t++)if(a(e[t],t,e))return e[t]}catch(e){}}var k={cmdQueue:[],init:function(){k.cmdQueue=[]},run:function(e){var a=e.map((function(e){return k.toCommands.apply(k,[e])})),t=k.cmdQueue.concat(a);for(k.cmdQueue=[];t.length>0;)k.runCommand.apply(this,[t[0]])&&k.cmdQueue.push(t[0]),t.shift()},toCommands:function(e){return new d(e)},runCommand:function(e){if(e.isCreateCommand)this.create.apply(this,[e.trackerName].concat(o(e.fields)));else if(e.isConfigCommand){var a=this.getByName(e.trackerName);if(!a)throw"不存在"+e.trackerName+"实例";var t=e.fields[0];for(var i in t)t.hasOwnProperty(i)&&(h(t[i])?a.set(i,Object.assign({},a.get(i),t[i])):a.set(i,t[i]))}else if(e.isEventCommand){var n=this.getByName(e.trackerName);if(!n)throw"不存在"+e.trackerName+"实例";n.send.call(n,{type:"event",fields:e.fields})}else if(e.isTimingCommand){var p=this.getByName(e.trackerName);if(!p)throw"不存在"+e.trackerName+"实例";var r=e.fields[0],d=[].slice.call(e.fields,1);"start"===r?p.regestTimingReportor(d):"end"===r&&p.endTimingReportor(d)}}};k.init();var T={http:"http://mbd.baidu.com/tcbox?action=pblog",https:"https://mbd.baidu.com/tcbox?action=pblog"}["https:"===document.location.protocol?"https":"http"];function x(e,a,t,i){var n=function(e){var a=document.createElement("img");return a.width=1,a.height=1,a.src=e,a}(e=b(e,{data:a})),o=!1;setTimeout((function(){t&&!o&&(t(i),o=!0)}),100),n.onload=n.onerror=function(){n=null,t&&!o&&(t(i),o=!0)}}function j(e,a,t,i){e=b(e,{data:a}),window.navigator.sendBeacon(e),t(i)}function I(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;return"function"==typeof window.navigator.sendBeacon&&(n.model.useSendBeacon&&0===i||1===i)?j(e,a,t,n):x(e,a,t,n)}var O,N,A=[{appname:"baiduboxmission",reg:/\bmission\sbaiduboxapp\b/i,appid:"10006"},{appname:"baiduboxlite",reg:/\b(?:lite|info) baiduboxapp\b/i,appid:"10001"},{appname:"baiduboxapp",reg:/\bbaiduboxapp\b/i,appid:"1"},{appname:"tieba",reg:/\btieba\b/i,appid:"11001"},{appname:"haokan",reg:/\bhaokan\b/i,appid:"11000"},{appname:"quanmin",reg:/\bbdminivideo\b/i,appid:"12022"},{appname:"bdmap",reg:/\bbaidumap_/i,appid:"11006"},{appname:"wangpan",reg:/\bnetdisk;/i,appid:"12018"},{appname:"askmybaby",reg:/\bmybaby\//i,appid:"12019"},{appname:"xifan",reg:/\bbdxifan\//i,appid:"12006"},{appid:"12031",appname:"sowhat"},{appid:"12010",appname:"lemon",reg:/lemonapp/i},{appid:"12015",appname:"baijiahao"},{appid:"12012",appname:"fanle"},{appid:"12013",appname:"zhaocaimao"},{appid:"12014",appname:"gamenow"},{appid:"12016",appname:"iqiyi"},{appid:"12017",appname:"baike"},{appid:"12023",appname:"flow"},{appid:"12026",appname:"dutaxi"},{appid:"12011",appname:"youjia"},{appid:"12020",appname:"feedsunion"},{appid:"12021",appname:"album"},{appid:"12024",appname:"webgame"},{appid:"12027",appname:"hmi_passenger"},{appid:"12028",appname:"bdwenku"},{appid:"12029",appname:"fanyi"},{appid:"12030",appname:"iknow"},{appid:"12025",appname:"duxiaoxiao"},{appid:"12032",appname:"baiduhanyu"},{appid:"12034",appname:"exp"},{appid:"12036",appname:"demo"},{appid:"12037",appname:"baiduyuedu"},{appid:"12038",appname:"cdm"},{appid:"12040",appname:"weiba"},{appid:"12041",appname:"baiduboxvision"},{appid:"12042",appname:"hiphop"},{appid:"12043",appname:"robobus-panel"},{appid:"12044",appname:"wenkustudent"},{appid:"12045",appname:"pc_live"},{appid:"12049",appname:"yunshangbaidu"},{appid:"12050",appname:"baiduwenku_pc"},{appid:"12051",appname:"yinci"},{appid:"12052",appname:"novel"},{appid:"12054",appname:"yoopu"},{appid:"12057",appname:"yinbo"},{appid:"12062",appname:"aiqicha"},{appid:"12066",appname:"Bamboo_Health"},{appid:"12067",appname:"Bamboo_Health_Dr"},{appid:"12073",appname:"superduer"},{appid:"12074",appname:"baidujiankangapp"},{appid:"12075",appname:"bdcrm_aifanfan"},{appid:"12077",appname:"muzhidoctor"},{appid:"12079",appname:"apollogo"},{appid:"12080",appname:"lvlin"},{appid:"12083",appname:"aipurchase"},{appid:"12088",appname:"BaiDuCarLife"},{appid:"12090",appname:"baidujiankangtt"},{appid:"12092",appname:"infoflow",reg:/\bbaiduhi/i},{appid:"12094",appname:"hmi_driver"},{appid:"12095",appname:"vr_expo"},{appid:"12096",appname:"content_ecommerce"},{appid:"12097",appname:"play_control"},{appid:"12098",appname:"aipurchaser"},{appid:"12101",appname:"ditutaojin"},{appid:"12102",appname:"hp_location"},{appid:"12106",appname:"chatroom"},{appid:"12107",appname:"gaia"},{appid:"12108",appname:"ubi"},{appid:"12109",appname:"yiju"},{appid:"12111",appname:"bml"},{appid:"12112",appname:"aihome"},{appid:"12113",appname:"aihome_children"},{appid:"12114",appname:"mobsecurity"},{appid:"12117",appname:"tomas"},{appid:"12118",appname:"baidu_flutter"},{appid:"12120",appname:"wepod"},{appid:"12121",appname:"yy"},{appid:"12122",appname:"kidedu"},{appid:"12123",appname:"wangpan_faster"},{appid:"12124",appname:"wepod_mobile"},{appid:"12125",appname:"baidu_vr_classroom_launcher"}],B=["type","value","ext"];function C(e){(this.model={},function(e,a){e.trackerName=a.trackerName,e.trackerId=a.trackerId||"",e.timingId=a.config&&a.config.timingId||"",e.useSendBeacon=a.config&&a.config.useSendBeacon||!1,e.version=a.config&&a.config.version||"1.0",a.config&&y(a.config.ifHeartbeatTime)?e.ifHeartbeatTime=a.config.ifHeartbeatTime:e.ifHeartbeatTime=!0;a.config&&y(a.config.testMode)?e.testMode=a.config.testMode:e.testMode=!1;e.testUrl=a.config&&a.config.testUrl||"",a.config&&y(a.config.autoPvTrack)?e.autoPvTrack=a.config.autoPvTrack:e.autoPvTrack=!1;a.config&&y(a.config.autoTimingTrack)?e.autoTimingTrack=a.config.autoTimingTrack:e.autoTimingTrack=!1;e.queryParams=a.config&&a.config.queryParams||{},e.version&&(e.queryParams.v=e.version,e.queryParams.appname=e.queryParams.appname||"baiduboxapp");e.appid=a.config&&a.config.appid||"1",e.cateid=a.config&&a.config.cateid||"99",e.actiontype=a.config&&a.config.actiontype||"0",e.from=a.config&&a.config.from||"act",e.duration=a.config&&a.config.duration||3,e.source=a.config&&a.config.source||"",e.inBox=u?"1":"0",e.abtest=a.config&&a.config.abtest||"",e.network=a.config&&a.config.network||"",e.page=a.config&&a.config.page||"",e.baiduTongJiId=a.config&&a.config.baiduTongJiId,e.isBaiduTongJi=!(!a.config||!a.config.baiduTongJiId),e.timingTasks=[],e.apptype=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a={appname:"other",appid:"12133"};if(e){return w(A,(function(a){return e===a.appname}))||a}var t,i=(null===(t=navigator)||void 0===t?void 0:t.userAgent)||"";return w(A,(function(e){return e.reg?e.reg.test(i):-1!==i.search(e.appname)}))||a}().appid}(this.model,e),this.get("isBaiduTongJi"))&&(window._hmt=window._hmt||[],function(e){if(e){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=e;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(a,t)}}("https://hm.baidu.com/hm.js?"+this.get("baiduTongJiId")));this.get("autoPvTrack")&&this.send({type:"event",fields:["pageAutoPv"]}),this.get("autoTimingTrack")&&this.regestTimingReportor(["pageAutoTiming"])}C.prototype.set=function(e,a){this.model[e]=a},C.prototype.get=function(e){return this.model[e]},C.prototype.send=function(e){var a,t,o,p=e.type,r=e.fields,d=0;if("event"===p){if(r&&h(r[0])?(o=r[0],function(e){return"function"==typeof e}(r[1])&&(a=r[1])):o=f(B,r),t=function(e,a){var t={cateid:e.cateid,actiondata:{id:e.trackerId,type:"0",timestamp:Date.now(),content:i(i({page:e.page||window.location.hostname+window.location.pathname,source:e.source||g("idfrom")||"",from:e.from},a),{},{ext:i({apptype:e.apptype},a.ext)})}};"1.0"===e.version&&(t.actiondata.abtest=e.abtest,t.actiondata.inBox=e.inBox,t.actiondata.network=e.network,t.appid=e.appid,t.actiontype=e.actiontype);return t}(this.model,o),o.useSendBeacon&&(d=o.useSendBeacon),this.get("isBaiduTongJi")){var m=t.actiondata.content||{},c=m.page,s=m.type,u=m.value;window._hmt.push(["_trackEvent",c,s,u])}}else"timing"===p&&(t=function(e,a){var t=a.starttime,o=a.ext,p=n(a,["starttime","ext"]),r={cateid:e.cateid,actiondata:{id:e.timingId,type:"1",timestamp:Date.now(),starttime:t,content:{duration:e.duration,option:i(i({page:e.page||window.location.hostname+window.location.pathname,source:e.source||g("idfrom")||"",from:e.from},p),{},{ext:i({apptype:e.apptype},o)})}}};e.ifHeartbeatTime||(r.actiondata.endtime=Date.now(),r.actiondata.content.duration=(r.actiondata.endtime-r.actiondata.starttime)/1e3);"1.0"===e.version&&(r.actiondata.abtest=e.abtest,r.actiondata.inBox=e.inBox,r.actiondata.network=e.network,r.appid=e.appid,r.actiontype=e.actiontype);return r}(this.model,r));var l=this.get("testMode")?"http://bjyz-mco-searchbox201609-m12xi3-044.bjyz.baidu.com:8080/tcbox?action=pblog":T;"2.0"===this.model.version&&(l=this.get("testMode")?"http://bjyz-mco-searchbox201609-m12xi3-044.bjyz.baidu.com:8080/ztbox?action=zpblog":"https://h2tcbox.baidu.com/ztbox?action=zpblog",l=b(l=this.model.testUrl||l,this.model.queryParams)),I.apply(this,[l,t,a,d,this])},C.prototype.regestTimingReportor=function(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.get("timingId"))throw"timing ID is required!";var t=this.get("timingTasks"),n=this.get("duration"),o=this.get("ifHeartbeatTime"),p={};p=a&&h(a[1])?i({type:a[0]},a[1]):f(B,a);var r=w(t,(function(e){return e.eventName===a[0]}));if(p.starttime=Date.now(),!r){var d=0;o&&(this.send({type:"timing",fields:p}),d=setInterval((function(){e.send({type:"timing",fields:p})}),1e3*n)),t.push({timingIntevalId:d,isReporting:!0,eventName:a[0],fields:p})}},C.prototype.stopAllTimingReportor=function(){var e=this;this.get("timingTasks").forEach((function(a){e.send({type:"timing",fields:a.fields}),a.isReporting=!1,clearInterval(a.timingIntevalId)}))},C.prototype.startAllTimingReportor=function(){var e=this,a=this.get("timingTasks"),t=this.get("duration"),i=this.get("ifHeartbeatTime");a.forEach((function(a){a.isReporting||(a.isReporting=!0,a.fields.starttime=Date.now(),i&&(e.send({type:"timing",fields:a.fields}),a.timingIntevalId=setInterval((function(){e.send({type:"timing",fields:a.fields})}),1e3*t)))}))},C.prototype.endTimingReportor=function(e){var a=this,t={};e&&h(e[1])&&(t=e[1]);var n=this.get("timingTasks"),o=[];n.forEach((function(n){var p=n.timingIntevalId;n.eventName===e[0]?(a.send({type:"timing",fields:i(i({},n.fields),t)}),clearInterval(p)):o.push(n),a.set("timingTasks",o)}))},C.prototype.removeAllTimingReportor=function(){var e=this,a=this.get("timingTasks");a.forEach((function(a){e.send({type:"timing",fields:a.fields}),clearInterval(a.timingIntevalId)})),a=[]},void 0!==document.hidden?(O="hidden",N="visibilitychange"):void 0!==document.msHidden?(O="msHidden",N="msvisibilitychange"):(void 0!==document.webkitHidden||void 0!==document.baiduboxappvisibilitychange)&&(O="webkitHidden",N="webkitvisibilitychange");var P=[],_={},S=["trackerName","trackerId","config"];function E(){for(var e=arguments.length,a=new Array(e),t=0;t<e;t++)a[t]=arguments[t];k.run.call(window.ubc,[a])}E.create=function(){for(var e=arguments.length,a=new Array(e),t=0;t<e;t++)a[t]=arguments[t];var i=f(S,[].slice.call(a)),n=i.trackerName;if(_[n])return _[n];var o=new C(i);return _[n]=o,P.push(o),o},E.remove=function(e){for(var a=P.length,t=0;t<a;t++)if(P[t][e]===e){P.splice(t,1),_[e]=null;break}},E.main=function(){var e=window.ubc,a=e&&e.q;e&&"function"==typeof e.getAll&&(E=window.ubc),Array.isArray(a)&&(k.run.apply(E,[a]),e.q=[]),E.startTime=e&&e.l||1*new Date,E.loaded=!0,window.ubc=E},E.getByName=function(e){return _[e]},E.getAll=function(){return P.slice()},E.main(),function(e){void 0!==document.addEventListener&&void 0!==O&&document.addEventListener(N,(function(){e.getAll().forEach((function(e){var a=e.get("timingTasks");Array.isArray(a)&&(document[O]?e.stopAllTimingReportor():e.startAllTimingReportor())}))}),!1)}(E);var R=E;module.exports=R;
