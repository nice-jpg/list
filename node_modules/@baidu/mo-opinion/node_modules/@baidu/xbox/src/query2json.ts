/**
 * @file 对传入url query 部分转成json格式
 * @author wangyongqing <wangyongqing01@baidu.com>
 */

import {decodeUriComponent} from './decode-uri-component';

/**
 * 对传入url query 部分转成json格式
 *
 * @param url 待处理的url
 * @param [safe = true] 是否启用安全 decode 模式，默认 true
 * @return 返回处理后的 json
 */
export function query2json(url: string, safe = true) {
    const locse = url.split('?');
    const search = locse[1] ? locse[1] : locse[0];
    const pairs = search.split('&');
    let result: Record<string, string> = {};

    pairs.forEach(item => {
        const pair = item.split('=');
        if (pair[0].length > 0) {
            let resultPair = '';
            try {
                resultPair = (safe ? decodeUriComponent(pair[1]) : decodeURIComponent(pair[1])) || '';
            }
            catch (e) {
                console.info(e);
            }
            result[pair[0]] = resultPair;
        }
    });
    return result;
}
