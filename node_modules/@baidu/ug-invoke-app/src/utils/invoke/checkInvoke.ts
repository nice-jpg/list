/**
 * @file 调起情况检测
 * @author zhuzhibo(zhuzhibo@baidu.com)
 * @author zsy
 */

/**
 * 调起情况检测
 *
 */
export function checkInvoke(timeout: number) {
    return new Promise<void>((resolve, reject) => {
        const timer = setTimeout(() => {
            // 如果visibilitychange事件不触发，但是state会变化
            // 这里可以兜底判断回调
            // 但是这种概率还是挺小的
            if (document.visibilityState === 'hidden') {
                clearTimeout(timer);
                resolve();
                return;
            }
            reject();
        }, timeout);
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden') {
                clearTimeout(timer);
                resolve();
            }
        });
    });
}
