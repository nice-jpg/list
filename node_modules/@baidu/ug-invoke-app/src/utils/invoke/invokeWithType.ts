/**
 * @file invoke 类型
 * @author zhangsiyuan(zhangsiyuan@baidu.com)
 */

import {invokeAction} from './invokeAction';
import {checkInvoke} from './checkInvoke';
import {Status} from '../../config/Status';
import {InvokeType} from '../../config/app/InvokeType';
import {handleInvokeFailed} from './handleInvokeFailed';
import {InnerInvokeConfig} from '../../api/invokeApp';
import {sendH5ErrLog} from '../log/errorLog';

export async function invokeWithType(options: InnerInvokeConfig, invokeType: InvokeType) {
    console.warn('开始尝试调起！ type为：', invokeType);
    if (invokeType === InvokeType.ULINK) {
        window.top.location.href = options.ulink;
    }
    else if (invokeType === InvokeType.ANDROID_MARKET && options.marketScheme) {
        invokeAction(options.marketScheme, options.appName);
    }
    else if (invokeType === InvokeType.SCHEME) {
        invokeAction(options.scheme, options.appName);
    }

    try {
        await checkInvoke(options.timeout);
        const status = invokeType === InvokeType.ANDROID_MARKET ? Status.APPSTORE_SUCCESS : Status.INVOKE_SUCCESS;
        sendH5ErrLog(options, status);
        return status;
    }
    catch (e) {
        return handleInvokeFailed(options, invokeType);
    }
}
