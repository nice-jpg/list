/**
 * @file 获取手百版本
 * @author wangyongqing01
 */
import isBoxApp from './is-box';
import isMatrix from './is-matrix';
const UA = typeof window === 'object' && window.self === window ? navigator.userAgent : '';

/**
 * 获取框的版本号
 * @function getBoxVersion
 * @param {''|lite|pro|info} [subName=''] - 手百矩阵产品标识
 * @param {string} ua - 传入的 userAgent，如果不传则取 navigator.userAgent
 * @return {String} version 返回框的版本号
 * @example
 * getBoxVersion('lite') // 2.0.1
 * getBoxVersion() // 11.1.0
 */
export default function getBoxVersion(subName = '', ua = UA) {
    if (subName === 'main') {
        subName = '';
    }
    let version = '0';
    if (typeof window === 'object' && window.baiduboxapp_version) {
        /* eslint-disable no-undef */
        return baiduboxapp_version;
        /* eslint-enable no-undef */
    }

    if (isBoxApp(subName, ua) || isMatrix(subName, ua)) {
        let a;
        if ((a = /(baiduboxapp|baiduboxvision)\/([\d.]+)/.exec(ua))) {
            version = a[2];
        } else if ((a = /([\d+.]+)_(?:diordna|enohpi)_/.exec(ua))) {
            // 老版本手百
            a = a[1].split('.');
            version = a.reverse().join('.');
        }
    }

    return version;
}
// 获取大版本号
export function getV(str, subName = '', ua = UA) {
    str = str || getBoxVersion(subName, ua);
    if (str && typeof str === 'string') {
        let match = /\d+\.\d+/.exec(str);
        if (match) {
            return match[0];
        }
    }
    return 0;
}

/**
 * 获取手百版本，不建议使用，因为不区分手百矩阵产品
 * @function getVersion
 */
export function getVersion() {
    console.warn(`[xbox/getVersion]不建议使用，因为不能区分是什么版本手百
请使用 getVersion(subName) 方法
    `);

    const pro = getBoxVersion('pro');
    const lite = getBoxVersion('lite');
    const info = getBoxVersion('info');
    const mission = getBoxVersion('mission');
    const main = getBoxVersion();
    return pro || info || lite || mission || main;
}
