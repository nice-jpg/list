!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("core-js/modules/es6.array.index-of"),require("core-js/modules/es6.regexp.match"),require("core-js/modules/es6.regexp.split"),require("core-js/modules/es6.regexp.constructor"),require("core-js/modules/es6.array.is-array"),require("core-js/modules/es6.object.assign"),require("core-js/modules/es6.array.map"),require("core-js/modules/es6.array.for-each"),require("core-js/modules/es6.date.now"),require("core-js/modules/es6.array.find")):"function"==typeof define&&define.amd?define(["core-js/modules/es6.array.index-of","core-js/modules/es6.regexp.match","core-js/modules/es6.regexp.split","core-js/modules/es6.regexp.constructor","core-js/modules/es6.array.is-array","core-js/modules/es6.object.assign","core-js/modules/es6.array.map","core-js/modules/es6.array.for-each","core-js/modules/es6.date.now","core-js/modules/es6.array.find"],t):e["ubc-web-sdk"]=t()}(this,function(){"use strict";var e=/^(?:(\w+)\.)?(?:(\w+)\.)?(\w+)$/;function t(t){var i=e.exec(t[0]);if(null==i||4!==i.length)throw"UBC SDK error inputs";if(this.trackerName=i[1]||"t0",this.pluginName=i[2]||"",this.methodName=i[3],this.fields=[].slice.call(t,1),this.isCreateCommand="init"===this.methodName,this.isConfigCommand="config"===this.methodName,this.isEventCommand="event"===this.methodName||"pv"===this.methodName,this.isTimingCommand="timing"===this.methodName,!this.methodName)throw"UBC SDK methodName can not be empty!";if(this.isCreateCommand&&!this.fields[0])throw"UBC SDK serverId can not be empty!"}var i=window.navigator.userAgent,n=/ (lite|info) baiduboxapp\//i.test(i),o=/ mission baiduboxapp\//i.test(i),r=/ baiduboxapp\//i.test(i)&&!n&&!o,a=function(e,t){if(!Array.isArray(e)||!Array.isArray(t))return{};for(var i={},n=Math.min(e.length+1,t.length),o=0;o<n;o++)if("object"==typeof t[o])for(var r in i[e[o]]={},t[o])t[o].hasOwnProperty(r)&&(i[e[o]][r]=t[o][r]);else o<e.length&&(i[e[o]]=t[o]);return i};function s(e,t){return void 0===e&&(e=""),void 0===t&&(t={}),e+(~e.indexOf("?")?"&":"?")+function(e){if(void 0===e&&(e={}),!e)return"";var t="";for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];null==n?n="":"object"==typeof n&&(n=JSON.stringify(n)),t+="&"+encodeURIComponent(i)+"="+encodeURIComponent(n)}return t.slice(1)}(t)}function c(e){var t=typeof e;return"function"===t||!!e&&"object"===t}function d(e){return!0===e||!1===e}function u(){}var m={cmdQueue:[],init:function(){m.cmdQueue=[]},run:function(e){var t=e.map(function(e){return m.toCommands.apply(m,[e])}),i=m.cmdQueue.concat(t);for(m.cmdQueue=[];i.length>0;)m.runCommand.apply(this,[i[0]])&&m.cmdQueue.push(i[0]),i.shift()},toCommands:function(e){return new t(e)},runCommand:function(e){if(e.isCreateCommand)this.create.apply(this,[e.trackerName].concat(e.fields));else if(e.isConfigCommand){var t=this.getByName(e.trackerName),i=e.fields[0];for(var n in i)i.hasOwnProperty(n)&&(c(i[n])?t.set(n,Object.assign({},t.get(n),i[n])):t.set(n,i[n]))}else if(e.isEventCommand){var o=this.getByName(e.trackerName);o.send.call(o,{type:"event",fields:e.fields})}else if(e.isTimingCommand){var r=this.getByName(e.trackerName),a=e.fields[0],s=[].slice.call(e.fields,1);"start"===a?r.regestTimingReportor(s):"end"===a&&r.endTimingReportor(s)}}};m.init();var f={http:"http://m.baidu.com/tcbox?action=pblog",https:"https://mbd.baidu.com/tcbox?action=pblog"}["https:"===document.location.protocol?"https":"http"],g="https://hm.baidu.com/hm.js",l=function(e){var t=document.createElement("img");return t.width=1,t.height=1,t.src=e,t},p=100;function h(e,t,i,n,o){return void 0===i&&(i=u),void 0===n&&(n=0),"function"==typeof window.navigator.sendBeacon&&(o.model.useSendBeacon&&0===n||1===n)?function(e,t,i,n){e=s(e,{data:t}),window.navigator.sendBeacon(e),i(n)}(e,t,i,o):function(e,t,i,n){e=s(e,{data:t});var o=l(e),r=!1;setTimeout(function(){i&&!r&&(i(n),r=!0)},p),o.onload=o.onerror=function(){o=null,i&&!r&&(i(n),r=!0)}}(e,t,i,o)}var v,y,b="1.0",w="1",k="99",T="0",x="act",I=3,j=["type","value","ext"];function N(e){(this.model={},function(e,t){e.trackerName=t.trackerName,e.trackerId=t.trackerId||"",e.timingId=t.config&&t.config.timingId||"",e.useSendBeacon=t.config&&t.config.useSendBeacon||!1,e.version=t.config&&t.config.version||b,t.config&&d(t.config.testMode)?e.testMode=t.config.testMode:e.testMode=!1;e.testUrl=t.config&&t.config.testUrl||"",t.config&&d(t.config.autoPvTrack)?e.autoPvTrack=t.config.autoPvTrack:e.autoPvTrack=!1;t.config&&d(t.config.autoTimingTrack)?e.autoTimingTrack=t.config.autoTimingTrack:e.autoTimingTrack=!1;e.queryParams=t.config&&t.config.queryParams||{},e.version&&(e.queryParams.v=e.version);e.appid=t.config&&t.config.appid||w,e.cateid=t.config&&t.config.cateid||k,e.actiontype=t.config&&t.config.actiontype||T,e.from=t.config&&t.config.from||x,e.duration=t.config&&t.config.duration||I,e.source=t.config&&t.config.source||function(e,t){void 0===t&&(t=window.location.href);var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i");if(t.split("?")[1]){var n=t.split("?")[1].match(i);return null!=n?decodeURIComponent(n[2]):null}return null}("idfrom")||"",e.inBox=r?"1":"0",e.abtest=t.config&&t.config.abtest||"",e.network=t.config&&t.config.network||"",e.page=t.config&&t.config.page||window.location.hostname+window.location.pathname,e.baiduTongJiId=t.config&&t.config.baiduTongJiId,e.isBaiduTongJi=!(!t.config||!t.config.baiduTongJiId),e.timingTasks=[]}(this.model,e),this.get("isBaiduTongJi"))&&(window._hmt=window._hmt||[],function(e){if(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=e;var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(t,i)}}(g+"?"+this.get("baiduTongJiId")));this.get("autoPvTrack")&&this.send({type:"event",fields:["pageAutoPv"]}),this.get("autoTimingTrack")&&this.regestTimingReportor(["pageAutoTiming"])}N.prototype.set=function(e,t){this.model[e]=t},N.prototype.get=function(e){return this.model[e]},N.prototype.send=function(e){var t,i,n,o=e.type,r=e.fields,d=0;if("event"===o){if(r&&c(r[0])?(n=r[0],function(e){return"function"==typeof e}(r[1])&&(t=r[1])):n=a(j,r),i=function(e,t){var i={cateid:e.cateid,actiondata:{id:e.trackerId,type:"0",timestamp:Date.now(),content:{page:t.page||e.page,source:e.source,from:e.from,type:t.type,value:t.value,ext:t.ext}}};"1.0"===e.version&&(i.actiondata.abtest=e.abtest,i.actiondata.inBox=e.inBox,i.actiondata.network=e.network,i.appid=e.appid,i.actiontype=e.actiontype);return i}(this.model,n),n.useSendBeacon&&(d=n.useSendBeacon),this.get("isBaiduTongJi")){var u=i.actiondata.content||{},m=u.page,g=u.type,l=u.value;window._hmt.push(["_trackEvent",m,g,l])}}else"timing"===o&&(i=function(e,t){var i={cateid:e.cateid,actiondata:{id:e.timingId,type:"1",timestamp:Date.now(),starttime:t.starttime,content:{duration:e.duration,option:{page:e.page,source:e.source,from:e.from,type:t.type,value:t.value,ext:t.ext}}}};"1.0"===e.version&&(i.actiondata.abtest=e.abtest,i.actiondata.inBox=e.inBox,i.actiondata.network=e.network,i.appid=e.appid,i.actiontype=e.actiontype);return i}(this.model,r));var p=this.get("testMode")?"http://bjyz-mco-searchbox201609-m12xi3-044.bjyz.baidu.com:8080/tcbox?action=pblog":f;"2.0"===this.model.version&&(p=this.get("testMode")?"http://bjyz-mco-searchbox201609-m12xi3-044.bjyz.baidu.com:8080/ztbox?action=zpblog":"https://mbd.baidu.com/ztbox?action=zpblog",p=s(p=this.model.testUrl||p,this.model.queryParams)),h.apply(this,[p,i,t,d,this])},N.prototype.regestTimingReportor=function(e){var t=this;if(void 0===e&&(e=[]),!this.get("timingId"))throw"timing ID is required!";var i=this.get("timingTasks"),n=this.get("duration");e=a(j,e);var o=i.find(function(t){return t.eventName===e.type});if(e.starttime=Date.now(),!o){this.send({type:"timing",fields:e});var r=setInterval(function(){t.send({type:"timing",fields:e})},1e3*n);i.push({timingIntevalId:r,isReporting:!0,eventName:e.type,fields:e})}},N.prototype.stopAllTimingReportor=function(){this.get("timingTasks").forEach(function(e){e.isReporting=!1,clearInterval(e.timingIntevalId)})},N.prototype.startAllTimingReportor=function(){var e=this,t=this.get("timingTasks"),i=this.get("duration");t.forEach(function(t){t.isReporting=!0,t.fields.starttime=Date.now(),e.send({type:"timing",fields:t.fields}),t.timingIntevalId=setInterval(function(){e.send({type:"timing",fields:t.fields})},1e3*i)})},N.prototype.endTimingReportor=function(e){var t=this;e=a(j,e);var i=this.get("timingTasks"),n=[];i.forEach(function(i){var o=i.timingIntevalId;i.eventName===e.type?clearInterval(o):n.push(i),t.set("timingTasks",n)})},N.prototype.removeAllTimingReportor=function(){var e=this.get("timingTasks");e.forEach(function(e){clearInterval(e.timingIntevalId)}),e=[]},void 0!==document.hidden?(v="hidden",y="visibilitychange"):void 0!==document.msHidden?(v="msHidden",y="msvisibilitychange"):void 0!==document.webkitHidden?(v="webkitHidden",y="webkitvisibilitychange"):void 0!==document.baiduboxappvisibilitychange&&(v="webkitHidden",y="webkitvisibilitychange");var B="ubc",C=[],A={},q=["trackerName","trackerId","config"];function R(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];m.run.call(window[B],[t])}return R.create=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=a(q,[].slice.call(t)),o=n.trackerName;if(A[o])return A[o];if(C.find(function(e){return e.get("trackerId")===n.trackerId}))throw"multi tracker serverId can not be same";var r=new N(n);return A[o]=r,C.push(r),r},R.remove=function(e){for(var t=C.length,i=0;i<t;i++)if(C[i][e]===e){C.splice(i,1),A[e]=null;break}},R.main=function(){var e=window[B],t=e&&e.q;e&&"function"==typeof e.getAll&&(R=window[B]),Array.isArray(t)&&(m.run.apply(R,[t]),e.q=[]),R.startTime=e&&e.l||1*new Date,R.loaded=!0,window[B]=R},R.getByName=function(e){return A[e]},R.getAll=function(){return C.slice()},R.main(),function(e){void 0!==document.addEventListener&&void 0!==v&&document.addEventListener(y,function(){e.getAll().forEach(function(e){var t=e.get("timingTasks");Array.isArray(t)&&(document[v]?e.stopAllTimingReportor():e.startAllTimingReportor())})},!1)}(R),R});
