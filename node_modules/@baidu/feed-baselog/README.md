# baselog

符合Feed前端业务打点规范的基础类库

wiki：http://wiki.baidu.com/pages/viewpage.action?pageId=1631749970

## 开发
```sh
# 安装依赖
yarn

# 启动
yarn start

# 打包
yarn run build
yarn run build-dev

# 打包hn
yarn run build-hn

# 发布
yarn run pub
# 输入需要发布的tag包：hn|wise|任意

# 单测
yarn run test
```

# 发布
注意：

1、hn&h5依赖不同的ubc包，baselog通过scripts/pack.js统一管理差异的dependencies依赖

2、针对hn&h5的差异化，同时通过发布tag来支持差异化产物

3、hn&h5相差一个大版本发布，hn取奇数版本，h5取偶数版本

通过npm dist-tag ls @baidu/feed-baselog查看tag包

## 安装

h5：yarn add @baidu/feed-baselog@latest

hn：yarn add @baidu/feed-baselog@hn

## 使用规范

### 实例化baselog

参数：

参数名 | 类型  |是否必传| 说明 | 备注 | 
|---|---|---|---|---|
|*mode*|string｜number|否|控制迁移打点模式 <br> both: 双打<br> 0.x: ubc/thudner占比||
|*params*|object|否|page: 页面标识<br>from: 业务标识(act)<br>source: 渠道来源<br>testMode: 测试模式<br>testUrl: 测试模式URL<br>...|ubc初始化<br>可参考[ubc-sdk](https://console.cloud.baidu-int.com/devops/icode/repos/baidu/jady/ubc-report-sdk/tree/master)|
|*tparams*|object|否|thunder初始化可选参数||

示例：

```js
import {BaseLog} from '@baidu/feed-baselog';

const initArgs = {
    mode: '0.5', 
    params: {
        page: '',
        from: '',
        source: '',
        queryParams: '',
        testMode: false,
        testUrl: '',
    },
    tParams: {
        ct: 3,
        logFrom: ''
    }
};

const baselog = new BaseLog({...initArgs});
```

### 单打ubc
合并ubc-sdk初始化ID&&打点操作，每个ID分配一个ubc实例，业务只需要send打点即可，`queryParams`支持push到data同级【可选】，支持回调【可选】

参数：

参数名 | 类型  |是否必传| 说明 |
|---|---|---|---|
|ubcId|string｜number|是|打点ubcid|
|params|object|是|打点自定义data参数<br>page: 页面标识<br>type: 打点类型<br>value: 类型值<br>ext: {...} 扩展参数<br>...<br>|
|queryParams|object|否|打点data同级自定义参数|

示例：

```js
const uargs = {
    ubcId: '13587',
    params: {
        page: '',
        type: '',
        value: '',
        ext: {
            p1: '',
            p2: ''
        },
    },
    queryParams: {...}
}

baselog.sendUbc({...uargs}, callback)
```

### 单打thunder

参数：

参数名 | 类型  |是否必传| 说明 |
|---|---|---|---|
| targs | object | 是 | thunder日志自定义参数 |
| callback | function | 否 | 回调函数 |
| url | string | 否 | Request URL <br> 默认: https://hpd.baidu.com/v.gif|

示例：

```js
const targs = {
    cst: 1,
    logInfo: "",
    sid: "",
    ssid: 0,
    tid: 9999
}

baselog.sendThunder({...targs}, callback, url)
```

### 混合打点
满足feed业务侧thunder迁移ubc打点需求，支持双打，ubc/thunder小流量

参数：

参数名 | 类型  |是否必传| 说明 |
|---|---|---|---|
| targs | object | 是 | thunder日志自定义参数 |
| ubcId | number | 否 | 迁移ubcid<br>默认13587 |
| callback | function | 否 | 回调函数 |
| url | string | 否 | Request URL <br> 默认: https://hpd.baidu.com/v.gif|

示例：

```js
const targs = {
    cst: 1,
    logInfo: "",
    sid: "",
    ssid: 0,
    tid: 9999
}

baselog.sendLog({...targs}, ubcId, callback, url);
```

### 其他

ubc：https://console.cloud.baidu-int.com/devops/icode/repos/baidu/jady/ubc-report-sdk/tree/master