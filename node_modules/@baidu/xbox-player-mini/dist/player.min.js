/**
 * @baidu/xbox-player v1.0.7
 * global xbox.player 
 * Created at 2022-01-13 14:49:39
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).XPlayer={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=u(e);if(t){var r=u(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return c(this,i)}}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"_";i(this,e),this._events={},this._eventsCount=0,this.prefix=t.slice(0,1)}return r(e,[{key:"on",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("function"!=typeof t)throw new TypeError("The listener must be a function");var r={fn:t,context:i||this,once:n},a=this.prefix?this.prefix+e:e;return this._events[a]||(this._events[a]=[],this._eventsCount++),this._events[a].push(r),this}},{key:"once",value:function(e,t,i){return this.on(e,t,i,!0)}},{key:"emit",value:function(e){var t=this.prefix?this.prefix+e:e;if(!this._events[t])return!1;for(var i=(this._events[t]||[]).slice(),n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(var o=0,s=i.length;o<s;o++){i[o].once&&this.off(e,i[o].fn,void 0,!0);try{i[o].fn.apply(i[o].context,r)}catch(t){console.log("emit "+e+" event error! please check it: ",t)}}return!0}},{key:"clearEvent",value:function(e){0==--this._eventsCount?this._events={}:delete this._events[e]}},{key:"off",value:function(e,t,i,n){var r=this.prefix?this.prefix+e:e;if(this._events[r]&&this._events[r].length)if(t){for(var a=this._events[r],o=[],s=0,l=a.length;s<l;s++)(a[s].fn!==t||n&&!a[s].once||i&&a[s].context!==i)&&o.push(a[s]);o.length?this._events[r]=o:this.clearEvent(r)}else this.clearEvent(r);return this}},{key:"removeAllListeners",value:function(){return this._events={},this._eventsCount=0,this}}]),e}(),f=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){if("na"===this.api.getMode())return!!this.api.getPlayerOption("autoplay");var e=this.api.getVideoInstance();return e?e.autoplay:""}},{key:"set",value:function(e){if("na"!==this.api.getMode()){var t=this.api.getVideoInstance();t&&(t.autoplay=e),this.api.setPlayerOption("autoplay",e)}else this.api.getPlayerController("playerKernelInit")||this.api.setPlayerOption("autoplay",e)}}]),e}(),y=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){if("na"===this.api.getMode())return this.api.getPlayerOption("muted");var e=this.api.getVideoInstance();return e?e.muted:""}},{key:"set",value:function(e){var t=this.api.getBoxTools(),i=t.isIOS,n=t.isAndroid,r=t.invokeP,a=this.api.getPlayerOption("containerId"),o=this.api.getVideoInstance();"na"!==this.api.getMode()?(o&&(o.muted=e),this.api.setPlayerOption("muted",e)):i()?r("video/slrSetMuted",{params:{containerId:a,muted:+e}}):n()&&(o.zeusVideoExt=JSON.stringify({id:a,name:"h5samelayer",action:"setMute",data:{muted:+e}}))}}]),e}(),v=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"run",value:function(){if("na"===this.api.getMode())return this.naRun();this.h5Run()}},{key:"h5Run",value:function(){var e=this.api.getVideoInstance();return e&&e.play()}},{key:"naRun",value:function(){var e=this,t=this.api.getBoxTools(),i=t.isIOS,n=t.isAndroid,r=t.invokeP;if(i()){var a=this.api.getPlayerOption("containerId"),o=this.api.getPlayerInstance().paused;r("video/slrPlayPlayer",{params:{containerId:a}}).then((function(){o&&e.api.getPlayerController("playerKernelInit")&&(e.api.emit("play"),e.api.setPlayerOption("paused",!1),e.api.emit("playing"))}))}else n()&&this.h5Run()}}]),e}(),g=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){if("na"===this.api.getMode())return this.api.getPlayerOption("volume");var e=this.api.getVideoInstance();return e?e.volume:""}},{key:"set",value:function(e){var t=this,i=this.api.getBoxTools(),n=i.isIOS,r=i.invokeP,a=this.api.getPlayerOption("containerId");if("na"===this.api.getMode()&&n())r("video/slrSetSystemVolume",{params:{containerId:a,volume:e}}).then((function(){return t.api.setPlayerOption("volume",e)}));else{var o=this.api.getVideoInstance();o&&(o.volume=e)}}}]),e}(),m=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("duration");var t=this.api.getVideoInstance();return t?t.duration:""}}]),e}(),P=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("error");var t=this.api.getVideoInstance();return t?t.error:""}}]),e}(),O=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("playbackRate");var t=this.api.getVideoInstance();return t?t.playbackRate:""}},{key:"set",value:function(e){var t=this,i=this.api.getBoxTools(),n=i.isIOS,r=i.invokeP;if("na"===this.api.getMode()&&n()){r("video/slrPlaybackRate",{params:{containerId:this.api.getPlayerOption("containerId"),playbackRate:e}}).then((function(e){return!t.api.getPlayerController("playerKernelInit")&&t.api.setPlayerOption("playbackRate",e.playbackRate)}))}else{var a=this.api.getVideoInstance();a&&(a.playbackRate=e),this.api.setPlayerOption("playbackRate",e)}}}]),e}(),k=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("src");var t=this.api.getVideoInstance();return t?t.src:""}}]),e}(),b=function(e){return{wrap:e,inner:e+1}},I=function(){function e(t,n){var r=this;i(this,e),this.api=t,this.pluginOptions=n,this.perf={},this.perflog={},this.isEmitPerf=!1,this.api.on("reset",(function(e){return r.reset(e)})),this.api.on("destroy",(function(){return r.destroy()}))}return r(e,[{key:"run",value:function(e,t){if(!this.api.getVideoInstance()&&this.api.getRoot()){var i=this.api.getPlayerOption();this.perf.createStart=+new Date,this.perf.clk=i.prepareInvokePlayerTime||this.perf.createStart;var n=this.api.getBoxTools(),r=n.isMainBox,a=n.version,o=n.versionCompare,s=n.isIOS,l=n.isAndroid;this.isIOS=s(),this.isAndroid=l();var u=this.api.getBoxTools().getRandomName;if(this.cid=u("h5-samelayer-cid-")||this.cid,this.api.setPlayerOption("containerId",this.cid),i.customizedVideo&&this.api.setPlayerController("slrOnly",!0),!t&&r()&&(this.isIOS&&o(a,"12.9")>=0||this.isAndroid&&o(a,"12.10")>=0)){if(this.isIOS)return this.iosMaxQueryCnt=e||5,this.iosCreateVideo();if(this.isAndroid)return this.androidCreateVideo(i.pageUrl)}this.h5Run()}}},{key:"destroy",value:function(){var e=this.api.getBoxTools().invokeP,t=this.api.getVideoInstance(),i=this.api.getPlayerController();if("na"===this.api.getMode()){if(window.removeEventListener("pagehide",i.pagehideHandler),window.removeEventListener("pageshow",i.pageshowHandler),this.isIOS){var n=i.eventCallback;return window[n]=function(){},e("video/slrStopPlayer",{params:{containerId:this.cid}}),document.removeEventListener(i.visibilityChange,i.visibilityHandler),void this.removeDom()}if(this.isAndroid){var r=i.operationjscallback;window[r]=function(){},e("v5/datachannel/unregister",{action:"com.baidu.videoplayer.operationresult",jscallback:r})}}Object.keys(i.videoEventHandler).forEach((function(e){return t.removeEventListener(e,i.videoEventHandler[e])})),Object.keys(i.docEventHandler).forEach((function(e){return document.removeEventListener(e,i.docEventHandler[e])})),t.src="",this.removeDom()}},{key:"removeDom",value:function(){var e=this.api.getVideoInstance();e&&e.parentNode&&e.parentNode.removeChild(e),this.api.setVideoInstance(null)}},{key:"iosCreateVideo",value:function(){var e=this.api.getRoot(),t=this.getContainerBox(e),i=this.api.getPlayerOption();this.width=i.width||t.width,this.height=i.height||t.height;var n=b(this.height),r=n.wrap,a=n.inner,o=document.createElement("div");o.className=this.cid,o.style="width:"+this.width+"px;height:"+r+"px;overflow: scroll; -webkit-overflow-scrolling: touch; background-color: transparent;";var s=document.createElement("div");s.style="width: 100%; height:"+a+"px",i.precreate&&o.setAttribute("data-precreatevideoinfo",JSON.stringify({videoUrl:i.src,vid:i.vid,playerControlType:i.playerControlType||0})),o.appendChild(s),e.appendChild(o),this.times=0,this.isScrollViewFound=!1,this.isRenderComplete=!1,this.api.setVideoInstance(o);var l=i.position||this.getContainerBox(o);this.api.setPlayerOption("",{width:this.width,height:this.height,position:l}),this.perf.queryStart=+new Date,this.iosQuery(l)}},{key:"getContainerBox",value:function(e){var t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY,width:Math.round(t.width),height:Math.round(t.height)}}},{key:"iosQuery",value:function(e){var t=this,i=this.api.getBoxTools().invokeP;if(++this.times>this.iosMaxQueryCnt&&(!this.isScrollViewFound||!this.isRenderComplete))return this.perflog.queryfail=+new Date-this.perf.queryStart,this.h5Run();i("video/slrIsFoundContainerView",{params:{containerId:this.cid,position:e,scrollHeight:b(e.height).inner}}).then((function(i){return i.isSupportSameLR?(t.perflog.model=i.detailMsg||null,i.isScrollViewFound&&(t.isScrollViewFound=!0,i.isRenderComplete)?(t.isRenderComplete=!0,t.perflog.count=t.times,t.perflog.querysuc=+new Date-t.perf.queryStart,t.times=999,t.iosInvokePlayer()):void t.iosQuery(e)):t.h5Run()})).catch((function(e){t.perflog.queryfail=+new Date-t.perf.queryStart,t.h5Run()}))}},{key:"iosInvokePlayer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video/slrInvokePlayer",i=this.cid,n=this.api.getBoxTools(),r=n.invokeP,a=n.getGlobalFunc,o=this.api.getPlayerController("eventCallback")||a((function(t,i){return e.iosPlayerEventDispatch(t,i)}));this.api.setPlayerController("eventCallback",o);var s=this.api.getPlayerOption(),u=s.fullScreenType||"windowFullScreen",p=!s.hasOwnProperty("isIgnoreDeviceOrientation")||!!s.isIgnoreDeviceOrientation,c={containerId:i,eventCallback:o,videoinfo:l(l({},s),{},{vid:s.vid,videoUrl:s.src,posterImage:s.poster,muted:+s.muted,loop:+s.loop,syncPlayerPosition:1,fullScreenType:u,isIgnoreDeviceOrientation:+p,ext_log:l({prepareInvokePlayerTime:this.perf.clk},s.ext||{})})},h=this.api.getPlayerInstance();r(t,{params:c}).then((function(){e.api.setMode("na"),e.perflog.create=+new Date-e.perf.createStart,e.api.emit("ready",{mode:"na",isIOS:e.isIOS,isAndroid:e.isAndroid});var t=e.api.getPlayerController(),i=t.fromCache,n=t.hidePlaying;(i&&n||!i&&s.autoplay)&&(e.isEmitPerf=!0,h.play(),e.api.setPlayerController("fromCache",!1),e.api.setPlayerController("hidePlaying",!1))})).catch((function(t){e.h5Run()})),this.iosUpdatePlayerStatus(),s.hasOwnProperty("volume")?h.volume=s.volume:r("video/slrGetSystemVolume",{params:{containerId:this.cid}}).then((function(t){return e.api.setPlayerOption("volume",t.volume)})),this.api.setPlayerOption("",{ended:!1,paused:!1,fullscreen:!1,currentTime:0,duration:0,readyState:0,networkState:0,fullScreenType:u,isIgnoreDeviceOrientation:p,timeInterval:s.timeInterval||1,accurate:s.accurate||!1});var d=this.api.getPlayerController("fullscreenEvt")||function(e){e.stopPropagation(),e.preventDefault()};this.api.setPlayerController("fullscreenEvt",d),this.iosVideoVisible()}},{key:"iosVideoVisible",value:function(){var e=this;if(!this.api.getPlayerController("visibilityHandler")){var t="",i="";if(void 0!==document.visibilityState?(t="visibilityState",i="visibilitychange"):void 0!==document.webkitVisibilityState&&(t="webkitVisibilityState",i="webkitvisibilitychange"),i){var n=function(){var i=e.api.getPlayerInstance();i&&("visible"===document[t]?e.api.getPlayerController("hideNeedResume")&&(i.reset({src:i.src}),i.play(),e.api.setPlayerController("hideNeedResume",!1)):!e.api.getPlayerController("playerKernelInit")||i.ended||i.paused||(i.pause(),e.api.setPlayerController("hideNeedResume",!0)))};this.api.setPlayerController("visibilityChange",i),this.api.setPlayerController("visibilityHandler",n),document.addEventListener(i,n,!1),this.naBackRecovery()}else console.log("browser donot supports the Page Visibility API.")}}},{key:"naBackRecovery",value:function(){var e=this;if(!this.api.getPlayerController("pagehideHandler")){var t=function(t){if(t.persisted){var i=e.api.getPlayerInstance();e.isIOS?setTimeout((function(){e.api.setPlayerController("fromCache",!0),e.perf.clk=+new Date,e.perf.createStart=e.perf.clk,e.iosCreateVideo()}),10):e.api.getPlayerController("hidePlaying")&&(i.play(),e.api.getPlayerController("hidePlaying",!1))}};window.addEventListener("pageshow",t),this.api.setPlayerController("pageshowHandler",t);var i=function(){e.isIOS&&(e.removeDom(),e.perf={});var t=e.api.getPlayerInstance(),i=e.api.getPlayerController("playerKernelInit")&&!t.ended&&!t.paused;e.api.setPlayerController("hidePlaying",i)};window.addEventListener("pagehide",i),this.api.setPlayerController("pagehideHandler",i)}}},{key:"iosUpdatePlayerStatus",value:function(){var e=this;(0,this.api.getBoxTools().invokeP)("video/slrGetPlayerStatus",{params:{containerId:this.cid,gather:["muted","duration","rate","loop"]}}).then((function(t){return e.api.setPlayerOption("",{muted:!!t.muted,duration:t.duration||0,playbackRate:t.rate,loop:!!t.loop})}))}},{key:"iosPlayerEventDispatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&t.containerId===this.cid)switch(delete t.containerId,e){case"slrPlayerStateChanged":this.iosPlayerStatusDispatch(t);break;case"slrLoadingViewStatusChanged":this.api.setPlayerOption("networkState",2),this.api.emit("loadingchange",t.loadingShow);break;case"slrMuteChanged":this.api.setPlayerOption("",{muted:!!t.muted,volume:t.volume}),this.api.emit("mutedchange",!!t.muted);break;case"slrSystemVolumeChanged":this.api.setPlayerOption("volume",t.volume),this.api.emit("volumechange",t.volume);break;case"slrPlayerProgressChanged":this.api.setPlayerOption("",{currentTime:t.currentTime,duration:t.duration}),this.api.emit("timeupdate",t.currentTime);break;case"slrRateChanged":this.api.setPlayerOption("playbackRate",t.newRate),this.api.emit("ratechange",t.newRate)}}},{key:"iosPlayerStatusDispatch",value:function(e){var t="";switch(e.event){case"onStartPrepare":t="prepare",this.api.setPlayerOption("",{ended:!1,readyState:1});break;case"onPrepared":t="canplay",this.api.setPlayerOption("readyState",4);break;case"onPlaySuccess":this.api.setPlayerController("playerKernelInit",!0),this.perflog.clk2play=+new Date-this.perf.clk,this.iosUpdatePlayerStatus(),this.isEmitPerf&&this.emitPerfEvent();case"onReplay":this.api.setPlayerOption("ended",!1);case"onResumePlay":this.api.emit("play"),this.api.setPlayerOption("paused",!1),t="playing";break;case"onPaused":t="pause",this.api.setPlayerOption("paused",!0);break;case"onFinished":t="ended",this.api.setPlayerOption("ended",!0);break;case"onClosed":t="closed";break;case"onError":t="error",this.api.setPlayerOption("error",e)}t&&this.api.emit(t)}},{key:"androidCreateVideo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.api.setMode("na"),this.androidNaEvent().then((function(){e.createVideoTag({"t7-video-player-type":"h5samelayer","t7-video-player-ext":t}),e.androidInitPlayer()})),this.naBackRecovery()}},{key:"androidInitPlayer",value:function(){var e=this,t=this.api.getVideoInstance(),i=this.api.getPlayerOption(),n={};["from","page","value"].forEach((function(e){i.hasOwnProperty(e)&&(n[e]=i[e])}));var r=["mpd","clarityUrl"].concat(i.passThrough||[]),a={videoUrl:i.src};r.forEach((function(e){i[e]&&(a[e]=i[e])})),a.mpd&&a.clarityUrl&&delete a.clarityUrl,t.zeusVideoExt=JSON.stringify({id:this.cid,name:"h5samelayer",action:"init",data:{vid:i.vid,ignore4gToast:+!!i.ignore4gToast,syncProgress:+!!i.needReadLocalProgress,getSysVolume:+(!i.hasOwnProperty("volume")||i.muted),videoInfo:a,samelrLog:l(l({},n),{},{extLog:l({prepareInvokePlayerTime:this.perf.clk},i.ext||{})})}});var o=this.api.getPlayerInstance();t.addEventListener("loadedmetadata",(function n(){e.perflog.create=+new Date-e.perf.createStart,i.hasOwnProperty("volume")&&(o.volume=i.volume),!i.useAutoVolume&&(o.muted=!!i.muted),i.hasOwnProperty("seekSeconds")&&(o.currentTime=i.seekSeconds),t.removeEventListener("loadedmetadata",n)})),this.api.emit("ready",{mode:"na",isIOS:this.isIOS,isAndroid:this.isAndroid})}},{key:"androidNaEvent",value:function(){var e=this,t=this.api.getBoxTools(),i=t.invokeP,n=(0,t.getGlobalFunc)((function(t,i){if("com.baidu.videoplayer.operationresult"===t&&e.api.getVideoInstance()){try{i=JSON.parse(i)}catch(e){}if(0===i.status){e.api.getPlayerOption("containerId");var n=e.api.getVideoInstance(),r=e.api.getPlayerInstance();switch(i.action){case"init":break;case"volumeChanged":if(r.volume===i.data.volume&&!e.api.getPlayerOption("useAutoVolume"))return;if(e.api.setPlayerOption("volume",i.data.volume),n.volume!==i.data.volume&&(r.volume=i.data.volume),e.api.emit("volumechange",i.data.volume),!e.api.getPlayerController("playerKernelInit"))return;0!==i.data.volume||r.muted||(r.muted=!0),i.data.volume>0&&r.muted&&(r.muted=!1);break;case"setMute":r.muted!==!!i.data.muted&&(e.api.setPlayerOption("muted",!!i.data.muted),e.api.emit("mutedchange",!!i.data.muted));break;case"getSysVolume":var a=1==+i.data.volume?+i.data.volume:+i.data.volume.toFixed(3);e.api.setPlayerOption("volume",a)}}}}));return this.api.setPlayerController("operationjscallback",n),i("v5/datachannel/register",{action:"com.baidu.videoplayer.operationresult",jscallback:n})}},{key:"videoEventDispatch",value:function(){var e=this,t=this.api.getVideoInstance(),i="h5"===this.api.getMode(),n=["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","waiting","webkitendfullscreen"];i&&n.push("volumechange");var r={};n.forEach((function(n){r[n]=function(r){var a=e.api.getPlayerController("playerKernelInit");i||a||"canplay"!==n||!e.api.getPlayerOption("autoplay")||(e.isEmitPerf=!0,t.play()),a||"play"!==n||(e.api.setPlayerController("playerKernelInit",!0),e.perflog.clk2play=+new Date-e.perf.clk,e.isEmitPerf&&e.emitPerfEvent()),e.api.emit(n,r)},t.addEventListener(n,r[n])})),this.api.setPlayerController("videoEventHandler",r);var a={};["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"].forEach((function(i){a[i]=function(){var i=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i&&i===t?(e.api.setPlayerOption("fullscreen",!0),e.api.emit("enterfullscreen")):e.api.getPlayerOption("fullscreen")&&(e.api.setPlayerOption("fullscreen",!1),e.api.emit("exitfullscreen"))},document.addEventListener(i,a[i])})),this.api.setPlayerController("docEventHandler",a)}},{key:"createVideoTag",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.api.getRoot(),i=this.api.getPlayerOption(),n=document.createElement("video"),r=i.width?i.width+"px":"100%",a=i.height?i.height+"px":"100%";n.style="width:"+r+"; height: "+a+";"+(2===i.videoGravity?"object-fit: cover;":""),Object.keys(e).forEach((function(t){return n.setAttribute(t,e[t])})),t.appendChild(n);var o=["controls","loop","mediaGroup","playbackRate","preload","src","poster","volume"];return"h5"===this.api.getMode()&&(o=o.concat(["muted","autoplay"])),Object.keys(i).filter((function(e){return o.indexOf(e)>-1})).forEach((function(e){try{n[e]=i[e]}catch(e){}})),this.api.setPlayerOption("containerId",this.cid),this.api.setVideoInstance(n),this.videoEventDispatch(),n}},{key:"emitPerfEvent",value:function(){var e=this.perf,t=e.clk,i=e.queryStart,n=e.createStart;this.perflog.clk2create=n-t,i&&(this.perflog.clk2query=i-t),this.api.emit("perf",this.perflog),this.perflog={},this.isEmitPerf=!1}},{key:"resetRect",value:function(e,t){var i=this.api.getBoxTools(),n=i.isIOS,r=i.invokeP,a=this.api.getVideoInstance(),o=this.api.getPlayerOption(),s=o.containerId,l=o.videoGravity;if("na"===this.api.getMode()&&n()){var u=b(t),p=u.wrap,c=u.inner,h=a.firstChild;a.style.width=e+"px",a.style.height=p+"px",h.style.height=c+"px",r("video/slrUpdatePlayerInfo",{params:{containerId:s,position:{left:0,top:0,width:e,height:t}}})}else{var d=e?e+"px":"100%",f=t?t+"px":"100%";a.style="width:"+d+"; height: "+f+";"+(2===l?"object-fit: cover;":"")}}},{key:"reset",value:function(e){var t=this.api.getVideoInstance();if(t){var i=this.api.getPlayerOption(),n=this.api.getMode();if((e.width||e.height)&&(this.resetRect(i.width,i.height),e.width&&delete e.width,e.height&&delete e.height),!(0===Object.keys(e).length||"h5"===n&&this.api.getPlayerController("slrOnly"))){if(this.perf.createStart=+new Date,this.perf.clk=e.prepareInvokePlayerTime||this.perf.createStart,this.api.setPlayerController("playerKernelInit",!1),"na"===n&&this.isIOS)return this.perf.queryStart=this.perf.createStart,void this.iosInvokePlayer("video/slrSetPlayerInfo");var r=["controls","loop","mediaGroup","playbackRate","preload","src","poster","volume"];"h5"===n&&(r=r.concat(["muted","autoplay"])),Object.keys(i).filter((function(e){return r.indexOf(e)>-1})).forEach((function(e){try{t[e]=i[e]}catch(e){}})),"h5"!==n?this.isAndroid&&(t.setAttribute("t7-video-player-ext",i.pageUrl||""),this.androidInitPlayer()):this.api.emit("ready",{mode:"h5",isIOS:this.isIOS,isAndroid:this.isAndroid})}}}},{key:"h5Run",value:function(){if(this.api.setMode("h5"),this.removeDom(),this.api.getPlayerController("slrOnly"))return this.api.emit("ready",{mode:"h5",isIOS:this.isIOS,isAndroid:this.isAndroid}),void this.emitPerfEvent();this.isEmitPerf=!!this.api.getPlayerOption("autoplay"),this.createVideoTag({playsinline:!0,"webkit-playsinline":!0}),this.api.emit("ready",{mode:"h5",isIOS:this.isIOS,isAndroid:this.isAndroid})}}]),e}(),w=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("ended");var t=this.api.getVideoInstance();return t?t.ended:""}}]),e}(),S=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"run",value:function(){if("na"===this.api.getMode())return this.naRun();this.h5Run()}},{key:"h5Run",value:function(){var e=this.api.getVideoInstance();return e&&"function"==typeof e.pause&&e.pause()}},{key:"naRun",value:function(){var e=this.api.getBoxTools(),t=e.isIOS,i=e.isAndroid,n=e.invokeP;t()?n("video/slrPausePlayer",{params:{containerId:this.api.getPlayerOption("containerId")}}):i()&&this.h5Run()}}]),e}(),C=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("currentTime");var t=this.api.getVideoInstance();return t?t.currentTime:""}},{key:"set",value:function(e){var t=this.api.getBoxTools(),i=t.isIOS,n=t.invokeP;if("na"===this.api.getMode()&&i()){var r=this.api.getPlayerOption();n("video/slrSeekPlayer",{params:{containerId:r.containerId,seconds:e,accurate:r.accurate}})}else{var a=this.api.getVideoInstance();a&&(a.currentTime=e)}}}]),e}(),_=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("loop");var t=this.api.getVideoInstance();return t?t.loop:""}},{key:"set",value:function(e){var t=this,i=this.api.getBoxTools(),n=i.isIOS,r=i.invokeP;if("na"===this.api.getMode()&&n()){r("video/slrSetLoop",{params:{containerId:this.api.getPlayerOption("containerId"),loop:+e}}).then((function(){return t.api.setPlayerOption("loop",e)}))}else{var a=this.api.getVideoInstance();a&&(a.loop=e),this.api.setPlayerOption("loop",e)}}}]),e}(),x=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("paused");var t=this.api.getVideoInstance();return t?t.paused:""}}]),e}(),E=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("poster");var t=this.api.getVideoInstance();return t?t.poster:""}}]),e}(),V=function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("readyState");var t=this.api.getVideoInstance();return t?t.readyState:""}}]),e}(),R={autoplay:f,paused:x,currentTime:C,duration:m,ended:w,loop:_,muted:y,networkState:function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"get",value:function(){var e=this.api.getBoxTools().isIOS;if("na"===this.api.getMode()&&e())return this.api.getPlayerOption("networkState");var t=this.api.getVideoInstance();return t?t.networkState:""}}]),e}(),playbackRate:O,readyState:V,src:k,poster:E,volume:g,error:P,create:I,play:v,replay:function(){function e(t,n){i(this,e),this.api=t,this.pluginOptions=n}return r(e,[{key:"run",value:function(){if("na"===this.api.getMode())return this.naRun();this.h5Run()}},{key:"naRun",value:function(){var e=this.api.getBoxTools(),t=e.isIOS,i=e.invokeP,n=this.api.getPlayerOption("containerId");t()&&i("video/slrReplayPlayer",{params:{containerId:n}}),this.h5Run()}},{key:"h5Run",value:function(){var e=this.api.getVideoInstance();e&&(e.currentTime=0,(e.paused||e.ended)&&e.play())}}]),e}(),pause:S},T="object"===("undefined"==typeof window?"undefined":t(window))&&window.self===window?navigator.userAgent:"",j=function(){return/(iPhone|iPod|iPad)/.test(T)},M=function(){return/(Android);?[\s\/]+([\d.]+)?/.test(T)},B=function(){return/ (baiduboxapp|biduboxapp)\//i.test(T)&&!/ (lite|info|pro|mission) (baiduboxapp|biduboxapp)/.test(T)},D=function(e){var t=document.createElement("iframe"),i=document.body||document.getElementsByTagName("body")[0];t.style.display="none",t.src=e,i.appendChild(t),setTimeout((function(){i.removeChild(t),t=null}),0)},A=function(e){var t=window.Bdbox_android_jsbridge;if(!t||!t.dispatch)return window.prompt("BdboxApp:"+JSON.stringify({obj:"Bdbox_android_jsbridge",func:"dispatch",args:[e]}));t.dispatch(e)},L=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},N=0,F=function(e){return N++,e+(Date.now().toString(16)+N).slice(-8)},H="object"===("undefined"==typeof window?"undefined":t(window))?window:global,U=function(e){if("function"==typeof e){var t="_xfunc_".concat(F("_xfunc_"));return H[t]=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e.apply(H,i)},t}return e},q=function(e){if("string"===L(e))return e;var t={};for(var i in e){var n=e[i];"function"===L(n)&&(n=U(n)),t[i]=n}return encodeURIComponent(JSON.stringify(t))},K=function(e){var t=[];for(var i in e){var n=e[i];"function"===L(n)&&(n=U(n)),t.push(i+"="+n)}return t.join("&")};function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"baiduboxapp";return B()?new Promise((function(n,r){var a=t.params||{};0===Object.keys(a).length&&a.constructor===Object||"%7B%7D"===a||"{}"===a?delete t.params:"object"===L(a)&&(t.params=q(a));var o=l(l({},t),{},{callback:function(e){var t=e;if("string"===L(e))try{t=JSON.parse(e)}catch(e){console.log(e)}0!=+t.status?r(t):n(t.data)}}),s=K(o),u="".concat(i,"://").concat(e,"?").concat(s);j()?D(u):M()&&A(u)})):Promise.reject({status:902,message:"主版APP外无法调用端能力"})}var J=function(e,t){t+="";for(var i=(e+="").split("."),n=t.split("."),r=0,a=Math.max(i.length,n.length);r<a;r++){if(i[r]&&!n[r]&&parseInt(i[r],10)>0||parseInt(i[r],10)>parseInt(n[r],10))return 1;if(n[r]&&!i[r]&&parseInt(n[r],10)>0||parseInt(i[r],10)<parseInt(n[r],10))return-1}return 0},z=function(){var e,i="0";if("object"===("undefined"==typeof window?"undefined":t(window))&&window.baiduboxapp_version)return window.baiduboxapp_version;B()&&((e=/baiduboxapp\/([\d.]+)/.exec(T))?i=e[1]:(e=/([\d+.]+)_(?:diordna|enohpi)_/.exec(T))&&(i=(e=e[1].split(".")).reverse().join(".")));return i}(),Q=function(){function e(t,n){i(this,e),this._player=n,this.id=t}return r(e,[{key:"getPlayerInstance",value:function(){return this._player}},{key:"getVideoInstance",value:function(){return this._player.video}},{key:"setVideoInstance",value:function(e){this._player.video=e}},{key:"getRoot",value:function(){return this._player._root}},{key:"getMode",value:function(){return this._player._mode}},{key:"setMode",value:function(e){this._player._mode=e}},{key:"getPlayerOption",value:function(e){return e?this._player.options[e]:this._player.options}},{key:"setPlayerOption",value:function(e,t){e?this._player.options[e]=t:"object"===L(t)&&o(this._player.options,t)}},{key:"getPlayerController",value:function(e){return e?this._player._controller[e]:this._player._controller}},{key:"setPlayerController",value:function(e,t){this._player._controller[e]=t}},{key:"getBoxTools",value:function(){return{isIOS:j,isAndroid:M,isMainBox:B,iosInvoke:D,androidInvoke:A,getGlobalFunc:U,getRandomName:F,invokeP:G,versionCompare:J,version:z}}},{key:"on",value:function(e,t){this._player.on(e,t)}},{key:"once",value:function(e,t){this._player.once(e,t)}},{key:"emit",value:function(e,t){this._player.emit(e,t)}},{key:"off",value:function(e,t){this._player.off(e,t)}}]),e}(),X=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(n,e);var t=h(n);function n(e){var r;if(i(this,n),!e||"object"!==L(e)||0===Object.keys(e).length||!e.id)throw new Error("player config error");return(r=t.call(this))._defaultInit=!e.customizedInit,r.options={autoplay:!1,muted:!1,loop:!1},r.reset(e),r._controller={},r._mode=e.mode||"h5",e.plugins&&r.registryPlugins(e.plugins),r._root=document.getElementById(e.id),r.video=null,r._plugins=R||{},r._inited=!1,r._defaultInit&&r.init(),r}return r(n,[{key:"reset",value:function(e){var t=this;Object.keys(e).forEach((function(i){"pluginOptions"!==i&&(t.options[i]=e[i])})),this.pluginOptions=e.pluginOptions||this.pluginOptions||{},this._inited&&this.emit("reset",e)}},{key:"_validate",value:function(e){return 0!==e.indexOf("_")&&(-1===["on","once","emit","off","init","destroy","reset","registryPlugin","registryPlugins","isSupportCode"].indexOf(e)||this[e])}},{key:"registryPlugin",value:function(e,t){if(this._validate(e)){if(this._inited)return this._loadPlugin(e,t);this._plugins||(this._plugins={}),this._plugins[e]=t}}},{key:"registryPlugins",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"h5";this._mode=i,Object.keys(t).forEach((function(i){return e.registryPlugin(i,t[i])}))}},{key:"_loadPlugin",value:function(e,t){var i=new t(new Q(e,this),this.pluginOptions[e]);this._defineProp(e,i)}},{key:"_defineProp",value:function(e,t){var i={};"function"===L(t.get)?(i.get=t.get.bind(t),"function"===L(t.set)&&(i.set=t.set.bind(t))):"function"===L(t.run)&&(i={get:function(){return t.run.bind(t)}}),Object.defineProperty(this,e,i)}},{key:"init",value:function(){var e=this;this._inited||(this._inited=!0,Object.keys(this._plugins).forEach((function(t){var i=e._plugins[t];e._loadPlugin(t,i)})),this.emit("init"))}},{key:"destroy",value:function(){this._root&&(this.emit("destroy"),this.removeAllListeners(),this._root=null)}}]),n}(d),Y=function(e){if(B()&&J(z,"12.6")>=0){var t=j()?"video/slrPrefetchVideo":M()?"videoplayer/slrPrefetchVideo":"";t&&G(t,{params:{prefetchInfo:e}})}};e.default=X,e.prefetch=Y,Object.defineProperty(e,"__esModule",{value:!0})}));
