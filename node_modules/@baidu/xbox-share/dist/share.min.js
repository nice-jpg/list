/**
 * @baidu/xbox-share v1.0.8
 * global xbox.share 
 * Created at 2022-03-03 18:55:36
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(((e=e||self).xbox=e.xbox||{},e.xbox.share={}))}(this,(function(e){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}var c="object"===("undefined"==typeof window?"undefined":n(window))&&window.self===window?navigator.userAgent:"",a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;"main"===e&&(e="");var t=/ (baiduboxapp|biduboxapp)\//i;if(!1===t.test(n))return!1;var o=n.match(t),r=o[1];return!!~n.indexOf("".concat(e," ").concat(r))},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;"main"===e&&(e="");var t=/\bbdapp\/\d+\.\d+\s+\((\w+);\s*(\w+)\)/;if(""===e){var o=/\s(lite|pro|info|mission)\sbaiduboxapp\//.exec(n);if(o)return!0;if(/\bbdapp\/\d+\.\d+\s/.test(n))return!0}else if(!1===e){var r=n.match(t);if(r&&r[1])return!0}else{if(new RegExp(new RegExp("\\s".concat(e,"\\sbaiduboxapp/"))).test(n))return!0;var i=n.match(t);if(i&&i[1]&&i[1]===e)return!0}return!1},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;return/micromessenger\//i.test(e)},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;return/QQ\//.test(e)},f=0,p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return f++,(Date.now().toString(16)+f).slice(-1*e)},d=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()};function h(e,n){return d(e)===n.toLowerCase()}function g(e){return null==e}function b(e){return!!h(e,"Object")&&(null===Object.getPrototypeOf(e)||Object===e.constructor)}function w(e){return h(e,"Function")}function v(e){return h(e,"String")}function m(e){return h(e,"Array")}var x="object"===("undefined"==typeof window?"undefined":n(window))?window:global,y=function(e){if("function"==typeof e){var n="_xfunc_".concat(p());return x[n]=function(){for(var n=arguments.length,t=new Array(n),o=0;o<n;o++)t[o]=arguments[o];return e.apply(x,t)},n}return e},j=encodeURIComponent,S=function(e){return j(e).replace(/[!'()*]/g,(function(e){return"%".concat(e.charCodeAt(0).toString(16).toUpperCase())}))};function k(e){return e.map((function(e){switch(d(e)){case"string":return e;case"function":return y(e);default:return e}}))}var O=function(){};function _(e){return h(e,"function")}function C(e){var t=e.url,o=e.before,r=e.success,i=e.error,c=e.timeout,a=void 0===c?2e4:c,s=e.async,u=e.data,l=e.jsonpCallback,f=e.jsonpCallbackName;"object"===n(u)&&(u=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(v(e))return e;var t=[];for(var o in e){var r=e[o];m(r)?r=JSON.stringify(k(r)):g(r)?r="":b(r)?r=JSON.stringify(r):w(r)&&(r=y(r)),t.push("".concat(o,"=").concat(n?S(r):r))}return t.join("&")}(u)),u&&(t+=(-1===t.indexOf("?")?"?":"&")+u),t=t.replace(/[&?]{1,2}/,"?");var d,h=(_(l)?l():l)||"_boxjsonp"+p(),x=window[h];window[h]=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];d=n},f?t+="&"+f+"="+h:/=\?/.test(t)&&(t=t.replace(/=\?/,"="+h)),function e(n,t,o){var r,i,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=document,s=n.replace(/^(css|img)!/,""),u=!1,l=o.async,f=void 0===l||l,p=o.maxTries,d=void 0===p?1:p,h=o.timeout,g=void 0===h?2e4:h,b=o.before,w=void 0===b?null:b,v=w;"function"!=typeof v&&(v=O),/(^css!|\.css$)/.test(n)?(u=!0,(r=a.createElement("link")).rel="stylesheet",r.href=s):/(^img!|\.(png|gif|jpg|svg)$)/.test(n)?(r=a.createElement("img")).src=s:((r=a.createElement("script")).src=n,r.async=!!f);var m=function(a){var s;if(clearTimeout(i),s=a instanceof Error?"e":a.type[0],u&&"hideFocus"in r)try{r.sheet.cssText.length||(s="e")}catch(e){s="e"}if("e"===s&&(c+=1)<d)return e(n,t,o,c);r.onload=r.onerror=r.onbeforeload=null,r=null,t("e"===s?a||"error":null,n)};if(r.onload=r.onerror=m,!1!==v(n,r)){var x=a.head||a.getElementsByTagName("script")[0];x.appendChild(r),g>0&&(i=setTimeout((function(){m(new Error("timeout"))}),g))}}(t,(function(e,n){e?i(e,n):r(d&&d[0]),window[h]=x,d&&_(x)&&x(d[0]),x=d=void 0}),{timeout:a,async:s,before:o})}var D=document,I="https:"!==location.protocol?"http:":"https:",U=W("//res.wx.qq.com/open/js/jweixin-1.4.0.js"),q=W("//qzonestyle.gtimg.cn/qzone/qzact/common/share/share.js"),E=W("//po.baidu.com/api/wechat/token.jsonp"),T=function(){},A=location.href,M=W("//mbd.baidu.com/tcbox"),P="https://b.bdstatic.com/searchbox/icms/searchbox/img/po/act/newuserredpack/box_logo.png",Q={url:E,method:"jsonp",optionObj:{},promiseFunc:null};function W(e){return 0===e.indexOf("//")?"".concat(I).concat(e):e}var N=function(e){return encodeURIComponent(e)};function F(e,n){var t,o=D.getElementsByTagName("img"),r=o.length;for(r=r<=10?r:10,t=0;t<r;t++)!function(n){var t=D.createElement("img");t.onload=function(){t.width>290&&t.height>290&&e(n),t=null},t.src=n}(o[t].src);setTimeout((function(){e(n)}),1e3)}function z(e,n){if(!(Math.random()<=.95&&A.indexOf("share_config_random=1")<0)&&e&&n){n=N(n);var t,o,r="".concat(M,"?service=bdbox&action=pblog&data=")+(t={appid:1,dataid:2,cateid:26,actionid:2,actiontype:"0",actiondata:{type:0,timestamp:Date.now(),content:{from:"xbox",page_id:"300_001",logtype:3,type:"c_"+e,msg:n}}},o=!0,h(t,"string")||(t=JSON.stringify(t)),o&&(t=N(t)),t),i=new Image;i.onload=i.onerror=i.onabort=function(){i=null},i.src=r}}function L(e){return h(e,"string")?e:e&&1===e.nodeType?e.innerText.replace(/\n/gim,"").replace(/^\s+/,"").replace(/\s+$/,""):""}function J(){for(var e="_shareConfigFN_"+p(),n=arguments.length,t=new Array(n),o=0;o<n;o++)t[o]=arguments[o];var r=t.find((function(n){return h(n,"function")?(window[e]=n,!0):(h(n,"string")&&h(window[n],"function")&&(e=n),!1)}));return r||(e="_shareConfigEmptyFn_",window[e]=T),e}var R=function(){function e(){var n=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{debug:!1,channel:"",title:D.title,titleDefault:D.title||"百度App",linkUrl:A,content:"",contentDefault:"百度App",iconUrl:"",iconUrlDefault:P,bdbox:{},wx:{appId:"wxadc1a0c6b9096e89",jsApiList:[]},customWeixinjs:U,customQzonejs:q,getSignatureInterface:Q,success:T,error:T},r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;t(this,e),this.log=B(o.debug),this._wxCache={},this.useWeixinCache=o.useWeixinCache||!0;var c=L(o.content)||L(o.contentDefault);o.content=c.length<=50?c:c.slice(0,50)+"...",o.title=o.title?o.title:o.titleDefault,o.wx&&(!o.wx.appId||o.wx.appId.length<10)&&(o.wx.appId="wxadc1a0c6b9096e89"),this.options=o,this.successCallback=J(r,o.success),this.errorCallback=J(i,o.error);var f=!1;o.iconUrl||F((function(e){f||(f=!0,n.options.iconUrl=e)}),o.iconUrlDefault),u()?window.wx?this.weixin():C({url:this.options.customWeixinjs||U,success:function(){n.weixin()},error:function(){z("load_wxsdk_err",A)}}):l()?window.setShareInfo?this.qq():C({url:this.options.customQzonejs||q,success:function(){n.qq()},error:function(){z("load_qqsdk_err",A)}}):(a()||s())&&this.box()}var c,f,p;return c=e,(f=[{key:"qq",value:function(){l()&&!window.setShareInfo&&this.log("QQ SDK 未加载完成");var e=this.options,n=e.wx,t=void 0===n?{}:n,o=e.title,r=e.content,i=e.linkUrl,c=e.iconUrl,a=t.appId;this._getWeixinSignature(a,(function(e){window.setShareInfo({title:o,summary:r,pic:c,url:i,WXconfig:{swapTitleInWX:!1,appId:a,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature}})}))}},{key:"weixin",value:function(){var e=this;u()&&!window.wx&&this.log("微信 SDK 未加载完成");var n=this.options,t=n.title,o=n.content,r=n.linkUrl,i=n.iconUrl,c=n.wx,a=c.appId,s=c.jsApiList,l=void 0===s?[]:s;l=l.concat(["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"]);var f=window[this.successCallback],p=window[this.errorCallback];this._getWeixinSignature(a,(function(n){wx.config({debug:!!e.options.debug,jsApiList:l,appId:a,nonceStr:n.nonceStr,timestamp:n.timestamp,signature:n.signature});var c={title:t,desc:o,link:r,imgUrl:i,success:f,cancel:p};wx.ready((function(){wx.onMenuShareTimeline(c),wx.onMenuShareAppMessage(c),wx.onMenuShareQQ(c),wx.onMenuShareWeibo(c),wx.onMenuShareQZone(c)}))}))}},{key:"_getWeixinSignature",value:function(e,n){var t=this._wxCache[e];t&&t.signature&&t.nonceStr&&Date.now()-t._now<12e5&&n(t);var o=this;if(e){var c=function(t){var r=t.errno,i=t.data,c=void 0===i?{}:i,a=t.errmsg;if(0!=+r||!c.signature)return z("wx_gettoken_err",A),void o.log("获取签名的接口错误："+a);n(c),c._now=Date.now(),o._wxCache[e]=c},a=o.options.getSignatureInterface||Q,s=a.url,u=a.method,l=a.optionObj,f=void 0===l?{}:l,p=a.promiseFunc;p&&"function"==typeof p?p().then((function(e){c(e)})):"GET"===u?fetch(s,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({method:u},f)).then((function(e){return e.json()})).then((function(e){c(e)})):C({url:E,data:{app_id:e,url:N(A),callback:"?",ts:Date.now()},success:function(e){var n=e.errno,t=e.data,o=void 0===t?{}:t,r=e.errmsg;c({errno:n,data:o,errmsg:r})}})}else o.log("appId is empty")}},{key:"box",value:function(){var e=this.options,n=e.linkUrl,t=e.bdbox.source;if(!t)return z("no_bdbox_source",A),void this.log("使用手百分享必须配置 source 参数");var o={type:"url",mediaType:"all",linkUrl:n,source:t};for(var r in e)"bdbox"!==r&&(o[r]=e[r]);window.BoxShareData={options:o,successcallback:this.successCallback,errorcallback:this.errorCallback}}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"===n(e)){for(var t in e)this.options[t]=e[t];e.success&&(this.successCallback=J(e.success)),e.error&&(this.errorCallback=J(e.error)),u()?this.weixin():a()||s()?this.box():l()&&this.qq()}}}])&&o(c.prototype,f),p&&o(c,p),e}();function B(e){return"alert"===e?alert:!1===e?T:h(e,"function")?e:function(e){console.log("%c[share]","color:red;background:yellow",e)}}e.ShareConfig=R,e.default=function(e,n,t){return new R(e,n,t)},Object.defineProperty(e,"__esModule",{value:!0})}));
