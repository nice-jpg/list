module.exports = function () {
  var $ = require('boxjs/dist/utils/_bdboxWrapper');
  /* eslint-disable */

  /**
   * 登录；
   * @memberOf Bdbox.client
   * @name login
   *
   */


  var getVersion = require('../utils/getVersion');

  var version_compare = require('../utils/version_compare');

  var A_NAMESPACE = 'Bdbox_android_account';

  var ios_invokeApp = require('../ios/invokeApp');

  var android_invokeApp = require('../android/invokeApp');

  var self = function (options) {
    var defalutOpt = {
      callback: '',
      url: location.href,
      tpl: '',
      login_type: '',
      third_login: '0'
      /* 第三方登录6.5新增，支持1，不支持0 */

    };
    var attr;

    for (attr in defalutOpt) {
      if (!options.hasOwnProperty(attr)) {
        options[attr] = defalutOpt[attr];
      }
    }
    /* 5.5版本支持js调起native登录 */


    if ($.isBox && version_compare(getVersion(), '5.5') >= 0 || $.$isLiteBox()) {
      if ($.$isIOS()) {
        options.func = options.callback;
        delete options.callback;
        options = JSON.stringify(options);
        ios_invokeApp('account', {
          'action': 'logindialog',
          'params': encodeURIComponent(options),
          'minver': '5.5.0.0'
        });
      } else {
        android_invokeApp(A_NAMESPACE, 'loginDialog', [JSON.stringify(options), options.callback]);
      }
    } else {
      /* 5.5以下版本跳转至baidu passport web页登录 不支持回调 */

      /* 添加支持短信登录 */
      var passurl = 'http://wappass.baidu.com/?adapter=1&regLink=1';

      if (options.login_type === 'sms') {
        passurl += '&sms=1';
      }

      if (options.subpro) {
        passurl += '&subpro=' + options.subpro;
      }

      if (options.tpl != '') {
        passurl += '&tpl=' + options.tpl;
      }

      window.location.href = passurl + '&u=' + encodeURIComponent(options.url);
    }
  };

  return self;
}();