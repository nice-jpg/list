module.exports = function () {
  var $ = require('boxjs/dist/utils/_bdboxWrapper');
  /**
   * ios打开schema协议，封装了callback方法
   * @memberOf Bdbox.ios
   * @function
   * @name open
   * @param  {String} url schema协议，比如`baiduboxappv5://openxxx?abc=fff`
   * @param  {Function} callback 回调函数，接收一个参数isTimeout
   * @example
   * Bdbox.ios.open('baiduboxapp://', function(isTimeout) {
   *   if (isTimeout) {
   *       console.log('通过isTimeout是true，判断没有安装');
   *   } else {
   *       console.log('成功');
   *   }
   * });
   * @version $Id: openMap.js 260791 2015-08-18 06:42:13Z wangyongqing01 $
   */


  function openIos(url, callback) {
    if (!url) {
      $.isFunction(callback) && callback(false);
      return;
    } // 记录起始时间


    var last = Date.now(); // 创建一个iframe

    var ifr = document.createElement('IFRAME');
    ifr.src = url;
    ifr.style.display = 'none'; // 飘出屏幕外

    ifr.style.position = 'absolute';
    ifr.style.left = '-2000px';
    ifr.style.top = '-1000px';
    ifr.style.width = '1px';
    ifr.style.height = '1px'; // 设置一个4秒的动画用于检查客户端是否被调起

    ifr.style.webkitTransition = 'all 1s';
    ifr.style.transition = 'all 1s';
    document.body.appendChild(ifr);
    setTimeout(function () {
      var end = function () {
        document.body.removeChild(ifr);

        if (Date.now() - last < 1500) {
          // 如果动画执行时间在预设范围内，就认为没有调起客户端
          callback(true);
        } else {
          // 动画执行超过预设范围，认为调起成功
          callback(false);
        }
      }; // 监听动画完成时间


      ifr.addEventListener('webkitTransitionEnd', end, false);
      ifr.addEventListener('transitionEnd', end, false); // 启动动画

      ifr.style.left = '-10px';
    }, 0);
  }

  return openIos;
}();